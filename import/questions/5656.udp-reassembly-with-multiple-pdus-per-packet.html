<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>UDP reassembly with multiple PDUs per packet - Wireshark Q&amp;A</title>
        <meta name="description" content="I am writing a dissector for a UDP protocol with the following (rather unfortunate) features:  A single PDU may (and in most cases does) span multiple packets. A single header may also span multiple packets A packet may also contain multiple PDUs, both complete and fragmented The length of a PDU is ..." />
        <meta name="keywords" content="reassembly,udp,dissector,pdu,fragmentation" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/5656/udp-reassembly-with-multiple-pdus-per-packet" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='5NQ7B6OsUAXqeVASZ5irBvG4sTuPLDEA' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet">UDP reassembly with multiple PDUs per packet</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-5656-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/5656/up/" rel="nofollow"> </a>
<div id="post-5656-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-5656-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/5656/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/5656/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I am writing a dissector for a UDP protocol with the following (rather unfortunate) features:</p>
<ul>
<li>A single PDU may (and in most cases does) span multiple packets.</li>
<li>A single header may also span multiple packets</li>
<li>A packet may also contain multiple PDUs, both complete and fragmented</li>
<li>The length of a PDU is determined by a header field, but an unknown number of bytes must be read before getting to that value, as the header is preceded by a variable length delimiter</li>
<li>There are no sequence numbers or other ways of uniquely identifying a PDU</li>
<li>There is no flag indicating whether a PDU will be fragmented, or whether multiple PDUs will appear in a packet, other than by reading the length</li>
<li>All communications are between a single sender and receiver</li>
</ul>
<p>In practice, this means that some assembly must be done before it is even possible to determine how much assembly will be needed to complete a PDU.</p>
<p>I have approached this by using the various tools in reassemble.h.  However, I am getting stuck in a few places, and am looking for suggestions.</p>
<p>My dissector essentially looks like this (pseudocode):</p>
<pre><code>dissect_proto(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree) {
    while [bytes remain in tvb from offset]
        if [pdu length is unknown]
            found = fragment_get(pinfo, 0, fragment_table);
            if [fragment was found]
                [loop through found-&gt;next and add total_length and data]
                buffer = tvb_new_real_data(data, total_length, total_length);
            else
                buffer = tvb_new_subset(tvb, offset, ...);

            bytes_available = tvb_length(buffer);
            pdu_length = get_pdu_length(buffer, &amp;pdu_offset);
            if [pdu length is known and is smaller than bytes remaining]
                complete = TRUE;
            /* bytes_to_consume is min(pdu_length, bytes_available) */
            pinfo-&gt;fragmented = !complete;
            head = fragment_add(tvb, offset, pinfo, 0, fragment_table,
                    offset, bytes_to_consume, !complete);
            next_tvb = process_reassembled_data(tvb, offset, pinfo, "Reassembled packet", head, &amp;proto_frag_items, NULL, tree);
            offset += bytes_to_consume;
</code></pre>
<p>Mostly, I am hung up on how to add fragments properly.  I would like to be able to read part of a packet, add any portion of that from a fragmented PDU into the table, and continue looping through.  As I read more PDUs out of that packet, I add fragments, marked complete, for those into the table.  The last PDU would likely be incomplete, and added as well.</p>
<p>It appears that the fragment table is expecting a single add operation per packet.  Is there a correct way to keep track of fragments when there may be multiple per packet?</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/reassembly/" class="post-tag tag-link-reassembly"
                                        title="see questions tagged 'reassembly'" rel="tag">reassembly</a>
                                
                                    <a href="/tags/udp/" class="post-tag tag-link-udp"
                                        title="see questions tagged 'udp'" rel="tag">udp</a>
                                
                                    <a href="/tags/dissector/" class="post-tag tag-link-dissector"
                                        title="see questions tagged 'dissector'" rel="tag">dissector</a>
                                
                                    <a href="/tags/pdu/" class="post-tag tag-link-pdu"
                                        title="see questions tagged 'pdu'" rel="tag">pdu</a>
                                
                                    <a href="/tags/fragmentation/" class="post-tag tag-link-fragmentation"
                                        title="see questions tagged 'fragmentation'" rel="tag">fragmentation</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>11 Aug '11, 12:27</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d84e8965aabf69774c0bf979cf8e55e6?s=32&amp;d=identicon&amp;r=g" alt="sweetpea's gravatar image" />
    <p><a href="/users/1449/sweetpea">sweetpea</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">&#9679;</span><span class="badgecount">3</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="sweetpea has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-5656">
    
</div>
<div id="comment-tools-5656" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-5656-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="5671"></a>
                    <div id="answer-container-5671" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-5671-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/5671/up/" rel="nofollow"> </a>
<div id="post-5671-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-5671-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/5671/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>From the looks of it your protocol is screwed up. UDP is an unreliable datagram protocol, hence does not guarantee delivery, nor sequence. Once an inconsistency occurs your dissector (and any receiver for that matter) will get out of sync.</p>
<p>Maybe the RTP dissector can be of help, it also runs over UDP, and contains reassembly code. Although I think it has the benefit of sequence numbers.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/5671/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>12 Aug '11, 01:38</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" alt="Jaap's gravatar image" />
    <p><a href="/users/4/jaap">Jaap ♦</a><br/>
    <span class="score" title="11680 reputation points"><span class="">11.7k</span></span><span title="16 badges"><span class="silver">&#9679;</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">&#9679;</span><span class="badgecount">101</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jaap has 155 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-5671">
    
        <a name="5707"></a>
        <div class="comment" id="comment-5707">
            <div id="post-5707-score" class="comment-score"></div>
            <div class="comment-text"><p>The protocol is screwed up.  Sadly, that doesn't eliminate the need to dissect and troubleshoot it.  The main consolation is that PDUs are generally fairly small, so any dropped or out-of-sequence packets will only affect a small part of the stream.</p>

<p>The RTP dissector seems to depend on conversations and sequence numbers, but it does offer some hints.  Setting the partial reassembly flag is one step I was missing.  I'm still stumped on multiple PDUs, though.</p></div>
            <div class="comment-info" id="comment-5707-info">
                
                
                
                

                

                <span class="comment-age">(15 Aug '11, 15:29)</span>
                <a class="comment-user userinfo" href="/users/1449/sweetpea">sweetpea</a>
                
            </div>
        </div>
    
        <a name="5709"></a>
        <div class="comment" id="comment-5709">
            <div id="post-5709-score" class="comment-score"></div>
            <div class="comment-text"><p>On the first pass through the capture, you'll see the packets in the sequence they're in inside the capture file, which is the closest approximation you'll get to the time order.  Reassemble them assuming they're in the right order; if they're not, what you reassemble will be what any receiver who got them in the same order would see - if that's bogus, then what the receiver reassembles will be bogus to, so Wireshark will show you that bogosity.  (I.e., given the brokenness of the protocol, the brokenness of reassembly will show you the results of the brokenness of the protocol.)</p></div>
            <div class="comment-info" id="comment-5709-info">
                
                
                
                

                

                <span class="comment-age">(16 Aug '11, 02:56)</span>
                <a class="comment-user userinfo" href="/users/79/guy-harris">Guy Harris ♦♦</a>
                
            </div>
        </div>
    
        <a name="5727"></a>
        <div class="comment" id="comment-5727">
            <div id="post-5727-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes.  I know I can't do better than the sequence coming into wireshark.  Originally, I implemented all of the reassembly myself, which worked on the first pass, but not on random access when looking at actual frames in wireshark.  I can understand how to parse and display PDUs based on that first pass; what's tricky is finding the correct way to store the information so that it works in random access.</p></div>
            <div class="comment-info" id="comment-5727-info">
                
                
                
                

                

                <span class="comment-age">(17 Aug '11, 15:42)</span>
                <a class="comment-user userinfo" href="/users/1449/sweetpea">sweetpea</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-5671" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-5671-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="5710"></a>
                    <div id="answer-container-5710" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-5710-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/5710/up/" rel="nofollow"> </a>
<div id="post-5710-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-5710-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/5710/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>OK, so let's look at the protocol's (mis-)features:</p>
<ul>
<li>A single PDU may (and in most cases does) span multiple packets.</li>
</ul>
<p>That means you need to have some way of knowing when the PDU ends, i.e. when you're done with reassembly.</p>
<ul>
<li>A single header may also span multiple packets</li>
</ul>
<p>That means you need to have some way of knowing when the header ends.</p>
<ul>
<li>A packet may also contain multiple PDUs, both complete and fragmented</li>
</ul>
<p>Again, you need to know when the PDU ends, even if the entire PDU is within one UDP datagram.</p>
<ul>
<li>The length of a PDU is determined by a header field, but an unknown number of bytes must be read before getting to that value, as the header is preceded by a variable length delimiter</li>
</ul>
<p>OK, that presumably means the length tells you when the PDU ends.  If the delimiter is variable-length, there has to be some way of knowing when the <em>delimiter</em> ends; what is that?</p>
<ul>
<li>There are no sequence numbers or other ways of uniquely identifying a PDU</li>
</ul>
<p>Which, as Jaap noted, means that the receiver has to assume that the packets are delivered in order, and, if they're not, it won't work correctly, so, if Wireshark doesn't reassemble the packets "correctly" in that case, it's actually correct in the sense that it'll show you what a receiver that got the UDP packets in the same order will <em>think</em> it got, even if that's not what the sender <em>intended</em> it to see.</p>
<ul>
<li>There is no flag indicating whether a PDU will be fragmented, or whether multiple PDUs will appear in a packet, other than by reading the length</li>
</ul>
<p>That's similar to many protocols running atop TCP, so that's not <em>inherently</em> insoluble.  You might have to implement something similar to <code>tcp_dissect_pdus()</code> in your dissector.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/5710/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>16 Aug '11, 03:03</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" alt="Guy%20Harris's gravatar image" />
    <p><a href="/users/79/guy-harris">Guy Harris ♦♦</a><br/>
    <span class="score" title="17443 reputation points"><span class="">17.4k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">&#9679;</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">&#9679;</span><span class="badgecount">196</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Guy Harris has 216 accepted answers">19&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/5710/">
                edited
                <strong>17 Aug '11, 16:10</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-5710">
    
        <a name="5711"></a>
        <div class="comment" id="comment-5711">
            <div id="post-5711-score" class="comment-score"></div>
            <div class="comment-text"><p>Whether or not the dissector will show PDU reassembly problems experienced by the receiver also depends on where the capture is made. At the sender side all may seem nice and dandy, while at the receiver things may not be...</p></div>
            <div class="comment-info" id="comment-5711-info">
                
                
                
                

                

                <span class="comment-age">(16 Aug '11, 05:02)</span>
                <a class="comment-user userinfo" href="/users/4/jaap">Jaap ♦</a>
                
            </div>
        </div>
    
        <a name="5728"></a>
        <div class="comment" id="comment-5728">
            <div id="post-5728-score" class="comment-score"></div>
            <div class="comment-text"><p>For the moment, I'm ignoring packet loss and sequence problems.</p></div>
            <div class="comment-info" id="comment-5728-info">
                
                
                
                

                

                <span class="comment-age">(17 Aug '11, 15:54)</span>
                <a class="comment-user userinfo" href="/users/1449/sweetpea">sweetpea</a>
                
            </div>
        </div>
    
        <a name="5729"></a>
        <div class="comment" id="comment-5729">
            <div id="post-5729-score" class="comment-score"></div>
            <div class="comment-text"><p>The delimiter looks like MSG:xxxxx[newline], where xxxxx is 1-5 characters.  Following is a 2-byte PDU type, and 2 byte PDU length, then the data, then a 2-byte checksum.</p>

<p>Packets often come in a pattern like this:</p>

<pre><code>Packet 1: MSG:xxxxx[newline]
Packet 2: [type][len]
Packet 3: [data][checksum]MSG:xxxxx[newline][type][len][data][checksum]MSG:xxxxx[newline]
Packet 4: [type][len]
Packet 5: [data][checksum]
Packet 6: MSG:xxxxx[newline]
</code></pre>

<p>...</p></div>
            <div class="comment-info" id="comment-5729-info">
                
                
                
                

                

                <span class="comment-age">(17 Aug '11, 15:57)</span>
                <a class="comment-user userinfo" href="/users/1449/sweetpea">sweetpea</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-5710" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-5710-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/5656/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='5NQ7B6OsUAXqeVASZ5irBvG4sTuPLDEA' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/5656/udp-reassembly-with-multiple-pdus-per-packet?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/dissector/"
            class="tag-link-dissector"
            title="see questions tagged'dissector'using tags"
            rel="tag">dissector</a> <span class="tag-number">&#215;637</span><br/>
        
        <a href="/tags/udp/"
            class="tag-link-udp"
            title="see questions tagged'udp'using tags"
            rel="tag">udp</a> <span class="tag-number">&#215;166</span><br/>
        
        <a href="/tags/reassembly/"
            class="tag-link-reassembly"
            title="see questions tagged'reassembly'using tags"
            rel="tag">reassembly</a> <span class="tag-number">&#215;78</span><br/>
        
        <a href="/tags/fragmentation/"
            class="tag-link-fragmentation"
            title="see questions tagged'fragmentation'using tags"
            rel="tag">fragmentation</a> <span class="tag-number">&#215;30</span><br/>
        
        <a href="/tags/pdu/"
            class="tag-link-pdu"
            title="see questions tagged'pdu'using tags"
            rel="tag">pdu</a> <span class="tag-number">&#215;18</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Aug. 11, 2011, 12:27 p.m.">11 Aug '11, 12:27</strong>
    </p>
    <p> 
     	question was seen: <strong>8,258 times</strong>
    </p>
    <p> 
        last updated: <strong title="Aug. 17, 2011, 4:10 p.m.">17 Aug '11, 16:10</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/22782/dissecting-stream">Dissecting stream</a>
        </p>
        
        <p>
            <a href="/questions/61912/handling-missing-fragments-while-reassembling">Handling missing fragments while reassembling</a>
        </p>
        
        <p>
            <a href="/questions/61954/my-dissector-is-processing-the-first-packet-multiple-times">My dissector is processing the first packet multiple times.</a>
        </p>
        
        <p>
            <a href="/questions/39824/fragmentation-not-successful">fragmentation not successful</a>
        </p>
        
        <p>
            <a href="/questions/59151/how-to-reassemble-custom-protocols-with-lua">How to reassemble custom protocols with Lua?</a>
        </p>
        
        <p>
            <a href="/questions/1357/lua-tcp-reassembly">Lua TCP reassembly</a>
        </p>
        
        <p>
            <a href="/questions/40023/how-can-i-dump-fragmented-packets-to-multiple-files">How can I dump fragmented packets to multiple files?</a>
        </p>
        
        <p>
            <a href="/questions/63866/fragment-overlap-true-via-udp">Fragment Overlap: True , Via UDP</a>
        </p>
        
        <p>
            <a href="/questions/20001/reassembling-tcp-fragments-doesnt-reassemble-some-packets">Reassembling TCP fragments doesn&#39;t reassemble some packets</a>
        </p>
        
        <p>
            <a href="/questions/37566/wireshark-dissector-development-reassembly-tcp-frames">Wireshark dissector development - Reassembly tcp frames</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
