<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Decrypt Secure Web Socket traffic not working - Wireshark Q&amp;A</title>
        <meta name="description" content="Hello, I&#39;m trying to decrypt WSS (websocket secure) traffic in in Wireshark, but for some reason I cannot make it work. Here are the steps I followed:  Collect all WSS traffic towards my server with tcpdump (i.e. $ sudo tcpdump -i any -w capture.pcap) Made sure that the negotiated cipher between cli..." />
        <meta name="keywords" content="ssl,websocket,decryption,wireshark" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/62441/decrypt-secure-web-socket-traffic-not-working" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='AidpM83AEalRS9EHWZ0oqKoSnJkCz8j9' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/62441/decrypt-secure-web-socket-traffic-not-working">Decrypt Secure Web Socket traffic not working</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-62441-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/62441/up/" rel="nofollow"> </a>
<div id="post-62441-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-62441-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/62441/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/62441/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hello,</p>
<p>I'm trying to decrypt WSS (websocket secure) traffic in in Wireshark, but for some reason I cannot make it work. Here are the steps I followed:</p>
<ul>
<li>Collect all WSS traffic towards my server with tcpdump (i.e. $ sudo tcpdump -i any -w capture.pcap)</li>
<li>Made sure that the negotiated cipher between client and server is NOT Diffie-Hellman so that it is decryptable using RSA key in wireshark</li>
<li>Open capture.pcap in wireshark and go to Preferences &gt; Protocols &gt; SSL &gt; RSA keys list &gt; Add and add: any, 5083, tcp, server.key. Where: 5083 is the server port for WSS, and server.key is the private key of the server in .pem format (notice that I have tested that this .pem is correct and works with wireshark by testing it with regular TLS traffic, where decryption works fine)</li>
<li>For some reason even after previous step the traffic still shows up decrypted.</li>
<li>I introduced an SSL debug file from Preferences &gt; Protocols &gt; SSL &gt; SSL debug file to figure out what is going on under the hood and the private key seems successfully loaded (based on the first lines of the log). I then checked for a specific frame that shows up as TLSv1.2 Application Data and which I would expect to be decrypted. But I see this issue: 'decrypt_ssl3_record: no decoder available'. </li>
</ul>
<p>Any idea why that is?</p>
<p>Thanks a lot in advance,
Antonis Tsakiridis</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/ssl/" class="post-tag tag-link-ssl"
                                        title="see questions tagged 'ssl'" rel="tag">ssl</a>
                                
                                    <a href="/tags/websocket/" class="post-tag tag-link-websocket"
                                        title="see questions tagged 'websocket'" rel="tag">websocket</a>
                                
                                    <a href="/tags/decryption/" class="post-tag tag-link-decryption"
                                        title="see questions tagged 'decryption'" rel="tag">decryption</a>
                                
                                    <a href="/tags/wireshark/" class="post-tag tag-link-wireshark"
                                        title="see questions tagged 'wireshark'" rel="tag">wireshark</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>30 Jun '17, 05:53</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d239d5cab74caaa43a594772e4724687?s=32&amp;d=identicon&amp;r=g" alt="atsakiridis's gravatar image" />
    <p><a href="/users/37517/atsakiridis">atsakiridis</a><br/>
    <span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">&#9679;</span><span class="badgecount">4</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="atsakiridis has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-62441">
    
        <a name="62445"></a>
        <div class="comment" id="comment-62445">
            <div id="post-62445-score" class="comment-score"></div>
            <div class="comment-text"><p>What Wireshark version is in use? Latest stable is 2.2.7. Are you sure that the private key matches the one in the certificate? In the debug file you should see a match between the pubkey from the Certificate handshake message and the pubkey from the private key (if you use Wireshark &gt;= 2.0).</p></div>
            <div class="comment-info" id="comment-62445-info">
                
                
                
                

                

                <span class="comment-age">(30 Jun '17, 06:42)</span>
                <a class="comment-user userinfo" href="/users/5644/lekensteyn">Lekensteyn</a>
                
            </div>
        </div>
    
        <a name="62490"></a>
        <div class="comment" id="comment-62490">
            <div id="post-62490-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for the prompt reply Lekensteyn. So let me try to answer your questions: a. Used 2.2.3, but updated to 2.2.7 to make sure it's not an issue with previous version. The problem is that the issue still occurs :(. b. I did some more digging after you mentioned pubkey in the debug file and I realized that there is no Certificate in the ServerHello in the .pcap! Is this somehow legit? I then checked the SSL debug file more information and I saw only this:</p>

<p><code>
dissect_ssl enter frame #346 (first time)
packet_from_server: is from server - TRUE
  conversation = 0x116b9fbb0, ssl_session = 0x116ba0fd0
  record: offset = 0, reported_length_remaining = 86
ssl_try_set_version found version 0x0303 -&gt; state 0x91
dissect_ssl3_record: content_type 22 Handshake
Calculating hash with offset 5 81
decrypt_ssl3_record: app_data len 81, ssl state 0x91
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
dissect_ssl3_handshake iteration 1 type 2 offset 5 length 77 bytes, remaining 86
ssl_try_set_version found version 0x0303 -&gt; state 0x91
ssl_dissect_hnd_hello_common found SERVER RANDOM -&gt; state 0x93
ssl_dissect_hnd_srv_hello found CIPHER 0x002F TLS_RSA_WITH_AES_128_CBC_SHA -&gt; state 0x97
</code></p>

<p>Any hints?</p></div>
            <div class="comment-info" id="comment-62490-info">
                
                
                
                

                

                <span class="comment-age">(04 Jul '17, 06:03)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62491"></a>
        <div class="comment" id="comment-62491">
            <div id="post-62491-score" class="comment-score"></div>
            <div class="comment-text"><p>Also, here's another, successful scenario where I use plain TLS (i.e. not WSS). The ServerHello has a Certificate and this is how it look in SSL debug (notice the additional fields on the bottom):</p>

<p><code>
dissect_ssl enter frame #320 (first time)
packet_from_server: is from server - TRUE
  conversation = 0x12166b840, ssl_session = 0x12166c420
  record: offset = 0, reported_length_remaining = 821
ssl_try_set_version found version 0x0301 -&gt; state 0x91
dissect_ssl3_record: content_type 22 Handshake
Calculating hash with offset 5 816
decrypt_ssl3_record: app_data len 816, ssl state 0x91
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
dissect_ssl3_handshake iteration 1 type 2 offset 5 length 77 bytes, remaining 821
ssl_try_set_version found version 0x0301 -&gt; state 0x91
ssl_dissect_hnd_hello_common found SERVER RANDOM -&gt; state 0x93
ssl_dissect_hnd_srv_hello found CIPHER 0x002F TLS_RSA_WITH_AES_128_CBC_SHA -&gt; state 0x97
dissect_ssl3_handshake iteration 0 type 11 offset 86 length 727 bytes, remaining 821
lookup(KeyID)[20]:
| ea 6b 53 25 49 89 f8 29 a7 11 fd 9f 2f 97 88 6a |.kS%I..)..../..j|
| fd 8f 24 5b                                     |..$[            |
ssl_find_private_key_by_pubkey: lookup result: 0x7fc814867400
dissect_ssl3_handshake iteration 0 type 14 offset 817 length 0 bytes, remaining 821
</code></p></div>
            <div class="comment-info" id="comment-62491-info">
                
                
                
                

                

                <span class="comment-age">(04 Jul '17, 06:03)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62494"></a>
        <div class="comment" id="comment-62494">
            <div id="post-62494-score" class="comment-score"></div>
            <div class="comment-text"><p>One totally irrelevant hint is to use &lt; code &gt; &lt; /code &gt; markers around your log output so that it shows up in a readable format.</p></div>
            <div class="comment-info" id="comment-62494-info">
                
                
                
                

                

                <span class="comment-age">(04 Jul '17, 07:58)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="62495"></a>
        <div class="comment" id="comment-62495">
            <div id="post-62495-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks a lot grahamb for fixing this! I'm new to this forum, so will keep it in mind from now on</p></div>
            <div class="comment-info" id="comment-62495-info">
                
                
                
                

                

                <span class="comment-age">(04 Jul '17, 08:09)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62496"></a>
        <div class="comment not_top_scorer" id="comment-62496">
            <div id="post-62496-score" class="comment-score"></div>
            <div class="comment-text"><p>Any chance of a capture along with the key so others can test?</p></div>
            <div class="comment-info" id="comment-62496-info">
                
                
                
                

                

                <span class="comment-age">(04 Jul '17, 08:12)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="62519"></a>
        <div class="comment not_top_scorer" id="comment-62519">
            <div id="post-62519-score" class="comment-score"></div>
            <div class="comment-text"><p>Hello, sure, I'm sharing a link from my google drive that points to wireshark-wss.zip which contains: 1. wss.pcap which is the actual capture file, notice that WSS traffic is towards/from port 5083, 2. server.key which is the WSS server private key (it's a just a test key), 3. ssl-debug-wss.log which is the wireshark SSL debug file that I told you about. Here it is: <a href="https://drive.google.com/file/d/0BwfD74mG87iMQ3MxblNvOTA0Nm8/view?usp=sharing">https://drive.google.com/file/d/0BwfD74mG87iMQ3MxblNvOTA0Nm8/view?usp=sharing</a></p>

<p>As an example you can check frame #49, which is the ServerHello that doesn't include a Certificate section at all</p>

<p>Any hints on what  might be wrong?</p>

<p>In case you 're interested, this is the RSA keys list file contents: </p>

<p>"any","5083","tcp","/Users/antonis/Documents/server.key",""</p>

<p>Best regards and thanks in advance,
Antonis</p></div>
            <div class="comment-info" id="comment-62519-info">
                
                
                
                

                

                <span class="comment-age">(05 Jul '17, 07:03)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-62441" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-62441-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="62527"></a>
                    <div id="answer-container-62527" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-62527-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/62527/up/" rel="nofollow"> </a>
<div id="post-62527-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-62527-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/62527/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="atsakiridis has selected this answer as the correct answer"
        href="/accept_answer/62527/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>I think you're out of luck. The TLS connection is using TLS session resumption as the Client Hello provides a Session ID which the server echo's back indicating that the server has retained state for that particular Session ID so no server certificate is required.  As the capture does not include the original TLS session that created that Session ID Wireshark (currently) fails to decrypt the session.</p>
<p>You capture also seems to contain a lot of duplicate messages which I eliminated using <code>editcap -d wss.pcap wss2.pcap</code></p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/62527/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>05 Jul '17, 08:27</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" alt="grahamb's gravatar image" />
    <p><a href="/users/1225/grahamb">grahamb ♦</a><br/>
    <span class="score" title="19834 reputation points"><span class="">19.8k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">&#9679;</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">&#9679;</span><span class="badgecount">206</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="grahamb has 274 accepted answers">22&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-62527">
    
        <a name="62559"></a>
        <div class="comment" id="comment-62559">
            <div id="post-62559-score" class="comment-score"></div>
            <div class="comment-text"><p>You 're right; seems that the browser even after refresh sometimes remembers previous session IDs and reuses them, which explains why Cert wasn't sent by server in ServerHello and wireshark couldn't correlate. I verified by using Firefox (instead of Chrome) and a private tab and indeed first WSS connection has full negotiation, and in that case indeed decryption for WSS worked like a charm! I had another error in the RSA keys list configuration, where I used 'tcp' instead of 'http', but after I fixed that all was good :)</p>

<p>The only issue I'd like to improve now is the presentation where I have the following issues. I'm working on an open source communications platform, and we 're dealing a lot with SIP. In fact the WSS traffic I'm investigating contains SIP flows. </p>

<p>So I'd like instead of getting the generic Websocket presentation in the packet list as can be seen here: <a href="https://drive.google.com/file/d/0BwfD74mG87iMcWNmTFQ0RTk1bDA/view,">https://drive.google.com/file/d/0BwfD74mG87iMcWNmTFQ0RTk1bDA/view,</a> to see that its a SIP message and its type (i.e. REGISTER) like this: <a href="https://drive.google.com/file/d/0BwfD74mG87iMTDRRbGxVbHE5RUE/view">https://drive.google.com/file/d/0BwfD74mG87iMTDRRbGxVbHE5RUE/view</a> (taken from non WSS session where SIP is directly on top of TCP and hence is presented nicely).</p>

<p>Do you think that is possible with the current state of Wireshark, with some additional configuration? If not I could try to contribute it, with some help from you guys. I think it will prove pretty useful for a lot of folks out there, as WS is pretty much used everywhere nowadays for signaling in communication systems (and with WebRTC boom it's even more widespread). Notice that the same issue exists when working with non encrypted WS. It's still not parsed as SIP and it's harder to do troubleshooting</p>

<p>Finally thanks for the pointer on editcap. Actually I had tried it on another pcap on my Mac but I got:</p>

<p><code>
$ editcap -d wholeff.pcap wholeff-no-dups.pcap
editcap: Error writing to wholeff-no-dups.pcap: Internal error
</code></p>

<p>So I didn't try again. Maybe because I'm collecting using tcpdump and Ctrl-C to stop? Could it be that a packet is cut in half and it messes up the parsing</p>

<p>Thanks a lot for your quick responses and help. I know first hand that keeping up with community requests can be hard.</p></div>
            <div class="comment-info" id="comment-62559-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 03:17)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62560"></a>
        <div class="comment" id="comment-62560">
            <div id="post-62560-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="https://ask.wireshark.org/users/1225/grahamb">@grahamb</a>, I just posted a comment here and then edited it again to make a small change but got an error in the lines of:
'Akismet thinks your comment is spam' and I lost it! Can you guys check where that comment went and try to repost it -it was huge and will take me forever to rewrite :(</p></div>
            <div class="comment-info" id="comment-62560-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 03:21)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62562"></a>
        <div class="comment" id="comment-62562">
            <div id="post-62562-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Maybe because I'm collecting using tcpdump and Ctrl-C to stop? Could it be that a packet is cut in half and it messes up the parsing</p>
</blockquote>

<p>Nope. Ctrl-C stops tcpdump gracefully, the last packet is written in full. "Cut in the middle" packets happen when you copy the output file before stopping tcpdump as the file write buffering ignores packet borders.</p>

<p>To double-check you can export just a few packets from the beginning of the capture and try editcap on the exported file.</p></div>
            <div class="comment-info" id="comment-62562-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 03:31)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="62563"></a>
        <div class="comment" id="comment-62563">
            <div id="post-62563-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="https://ask.wireshark.org/users/37517/atsakiridis">@atsakiridis</a> If there is a <code>Sec-WebSocket-Protocol: sip</code> header, it should be automatically picked up by Wireshark 2.4. In older versions or other cases, one method to force dissection of Websockets data as SIP is by means of the <code>websocket.text_type:As SIP</code> option (right-click the Websocket layer, select Protocol Preferences and change "Dissect websocket text as ...").</p></div>
            <div class="comment-info" id="comment-62563-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 03:50)</span>
                <a class="comment-user userinfo" href="/users/5644/lekensteyn">Lekensteyn</a>
                
            </div>
        </div>
    
        <a name="62564"></a>
        <div class="comment" id="comment-62564">
            <div id="post-62564-score" class="comment-score"></div>
            <div class="comment-text"><p>Second option works perfectly, thanks!</p>

<p>We will also consider introducing the SIP header you 're talking about for easier troubleshooting</p></div>
            <div class="comment-info" id="comment-62564-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 03:59)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62566"></a>
        <div class="comment not_top_scorer" id="comment-62566">
            <div id="post-62566-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a>, here's what I tried: I opened the pcap and did 'Export Specific Packets' without applying any filters. And then tried to editcap the result of that export and it worked fine. So there seems to have been something wrong to the original capture from tcpdump that somehow was 'corrected' by the export. But can't say what. I did verify that the number of frames between original and exported was the same though.</p></div>
            <div class="comment-info" id="comment-62566-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 04:41)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
        <a name="62567"></a>
        <div class="comment not_top_scorer" id="comment-62567">
            <div id="post-62567-score" class="comment-score"></div>
            <div class="comment-text"><p>...while the original file opens normally in Wireshark but still causes trouble to editcap? If so, may I see that file?</p></div>
            <div class="comment-info" id="comment-62567-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 04:43)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="62568"></a>
        <div class="comment not_top_scorer" id="comment-62568">
            <div id="post-62568-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a> unfortunately I cannot share the problematic pcap as it contains sensitive data, and trying to reproduce the issue now is not possible. I'll keep an eye on it and if it happens again in the future will post again here to get to the bottom of this.</p>

<p>Thanks for the help</p></div>
            <div class="comment-info" id="comment-62568-info">
                
                
                
                

                

                <span class="comment-age">(06 Jul '17, 04:55)</span>
                <a class="comment-user userinfo" href="/users/37517/atsakiridis">atsakiridis</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-62527" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 8
        </span>
        <a href="#" class="show-all-comments-link">show 3 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-62527-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/62441/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='AidpM83AEalRS9EHWZ0oqKoSnJkCz8j9' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/62441/decrypt-secure-web-socket-traffic-not-working?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/wireshark/"
            class="tag-link-wireshark"
            title="see questions tagged'wireshark'using tags"
            rel="tag">wireshark</a> <span class="tag-number">&#215;1,620</span><br/>
        
        <a href="/tags/ssl/"
            class="tag-link-ssl"
            title="see questions tagged'ssl'using tags"
            rel="tag">ssl</a> <span class="tag-number">&#215;319</span><br/>
        
        <a href="/tags/decryption/"
            class="tag-link-decryption"
            title="see questions tagged'decryption'using tags"
            rel="tag">decryption</a> <span class="tag-number">&#215;165</span><br/>
        
        <a href="/tags/websocket/"
            class="tag-link-websocket"
            title="see questions tagged'websocket'using tags"
            rel="tag">websocket</a> <span class="tag-number">&#215;9</span><br/>
        
    </p>
    <p>
        question asked: <strong title="June 30, 2017, 5:53 a.m.">30 Jun '17, 05:53</strong>
    </p>
    <p> 
     	question was seen: <strong>7,690 times</strong>
    </p>
    <p> 
        last updated: <strong title="July 6, 2017, 4:55 a.m.">06 Jul '17, 04:55</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/21341/cant-save-the-decrypted-data-in-wireshark">Can&#39;t save the decrypted data in wireshark</a>
        </p>
        
        <p>
            <a href="/questions/35600/not-able-to-configure-wireshark-with-gnutls">Not able to configure Wireshark with gnutls!</a>
        </p>
        
        <p>
            <a href="/questions/28145/cant-decrypt-ssl-in-capture-from-windump">Can&#39;t decrypt ssl in capture from windump</a>
        </p>
        
        <p>
            <a href="/questions/37223/wireshark-decryption">Wireshark Decryption</a>
        </p>
        
        <p>
            <a href="/questions/54975/issues-decrypting-ssl-traffic">issues decrypting SSL Traffic</a>
        </p>
        
        <p>
            <a href="/questions/13004/decoding-ssl-traffic">Decoding ssl traffic</a>
        </p>
        
        <p>
            <a href="/questions/28720/ldap-ssl-malformed-packet-causing-error-in-decoding">LDAP SSL malformed packet causing error in decoding</a>
        </p>
        
        <p>
            <a href="/questions/50305/how-does-wireshark-decrypt-ssltls-with-only-clientrandom">How does Wireshark decrypt SSL/TLS with only ClientRandom</a>
        </p>
        
        <p>
            <a href="/questions/15117/tls_empty_renegotiation_info_scsv-query">TLS_EMPTY_RENEGOTIATION_INFO_SCSV query</a>
        </p>
        
        <p>
            <a href="/questions/38718/getting-strange-ssl-record-size">Getting strange SSL record size</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
