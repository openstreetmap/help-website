<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Trouble decoding LDAP over SSL - Wireshark Q&amp;A</title>
        <meta name="description" content="I&#39;m trying to decode LDAP traffic over SSL to troubleshoot an issue we&#39;re having. I&#39;ve setup the SSL protocol properties with the PFX file that has the private key in it and I&#39;ve decoded both source 636 and dest 636 as LDAP, but it never wants to actually decode anything and just leaves everything a..." />
        <meta name="keywords" content="decode,ssl,ldap" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/9784/trouble-decoding-ldap-over-ssl" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/9784/trouble-decoding-ldap-over-ssl?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='6D9RmQvrUMweEjRLdoiSWAqBaPLyCsqg' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/9784/trouble-decoding-ldap-over-ssl">Trouble decoding LDAP over SSL</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-9784-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/9784/up/" rel="nofollow"> </a>
<div id="post-9784-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-9784-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/9784/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/9784/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I'm trying to decode LDAP traffic over SSL to troubleshoot an issue we're having.  I've setup the SSL protocol properties with the PFX file that has the private key in it and I've decoded both source 636 and dest 636 as LDAP, but it never wants to actually decode anything and just leaves everything as TCP.  I'm running Wireshark 1.6.5.  I know that I've done this in the past with an earlier version of Wireshark.  If I leave it un-decoded, it'll show the data packets as TLSv1 and indicate that there is encrypted LDAP traffic in the packet, so I'm not sure what the deal is, but I'm obviously missing something.</p>
<p>Edit: debug file moved from "answer" to question:</p>
<pre><code>ssl_association_remove removing TCP 636 - ldap handle 0000000003DAB350
ssl_init keys string:
1.1.1.1,636,ldap,c:\\server.pem
ssl_init found host entry 1.1.1.1,636,ldap,c:\\server.pem
ssl_init addr '1.1.1.1' port '636' filename 'c:\\server.pem' password(only for p12 file) '(null)'
Private key imported: KeyID 08:c7:ea:d2:...
ssl_init private key file c:\\server.pem successfully loaded
association_add TCP port 636 protocol ldap handle 0000000003DAB350

dissect_ssl enter frame #3 (first time)
ssl_session_init: initializing ptr 00000000086A1F48 size 672
  conversation = 00000000086A1CE8, ssl_session = 00000000086A1F48
  record: offset = 0, reported_length_remaining = 133
dissect_ssl3_record found version 0x0301 -&gt; state 0x10
dissect_ssl3_record: content_type 23
decrypt_ssl3_record: app_data len 128, ssl state 0x10
association_find: TCP port 65250 found 0000000000000000
packet_from_server: is from server - FALSE
decrypt_ssl3_record: using client decoder
decrypt_ssl3_record: no decoder available
association_find: TCP port 65250 found 0000000000000000
association_find: TCP port 636 found 000000004E9C5230

dissect_ssl enter frame #4 (first time)
  conversation = 00000000086A1CE8, ssl_session = 00000000086A1F48
  record: offset = 0, reported_length_remaining = 53
dissect_ssl3_record: content_type 23
decrypt_ssl3_record: app_data len 48, ssl state 0x10
association_find: TCP port 636 found 000000004E9C5230
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
association_find: TCP port 636 found 000000004E9C5230
</code></pre>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/decode/" class="post-tag tag-link-decode"
                                        title="see questions tagged 'decode'" rel="tag">decode</a>
                                
                                    <a href="/tags/ssl/" class="post-tag tag-link-ssl"
                                        title="see questions tagged 'ssl'" rel="tag">ssl</a>
                                
                                    <a href="/tags/ldap/" class="post-tag tag-link-ldap"
                                        title="see questions tagged 'ldap'" rel="tag">ldap</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>27 Mar '12, 06:55</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/8c9cbc025922240dfd5cb3e1a65d00fa?s=32&amp;d=identicon&amp;r=g" alt="infinity9999's gravatar image" />
    <p><a href="/users/2426/infinity9999">infinity9999</a><br/>
    <span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="infinity9999 has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/9784/">
                edited
                <strong>27 Mar '12, 08:49</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" alt="grahamb's gravatar image" />
            <p><a href="/users/1225/grahamb">grahamb ♦</a><br/>
            <span class="score" title="19834 reputation points"><span class="">19.8k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">&#9679;</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">&#9679;</span><span class="badgecount">206</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-9784">
    
</div>
<div id="comment-tools-9784" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-9784-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/9784/trouble-decoding-ldap-over-ssl?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/9784/trouble-decoding-ldap-over-ssl?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/9784/trouble-decoding-ldap-over-ssl?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/9784/trouble-decoding-ldap-over-ssl?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="9785"></a>
                    <div id="answer-container-9785" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-9785-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/9785/up/" rel="nofollow"> </a>
<div id="post-9785-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-9785-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/9785/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Have you reviewed the <a href="http://wiki.wireshark.org/SSL">SSL</a> page on the wiki?  That states that the key should be in PEM format and gives some conversion recipes, and also discusses LDAP but I don't think that info is applicable in your case.</p>
<p>Using the SSL dissector preferences you can also set an SSL Debug file.  Doing that and posting the contents here may help us to answer your question.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/9785/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>27 Mar '12, 07:38</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" alt="grahamb's gravatar image" />
    <p><a href="/users/1225/grahamb">grahamb ♦</a><br/>
    <span class="score" title="19834 reputation points"><span class="">19.8k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">&#9679;</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">&#9679;</span><span class="badgecount">206</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="grahamb has 274 accepted answers">22&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-9785">
    
        <a name="9786"></a>
        <div class="comment" id="comment-9786">
            <div id="post-9786-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes, I've read it.  I've tried both PEM and PFX (1.6.5 allows PFX or P12 with the password).  I just tried with 1.4.11 and that didn't work either.<br>
</p>

<p>The debug shows this (snippet from the top), which appears to me to be working as it should (i.e. it can read in the key and appears to be able to figure out which packets to dissect):</p>

<p>ssl_association_remove removing TCP 636 - ldap handle 0000000003DAB350
ssl_init keys string:
1.1.1.1,636,ldap,c:\server.pem
ssl_init found host entry 1.1.1.1,636,ldap,c:\server.pem
ssl_init addr '1.1.1.1' port '636' filename 'c:\server.pem' password(only for p12 file) '(null)'
Private key imported: KeyID 08:c7:ea:d2:...
ssl_init private key file c:\server.pem successfully loaded
association_add TCP port 636 protocol ldap handle 0000000003DAB350</p>

<p>dissect_ssl enter frame #3 (first time)
ssl_session_init: initializing ptr 00000000086A1F48 size 672
  conversation = 00000000086A1CE8, ssl_session = 00000000086A1F48
  record: offset = 0, reported_length_remaining = 133
dissect_ssl3_record found version 0x0301 -&gt; state 0x10
dissect_ssl3_record: content_type 23
decrypt_ssl3_record: app_data len 128, ssl state 0x10
association_find: TCP port 65250 found 0000000000000000
packet_from_server: is from server - FALSE
decrypt_ssl3_record: using client decoder
decrypt_ssl3_record: no decoder available
association_find: TCP port 65250 found 0000000000000000
association_find: TCP port 636 found 000000004E9C5230</p>

<p>dissect_ssl enter frame #4 (first time)
  conversation = 00000000086A1CE8, ssl_session = 00000000086A1F48
  record: offset = 0, reported_length_remaining = 53
dissect_ssl3_record: content_type 23
decrypt_ssl3_record: app_data len 48, ssl state 0x10
association_find: TCP port 636 found 000000004E9C5230
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
association_find: TCP port 636 found 000000004E9C5230</p></div>
            <div class="comment-info" id="comment-9786-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 08:34)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9787"></a>
        <div class="comment" id="comment-9787">
            <div id="post-9787-score" class="comment-score"></div>
            <div class="comment-text"><p>I've converted your "answer" to a comment and (due to the comment length limits) copied the debug output into the question and formatted it as "code".</p></div>
            <div class="comment-info" id="comment-9787-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 08:51)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="9788"></a>
        <div class="comment" id="comment-9788">
            <div id="post-9788-score" class="comment-score"></div>
            <div class="comment-text"><p>I'm wondering if it's becuase I'm not seeing the SSL handshake in my trace.  Does the handshake need to be in the trace for it to actually decode things?</p></div>
            <div class="comment-info" id="comment-9788-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:20)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9789"></a>
        <div class="comment" id="comment-9789">
            <div id="post-9789-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes.  That is where the session key is derived from the master key to use during the subsequent data exchanges.</p></div>
            <div class="comment-info" id="comment-9789-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:24)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="9790"></a>
        <div class="comment not_top_scorer" id="comment-9790">
            <div id="post-9790-score" class="comment-score"></div>
            <div class="comment-text"><p>I'm looking in my trace and I do see handshakes occuring.  Do I need to decode things from the handshake packet itself? I thought you could just decode from any packet that was talking on that port.</p></div>
            <div class="comment-info" id="comment-9790-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:28)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9791"></a>
        <div class="comment not_top_scorer" id="comment-9791">
            <div id="post-9791-score" class="comment-score"></div>
            <div class="comment-text"><p>Does it make a difference that it's LDAP against Active Directory?</p></div>
            <div class="comment-info" id="comment-9791-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:40)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9792"></a>
        <div class="comment not_top_scorer" id="comment-9792">
            <div id="post-9792-score" class="comment-score"></div>
            <div class="comment-text"><p>Re needing the handshake.  Yes that must be present in the trace.  What do you mean by "decode from the handshake packet itself"?  The debug log should show the info from the handshakes and the calculation of the session key.</p>

<p>Re LDAP against AD.  Not that I know of.</p></div>
            <div class="comment-info" id="comment-9792-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:49)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="9793"></a>
        <div class="comment not_top_scorer" id="comment-9793">
            <div id="post-9793-score" class="comment-score"></div>
            <div class="comment-text"><p>See also <a href="http://ask.wireshark.org/questions/7886/ssl-decrypting-problem">this</a> question which was also about AD LDAP over SSL.  They had issues with the key exchange cipher that prevented decryption.</p></div>
            <div class="comment-info" id="comment-9793-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 09:58)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="9794"></a>
        <div class="comment not_top_scorer" id="comment-9794">
            <div id="post-9794-score" class="comment-score"></div>
            <div class="comment-text"><p>I do show this in the debug log, but the packet says it's using Cipher Suite TLS_RSA_WITH_AES_128_CBC_SHA (0x002f):</p>

<pre><code>    dissect_ssl enter frame #172799 (first time)
  conversation = 000000000D954BE8, ssl_session = 000000000D9550B0
  record: offset = 0, reported_length_remaining = 145
dissect_ssl3_record found version 0x0301 -&gt; state 0x11
dissect_ssl3_record: content_type 22
decrypt_ssl3_record: app_data len 81, ssl state 0x11
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
dissect_ssl3_handshake iteration 1 type 2 offset 5 length 77 bytes, remaining 86 
dissect_ssl3_hnd_hello_common found SERVER RANDOM -&gt; state 0x13
ssl_restore_session can't find stored session
dissect_ssl3_hnd_srv_hello found CIPHER 0x002F -&gt; state 0x17
dissect_ssl3_hnd_srv_hello trying to generate keys
ssl_generate_keyring_material not enough data to generate key (0x17 required 0x37 or 0x57)
dissect_ssl3_hnd_srv_hello can't generate keyring material
  record: offset = 86, reported_length_remaining = 59
dissect_ssl3_record: content_type 20
dissect_ssl3_change_cipher_spec
packet_from_server: is from server - TRUE
ssl_change_cipher SERVER
  record: offset = 92, reported_length_remaining = 53
dissect_ssl3_record: content_type 22
decrypt_ssl3_record: app_data len 48, ssl state 0x17
packet_from_server: is from server - TRUE
decrypt_ssl3_record: using server decoder
decrypt_ssl3_record: no decoder available
dissect_ssl3_handshake iteration 1 type 254 offset 97 length 16114481 bytes, remaining 145 
</code></pre></div>
            <div class="comment-info" id="comment-9794-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 10:59)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9795"></a>
        <div class="comment not_top_scorer" id="comment-9795">
            <div id="post-9795-score" class="comment-score"></div>
            <div class="comment-text"><p>Also, re: the decode packet, disregard that.  That was part of a doc that we had used that described decrypting SSL on non-standard ports.  My brain hasn't been all there recently.</p></div>
            <div class="comment-info" id="comment-9795-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 11:08)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9796"></a>
        <div class="comment not_top_scorer" id="comment-9796">
            <div id="post-9796-score" class="comment-score"></div>
            <div class="comment-text"><p>That is the first part of the key exchange that has the server hello and certificate, the next part is the client key exchange, the change cipher spec and handshake finished.  That is the key frame you need to inspect in the debug log.</p>

<p>The snakeoil demo on the SSL wiki page uses TLS_RSA_WITH_AES_256_CBC_SHA (0x0035) which is stronger than you are using, so no worries there.</p>

<p>You need to inspect (or post) the next part of the debug log that shows the session key generation.</p></div>
            <div class="comment-info" id="comment-9796-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 13:45)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="9797"></a>
        <div class="comment not_top_scorer" id="comment-9797">
            <div id="post-9797-score" class="comment-score"></div>
            <div class="comment-text"><pre><code>
dissect_ssl enter frame #172811 (first time)
  conversation = 000000000D954BE8, ssl_session = 000000000D9550B0
  record: offset = 0, reported_length_remaining = 6
dissect_ssl3_record: content_type 20
dissect_ssl3_change_cipher_spec
packet_from_server: is from server - FALSE
ssl_change_cipher CLIENT

dissect_ssl enter frame #172812 (first time)
  conversation = 000000000D954BE8, ssl_session = 000000000D9550B0
  record: offset = 0, reported_length_remaining = 53
dissect_ssl3_record: content_type 22
decrypt_ssl3_record: app_data len 48, ssl state 0x17
packet_from_server: is from server - FALSE
decrypt_ssl3_record: using client decoder
decrypt_ssl3_record: no decoder available
dissect_ssl3_handshake iteration 1 type 227 offset 5 length 15358476 bytes, remaining 53 
</code></pre></div>
            <div class="comment-info" id="comment-9797-info">
                
                
                
                

                

                <span class="comment-age">(27 Mar '12, 14:26)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9843"></a>
        <div class="comment not_top_scorer" id="comment-9843">
            <div id="post-9843-score" class="comment-score"></div>
            <div class="comment-text"><p>Did more digging and testing.  I think the issue lies that the server hello packet in response to the client request doesn't list the certificate in it, only the change cipher spec and encrypted handshake. The handshake occurs for the application, but the cert is never passed along, so wireshark probably can't figure out what to decrypt.</p></div>
            <div class="comment-info" id="comment-9843-info">
                
                
                
                

                

                <span class="comment-age">(29 Mar '12, 11:52)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9850"></a>
        <div class="comment not_top_scorer" id="comment-9850">
            <div id="post-9850-score" class="comment-score"></div>
            <div class="comment-text"><p>And more digging is uncovering some more info.  Basically the issue we're investigating is what looks like a complete network drop for about a minute on the server end.  In the trace, we can see all the resets followed by normal activity.  However after the resets go through, I'm able to decrypt at the least the bind traffic.  It looks like there's more, but it's not decrypting.  So, I'm thinking that we have something like persistent connections that are just maintaining themselves without doing handshakes with the certs or something so I can't decrypt prior to the resets.</p></div>
            <div class="comment-info" id="comment-9850-info">
                
                
                
                

                

                <span class="comment-age">(29 Mar '12, 13:45)</span>
                <a class="comment-user userinfo" href="/users/2426/infinity9999">infinity9999</a>
                
            </div>
        </div>
    
        <a name="9855"></a>
        <div class="comment" id="comment-9855">
            <div id="post-9855-score" class="comment-score">1</div>
            <div class="comment-text"><p>The SSL client and server can cache the keying information for each session. This will prevent a new connection from doing the CPU expensive key exchange.</p>

<p>As you already noticed, the "Certificate" message is missing in those cases. But more importantly, the "ClientKeyExchange" message is missing, it is this message that contains the keying material (encrypted with the public key from the Certificate).</p>

<p>Wireshark uses the private key from the server to decrypt the "ClientKeyExchange" to get to the keying material for that particular SSL session. Without the keying material, no SSL decryption!</p></div>
            <div class="comment-info" id="comment-9855-info">
                
                
                
                

                

                <span class="comment-age">(30 Mar '12, 01:04)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-9785" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 15
        </span>
        <a href="#" class="show-all-comments-link">show 10 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-9785-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/9784/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='6D9RmQvrUMweEjRLdoiSWAqBaPLyCsqg' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/9784/trouble-decoding-ldap-over-ssl?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/9784/trouble-decoding-ldap-over-ssl?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/ssl/"
            class="tag-link-ssl"
            title="see questions tagged'ssl'using tags"
            rel="tag">ssl</a> <span class="tag-number">&#215;319</span><br/>
        
        <a href="/tags/decode/"
            class="tag-link-decode"
            title="see questions tagged'decode'using tags"
            rel="tag">decode</a> <span class="tag-number">&#215;89</span><br/>
        
        <a href="/tags/ldap/"
            class="tag-link-ldap"
            title="see questions tagged'ldap'using tags"
            rel="tag">ldap</a> <span class="tag-number">&#215;24</span><br/>
        
    </p>
    <p>
        question asked: <strong title="March 27, 2012, 6:55 a.m.">27 Mar '12, 06:55</strong>
    </p>
    <p> 
     	question was seen: <strong>10,628 times</strong>
    </p>
    <p> 
        last updated: <strong title="March 30, 2012, 1:04 a.m.">30 Mar '12, 01:04</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/13721/decrypt-ssl-traffic-problem-because-of-dhe-cipher">Decrypt SSL traffic problem because of DHE Cipher</a>
        </p>
        
        <p>
            <a href="/questions/13874/ssl-decrypt-works-depending-on-the-used-browser">SSL Decrypt works depending on the used browser</a>
        </p>
        
        <p>
            <a href="/questions/41707/decoding-preexisting-ldap-connection">decoding preexisting ldap connection</a>
        </p>
        
        <p>
            <a href="/questions/28720/ldap-ssl-malformed-packet-causing-error-in-decoding">LDAP SSL malformed packet causing error in decoding</a>
        </p>
        
        <p>
            <a href="/questions/45999/decrypt-ldap-over-ssl">decrypt ldap over ssl</a>
        </p>
        
        <p>
            <a href="/questions/25156/ldap-ssl-decrypt-issue">LDAP SSL decrypt issue</a>
        </p>
        
        <p>
            <a href="/questions/2920/ldap-sslv3-malformed-packet">LDAP SSLv3 malformed packet</a>
        </p>
        
        <p>
            <a href="/questions/5926/why-can-i-no-longer-decode-ssl-traffic-with-wireshark">Why can I no longer decode SSL traffic with Wireshark?</a>
        </p>
        
        <p>
            <a href="/questions/56656/decode-as-wrong-box-please-help">decode as wrong box? please help</a>
        </p>
        
        <p>
            <a href="/questions/337/where-did-the-google-ssl-video-go">Where did the Google SSL video go?</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
