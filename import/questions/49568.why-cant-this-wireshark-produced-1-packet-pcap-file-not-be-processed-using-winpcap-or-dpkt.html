<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Why can&#39;t this Wireshark produced 1 Packet PCAP file not be processed using WinPcap or DPKT? - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, I have a problem with a Wireshark produced PCAP-file. With Wireshark I exported 1 packet in a seperate PCAP-file, which demonstrate the issue: This is a dropbox link to a PCAP File with 1 packet. If I load this PCAP in WireShark I nicely get a TCP and IP header, see sreenshot below.  The problem..." />
        <meta name="keywords" content="raw,wireshark,pcap,encapsulation,format" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='0G83xd3yTMNOGfy4NWghha5kslKDxIDh' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt">Why can&#39;t this Wireshark produced 1 Packet PCAP file not be processed using WinPcap or DPKT?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-49568-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/49568/up/" rel="nofollow"> </a>
<div id="post-49568-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-49568-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/49568/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/49568/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi,</p>
<p>I have a problem with a Wireshark produced PCAP-file. With Wireshark I exported 1 packet in a seperate PCAP-file, which demonstrate the issue:</p>
<p><strong><a href="https://www.dropbox.com/s/31jcb107ma8aseu/t_0.pcap?dl=0">This is a dropbox link to a PCAP File with 1 packet.</a></strong></p>
<p>If I load this PCAP in WireShark I nicely get a TCP and IP header, see sreenshot below. </p>
<p>The problem is that if I try to load this using:</p>
<ul>
<li>Java with JNetPcap 1.3.0 with WinCap 4.1.3 DLL I get only a Ethernet Header and a Payload Header. </li>
<li>
<p>Python with DPKT goes completely crazy, where the ethernet data is of type string !!</p>
<pre><code>for ts, buf in pcap:
    eth = dpkt.ethernet.Ethernet(buf)
    print 'eth type %d python datatype %s '%(eth.type,type(eth.data))
</code></pre>
</li>
</ul>
<p>Results in:</p>
<pre><code>    eth type 44048 python datatype type str
</code></pre>
<p>Now CAPINFOS reveals that this PCAP file is Raw IP encapsulation, where correct readable ones are Ethernet encapsulated. </p>
<p>I tried to convert the PCAP file using:</p>
<p><strong>editcap -T ether t_0.pcap t_.new.pcap</strong></p>
<p>The encapsulation is now reported as Ethernet, however even in WireShark the TCP and IP header are now gone. </p>
<p><strong>So my question is: What is wrong with this Wireshark generated 1 packet file, causing that it cannot be read by WinCap/DPTK?</strong></p>
<p><strong>How can I modify this pcap file to get it processed by WinPcap and get TCP and IP headers?</strong> </p>
<p>Thanks.</p>
<p><img alt="alt text" src="https://osqa-ask.wireshark.org/upfiles/wireshark_0.jpg"></p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/raw/" class="post-tag tag-link-raw"
                                        title="see questions tagged 'raw'" rel="tag">raw</a>
                                
                                    <a href="/tags/wireshark/" class="post-tag tag-link-wireshark"
                                        title="see questions tagged 'wireshark'" rel="tag">wireshark</a>
                                
                                    <a href="/tags/pcap/" class="post-tag tag-link-pcap"
                                        title="see questions tagged 'pcap'" rel="tag">pcap</a>
                                
                                    <a href="/tags/encapsulation/" class="post-tag tag-link-encapsulation"
                                        title="see questions tagged 'encapsulation'" rel="tag">encapsulation</a>
                                
                                    <a href="/tags/format/" class="post-tag tag-link-format"
                                        title="see questions tagged 'format'" rel="tag">format</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>27 Jan '16, 23:51</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/b29ba250b3689fdd86050f2671a828d2?s=32&amp;d=identicon&amp;r=g" alt="Jos's gravatar image" />
    <p><a href="/users/22825/jos">Jos</a><br/>
    <span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">&#9679;</span><span class="badgecount">5</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jos has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/49568/">
                edited
                <strong>27 Jan '16, 23:57</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-49568">
    
</div>
<div id="comment-tools-49568" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-49568-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="49583"></a>
                    <div id="answer-container-49583" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-49583-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/49583/up/" rel="nofollow"> </a>
<div id="post-49583-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-49583-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/49583/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <blockquote>
<p>but the idea that I have lib/winpcap to do this for me</p>
</blockquote>
<p>No, you don't.  libpcap/winPcap don't parse <em>any</em> headers for you.</p>
<blockquote>
<p>So I want to know how I can convert this RAW PCAP to a PCAP which WinPcap/LibPcap interprets as IP/TCP/UDP-headers.</p>
</blockquote>
<p>The <code>cat</code> command will do so quite nicely. :-)</p>
<p>I.e., a pcap file with type "Raw IP" <em>HAS</em> packets that contain IP headers - each packet <em>begin</em> with an IP header.  Do not look for an Ethernet header, because there are no Ethernet headers - or any <em>other</em> headers before the IP header.</p>
<blockquote>
<p>The problem is that if I try to load this using:</p>
<ul>
<li>Java with JNetPcap 1.3.0 with WinCap 4.1.3 DLL I get only a Ethernet Header and a Payload Header.</li>
</ul>
</blockquote>
<p>No, you get an IP header - no Ethernet header.  If JNetPcap can't handle "Raw IP" packets, then it can't handle your capture file (and it's not as good a library as it could be, because it certainly <em>could</em> handle "Raw IP" packets).</p>
<blockquote>
<ul>
<li>Python with DPKT goes completely crazy, where the ethernet data is of type string !!</li>
</ul>
</blockquote>
<p>Don't use <code>dpkt.ethernet</code>, because there is <em>no</em> Ethernet header in the packet.</p>
<blockquote>
<p>Now CAPINFOS reveals that this PCAP file is Raw IP encapsulation,</p>
</blockquote>
<p>Because that's what it is.</p>
<blockquote>
<p>where correct readable ones are Ethernet encapsulated.</p>
</blockquote>
<p><em>Correct</em> pcap files can have <strong><em>ANY</em></strong> of <a href="http://www.tcpdump.org/linktypes.html">these encapsulations</a>; they are <strong><em>NOT</em></strong> necessarily Ethernet-encapsulated.</p>
<p>There may be some lesser tools that can only handle Ethernet encapsulation, but the <em>better</em> tools can read more than just Ethernet-encapsulated pcaps; at <em>minimum</em>, a good tool or library should be able to handle Ethernet, 802.11, 802.11 with radiotap, Raw IP, and <code>LINKTYPE_NULL</code>/<code>LINKTYPE_LOOP</code>.</p>
<blockquote>
<p>What is wrong with this Wireshark generated 1 packet file</p>
</blockquote>
<p>Nothing.  Something <em>is</em>, however, wrong with:</p>
<ul>
<li>either JNetPcap or the program you wrote using it;</li>
<li>either DPKT or the program you wrote using it.</li>
</ul>
<p>For JNetPcap, try first using <a href="http://jnetpcap.com/docs/javadocs/jnetpcap-1.3/index.html">the GetValue method of the DataLinkType class</a> to get the encapsulation, and:</p>
<ul>
<li>if and only if it's Ethernet (<code>PcapDLT.EN10MB.value</code>), you can use the Ethernet class;</li>
<li>if and only if it's 802.11 (<code>PcapDLT.IEEE802_11.value</code>), it's not clear whether <em>what</em> classes you can use, as the JNetPcap JavaDocs I found don't mention any classes for 802.11;</li>
<li>the same applies to 802.11 + radiotap;</li>
<li>if and only if it's Raw IP (<code>PcapDLT.RAW.value</code>), you <em>might</em> be able to use the <code>Ip4</code> or <code>Ip6</code> classes <em>if</em> JNetPcap supports Raw IP.</li>
</ul>
<p>For DPKT, use <a href="http://dpkt.readthedocs.org/en/latest/api/api_auto.html#dpkt.pcap.FileHdr.linktype"><code>dpkt.pcap.FileHdr.linktype</code></a> to find out the encapsulation type, and do similar checks; if it's raw IP, you <em>might</em> be able to use the <a href="http://dpkt.readthedocs.org/en/latest/api/api_auto.html#module-dpkt.ip"><code>dpkt.ip</code></a> or <a href="http://dpkt.readthedocs.org/en/latest/api/api_auto.html#module-dpkt.ip6"><code>dpkt.ip6</code></a> modules.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/49583/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>28 Jan '16, 03:00</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" alt="Guy%20Harris's gravatar image" />
    <p><a href="/users/79/guy-harris">Guy Harris ♦♦</a><br/>
    <span class="score" title="17443 reputation points"><span class="">17.4k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">&#9679;</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">&#9679;</span><span class="badgecount">196</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Guy Harris has 216 accepted answers">19&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-49583">
    
        <a name="49586"></a>
        <div class="comment" id="comment-49586">
            <div id="post-49586-score" class="comment-score"></div>
            <div class="comment-text"><p>Guy,</p>

<p>Thanks for your comment, but:</p>

<ul>
<li>
<p>Why should I go for your solution, and not inject fake Ethernet headers with tcprewrite as I wrote here above. If I inject fake Ethernet headers, I also get access to JNetPcap PcapPacket.getHeader(tcp) (and IP/UDP).</p>
</li>
<li>
<p>You wrote: "libpcap/winPcap don't parse any headers for you.". He? But I can do in JNetPcap for example myPacket.getHeader(tcp), and then I get a TCP object. So JNetPcap/WinPcap is indeed parsing.</p>
</li>
</ul></div>
            <div class="comment-info" id="comment-49586-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 04:02)</span>
                <a class="comment-user userinfo" href="/users/22825/jos">Jos</a>
                
            </div>
        </div>
    
        <a name="49589"></a>
        <div class="comment" id="comment-49589">
            <div id="post-49589-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/22825/jos">@Jos</a>, most people answering questions on this site prefer to provide answers which are generic in terms that someone else asking a similar question can make use of an existing answer. That's why, I guess, <a href="/users/79/guy-harris">@Guy Harris</a> has spent so much time to comment the individual steps of your description.</p>

<blockquote>
<p>Why should I go for your solution</p>
</blockquote>

<p>If you look for the fastest method to handle a <strong>single</strong> capture taken as "raw IP" encapsulation (to say "raw" and to say "raw IP" is quite a difference) using an existing tool which can <em>only</em> process ethernet encapsulation, then your approach (use editcap to augment the raw IP packets with forged, meaningless, but formally correct ethernet layer) is the correct one; if you want to handle such captures systematically, Guy's suggestion to modify your tool in such a way that it would take the information about encapsulation type into account and start parsing the packet from the corresponding layer is the correct one.</p>

<p>The pcap file indicates the encapsulation type in order to allow the parsing application to choose the proper entry point to the parser without need to tell it so "manually".</p>

<blockquote>
<p>I can do in JNetPcap for example myPacket.getHeader(tcp)</p>
</blockquote>

<p>Yes. In JNetPcap. Are you sure that JNetPcap is a mere wrapper of WinPcap, or it also has some parsing logic in it?</p></div>
            <div class="comment-info" id="comment-49589-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 04:40)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="49608"></a>
        <div class="comment" id="comment-49608">
            <div id="post-49608-score" class="comment-score"></div>
            <div class="comment-text"><p>JNetPcap <strong><em>MOST DEFINITELY</em></strong> has parsing logic in it.  <strong><em>THAT</em></strong> is why it's doing parsing; the parsing is <strong><em>NOT</em></strong> being done by libpcap/WInPcap, it's being done by the <strong><em>ADDITIONAL</em></strong> parsing code in JNetPcap.</p></div>
            <div class="comment-info" id="comment-49608-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 10:56)</span>
                <a class="comment-user userinfo" href="/users/79/guy-harris">Guy Harris ♦♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-49583" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-49583-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="49569"></a>
                    <div id="answer-container-49569" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-49569-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/49569/up/" rel="nofollow"> </a>
<div id="post-49569-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-49569-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/49569/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Technically there's nothing wrong with the capture. What you need to appreciate is that the encapsulation is "Raw IP", while you seem to insist of getting it interpreted as Ethernet, which it is not (since there is no Ethernet header, forcing the encapsulation to 'ether' by means of editcap just makes the file header incorrect with respect to the content of the frame(s) and therefore Wireshark cannot interpret the manipulated capture file anymore either). </p>
<p>So, whatever you are doing using WinPcap or DPTK, stop interpreting it as an Ethernet frame, which it isn't, and look at it as an Raw IP frame, which it is.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/49569/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>28 Jan '16, 00:22</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" alt="Jaap's gravatar image" />
    <p><a href="/users/4/jaap">Jaap ♦</a><br/>
    <span class="score" title="11680 reputation points"><span class="">11.7k</span></span><span title="16 badges"><span class="silver">&#9679;</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">&#9679;</span><span class="badgecount">101</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jaap has 155 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-49569">
    
        <a name="49572"></a>
        <div class="comment" id="comment-49572">
            <div id="post-49572-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks, but for my research I want to get access to IP/TCP/UDP/ARP etc headers.Of course I can parse everything directly by hand, but the idea that I have lib/winpcap to do this for me. So I want to know how I can convert this RAW PCAP to a PCAP which WinPcap/LibPcap interprets as IP/TCP/UDP-headers. Since WireShark is showing TCP/IP/etc. headers in the Window, I assume there is some way to convert RAW PCAP to an "enhanced" PCAP format.</p>

<p>Also I have multiple PCAP-captures of which the most are not raw (so I can extract IP/TCP/UDP headers with libpcap), so it would be nice if I can convert the raw ip to this form, so I can process them with 1 data extraction algo.</p></div>
            <div class="comment-info" id="comment-49572-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 00:47)</span>
                <a class="comment-user userinfo" href="/users/22825/jos">Jos</a>
                
            </div>
        </div>
    
        <a name="49609"></a>
        <div class="comment" id="comment-49609">
            <div id="post-49609-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Thanks, but for my research I want to get access to IP/TCP/UDP/ARP etc headers.</p>
</blockquote>

<p>You have access to them if you're willing to parse the raw packet data, and <em>if</em> JNetPcap can handle <code>LINKTYPE_RAW</code>, it would be able to parse them for you.  (If it doesn't, it should be fixed to do so.)</p>

<blockquote>
<p>Of course I can parse everything directly by hand, but the idea that I have lib/winpcap to do this for me.</p>
</blockquote>

<p>No, you have JNetPcap to do it for you.  libpcap/WInPcap doesn't do any parsing of packet data.</p>

<blockquote>
<p>So I want to know how I can convert this RAW PCAP to a PCAP which WinPcap/LibPcap interprets as IP/TCP/UDP-headers.</p>
</blockquote>

<p>The <em>only</em> place where libpcap/WinPcap interprets the headers is in packet filtering, where it compiles a filter expression into BPF "machine code" to check whether the filter matches or not - and <em>that</em> code <em>does</em> handle <code>LINKTYPE_RAW</code>.</p>

<blockquote>
<p>Since WireShark is showing TCP/IP/etc. headers in the Window, I assume there is some way to convert RAW PCAP to an "enhanced" PCAP format.</p>
</blockquote>

<p>You assume incorrectly.  For one thing, "RAW" isn't a different format of pcap, it's a different link-layer header type code; there's no "enhancement" involved.  For another thing, Wireshark shows the headers <em>because it has code to parse them</em> - or, rather, it has code that does <em>not</em> try to parse <em>link-layer headers</em> for <code>LINKTYPE_RAW</code> captures - just as it has code to parse Ethernet headers and Token Ring headers and FDDI headers and 802.11 headers and so on and so forth.</p></div>
            <div class="comment-info" id="comment-49609-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 11:02)</span>
                <a class="comment-user userinfo" href="/users/79/guy-harris">Guy Harris ♦♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-49569" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-49569-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="49581"></a>
                    <div id="answer-container-49581" class="answer answered-by-owner">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-49581-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/49581/up/" rel="nofollow"> </a>
<div id="post-49581-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-49581-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/49581/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>I found the solution. RAW IP PCAPs should first be processed by <code>tcprewrite</code>. </p>

<pre><code>tcprewrite --dlt=enet --enet-dmac=00:11:22:33:44:55 --enet-smac=66:77:88:99:AA:BB --infile=input.pcap --outfile=output.pcap
</code></pre>

<p>The output file has nicely some TCP and IP headers.</p>

<p><a href="http://edeca.net/wp/2011/06/adding-fake-ethernet-headers-to-pcap-files/">Source here,</a></p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/49581/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>28 Jan '16, 02:06</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/b29ba250b3689fdd86050f2671a828d2?s=32&amp;d=identicon&amp;r=g" alt="Jos's gravatar image" />
    <p><a href="/users/22825/jos">Jos</a><br/>
    <span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">&#9679;</span><span class="badgecount">5</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jos has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-49581">
    
        <a name="49587"></a>
        <div class="comment" id="comment-49587">
            <div id="post-49587-score" class="comment-score"></div>
            <div class="comment-text"><p>What you are doing here is adding a fake Ethernet header.  While this does allow you to then <strong>not</strong> rewrite your pcap processing code to handle Raw IP, it's an extra step in your workflow that could easily be avoided if you re-read the answer from <a href="/users/79/guy-harris">@Guy Harris</a> on how you <strong>should</strong> handle a pcap that has either Ethernet or Raw IP.</p></div>
            <div class="comment-info" id="comment-49587-info">
                
                
                
                

                

                <span class="comment-age">(28 Jan '16, 04:07)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-49581" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-49581-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/49568/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='0G83xd3yTMNOGfy4NWghha5kslKDxIDh' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/49568/why-cant-this-wireshark-produced-1-packet-pcap-file-not-be-processed-using-winpcap-or-dpkt?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/wireshark/"
            class="tag-link-wireshark"
            title="see questions tagged'wireshark'using tags"
            rel="tag">wireshark</a> <span class="tag-number">&#215;1,620</span><br/>
        
        <a href="/tags/pcap/"
            class="tag-link-pcap"
            title="see questions tagged'pcap'using tags"
            rel="tag">pcap</a> <span class="tag-number">&#215;238</span><br/>
        
        <a href="/tags/format/"
            class="tag-link-format"
            title="see questions tagged'format'using tags"
            rel="tag">format</a> <span class="tag-number">&#215;24</span><br/>
        
        <a href="/tags/raw/"
            class="tag-link-raw"
            title="see questions tagged'raw'using tags"
            rel="tag">raw</a> <span class="tag-number">&#215;20</span><br/>
        
        <a href="/tags/encapsulation/"
            class="tag-link-encapsulation"
            title="see questions tagged'encapsulation'using tags"
            rel="tag">encapsulation</a> <span class="tag-number">&#215;14</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Jan. 27, 2016, 11:51 p.m.">27 Jan '16, 23:51</strong>
    </p>
    <p> 
     	question was seen: <strong>4,034 times</strong>
    </p>
    <p> 
        last updated: <strong title="Jan. 28, 2016, 11:02 a.m.">28 Jan '16, 11:02</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/43194/how-to-output-wireshark-captures-to-a-new-file">how to output wireshark captures to a new file ?</a>
        </p>
        
        <p>
            <a href="/questions/9080/implementing-autostop-condition-on-packet-capture">implementing autostop condition on packet capture!</a>
        </p>
        
        <p>
            <a href="/questions/13023/filter-multiple-ips">Filter multiple IPs</a>
        </p>
        
        <p>
            <a href="/questions/31378/sniffing-packets-from-mobile-devices-what-wifi-card-to-use">Sniffing packets from mobile devices, what wifi card to use?</a>
        </p>
        
        <p>
            <a href="/questions/32357/difference-between-ppp-pcap-files">Difference between .PPP &amp; .PCAP files ?</a>
        </p>
        
        <p>
            <a href="/questions/40989/after-converting-pcap-to-text-i-want-only-data-part-in-text-file-how-can-i-do-that">After converting pcap to text , I want only data part in text file how can i do that?</a>
        </p>
        
        <p>
            <a href="/questions/54152/how-do-i-create-a-pcap-file-where-the-mac-appears">¿How do I create a PCAP file where the MAC appears?</a>
        </p>
        
        <p>
            <a href="/questions/15118/how-to-display-flowid-alongwith-frame-number-for-each-packet-of-a-pcap-using-tsharkwireshark">how to display flowid alongwith frame number for each packet of a pcap using tshark/wireshark</a>
        </p>
        
        <p>
            <a href="/questions/16113/pcap-to-txt">pcap to txt</a>
        </p>
        
        <p>
            <a href="/questions/23333/providing-each-packet-to-wireshark-using-command-line">Providing each packet to wireshark using command line</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
