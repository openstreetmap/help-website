<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Why am I getting RSTACK packet after SYN ? - Wireshark Q&amp;A</title>
        <meta name="description" content="I am running a scanner against my server. I am trying to understand why TCP conversations (12-17) below have a SYN (sent by the scanner) with a RSTACK response sent by my server. Does anyone know why? Thanks in Advance. I am sorry that the data below seems to get reformatted. It should be 4 values p..." />
        <meta name="keywords" content="tcp.stream" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/26721/why-am-i-getting-rstack-packet-after-syn" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='U99PdF9Zl88h0gbMnUXoRXqREV0NTOB6' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/26721/why-am-i-getting-rstack-packet-after-syn">Why am I getting RSTACK packet after SYN ?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-26721-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/26721/up/" rel="nofollow"> </a>
<div id="post-26721-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-26721-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/26721/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/26721/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I am running a scanner against my server.
I am trying to understand why TCP conversations (12-17) below have a SYN (sent by the scanner) with a RSTACK response sent by my server.  Does anyone know why?  Thanks in Advance.</p>
<p>I am sorry that the data below seems to get reformatted.  It should be 4 values per line where
the value is  null for the column representing the receiver.</p>
<p><code>Packet  Scanner Sends   Service Sends   tcp.stream
1   SYN     0
2       SYNACK  0
3   RST     0
4   SYN     1
5       RSTACK  1
6   SYN     2
7       SYNACK  2
8   ACK     2
9   PSHACK      2
10      FINACK  2
11  FINACK      2
12      ACK 2
13  SYN     3
14      SYNACK  3
15  ACK     3
16  PSHACK      3
17      ack 3
18      FINACK  3
19  FINACK      3
20      ack 3
21  SYN     4
22      SYNACK  4
23  ACK     4
24  PSHACK      4
25      ACK 4
26      FINACK  4
27  FINACK      4
28      ACK 4
29  SYN     5
30      SYNACK  5
31  ACK     5
32  PSHACK      5
33      ACK 5
34      RSTACK  5
35  SYN     6
36      SYNACK  6
37  ACK     6
38  PSHACK      6
39      ACK 6
40      RSTACK  6
41  SYN     7
42      SYNACK  7
43  ACK     7
60  FINACK      7
65      ACK 7
78      FINACK  7
79  ACK     7
44  SYN     8
45      SYNACK  8
46  ACK     8
61  FINACK      8
66      ACK 8
85      FINACK  8
86  ACK     8
47  SYN     9
48      SYNACK  9
49  ACK     9
62  FINACK      9
67      ACK 9
87      FINACK  9
88  ACK     9
50  SYN     10
51      SYNACK  10
52  ACK     10
63  FINACK      10
68      ACK 10
89      FINACK  10
90  ACK     10
53  SYN     11
54      SYNACK  11
55  ACK     11
64  FINACK      11
69      ACK 11
93      FINACK  11
94  ACK     11
56  SYN     12
57      RSTACK  12
58  SYN     13
59      RSTACK  13
70  SYN     14
71      RSTACK  14
72  SYN     15
73      RSTACK  15
74  SYN     16
75      RSTACK  16
76  SYN     17
77      RSTACK  17
80  SYN     18
81      SYNACK  18
82  ACK     18
83  PSHACK      18
84      ACK 18
91  FINACK      18
92      ACK 18
95      FINACK  18
96  ACK     18</code></p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/tcp.stream/" class="post-tag tag-link-tcp.stream"
                                        title="see questions tagged 'tcp.stream'" rel="tag">tcp.stream</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>07 Nov '13, 08:16</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/ed4374aa147ed1279961c32dccfe9e85?s=32&amp;d=identicon&amp;r=g" alt="malhenry's gravatar image" />
    <p><a href="/users/4988/malhenry">malhenry</a><br/>
    <span class="score" title="21 reputation points">21</span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="5 badges"><span class="silver">&#9679;</span><span class="badgecount">5</span></span><span title="9 badges"><span class="bronze">&#9679;</span><span class="badgecount">9</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="malhenry has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/26721/">
                edited
                <strong>07 Nov '13, 09:54</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
            <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
            <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-26721">
    
        <a name="26722"></a>
        <div class="comment" id="comment-26722">
            <div id="post-26722-score" class="comment-score"></div>
            <div class="comment-text"><p>I do not believe the socket is closed during the time of RSTACK.  Also TCP conversation 18 seems to be successful after 6 failed connections.</p></div>
            <div class="comment-info" id="comment-26722-info">
                
                
                
                

                

                <span class="comment-age">(07 Nov '13, 08:21)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26727"></a>
        <div class="comment" id="comment-26727">
            <div id="post-26727-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for the edit Jasper!</p></div>
            <div class="comment-info" id="comment-26727-info">
                
                
                
                

                

                <span class="comment-age">(07 Nov '13, 10:13)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26741"></a>
        <div class="comment" id="comment-26741">
            <div id="post-26741-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>with a RSTACK response sent by my server. Does anyone know why?</p>
</blockquote>

<p>impossible to tell without further information.</p>

<ul>
<li>what is the OS and version of the server</li>
<li>is there a firewall involved</li>
<li>how do you scan (which tool)</li>
<li>what do you scan (same port over and over again, or different ports)</li>
<li>what are the time deltas between the frames</li>
<li>can you post a full capture file, instead of just the text output</li>
</ul></div>
            <div class="comment-info" id="comment-26741-info">
                
                
                
                

                

                <span class="comment-age">(07 Nov '13, 15:38)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="26779"></a>
        <div class="comment" id="comment-26779">
            <div id="post-26779-score" class="comment-score"></div>
            <div class="comment-text"><p>The server is Windows Server 2008 R2 as a VMware VM.
The firewall is disabled.
There is no AV running on the server.
The scanner is QualysGuard it is doing a PCI scan which involves many ports and tests (which Qualys does not describe in detail).
Every time this scan is run, Qualys says there was 7 good connections followed by 3 bad.  Well there are more than 10 TCP streams in this capture.  Qualys says there are two phases to the scan: discovery and vuln testing and that maybe the discovery packets are not included in their logging.
I will see if I can at least post the deltas....not sure I can post the capture file.</p>

<p>Thanks.</p></div>
            <div class="comment-info" id="comment-26779-info">
                
                
                
                

                

                <span class="comment-age">(08 Nov '13, 08:27)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26790"></a>
        <div class="comment" id="comment-26790">
            <div id="post-26790-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>not sure I can post the capture file.</p>
</blockquote>

<p>O.K. as an alternative, can you please post the output of the following command:</p>

<blockquote>
<p>tshark -nr tcpinfo.dump.pcap -T fields -e frame.number -e frame.time_relative -e ip.src -e ip.dst -e ip.id -e tcp.srcport -e tcp.dstport -e tcp.flags -e tcp.seq -e tcp.ack</p>
</blockquote>

<p>If you want, you can replace the real IP addresses with dummy values (search - replace in a text editor).</p></div>
            <div class="comment-info" id="comment-26790-info">
                
                
                
                

                

                <span class="comment-age">(08 Nov '13, 15:42)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-26721" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-26721-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="26794"></a>
                    <div id="answer-container-26794" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-26794-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/26794/up/" rel="nofollow"> </a>
<div id="post-26794-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-26794-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/26794/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>When you sort the packets chronologically it is obvious that your server only allows 5 concurrent connections from the same client. </p>
<p><strong>This seems to be caused by the SOMAXCONN limit as a forum thread in <a href="http://stackoverflow.com/questions/4709756/listen-maximum-queue-size-per-windows-version">stackoverflow.com</a> suggests.</strong></p>
<p>When streams 12-17 send their SYNs we still have 7-11 in an established state. </p>
<p>As soon as the server closes stream 7 the next SYN (stream 18) gets in.</p>
<p><img alt="alt text" src="https://osqa-ask.wireshark.org/upfiles/SYNRST.PNG"></p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/26794/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Nov '13, 22:22</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/5500bd1decb766660522dfb347eedc49?s=32&amp;d=identicon&amp;r=g" alt="mrEEde's gravatar image" />
    <p><a href="/users/4668/mreede">mrEEde</a><br/>
    <span class="score" title="3892 reputation points"><span class="">3.9k</span></span><span title="15 badges"><span class="badge1">&#9679;</span><span class="badgecount">15</span></span><span title="22 badges"><span class="silver">&#9679;</span><span class="badgecount">22</span></span><span title="70 badges"><span class="bronze">&#9679;</span><span class="badgecount">70</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mrEEde has 48 accepted answers">20&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/26794/">
                edited
                <strong>13 Nov '13, 12:36</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-26794">
    
        <a name="26795"></a>
        <div class="comment" id="comment-26795">
            <div id="post-26795-score" class="comment-score"></div>
            <div class="comment-text"><p>Just see that the state is CLOSEWAIT (FINACK arrived) when the SYN12 comes in...</p></div>
            <div class="comment-info" id="comment-26795-info">
                
                
                
                

                

                <span class="comment-age">(08 Nov '13, 22:27)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="26907"></a>
        <div class="comment" id="comment-26907">
            <div id="post-26907-score" class="comment-score"></div>
            <div class="comment-text"><p>Looks like a good possibility.  I will check the application software.  It would be awesome if you are right.!   Thanks!!
Here is the packet capture - <a href="http://cloudshark.org/captures/28fee41588d1">http://cloudshark.org/captures/28fee41588d1</a></p></div>
            <div class="comment-info" id="comment-26907-info">
                
                
                
                

                

                <span class="comment-age">(12 Nov '13, 14:52)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26949"></a>
        <div class="comment" id="comment-26949">
            <div id="post-26949-score" class="comment-score"></div>
            <div class="comment-text"><p>The trace shows the server is being scanned by Linux and the Windows server is rejecting SYN packets whenever there are more than 5 active connections to the client.</p></div>
            <div class="comment-info" id="comment-26949-info">
                
                
                
                

                

                <span class="comment-age">(13 Nov '13, 07:49)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="26955"></a>
        <div class="comment" id="comment-26955">
            <div id="post-26955-score" class="comment-score"></div>
            <div class="comment-text"><p>This may not be the best forum for the following post.  If there is one more appropriate, please inform.
Ultimately I have to have development change our server software in order to pass the PCI scan.  One bandaid is to increase the number of open connections in the listen call to the number that the scanner will request on this port, but this seems like a kludge.  So I am trying to figure out a better solution.
I wonder if timing is an issue.  For example I notice in tcp.stream 7 that:
our server responds to syn with synack in .00004 sec
our server responds to finack with ack in .00003 s
our server responds to ack with finack in 3.5 s
Is this because the overhead of tearing down a connection?  Or is something wrong with our server.
Thanks...</p></div>
            <div class="comment-info" id="comment-26955-info">
                
                
                
                

                

                <span class="comment-age">(13 Nov '13, 11:23)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26962"></a>
        <div class="comment" id="comment-26962">
            <div id="post-26962-score" class="comment-score"></div>
            <div class="comment-text"><p>Your problem was discussed in <a href="http://stackoverflow.com/questions/4709756/listen-maximum-queue-size-per-windows-version">http://stackoverflow.com/questions/4709756/listen-maximum-queue-size-per-windows-version</a></p>

<p>YOur server is actively closing idle connections after exactly 5 seconds, this is why you see the FIN_ACK going out that late in stream 7.</p></div>
            <div class="comment-info" id="comment-26962-info">
                
                
                
                

                

                <span class="comment-age">(13 Nov '13, 12:38)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="26968"></a>
        <div class="comment not_top_scorer" id="comment-26968">
            <div id="post-26968-score" class="comment-score"></div>
            <div class="comment-text"><p>Great link!  Can I assume that you are saying to examine my keepalive tcp parameter in light of the needs of my application?    <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html">http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/overview.html</a>  Thanks.</p></div>
            <div class="comment-info" id="comment-26968-info">
                
                
                
                

                

                <span class="comment-age">(13 Nov '13, 14:32)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="26984"></a>
        <div class="comment not_top_scorer" id="comment-26984">
            <div id="post-26984-score" class="comment-score"></div>
            <div class="comment-text"><p>No, TCP Keepalive is not involved here. 
What I was trying to say is that when a client connects to your server and does not send the expected data (or no data at all), your server will close the connection 5 seconds after the accept(). This is a timer in your server application</p></div>
            <div class="comment-info" id="comment-26984-info">
                
                
                
                

                

                <span class="comment-age">(13 Nov '13, 22:44)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="27007"></a>
        <div class="comment not_top_scorer" id="comment-27007">
            <div id="post-27007-score" class="comment-score"></div>
            <div class="comment-text"><p>In looking at stream 7, the only 5 second delta that I see is between the 3 way handshake and FinAck sent by my windows 2012 server in response to the FinAck sent by the scanner.  So the original finack is sent by the scanner.  So unless I am mistaken,  I think my server is responding to a finack packet, rather than a timer expiring.  Comments?</p>

<p>In any event, are you referring to the Fin_wait_2 timer <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff550023(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/hardware/ff550023(v=vs.85).aspx</a> ?  My earlier analysis 4 posts ago was slightly wrong.  The ack and finack (packets 65 and 78) sent by my server were in response to the finack sent by the scanner.<br>
</p>

<p>The largest delta between any consecutive packets in stream 7 is between packets 65 ack and 78 finack which are both sent by my server.  Is a 3.5 sec delay between an ack and finack normal for a windows 2008 R2 server on a Hyper-V vm?  My server is not under heavy load.
Lastly doesn't the accept() call map to the action of pulling a connection out of the socket receive buffer?  If so, I don't think that there is a packet that corresponds to this action and therefore there is no way to tell in wireshark when an accept() occurred.  Am I mistaken?  Thanks.</p></div>
            <div class="comment-info" id="comment-27007-info">
                
                
                
                

                

                <span class="comment-age">(14 Nov '13, 07:52)</span>
                <a class="comment-user userinfo" href="/users/4988/malhenry">malhenry</a>
                
            </div>
        </div>
    
        <a name="27049"></a>
        <div class="comment not_top_scorer" id="comment-27049">
            <div id="post-27049-score" class="comment-score"></div>
            <div class="comment-text"><p>"I think my server is responding to a finack packet, rather than a timer expiring. Comments?" 
While it is true that the finack packet acks the scanner's FIN packet I would think it is too much of a coincidence that the delta time between frame 41 and frame 78 <a href="http://cloudshark.org/captures/28fee41588d1?filter=frame.number%3D%3D41%20or%20frame.number%3D%3D78">http://cloudshark.org/captures/28fee41588d1?filter=frame.number%3D%3D41%20or%20frame.number%3D%3D78</a> is almost exactly 5 seconds. So my feeling is, the server didn't get notified that a fin has arrived and the server wakes up after its own 5 secs idle timer popped</p></div>
            <div class="comment-info" id="comment-27049-info">
                
                
                
                

                

                <span class="comment-age">(16 Nov '13, 06:46)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="27050"></a>
        <div class="comment not_top_scorer" id="comment-27050">
            <div id="post-27050-score" class="comment-score"></div>
            <div class="comment-text"><p>"In any event, are you referring to the Fin_wait_2 timer" No, the FINWAIT2 timer starts when your server closes the connection and TCP is waiting for the scanner's ACK to your FIN.</p></div>
            <div class="comment-info" id="comment-27050-info">
                
                
                
                

                

                <span class="comment-age">(16 Nov '13, 06:49)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="27051"></a>
        <div class="comment not_top_scorer" id="comment-27051">
            <div id="post-27051-score" class="comment-score"></div>
            <div class="comment-text"><p>"Lastly doesn't the accept() call map to the action of pulling a connection out of the socket receive buffer?" Not from the TCP receive buffer but from the listener's backlog queue</p></div>
            <div class="comment-info" id="comment-27051-info">
                
                
                
                

                

                <span class="comment-age">(16 Nov '13, 06:51)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-26794" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 11
        </span>
        <a href="#" class="show-all-comments-link">show 6 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-26794-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="27009"></a>
                    <div id="answer-container-27009" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-27009-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/27009/up/" rel="nofollow"> </a>
<div id="post-27009-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-27009-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/27009/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <blockquote>
<p>Ultimately <strong>I have to have development change our server software</strong> in order <strong>to pass the PCI scan</strong>.</p>
</blockquote>
<p>That's a rather bad idea and unfortunately a (common) result of totally useless and dumb PCI scans, just to pass that scan. </p>
<p>First: The tool scans the same port over and over again. What kind of security problem do they (Qualys) think to find by that kind of scan?</p>
<p>Secondly: The scanner of Qualys is kind of broken, as it scans the sever with <strong>source port</strong>  9150 (seems to be the destination port on the server), which results in a TCP Reset from either the firewall or the server itself. See Frame#4 in <a href="http://cloudshark.org/captures/28fee41588d1">http://cloudshark.org/captures/28fee41588d1</a> How much sense does that make?</p>
<p>{<strong>RANT:</strong> So, instead of 'fixing' your server software go back to Qualys and ask them to fix their scanner ;-)) Maybe your server software is <strong>not broken</strong>, and it has good reasons to allow only a certain number of concurrent connections from one client. That could be a security measure in itself. So, by 'fixing' that behavior, you might pass a <strong>dumb</strong> PCI scan, but actually you might also <strong>weaken the security</strong> of your server software. </p>
<p>But let's be honest: PCI scans are not about improving security. It's all about passing a bunch of dumb tests and getting a certificate ;-)  }</p>
<p>BTW: Is there a firewall between the client and the server? There should/must be one, if you want to pass a PCI audit ;-)). </p>
<p>Did you check what the firewall does to those scanning tests. Maybe it's the firewall and not the server software that limits the number of concurrent connections.</p>
<p>Regards <br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/27009/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>14 Nov '13, 08:18</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/27009/">
                edited
                <strong>14 Nov '13, 08:20</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-27009">
    
        <a name="27052"></a>
        <div class="comment" id="comment-27052">
            <div id="post-27052-score" class="comment-score"></div>
            <div class="comment-text"><p>Just curious: How did you know it was Qualys? Any indication in the trace ?</p></div>
            <div class="comment-info" id="comment-27052-info">
                
                
                
                

                

                <span class="comment-age">(16 Nov '13, 06:54)</span>
                <a class="comment-user userinfo" href="/users/4668/mreede">mrEEde</a>
                
            </div>
        </div>
    
        <a name="27055"></a>
        <div class="comment" id="comment-27055">
            <div id="post-27055-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/4988/malhenry">@malhenry</a> mentioned it in a comment.</p></div>
            <div class="comment-info" id="comment-27055-info">
                
                
                
                

                

                <span class="comment-age">(16 Nov '13, 14:29)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-27009" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-27009-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/26721/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='U99PdF9Zl88h0gbMnUXoRXqREV0NTOB6' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/26721/why-am-i-getting-rstack-packet-after-syn?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tcp.stream/"
            class="tag-link-tcp.stream"
            title="see questions tagged'tcp.stream'using tags"
            rel="tag">tcp.stream</a> <span class="tag-number">&#215;18</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Nov. 7, 2013, 8:16 a.m.">07 Nov '13, 08:16</strong>
    </p>
    <p> 
     	question was seen: <strong>3,032 times</strong>
    </p>
    <p> 
        last updated: <strong title="Nov. 16, 2013, 2:29 p.m.">16 Nov '13, 14:29</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/5111/how-can-i-tshark-a-folder-full-of-tracefiles-for-the-biggest-tcp-stream-in-each-trace">How can i tshark a folder full of tracefiles for the biggest tcp stream in each trace?</a>
        </p>
        
        <p>
            <a href="/questions/63469/tcpstream-vs-tcpseq">TCP.Stream VS TCP.Seq</a>
        </p>
        
        <p>
            <a href="/questions/5396/follow-multiple-tcp-streams">Follow multiple TCP streams</a>
        </p>
        
        <p>
            <a href="/questions/9354/how-can-follow-the-tcp-stream-in-batch">How can follow the tcp stream in batch?</a>
        </p>
        
        <p>
            <a href="/questions/10023/command-line-option-for-follow-tcp-stream">command line option for &quot;Follow tcp stream&quot;</a>
        </p>
        
        <p>
            <a href="/questions/14811/follow-tcp-stream-with-tshark-still-can-not-in-batch-mode">Follow tcp stream with tshark still can not in batch mode?</a>
        </p>
        
        <p>
            <a href="/questions/16558/reconstruct-tcp-conversation">Reconstruct TCP conversation</a>
        </p>
        
        <p>
            <a href="/questions/16592/tcp-stream-output-in-pdml-format">TCP Stream output in Pdml format</a>
        </p>
        
        <p>
            <a href="/questions/28965/reading-pcap-file-in-c-or-c">reading pcap file in C# or C++</a>
        </p>
        
        <p>
            <a href="/questions/31330/tcp-streams-and-their-dns-counterpart">TCP Streams and their DNS counterpart...</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
