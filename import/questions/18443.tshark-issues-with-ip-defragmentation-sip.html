<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>tshark - Issues with IP Defragmentation - SIP - Wireshark Q&amp;A</title>
        <meta name="description" content="I have a problem reading pcap files that have fragmented packets with tshark. My expectaion is tshark will re-assemble the fragmented IP packets before it passes them to the higher layer dissectors. But this doesnt appear to happen. If I open the same file with the Wireshark GUI application it does ..." />
        <meta name="keywords" content="reassembly,fragmentation,sip,tshark,reassemble" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/18443/tshark-issues-with-ip-defragmentation-sip" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='JIWMaFQzyBbXPXq7wmOPXjHyOkqjvtHB' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/18443/tshark-issues-with-ip-defragmentation-sip">tshark - Issues with IP Defragmentation - SIP</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-18443-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18443/up/" rel="nofollow"> </a>
<div id="post-18443-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-18443-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18443/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/18443/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I have a problem reading pcap files that have fragmented packets with tshark. My expectaion is tshark will re-assemble the fragmented IP packets before it passes them to the higher layer dissectors. But this doesnt appear to happen. If I open the same file with the Wireshark GUI application it does this fine.</p>
<p>Should I be able to do this with tshark on the command line? I have tried various tshark versions and get the same result. 1.4x, 1.6.7 and 1.8.2. I have also tried overriding the default sip.defragment option.</p>
<p>As an example I am searching pcap files (dumped with tcpump) for SIP calls. But the SIP dissector doesnt recognise the packets because they are still fragmented. So if I look at the first 10 packets in the file is see:</p>
<p><code>
$ tshark -r 218423_1.cap00 -c 10
  1   0.000000 10.0.226.129 -&gt; 10.0.226.133 SIP 1251 Request: OPTIONS sip:10.0.226.133;transport=tcp
  2   0.000835 10.0.226.133 -&gt; 10.0.226.129 SIP 1337 Status: 200 OK
  3   5.091195 10.0.226.133 -&gt; 10.0.226.129 SIP/SDP 1025 Request: INVITE sip:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1121232122272624212121215120213f213f2323273f202328">[email&#160;protected]</a>;user=phone, with session description
  4   5.094097 10.0.226.129 -&gt; 10.0.226.133 SIP 359 Status: 100 Trying
  5   5.122237 10.0.226.129 -&gt; 10.0.226.133 IPv4 132 Fragmented IP protocol (proto=UDP 17, off=1480, ID=d618)
  6   5.169126 10.0.226.129 -&gt; 10.0.226.133 IPv4 825 Fragmented IP protocol (proto=UDP 17, off=1480, ID=d619)
  7   5.171658 10.0.226.133 -&gt; 10.0.226.129 SIP 840 Status: 100 Trying
  8   5.176699 10.0.226.129 -&gt; 10.0.226.134 RTP 218 PT=ITU-T G.711 PCMA, SSRC=0x33B61227, Seq=1, Time=0 
  9   5.177610 10.0.226.129 -&gt; 10.0.226.134 RTCP 134 Receiver Report   Source description <br>
 10   5.196590 10.0.226.129 -&gt; 10.0.226.134 RTP 218 PT=ITU-T G.711 PCMA, SSRC=0x33B61227, Seq=2, Time=160 
</code></p>
<p>As you can see #5 and 6 show as fragmented. If I try to pass this through a sip filter it wont find those packets so it doesnt appear to be re-assembling them in the same way wireshark application does.</p>
<p><code>
$ tshark -r 218423_1.cap00 sip -c 10
  1   0.000000 10.0.226.129 -&gt; 10.0.226.133 SIP 1251 Request: OPTIONS sip:10.0.226.133;transport=tcp
  2   0.000835 10.0.226.133 -&gt; 10.0.226.129 SIP 1337 Status: 200 OK
  3   5.091195 10.0.226.133 -&gt; 10.0.226.129 SIP/SDP 1025 Request: INVITE sip:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fdcdcfcdcecbcac8cdcdcdcdbdcccdd3cdd3cfcfcbd3cccfc4">[email&#160;protected]</a>;user=phone, with session description
  4   5.094097 10.0.226.129 -&gt; 10.0.226.133 SIP 359 Status: 100 Trying
  7   5.171658 10.0.226.133 -&gt; 10.0.226.129 SIP 840 Status: 100 Trying
 12   5.216181 10.0.226.129 -&gt; 10.0.226.133 SIP 1026 Request: PRACK sip:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6e5e595658595f565e5e5e5e2e5f5e405e405c5c58405f5d5d">[email&#160;protected]</a>:5060
 14   5.219458 10.0.226.133 -&gt; 10.0.226.129 SIP 1385 Status: 200 OK
483   8.250769 10.0.226.133 -&gt; 10.0.226.129 SIP 1498 Status: 180 Ringing
487   8.267270 10.0.226.129 -&gt; 10.0.226.133 SIP 1028 Request: PRACK sip:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4777707f7170767f7777777707767769776975757169767474">[email&#160;protected]</a>:5060
488   8.270899 10.0.226.133 -&gt; 10.0.226.129 SIP 1387 Status: 200 OK
</code></p>
<p>As can be seen packets 5 and 6 (which in this I know form an INVITE) dont get shown. I have also tried the <code>-o ip.defragment:TRUE</code> and also writing the output to file but it still doesnt change anything.</p>
<p>For reference I am capturing them with tcpdump using the following BPF: <code>( vlan and (port 5060 or ip[6:2] &amp; 0x1fff != 0 ))</code></p>
<p>Any Advice would be much appreciated</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/reassembly/" class="post-tag tag-link-reassembly"
                                        title="see questions tagged 'reassembly'" rel="tag">reassembly</a>
                                
                                    <a href="/tags/fragmentation/" class="post-tag tag-link-fragmentation"
                                        title="see questions tagged 'fragmentation'" rel="tag">fragmentation</a>
                                
                                    <a href="/tags/sip/" class="post-tag tag-link-sip"
                                        title="see questions tagged 'sip'" rel="tag">sip</a>
                                
                                    <a href="/tags/tshark/" class="post-tag tag-link-tshark"
                                        title="see questions tagged 'tshark'" rel="tag">tshark</a>
                                
                                    <a href="/tags/reassemble/" class="post-tag tag-link-reassemble"
                                        title="see questions tagged 'reassemble'" rel="tag">reassemble</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>08 Feb '13, 02:12</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/04f2459d8c2e3e8f9f9afc61a05fc8d6?s=32&amp;d=identicon&amp;r=g" alt="Marv's gravatar image" />
    <p><a href="/users/4359/marv">Marv</a><br/>
    <span class="score" title="31 reputation points">31</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">&#9679;</span><span class="badgecount">6</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Marv has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-18443">
    
        <a name="18530"></a>
        <div class="comment" id="comment-18530">
            <div id="post-18530-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks Guys,</p>

<p>I have narrowed down the issue and it appears I have made a mistake in the way the files have been captured. On closer inspection Tshark is working fine but something is causing packets with the fragmented flag set to be dropped. This may be an aggregation switch before the capture box or the box itself so will need further investigation. When supplied with a valid file tshark will re-assemble them as expected. I do still have issues with extracting SIP when fragmented packets are present but I will get the capture issues sorted first.</p>

<p>Thanks all for you help an comments. They have helped a great deal in improving the BPF and tracking down the issue.</p>

<p>Cheers
Marv</p></div>
            <div class="comment-info" id="comment-18530-info">
                
                
                
                

                

                <span class="comment-age">(12 Feb '13, 01:10)</span>
                <a class="comment-user userinfo" href="/users/4359/marv">Marv</a>
                
            </div>
        </div>
    
        <a name="18531"></a>
        <div class="comment" id="comment-18531">
            <div id="post-18531-score" class="comment-score"></div>
            <div class="comment-text"><p>Your answer has been converted to a comment as that's how this site works. Please read the FAQ for more information.</p>

<p>If an answer has solved your issue, please accept the answer for the benefit of other users by clicking the checkmark icon next to the answer. Please read the FAQ for more information.</p></div>
            <div class="comment-info" id="comment-18531-info">
                
                
                
                

                

                <span class="comment-age">(12 Feb '13, 01:59)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-18443" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18443-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="18444"></a>
                    <div id="answer-container-18444" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18444-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18444/up/" rel="nofollow"> </a>
<div id="post-18444-score" class="post-score"
    title="current number of votes">
    3
</div>
<a id="post-18444-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18444/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>You're missing the first part of your IP fragmented packets. That's because you drop them with your capture filter.</p>
<p>That filter says:</p>
<p><code>vlan</code></p>
<p>oke, your on a vlan, make sure there's a tag and compensate for it,</p>
<p><code>and (port 5060</code></p>
<p>oke, you want UDP (and TCP) port 5060, the SIP signaling port,</p>
<p><code>or ip[6:2] &amp; 0x1fff != 0 )</code></p>
<p>not oke, you don't want to have IP fragments with offsets multiple of 8.191. This includes offset 0, the start of the fragmented packets you are missing. Mind you, without reassembled IP packets, there is no UDP datagram that can be dissected to match the <code>port 5060</code> filter.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18444/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Feb '13, 02:57</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" alt="Jaap's gravatar image" />
    <p><a href="/users/4/jaap">Jaap ♦</a><br/>
    <span class="score" title="11680 reputation points"><span class="">11.7k</span></span><span title="16 badges"><span class="silver">&#9679;</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">&#9679;</span><span class="badgecount">101</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jaap has 155 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18444">
    
</div>
<div id="comment-tools-18444" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18444-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="18450"></a>
                    <div id="answer-container-18450" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18450-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18450/up/" rel="nofollow"> </a>
<div id="post-18450-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-18450-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18450/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>It looks like your filter is OK, it captures all frames with TCP and UDP port 5060 and all frames that have an IP fragment offset of non-zero. But this means your filter will also catch IP fragments that were not for port 5060. So the fragments that you are referring too might not be SIP at all.</p>
<p>Then again, you say wireshark shows the packets fine. From the output of the packet it looks like</p>
<ol>
<li>
<p><strong>either the first fragments of packets 5 and 6 are not in the capture file.</strong> What is the output of <code>tshark -r 218423_1.cap00 -R "ip.id==0xd618 or ip.id==0xd619"</code>? Do you see only the two fragments or also the first parts of these IP packets? I expect to see only two fragments, as there were no frames with len=1500 (20 bytes IP header and 1480 bytes IP payload) before packet 5.)</p>
</li>
<li>
<p><strong>or IP reassembly is not enabled in the profile that tshark uses</strong> in which case you might want to try <code>tshark -o ip.defragment:TRUE -nlr 218423_1.cap00 -R sip</code></p>
</li>
</ol>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18450/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Feb '13, 13:08</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18450">
    
</div>
<div id="comment-tools-18450" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18450-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="18449"></a>
                    <div id="answer-container-18449" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18449-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18449/up/" rel="nofollow"> </a>
<div id="post-18449-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-18449-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18449/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <blockquote>
<p>My expectaion is tshark will re-assemble the fragmented IP packets before it passes them to the higher layer dissectors. </p>
</blockquote>
<p>Yes, it should/will do that.</p>
<blockquote>
<p>But this doesnt appear to happen. <strong>If I open the same file</strong> with the <strong>Wireshark GUI</strong> application <strong>it does this fine</strong>.</p>
</blockquote>
<p>O.K. you are saying, that for the <strong>identical</strong> file (captured with the BPF you mentioned) de-fragmentation works in Wireshark and it does not work in tshark?</p>
<p>If so, can you please upload the file somewhere (google docs, cloudshark.org, one-click file hoster. BEWARE the privacy issues in doing so!), so we can check ourselves?</p>
<p>BTW: Did you capture the whole frame (option -s0)? If you did not, you will get problems during de-fragmentation.</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18449/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Feb '13, 12:27</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/18449/">
                edited
                <strong>08 Feb '13, 12:29</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18449">
    
</div>
<div id="comment-tools-18449" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18449-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/18443/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='JIWMaFQzyBbXPXq7wmOPXjHyOkqjvtHB' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/18443/tshark-issues-with-ip-defragmentation-sip?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tshark/"
            class="tag-link-tshark"
            title="see questions tagged'tshark'using tags"
            rel="tag">tshark</a> <span class="tag-number">&#215;832</span><br/>
        
        <a href="/tags/sip/"
            class="tag-link-sip"
            title="see questions tagged'sip'using tags"
            rel="tag">sip</a> <span class="tag-number">&#215;109</span><br/>
        
        <a href="/tags/reassembly/"
            class="tag-link-reassembly"
            title="see questions tagged'reassembly'using tags"
            rel="tag">reassembly</a> <span class="tag-number">&#215;78</span><br/>
        
        <a href="/tags/fragmentation/"
            class="tag-link-fragmentation"
            title="see questions tagged'fragmentation'using tags"
            rel="tag">fragmentation</a> <span class="tag-number">&#215;30</span><br/>
        
        <a href="/tags/reassemble/"
            class="tag-link-reassemble"
            title="see questions tagged'reassemble'using tags"
            rel="tag">reassemble</a> <span class="tag-number">&#215;27</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Feb. 8, 2013, 2:12 a.m.">08 Feb '13, 02:12</strong>
    </p>
    <p> 
     	question was seen: <strong>8,028 times</strong>
    </p>
    <p> 
        last updated: <strong title="Feb. 12, 2013, 1:59 a.m.">12 Feb '13, 01:59</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/61912/handling-missing-fragments-while-reassembling">Handling missing fragments while reassembling</a>
        </p>
        
        <p>
            <a href="/questions/38533/reassembly-without-byte-or-fragment-alignment">Reassembly without Byte or Fragment Alignment</a>
        </p>
        
        <p>
            <a href="/questions/61954/my-dissector-is-processing-the-first-packet-multiple-times">My dissector is processing the first packet multiple times.</a>
        </p>
        
        <p>
            <a href="/questions/8562/fragmentation-problems">Fragmentation problems</a>
        </p>
        
        <p>
            <a href="/questions/5691/multi-file-search">Multi-file search</a>
        </p>
        
        <p>
            <a href="/questions/46802/is-the-output-complete-after-omitting-tcp-segment-of-reassembled-pdu">Is the output complete after omitting [TCP segment of reassembled PDU]?</a>
        </p>
        
        <p>
            <a href="/questions/23222/how-can-i-reassemble-fragments-from-two-different-datagrams-in-the-same-frame">How can I reassemble fragments from two different datagrams in the same frame?</a>
        </p>
        
        <p>
            <a href="/questions/27018/tshark-sip-statistics">tshark SIP Statistics</a>
        </p>
        
        <p>
            <a href="/questions/2289/enabling-reassembly-of-tcp-packets">Enabling reassembly of TCP packets</a>
        </p>
        
        <p>
            <a href="/questions/35448/question-about-filter-the-sip-by-tshark">Question about Filter the SIP by tshark</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
