<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>tshark memory usage - explanation needed - Wireshark Q&amp;A</title>
        <meta name="description" content="In the following question, @hoangsonk49 claims that he is running tshark continuously for 6 months without getting any memory usage problems, as predicted by the Wiki. Question:    http://ask.wireshark.org/questions/25091/wireshark-tshark-out-of-memory-problem  Last comment/answer of @hoangsonk49:  ..." />
        <meta name="keywords" content="out-of-memory,tshark,memory" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/34035/tshark-memory-usage-explanation-needed" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/34035/tshark-memory-usage-explanation-needed?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='UtWovpRunyBcewQasNHV6Ksb5mf3293H' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/34035/tshark-memory-usage-explanation-needed">tshark memory usage - explanation needed</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-34035-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/34035/up/" rel="nofollow"> </a>
<div id="post-34035-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-34035-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/34035/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/34035/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>In the following question, <a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49">@hoangsonk49</a></a></a> claims that he is running tshark <strong>continuously</strong> for 6 months without getting any memory usage problems, <a href="http://wiki.wireshark.org/KnownBugs/OutOfMemory">as predicted by the Wiki</a>.</p>
<p>Question: <br>
</p>
<blockquote>
<p><a href="http://ask.wireshark.org/questions/25091/wireshark-tshark-out-of-memory-problem">http://ask.wireshark.org/questions/25091/wireshark-tshark-out-of-memory-problem</a></p>
</blockquote>
<p>Last comment/answer of <a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49">@hoangsonk49</a></a></a>: <br>
</p>
<blockquote>
<p><a href="http://ask.wireshark.org/questions/25091/wireshark-tshark-out-of-memory-problem/33952">http://ask.wireshark.org/questions/25091/wireshark-tshark-out-of-memory-problem/33952</a></p>
</blockquote>
<p>Presumably he is using the following command:</p>
<blockquote>
<p>nohup tshark -i 5 -P -w /tmp/Log.pcap -b filesize:655350|split -b 655350000 -a 10 - /tmp/log/call_log- &amp;</p>
</blockquote>
<p>My understanding of the dissection engine is the following:</p>
<p>Running tshark on a link without any filter (I'm waiting for a comment of <a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49"><a href="/users/5593/hoangsonk49">@hoangsonk49</a></a></a> on that issue), he <strong>should</strong> run into a memory problem sooner or later, as almost every dissector creates <strong>at least</strong> an entry in the conversation hash tables. Some dissectors also add additional data to a conversation (e.g. HTTP). </p>
<pre>get_http_conversation_data(packet_info *pinfo)
{
    conversation_t  *conversation;
    http_conv_t *conv_data;

    conversation = find_or_create_conversation(pinfo);

    /* Retrieve information from conversation
     * or add it if it isn't there yet
     */
    conv_data = (http_conv_t *)conversation_get_proto_data(conversation, proto_http);
    if(!conv_data) {
        /* Setup the conversation structure itself */
        conv_data = (http_conv_t *)wmem_alloc0(wmem_file_scope(), sizeof(http_conv_t));
        conversation_add_proto_data(conversation, proto_http, conv_data);
    }
    return conv_data;
}
</pre>

<p>So, the hash table will keep growing as long as tshark is running. Furthermore, there should be other data structures as well in certain dissectors, which would increase the memory usage even more.</p>
<p>At least that's my understanding of the dissection engine.</p>
<p>So, if he <strong>does not see any increase in memory usage</strong> after running tshark for 6 months (just my interpretation of his comments), my understanding of the dissection engine might be wrong.</p>
<p>Any idea why tshark does not crash with an out of memory error after running it <strong>continuously</strong> for 6 months? </p>
<p>Is there anything in tshark that clears 'old data structures' if it is running in the way described above? I was not able to find such a thing in the code!?! </p>
<p>Thanks! <br>
Kurt</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/out-of-memory/" class="post-tag tag-link-out-of-memory"
                                        title="see questions tagged 'out-of-memory'" rel="tag">out-of-memory</a>
                                
                                    <a href="/tags/tshark/" class="post-tag tag-link-tshark"
                                        title="see questions tagged 'tshark'" rel="tag">tshark</a>
                                
                                    <a href="/tags/memory/" class="post-tag tag-link-memory"
                                        title="see questions tagged 'memory'" rel="tag">memory</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>22 Jun '14, 08:25</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/34035/">
                edited
                <strong>22 Jun '14, 08:47</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-34035">
    
</div>
<div id="comment-tools-34035" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-34035-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/34035/tshark-memory-usage-explanation-needed?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/34035/tshark-memory-usage-explanation-needed?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/34035/tshark-memory-usage-explanation-needed?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/34035/tshark-memory-usage-explanation-needed?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="34037"></a>
                    <div id="answer-container-34037" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-34037-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/34037/up/" rel="nofollow"> </a>
<div id="post-34037-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-34037-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/34037/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Either he's modified the source code directly (in a non-trivial way) or he's seeing <em>very</em> little traffic.</p>
<p>Or, potentially, he's running it via a system like upstart or systemd which automatically restarts crashed processes, in which case it does restart every couple of days he's just never noticed.</p>
<p>Tangentially: I had a hack at one point of just a couple of lines which would wipe out all state after each packet, letting tshark run in "stateless" mode but I've lost it and I don't know if it ever worked all that well in the first place.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/34037/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>22 Jun '14, 09:18</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=32&amp;d=identicon&amp;r=g" alt="eapache's gravatar image" />
    <p><a href="/users/5156/eapache">eapache</a><br/>
    <span class="score" title="41 reputation points">41</span><span title="3 badges"><span class="bronze">&#9679;</span><span class="badgecount">3</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="eapache has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-34037">
    
        <a name="34042"></a>
        <div class="comment" id="comment-34042">
            <div id="post-34042-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Or, potentially, he's running it via a system like upstart or systemd which automatically restarts crashed processes</p>
</blockquote>

<p>hm.. that's actually a possible explanation, and that's why I asked him to confirm that it's the same process (same PID) running for 6 months. I'm waiting for an answer.</p></div>
            <div class="comment-info" id="comment-34042-info">
                
                
                
                

                

                <span class="comment-age">(22 Jun '14, 10:43)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="34046"></a>
        <div class="comment" id="comment-34046">
            <div id="post-34046-score" class="comment-score"></div>
            <div class="comment-text"><p>I dug up my hack code and cleaned it up a bit and submitted it as a Work-In-Progress for code review: <a href="https://code.wireshark.org/review/2559/">https://code.wireshark.org/review/2559/</a></p></div>
            <div class="comment-info" id="comment-34046-info">
                
                
                
                

                

                <span class="comment-age">(22 Jun '14, 14:02)</span>
                <a class="comment-user userinfo" href="/users/5156/eapache">eapache</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-34037" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-34037-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="34039"></a>
                    <div id="answer-container-34039" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-34039-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/34039/up/" rel="nofollow"> </a>
<div id="post-34039-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-34039-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/34039/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Maybe the traffic he's capturing doesn't have the usual memory creation issues.  He said in his post he was looking at CAMEL protocol, which I guess means he's capturing M3UA/SCTP (right?)... and a quick peek at SCTP's dissector code doesn't show it creating conversations like UDP and TCP does.  So if all he's capturing is traffic between two SS7 systems or something similar, maybe he just doesn't have the type of packet traffic that would have the issues.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/34039/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>22 Jun '14, 10:23</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" alt="Hadriel's gravatar image" />
    <p><a href="/users/4318/hadriel">Hadriel</a><br/>
    <span class="score" title="2652 reputation points"><span class="">2.7k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">&#9679;</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">&#9679;</span><span class="badgecount">39</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Hadriel has 30 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-34039">
    
        <a name="34041"></a>
        <div class="comment" id="comment-34041">
            <div id="post-34041-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>So if all he's capturing is traffic between two SS7 systems or something similar, maybe he just doesn't have the type of packet traffic that would have the issues.</p>
</blockquote>

<p>that's what I thought as well, so I asked him if he pre-filtered the traffic, as that would explain it partly. I'm waiting for an answer.</p></div>
            <div class="comment-info" id="comment-34041-info">
                
                
                
                

                

                <span class="comment-age">(22 Jun '14, 10:42)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="34055"></a>
        <div class="comment" id="comment-34055">
            <div id="post-34055-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi all, here are my answers for Kurt 's questions:</p>

<blockquote>
<pre><code>do you see an increased memory usage of the tshark process?
</code></pre>
</blockquote>

<p>At the beginning, I saw an increased memory used of tshark. It reached 10% of 8 GB RAM in one hour and from that moment it works around 15% and I don't see any other increment.</p>

<blockquote>
<pre><code>can you ensure, that its the same tshark process running for 6 months (same PID)?
</code></pre>
</blockquote>

<p>YES, I'm pretty sure because it is the core process of our service. Our engineers check process and log files 3 times everyday, otherwise, if there 's any crash during running,the warning system should send an SMS to all of us automatically. It has the same PID and not able to re-start by itself (the source code was changed to process message but it is still running in the same way with the normal tshark).</p>

<blockquote>
<pre><code>do you pre-filter the traffic on eth0 (switch port/TAP filtering)?
</code></pre>
</blockquote>

<p>NO. In my program, I do run some filters but that happens after decoding messages. I ignore the messages which have decoded values of some parameters do not match our objective.</p>

<p>And here are my answers for some comments above:</p>

<blockquote>
<p>or he's seeing very little traffic</p>
</blockquote>

<p>As you can see my tshark command, the size of each log file is limited by ~650 Mb. This size is reached in about 12 minutes. Also,this is 1/3 traffic of the telco which has about 35 million subscribers, and tshark has to capture a hundred of calls every second. So I think, it is not quite little traffic:-)</p>

<blockquote>
<pre><code>So if all he's capturing is traffic between two SS7 systems or something similar, maybe he just
</code></pre>
<p>doesn't have the type of packet traffic that would have the issues.</p>
</blockquote>

<p>YES, You are right. I run tshark on IN network which has ONLY CAMEL, SCTP message... No other type of packet. Maybe this is the answer for my case :-)</p></div>
            <div class="comment-info" id="comment-34055-info">
                
                
                
                

                

                <span class="comment-age">(23 Jun '14, 00:12)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="34061"></a>
        <div class="comment" id="comment-34061">
            <div id="post-34061-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>YES, You are right. I run tshark on IN network <strong>which has ONLY CAMEL, SCTP message</strong>... </p>
</blockquote>

<p>Maybe that explains it, as <a href="/users/4318/hadriel">@Hadriel</a> said: The SCTP dissector does not create a conversation table entry, however it adds other data structures on its own. Hm...</p>

<p>BTW: Are there many different IP addresses or just a few IP addresses?</p></div>
            <div class="comment-info" id="comment-34061-info">
                
                
                
                

                

                <span class="comment-age">(23 Jun '14, 03:06)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="34101"></a>
        <div class="comment" id="comment-34101">
            <div id="post-34101-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>BTW: Are there many different IP addresses or just a few IP addresses?</p>
</blockquote>

<p>I see many different IP addresses (at least, more than 15 addresses). Some information: When a *.pcap is created, we dissect this file in real-time and when a file is completely decoded and switch to other file, we are able to delete this file without any warning or error. So i think when a pcap was decoded, there is no connection between this file and other data, otherwise, it should not be able to be deleted.</p></div>
            <div class="comment-info" id="comment-34101-info">
                
                
                
                

                

                <span class="comment-age">(23 Jun '14, 18:53)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="35247"></a>
        <div class="comment" id="comment-35247">
            <div id="post-35247-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Kurt, 
we are going to deploy a service which also captures and analyzes the message in IN network. It is similar to the previous service but in this case, the IN network contains only UDP (not CAMEL like the previous telco). According to my understanding, it definitely faces the problem of the memory because of the hashtable in <strong><code>get_udp_conversation_data</code></strong>. So, I have some questions that is not clear to me:</p>

<ul>
<li>I imagine the wireshark code structure like that : </li>
</ul>

<p></p><hr>
<pre><code>    1.Get the message
</code></pre>
<hr>
<pre><code>    2.Classify the protocol
</code></pre>
<hr>
<pre><code>    3.Analyze the data of the message by using the dissector of the protocol
</code></pre>
<hr>
<pre><code>    4.End
</code></pre>
<hr>
<pre><code>My question is: Where is <strong><code>get_udp_conversation_data</code></strong> in this picture ? AND what does it use for?
</code></pre>
<ul>
<li>
<p>Our processing is in the step 3, when we are able to have the useful data, we can stop the analysis and remove the pcap file. No need to store it anymore. So, is it possible to clear the hashtable after our processing OR remove the  Setup the conversation from the code? </p>
</li>
<li>
<p>If we do in this way, is there anything affected?</p>
</li>
</ul>
<p>Thanks!</p><p></p></div>
            <div class="comment-info" id="comment-35247-info">
                
                
                
                

                

                <span class="comment-age">(05 Aug '14, 23:46)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="35251"></a>
        <div class="comment not_top_scorer" id="comment-35251">
            <div id="post-35251-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>My question is: Where is get_udp_conversation_data in this picture ? AND what does it use for?</p>
</blockquote>

<p>that depends on the dissector that gets called on the UDP frame, so what if the protocol on top of UDP?</p></div>
            <div class="comment-info" id="comment-35251-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 01:32)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="35261"></a>
        <div class="comment not_top_scorer" id="comment-35261">
            <div id="post-35261-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>that depends on the dissector that gets called on the UDP frame, so what if the protocol on top of UDP?</p>
</blockquote>

<p>It is <strong>data.data</strong>. In this case, I'm afraid that changing the code of <code>get_udp_conversation_data</code> might affect the data that I want to analyze. So, It means I cannot clear the hash table or remove the Setup of conversation. If the conversation is set up after I get the analysis of data.data, there 's a hope to skip the conversation in order to have a workaround of the memory problem but now, it looks impossible. That 's a bad new.</p>

<p><img alt="alt text" src="https://osqa-ask.wireshark.org/upfiles/Untitled_8.png"></p></div>
            <div class="comment-info" id="comment-35261-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 04:01)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="35264"></a>
        <div class="comment not_top_scorer" id="comment-35264">
            <div id="post-35264-score" class="comment-score"></div>
            <div class="comment-text"><p>Is that one long lasting conversation or many short conversations?</p></div>
            <div class="comment-info" id="comment-35264-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 06:01)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="35266"></a>
        <div class="comment not_top_scorer" id="comment-35266">
            <div id="post-35266-score" class="comment-score"></div>
            <div class="comment-text"><p>that is one long lasting conversation. This is the data to be encoded.</p></div>
            <div class="comment-info" id="comment-35266-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 07:55)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="35267"></a>
        <div class="comment not_top_scorer" id="comment-35267">
            <div id="post-35267-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>that is one long lasting conversation.</p>
</blockquote>

<p>Then there will be only one entry in the hash table, or just a few if tshark runs for several days/weeks/months. That should be no problem at all.</p></div>
            <div class="comment-info" id="comment-35267-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 08:15)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="35269"></a>
        <div class="comment not_top_scorer" id="comment-35269">
            <div id="post-35269-score" class="comment-score"></div>
            <div class="comment-text"><p>maybe I have a misunderstanding. This is one of a thousand messages. Each message has one conversation like that. So at anytime, we capture many data.data to analyze. My question is: can I clear the hashtable or just remove the set up of conversation from the source code ?</p></div>
            <div class="comment-info" id="comment-35269-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 08:41)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="35274"></a>
        <div class="comment not_top_scorer" id="comment-35274">
            <div id="post-35274-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>can I clear the hashtable or just remove the set up of conversation from the source code ?</p>
</blockquote>

<p>well, yes you 'can', but I don't know if there would be any side effects, as I have not yet checked the code, and I'm not sure if I will find the time during the next couple of days.</p></div>
            <div class="comment-info" id="comment-35274-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 11:51)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="35276"></a>
        <div class="comment not_top_scorer" id="comment-35276">
            <div id="post-35276-score" class="comment-score"></div>
            <div class="comment-text"><p>You might be interested by <a href="https://blog.wireshark.org/2014/07/to-infinity-and-beyond-capturing-forever-with-tshark/">https://blog.wireshark.org/2014/07/to-infinity-and-beyond-capturing-forever-with-tshark/</a></p></div>
            <div class="comment-info" id="comment-35276-info">
                
                
                
                

                

                <span class="comment-age">(06 Aug '14, 13:18)</span>
                <a class="comment-user userinfo" href="/users/1538/pascal-quantin">Pascal Quantin</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-34039" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 13
        </span>
        <a href="#" class="show-all-comments-link">show 8 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-34039-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="41454"></a>
                    <div id="answer-container-41454" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-41454-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/41454/up/" rel="nofollow"> </a>
<div id="post-41454-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-41454-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/41454/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>I've used Tshark numerous times, but never for a period of 6 months.</p>
<p>But I have used the following on a WinTel machine for anywhere from 10 ~ 20 days without any errors.</p>
<p>tshark -i 3  -w MyCapture.pcap -s 80 -b filesize:1000000</p>
<p>I dump all my files in 1GB size. Then used Editcap to weed out only the portions I want (usually within 5 ~ 30 minutes prior to and/or after the problem to reduce the 1GB file to a more usable size.</p>
<p>I've had 192GB of data over 7 days and 233GB of data over 20 days, but never experienced any such error.</p>
<p>Cheers,</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/41454/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>15 Apr '15, 06:17</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/08ceaa93ec93bcecf429815ccc39e803?s=32&amp;d=identicon&amp;r=g" alt="Walter%20Benton's gravatar image" />
    <p><a href="/users/3571/walter-benton">Walter Benton</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Walter Benton has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-41454">
    
        <a name="41456"></a>
        <div class="comment" id="comment-41456">
            <div id="post-41456-score" class="comment-score"></div>
            <div class="comment-text"><p>Your snaplength of 80 (<code>-s 80</code>) limits the protocol layers in the capture.</p>

<p>It's possible that they may not be able to add state to the hash tables or other data they maintain.</p></div>
            <div class="comment-info" id="comment-41456-info">
                
                
                
                

                

                <span class="comment-age">(15 Apr '15, 06:50)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-41454" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-41454-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/34035/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='UtWovpRunyBcewQasNHV6Ksb5mf3293H' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/34035/tshark-memory-usage-explanation-needed?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/34035/tshark-memory-usage-explanation-needed?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tshark/"
            class="tag-link-tshark"
            title="see questions tagged'tshark'using tags"
            rel="tag">tshark</a> <span class="tag-number">&#215;832</span><br/>
        
        <a href="/tags/memory/"
            class="tag-link-memory"
            title="see questions tagged'memory'using tags"
            rel="tag">memory</a> <span class="tag-number">&#215;23</span><br/>
        
        <a href="/tags/out-of-memory/"
            class="tag-link-out-of-memory"
            title="see questions tagged'out-of-memory'using tags"
            rel="tag">out-of-memory</a> <span class="tag-number">&#215;10</span><br/>
        
    </p>
    <p>
        question asked: <strong title="June 22, 2014, 8:25 a.m.">22 Jun '14, 08:25</strong>
    </p>
    <p> 
     	question was seen: <strong>4,825 times</strong>
    </p>
    <p> 
        last updated: <strong title="April 15, 2015, 6:50 a.m.">15 Apr '15, 06:50</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/54168/why-does-loading-a-small-pcap-take-lots-of-memory-on-1-machine-but-not-on-another">Why does loading a small pcap take lots of memory on 1 machine but not on another?</a>
        </p>
        
        <p>
            <a href="/questions/53501/tshark-stops-working-at-random-times">Tshark stops working at random times</a>
        </p>
        
        <p>
            <a href="/questions/51373/how-to-run-tshark-without-creating-tmpwireshark_-file">How to run tshark without creating /tmp/wireshark_* file?</a>
        </p>
        
        <p>
            <a href="/questions/36559/failed-to-allocate-memory">Failed to allocate memory</a>
        </p>
        
        <p>
            <a href="/questions/41784/tshark-and-optimizing-memory-consumption">tshark and optimizing memory consumption</a>
        </p>
        
        <p>
            <a href="/questions/20954/tshark-memory-consumption-increasing-continuously">tshark memory consumption increasing continuously</a>
        </p>
        
        <p>
            <a href="/questions/62/static-tshark-builds-for-linux-andor-solaris-sparcx64">static tshark builds for linux and/or solaris sparc/x64</a>
        </p>
        
        <p>
            <a href="/questions/1670/tshark-hex-dump">tshark hex dump</a>
        </p>
        
        <p>
            <a href="/questions/3479/could-the-file-name-parameter-in-tshark-be-chinese-characters">could the file name parameter in tshark be chinese characters?</a>
        </p>
        
        <p>
            <a href="/questions/5132/write-gzip-encoded-http-as-inflated-in-pcap-file">Write Gzip Encoded HTTP as Inflated in PCAP File</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
