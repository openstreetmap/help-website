<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>How does TCP track sequence numbers? - Wireshark Q&amp;A</title>
        <meta name="description" content="Hey Guys, So, I&#39;m developing a dissector for a custom protocol (let&#39;s call it foo for now), part of that protocol is an incrementing sequence number, which we call a heartbeat, it&#39;s synonymous with &quot;Packet Number&quot; (this hbt = last_hbt++, very simple to check to see if we missed a packet). I&#39;ve been ..." />
        <meta name="keywords" content="development,dissector,custom" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/14393/how-does-tcp-track-sequence-numbers" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/14393/how-does-tcp-track-sequence-numbers?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='lrqJe853izKHAk46NAJFg1pIqwErTGiy' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/14393/how-does-tcp-track-sequence-numbers">How does TCP track sequence numbers?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-14393-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/14393/up/" rel="nofollow"> </a>
<div id="post-14393-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-14393-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/14393/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/14393/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   1
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hey Guys,</p>
<p>So, I'm developing a dissector for a custom protocol (let's call it foo for now), part of that protocol is an incrementing sequence number, which we call a heartbeat, it's synonymous with "Packet Number" (this hbt = last_hbt++, very simple to check to see if we missed a packet).</p>
<p>I've been trying to get this working with the conversation interface, but I've run into an issue. I can't work out how to compare two adjacent packets' heartbeats.</p>
<p>Here's what I've got for the conversation code.</p>
<pre><code>struct _foo_conversation_info
{
    guint16  heartbeat;
};

/* Code to actually dissect the packets */
static void
dissect_foo(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)
{

/* some variables are omitted for brevity */

conversation_t *htbt_conv;
guint16     last_heartbeat;
struct _foo_conversation_info *proto_data;

/* Some function code is omitted for brevity */

SET_ADDRESS(&amp;null_addr, AT_NONE, 0, NULL);
htbt_conv = find_conversation(pinfo-&gt;fd-&gt;num, &amp;pinfo-&gt;src,
    &amp;null_addr, pinfo-&gt;ptype, pinfo-&gt;destport, 0x0,
    NO_ADDR2|NO_PORT2);
if(!htbt_conv){
    htbt_conv = conversation_new(pinfo-&gt;fd-&gt;num, &amp;pinfo-&gt;src,
    &amp;null_addr, pinfo-&gt;ptype, pinfo-&gt;destport, 0x0,
    NO_ADDR2|NO_PORT2);
}

proto_data  = conversation_get_proto_data(htbt_conv, proto_foo);

if(!proto_data){
    proto_data = se_alloc0(sizeof(struct _foo_conversation_info));
    conversation_add_proto_data(htbt_conv, proto_foo,
        proto_data);

    last_heartbeat  = 0;
    proto_data-&gt;heartbeat = tvb_get_ntohs(tvb, 1);
    col_set_str(pinfo-&gt;cinfo, COL_INFO, "FOO");
}else{

    last_heartbeat  = proto_data-&gt;heartbeat;
    proto_data-&gt;heartbeat = tvb_get_ntohs(tvb, 1);

    if((proto_data-&gt;heartbeat - last_heartbeat) != 1){
        col_set_str(pinfo-&gt;cinfo, COL_INFO, "FOO - Skipped Heartbeat!");
    }else{
        col_set_str(pinfo-&gt;cinfo, COL_INFO, "FOO");
    }
}
</code></pre>
<p>Every packet in the packet list is marked "Skipped Heartbeat!", when it really shouldn't be (I have a packet generator with a switch so I can inject bad packets BTW).</p>
<p>I guess this is because the dissector isn't being passed the packets in order, as I would expect, so my next step was to look at TCP to see how it does it(packet-tcp.c &amp; packet-tcp.h), but I just can't follow it, there are whole function chains which seem to go nowhere, so, how the hell do I step through the conversation chain and test for no sequential packets??</p>
<p>Thanks in advance,</p>
<p>Craig.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/development/" class="post-tag tag-link-development"
                                        title="see questions tagged 'development'" rel="tag">development</a>
                                
                                    <a href="/tags/dissector/" class="post-tag tag-link-dissector"
                                        title="see questions tagged 'dissector'" rel="tag">dissector</a>
                                
                                    <a href="/tags/custom/" class="post-tag tag-link-custom"
                                        title="see questions tagged 'custom'" rel="tag">custom</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>20 Sep '12, 06:34</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7f557535084abef24cd30661f9daefad?s=32&amp;d=identicon&amp;r=g" alt="CTNOBLE's gravatar image" />
    <p><a href="/users/3450/ctnoble">CTNOBLE</a><br/>
    <span class="score" title="11 reputation points">11</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">&#9679;</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">&#9679;</span><span class="badgecount">6</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="CTNOBLE has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/14393/">
                edited
                <strong>20 Sep '12, 07:01</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
            <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
            <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-14393">
    
</div>
<div id="comment-tools-14393" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-14393-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/14393/how-does-tcp-track-sequence-numbers?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/14393/how-does-tcp-track-sequence-numbers?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/14393/how-does-tcp-track-sequence-numbers?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/14393/how-does-tcp-track-sequence-numbers?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="14394"></a>
                    <div id="answer-container-14394" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-14394-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/14394/up/" rel="nofollow"> </a>
<div id="post-14394-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-14394-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/14394/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="CTNOBLE has selected this answer as the correct answer"
        href="/accept_answer/14394/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The problem is that Wireshark will run through the packets once sequentially, but also goes through the packets at random to create the protocol tree to display. </p>
<p>Every frame will be marked "visited" on the first run, so you can use this to flag to do the dissection of each frame. If your dissection depends on the order of frames, use the following macro:</p>
<pre><code>if (!PINFO_FD_VISITED(pinfo)) {
    &lt;your code here&gt;
}
</code></pre>
<p>Also make sure that you need to save your dissection results that are sequence dependent in "per packet data" in the conversation table. See "2.5 Per-packet information." in doc/README.developer. For more details :-)</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/14394/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>20 Sep '12, 07:07</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-14394">
    
        <a name="14395"></a>
        <div class="comment" id="comment-14395">
            <div id="post-14395-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for posting an answer, I do appreciate it, but I need some more info please.</p>

<p>My question my have been a bit vague on exactly what I wanted to know.</p>

<p>I was aware that Wireshark will run through sequentially the first time and then might run through at random on any subsiquent runs.</p>

<p>Which is what the conversation is for, I was under the impression that the "find_conversation()" function would return a different per-packet data structure based on the frame number (first argument to that function), is that true? That said your "visited" macro looks more robust, so I'll go with that.</p></div>
            <div class="comment-info" id="comment-14395-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 07:25)</span>
                <a class="comment-user userinfo" href="/users/3450/ctnoble">CTNOBLE</a>
                
            </div>
        </div>
    
        <a name="14396"></a>
        <div class="comment" id="comment-14396">
            <div id="post-14396-score" class="comment-score"></div>
            <div class="comment-text"><p><strong> not enough chars for full comment </strong></p>

<p>If I was to call find_conversation(pinfo-&gt;fd-&gt;num--, ...) would that return the information from the previous frame in my stream or are the frame numbers not necessarily continuous? Would using a simple global variable be safe enough?</p>

<p>Basically how do I get data from the previous frame dissection into the current one?</p>

<p>Cheers,
Craig.</p></div>
            <div class="comment-info" id="comment-14396-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 07:26)</span>
                <a class="comment-user userinfo" href="/users/3450/ctnoble">CTNOBLE</a>
                
            </div>
        </div>
    
        <a name="14398"></a>
        <div class="comment" id="comment-14398">
            <div id="post-14398-score" class="comment-score"></div>
            <div class="comment-text"><p>find_conversation() will just give you the index to the conversation data based on addresses, ports and frame_number (as there might be more conversations with the same addresses/ports credentials).</p>

<p>A global variable will not do and neither will data inside your conversation data object, as you need to have the history at hand when your dissector is called for a specific frame.</p>

<p>You need to use the per-packet data to store states per packet.</p>

<p>So, please read the before mentioned paragraph of README.developer, which kind of explains this in more detail.</p></div>
            <div class="comment-info" id="comment-14398-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 08:01)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="14400"></a>
        <div class="comment" id="comment-14400">
            <div id="post-14400-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for the clarification, on conversations.</p>

<p>So here's some psudo code for what I think I need to do:</p>

<pre><code>if(packet not seen before){
    per-packet.lastheartbeat   &lt;- conversation.lastheartbeat
    conversation.lastheartbeat &lt;- heartbeat
}else{
    lastheartbeat &lt;- per-packet.lastheartbeat

    if(heartbeat-lastheartbeat != 1)
    {
        do some error stuff
    }
}
</code></pre>

<p>I'll keep experimenting and post back here next week with the actual code just in case anyone else wants to see how I ended up solving this.</p>

<p>Cheers,
Craig.</p></div>
            <div class="comment-info" id="comment-14400-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 09:44)</span>
                <a class="comment-user userinfo" href="/users/3450/ctnoble">CTNOBLE</a>
                
            </div>
        </div>
    
        <a name="14402"></a>
        <div class="comment" id="comment-14402">
            <div id="post-14402-score" class="comment-score"></div>
            <div class="comment-text"><p>Not exactly, the only time to detect if a heartbeat was lost is in the sequential run, so the check whether a heartbeat was lost should be done in the "packet not seen" block. The result should be stored in the per-packet information.</p></div>
            <div class="comment-info" id="comment-14402-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 10:04)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="14403"></a>
        <div class="comment not_top_scorer" id="comment-14403">
            <div id="post-14403-score" class="comment-score"></div>
            <div class="comment-text"><p>Something like this:</p>

<pre><code>if(packet not seen before){
    if( packet.heartbeat - conversation.lastheartbeat != 1)
        per-packet.skippedheartbeat = TRUE
    } else {
        per-packet.skippedheartbeat = FALSE
    }
    conversation.lastheartbeat = packet.heartbeat
}

if ( tree ) {
    ...
    get-per-packet-information()
    if( per-packet.skippedheartbeat ) {
       show-error-in-tree()
    }
    ...
}
</code></pre></div>
            <div class="comment-info" id="comment-14403-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 10:05)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="14405"></a>
        <div class="comment not_top_scorer" id="comment-14405">
            <div id="post-14405-score" class="comment-score"></div>
            <div class="comment-text"><p>Ahhhh, this just showed up when I hit OK for my code below. </p>

<p>I guess not retesting everytime might reduce the processing power needed, but wouldn't this be functionally equivalent code?</p>

<p>Good practice is always worth the effort - I'll change it next week and edit my answer post.</p>

<p>Thanks again!</p></div>
            <div class="comment-info" id="comment-14405-info">
                
                
                
                

                

                <span class="comment-age">(20 Sep '12, 10:11)</span>
                <a class="comment-user userinfo" href="/users/3450/ctnoble">CTNOBLE</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-14394" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-14394-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="14404"></a>
                    <div id="answer-container-14404" class="answer answered-by-owner">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-14404-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/14404/up/" rel="nofollow"> </a>
<div id="post-14404-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-14404-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/14404/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>OK, So I was able to get this working a lot faster than I thought. Here's my code.</p>
<pre><code>    SET_ADDRESS(&amp;null_addr, AT_NONE, 0, NULL);

        pcket_data = p_get_proto_data(pinfo-&gt;fd, proto_foo);

        if (!(pinfo-&gt;fd-&gt;flags.visited)){
            if(!pcket_data){
                pcket_data = se_alloc(sizeof(struct _foo_packet_info));
                p_add_proto_data(pinfo-&gt;fd, proto_foo, pcket_data);
            }

            htbt_conv = find_conversation(pinfo-&gt;fd-&gt;num, &amp;pinfo-&gt;src,
                &amp;null_addr, pinfo-&gt;ptype, pinfo-&gt;destport, 0x0,
                NO_ADDR2|NO_PORT2);

            if(!htbt_conv){
                htbt_conv = conversation_new(pinfo-&gt;fd-&gt;num, &amp;pinfo-&gt;src,
                &amp;null_addr, pinfo-&gt;ptype, pinfo-&gt;destport, 0x0,
                NO_ADDR2|NO_PORT2);
            }

            proto_data  = conversation_get_proto_data(htbt_conv, proto_foo);

            if(!proto_data){
                proto_data = se_alloc0(sizeof(struct _foo_conversation_info));
                conversation_add_proto_data(htbt_conv, proto_foo,
                    proto_data);

                last_heartbeat  = 0;
            }

            this_heartbeat = tvb_get_ntohs(tvb, 2);
            last_heartbeat = proto_data-&gt;heartbeat;
            proto_data-&gt;heartbeat = this_heartbeat;
            pcket_data-&gt;last_heartbeat = last_heartbeat;
        }

        last_heartbeat  = pcket_data-&gt;last_heartbeat;
        this_heartbeat = tvb_get_ntohs(tvb, 2);

        col_clear(pinfo-&gt;cinfo, COL_INFO);

        if((this_heartbeat - last_heartbeat) != 1){
            col_set_str(pinfo-&gt;cinfo, COL_INFO, "foo Aurora Packet - Skipped Heartbeat!");
        }else{          
            col_set_str(pinfo-&gt;cinfo, COL_INFO, "foo Aurora Packet");
        }
</code></pre>
<p>If anyone has comments on the style or safety of my code then that would be appreciated, otherwise I'm going to mark this as the answer early next week.</p>
<p>Thankyou SYN-bit for your help and guidance.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/14404/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>20 Sep '12, 10:09</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7f557535084abef24cd30661f9daefad?s=32&amp;d=identicon&amp;r=g" alt="CTNOBLE's gravatar image" />
    <p><a href="/users/3450/ctnoble">CTNOBLE</a><br/>
    <span class="score" title="11 reputation points">11</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">&#9679;</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">&#9679;</span><span class="badgecount">6</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="CTNOBLE has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-14404">
    
</div>
<div id="comment-tools-14404" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-14404-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/14393/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='lrqJe853izKHAk46NAJFg1pIqwErTGiy' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/14393/how-does-tcp-track-sequence-numbers?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/14393/how-does-tcp-track-sequence-numbers?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/dissector/"
            class="tag-link-dissector"
            title="see questions tagged'dissector'using tags"
            rel="tag">dissector</a> <span class="tag-number">&#215;637</span><br/>
        
        <a href="/tags/development/"
            class="tag-link-development"
            title="see questions tagged'development'using tags"
            rel="tag">development</a> <span class="tag-number">&#215;158</span><br/>
        
        <a href="/tags/custom/"
            class="tag-link-custom"
            title="see questions tagged'custom'using tags"
            rel="tag">custom</a> <span class="tag-number">&#215;33</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Sept. 20, 2012, 6:34 a.m.">20 Sep '12, 06:34</strong>
    </p>
    <p> 
     	question was seen: <strong>3,973 times</strong>
    </p>
    <p> 
        last updated: <strong title="Sept. 20, 2012, 10:12 a.m.">20 Sep '12, 10:12</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/4797/dissector-debugging-how-to-find-the-exact-line-of-a-malformed-packet-exception">dissector debugging -- how to find the exact line of a &quot;malformed packet&quot; exception</a>
        </p>
        
        <p>
            <a href="/questions/5867/what-is-the-best-way-to-track-data-between-packets-during-dissection">What is the best way to track data between packets during dissection?</a>
        </p>
        
        <p>
            <a href="/questions/7341/why-does-wireshark-make-multiple-passes-during-dissection">Why does Wireshark make multiple passes during dissection?</a>
        </p>
        
        <p>
            <a href="/questions/8627/can-i-pass-arguments-to-a-sub-dissector">Can I pass arguments to a sub-dissector?</a>
        </p>
        
        <p>
            <a href="/questions/5050/how-do-multiple-dissectors-work-in-same-plugindll">How do multiple dissectors work in same plugindll ?</a>
        </p>
        
        <p>
            <a href="/questions/5956/setting-address-information-in-packet-info-structure-for-conversations">Setting address information in packet info structure for conversations</a>
        </p>
        
        <p>
            <a href="/questions/8649/dissector-bug-protocol-mysql-in-packet-665-protoc2518-failed-assertion-hfinfo-type-ft_string-hfinfo-type-ft_stringz">Dissector bug, protocol MySQL, in packet 665: proto.c:2518: failed assertion &quot;hfinfo-&gt;type == FT_STRING || hfinfo-&gt;type == FT_STRINGZ&quot;</a>
        </p>
        
        <p>
            <a href="/questions/11433/error-lnk2005-and-lnk1169">error LNK2005 and LNK1169</a>
        </p>
        
        <p>
            <a href="/questions/22797/error-control-in-custom-dissector">Error Control in custom dissector</a>
        </p>
        
        <p>
            <a href="/questions/38289/how-to-implement-collapsed-subtrees-in-wireshark">How to implement collapsed subtrees in Wireshark?</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
