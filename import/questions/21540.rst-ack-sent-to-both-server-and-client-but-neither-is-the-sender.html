<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>[RST, ACK] Sent to both Server and client, but neither is the sender - Wireshark Q&amp;A</title>
        <meta name="description" content=" On the client we see the following sequence:   455 752.488904 47.29.0.122 24.114.118.166 TCP 76 50776 &amp;gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 MSS=1460 SACK_PERM=1 TSval=3355706 TSecr=0 WS=32   466 755.488538 47.29.0.122 24.114.118.166 TCP 76 50776 &amp;gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 M..." />
        <meta name="keywords" content="rst,ip,networking,tcp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='FL1a82Slr34KJmsLEH2foDvhvNHB8ZZE' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender">[RST, ACK] Sent to both Server and client, but neither is the sender</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-21540-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21540/up/" rel="nofollow"> </a>
<div id="post-21540-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-21540-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21540/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/21540/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <ol>
<li>On the client we see the following sequence:</li>
</ol>
<pre>    455 752.488904  47.29.0.122  24.114.118.166  TCP  76 50776 &gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 MSS=1460 SACK_PERM=1 TSval=3355706 TSecr=0 WS=32

    466 755.488538  47.29.0.122   24.114.118.166  TCP  76 50776 &gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 MSS=1460 SACK_PERM=1 TSval=3358706 TSecr=0 WS=32

    467 755.507154  24.114.118.166 47.29.0.122    TCP  56 http-alt &gt; 50776 [**ACK**] Seq=1 Ack=1 Win=49680 Len=0

    468 758.317805  24.114.118.166 47.29.0.122    TCP  56 http-alt &gt; 50776 [**RST**, **ACK**] Seq=1 Ack=1 Win=5840 Len=0
</pre>

<pre><code>
</code></pre>
<ol>
<li>On the server at the same time we see the following</li>
</ol>
<pre>    132 775.318404  47.29.0.122      192.168.140.26    TCP      74     50776 &gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 MSS=1380

    133 778.312651  47.29.0.122      192.168.140.26    TCP      74     50776 &gt; http-alt [**SYN**] Seq=0 Win=5840 Len=0 MSS=1380

    134 778.312828  192.168.140.26   47.29.0.122       TCP      54     http-alt &gt; 50776 [**ACK**] Seq=1 Ack=1 Win=49680 Len=0

    135 778.701649  192.168.140.26   47.29.0.122       TCP      58     http-alt &gt; 50776 [**SYN**, **ACK**] Seq=0 Ack=1 Win=49680 Len=0 MSS=1460

    136 781.123193  47.29.0.122      192.168.140.26    TCP      60     50776 &gt; http-alt [**RST**, **ACK**] Seq=1 Ack=1 Win=49680 Len=0

</pre>

<p>Note that the timing is not synchronized between client and server</p>
<p>Observations:</p>
<ol>
<li>
<p>Two SYN packets are sent from the client, the reason is because the first one did not get a SYN ACK reply. After 3 seconds another SYN is sent. This is strange because the BOTH SYN packets got to the server (i dont have the latency, unfortunately)</p>
</li>
<li>
<p>Then the client received a ACK (and not a SYN ACK as expected) from the server, which the server sent in replay to a SYN</p>
</li>
<li>
<p>Both client and server get a RST ACK although neither sent a RST to the other. This happens 3 seconds after the second SYN.
Like I pointed out below this could be because of something as quoted in this article:</p>
<p>"While this connection stays open in the connection table, if a SYN comes from the client that matches the same IP port combination then ACE closes that connection with a RST as a connection for that IP and port is already open in the connection table. The timeout value in our environment was setup to very high (8 hours), whih made the issue worse as more and more orphaned connections accumilated in the connection table.
The issue at ACE level was resolved by reducing the timeout to 20 minutes."</p>
</li>
</ol>
<p>Any help would be appreciated </p>
<p>[EDIT]</p>
<p>Added capture files here:</p>
<p><strong>Client</strong>: <a href="http://www.cloudshark.org/captures/5407bc01958e">http://www.cloudshark.org/captures/5407bc01958e</a></p>
<p><strong>Server</strong>: <a href="http://www.cloudshark.org/captures/3bf196dc6b3f">http://www.cloudshark.org/captures/3bf196dc6b3f</a></p>
<p>Note that there are several successful handshakes and ensuing traffic, but at some point something breaks as described above.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/rst/" class="post-tag tag-link-rst"
                                        title="see questions tagged 'rst'" rel="tag">rst</a>
                                
                                    <a href="/tags/ip/" class="post-tag tag-link-ip"
                                        title="see questions tagged 'ip'" rel="tag">ip</a>
                                
                                    <a href="/tags/networking/" class="post-tag tag-link-networking"
                                        title="see questions tagged 'networking'" rel="tag">networking</a>
                                
                                    <a href="/tags/tcp/" class="post-tag tag-link-tcp"
                                        title="see questions tagged 'tcp'" rel="tag">tcp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                
<div class="community-wiki">
        This question is marked "community wiki".
        
    </div>
                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>28 May '13, 14:53</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c6aad07d02fa7ac3af8a687d5e10835a?s=32&amp;d=identicon&amp;r=g" alt="RomanM's gravatar image" />
    <p><a href="/users/5025/romanm">RomanM</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="5 badges"><span class="bronze">&#9679;</span><span class="badgecount">5</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="RomanM has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/21540/">
                edited
                <strong>29 May '13, 18:25</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2b038237e64839261fcc88e9fdef2b68?s=32&amp;d=identicon&amp;r=g" alt="krishnayeddula's gravatar image" />
            <p><a href="/users/4450/krishnayeddula">krishnayeddula</a><br/>
            <span class="score" title="629 reputation points">629</span><span title="35 badges"><span class="badge1">&#9679;</span><span class="badgecount">35</span></span><span title="41 badges"><span class="silver">&#9679;</span><span class="badgecount">41</span></span><span title="48 badges"><span class="bronze">&#9679;</span><span class="badgecount">48</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-21540">
    
        <a name="21573"></a>
        <div class="comment" id="comment-21573">
            <div id="post-21573-score" class="comment-score"></div>
            <div class="comment-text"><p>It would really help to see these packets in full, like on www.cloudshark.org for example. I suspect the mac-addresses, ip ID's and IP TTLs can tell a lot more to pinpoint the problem.</p></div>
            <div class="comment-info" id="comment-21573-info">
                
                
                
                

                

                <span class="comment-age">(29 May '13, 09:53)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="21576"></a>
        <div class="comment" id="comment-21576">
            <div id="post-21576-score" class="comment-score"></div>
            <div class="comment-text"><p>done, added</p></div>
            <div class="comment-info" id="comment-21576-info">
                
                
                
                

                

                <span class="comment-age">(29 May '13, 10:06)</span>
                <a class="comment-user userinfo" href="/users/5025/romanm">RomanM</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-21540" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-21540-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="21587"></a>
                    <div id="answer-container-21587" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-21587-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21587/up/" rel="nofollow"> </a>
<div id="post-21587-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-21587-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21587/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="RomanM has selected this answer as the correct answer"
        href="/accept_answer/21587/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The same issued was discussed in a <a href="https://kr.forums.oracle.com/forums/thread.jspa?threadID=1954511">Oracle Forum thread</a></p>
<p>"The Solaris response, with just ACK instead of the typical SYN ACK, is good according to RFC 793.
The FW obviously doesn't agree to this behaviour and RST's the connection towards both ends.</p>
<p>Note that the correct (= expected) SYN ACK from the server is sent out delayed. So it might be the http server is having problems acctepting the new connection in a timely manner causing an unexpected ACK to flow out before the SYN_ACK. </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/21587/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>29 May '13, 23:29</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d6607c3aca20db751d019d8bbd2da893?s=32&amp;d=identicon&amp;r=g" alt="mrEEde2's gravatar image" />
    <p><a href="/users/4708/mreede2">mrEEde2</a><br/>
    <span class="score" title="336 reputation points">336</span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="6 badges"><span class="silver">&#9679;</span><span class="badgecount">6</span></span><span title="14 badges"><span class="bronze">&#9679;</span><span class="badgecount">14</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mrEEde2 has 5 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-21587">
    
        <a name="21616"></a>
        <div class="comment" id="comment-21616">
            <div id="post-21616-score" class="comment-score"></div>
            <div class="comment-text"><p>i think this article is most insightful and relevant to the issue.</p>

<p>I guess the double SYN packet is the root cause and what makes things cascade, we will need to investigate it</p></div>
            <div class="comment-info" id="comment-21616-info">
                
                
                
                

                

                <span class="comment-age">(30 May '13, 11:38)</span>
                <a class="comment-user userinfo" href="/users/5025/romanm">RomanM</a>
                
            </div>
        </div>
    
        <a name="21619"></a>
        <div class="comment" id="comment-21619">
            <div id="post-21619-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>The same issued was discussed in a Oracle Forum thread</p>
</blockquote>

<p>good find!</p>

<blockquote>
<p>is good according to RFC 793.</p>
</blockquote>

<p>I doubt that! That's just a comment of one forum user, without any explanation why that would be O.K. </p>

<p>It's rather a bug, as also mentioned in the forum article. Unfortunately the link is dead. But if you search for the BUG ID, you'll find some information.</p>

<blockquote>
<p>6972966 SYN-ACK-ACK is not handled properly when accepting connection from Linux client using HTTP benchmark</p>
</blockquote>

<p>Anyway, is there any Solaris system involved?</p></div>
            <div class="comment-info" id="comment-21619-info">
                
                
                
                

                

                <span class="comment-age">(30 May '13, 12:11)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="21634"></a>
        <div class="comment" id="comment-21634">
            <div id="post-21634-score" class="comment-score"></div>
            <div class="comment-text"><p>The command to start the trace at the server was snoop. So this must be a solaris system.</p></div>
            <div class="comment-info" id="comment-21634-info">
                
                
                
                

                

                <span class="comment-age">(30 May '13, 22:57)</span>
                <a class="comment-user userinfo" href="/users/4708/mreede2">mrEEde2</a>
                
            </div>
        </div>
    
        <a name="21635"></a>
        <div class="comment" id="comment-21635">
            <div id="post-21635-score" class="comment-score"></div>
            <div class="comment-text"><p>The double syn packet is not the root cause, it is a retransmission because the linux client didn't see a syn_ack within 3 secs. In total the http server didn't accept the new connection for 3.3 secs. This is the problem that needs to be investigated</p></div>
            <div class="comment-info" id="comment-21635-info">
                
                
                
                

                

                <span class="comment-age">(30 May '13, 23:12)</span>
                <a class="comment-user userinfo" href="/users/4708/mreede2">mrEEde2</a>
                
            </div>
        </div>
    
        <a name="21657"></a>
        <div class="comment" id="comment-21657">
            <div id="post-21657-score" class="comment-score"></div>
            <div class="comment-text"><p>So you are saying that the double SYN is normal and is per the implementation of the linux stack ? It was odd  to me because I know that a lot of network equipment will be suspicious of multiple SYN packets 'flooding' - hence the RST...</p></div>
            <div class="comment-info" id="comment-21657-info">
                
                
                
                

                

                <span class="comment-age">(31 May '13, 07:56)</span>
                <a class="comment-user userinfo" href="/users/5025/romanm">RomanM</a>
                
            </div>
        </div>
    
        <a name="21660"></a>
        <div class="comment not_top_scorer" id="comment-21660">
            <div id="post-21660-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>I know that a lot of network equipment will be suspicious of multiple SYN packets 'flooding' </p>
</blockquote>

<p>no device I know of will block a second SYN (after a few seconds) as 'flooding', as that's just regular TCP retry mechanisms.</p></div>
            <div class="comment-info" id="comment-21660-info">
                
                
                
                

                

                <span class="comment-age">(31 May '13, 07:59)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="21662"></a>
        <div class="comment not_top_scorer" id="comment-21662">
            <div id="post-21662-score" class="comment-score"></div>
            <div class="comment-text"><p>That's standard tcp behaviour: retransmit, when you don't get an ack within your retransmission timer. Later in the flow we can use the rtt measurement to adjust this but initially we have to take a guess. Linux uses 3 secs, which is far away from 'flooding'</p></div>
            <div class="comment-info" id="comment-21662-info">
                
                
                
                

                

                <span class="comment-age">(31 May '13, 08:03)</span>
                <a class="comment-user userinfo" href="/users/4708/mreede2">mrEEde2</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-21587" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-21587-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="21541"></a>
                    <div id="answer-container-21541" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-21541-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21541/up/" rel="nofollow"> </a>
<div id="post-21541-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-21541-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21541/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Looks like Load balancer is not translating server ip address  to virtual ip address when replying back to client.
Assuming 47.29.0.122 is the client,if you check  ACK-RST packet which is 136 is having SIP:47.29.0.122 and DIP:192.168.140.26(In normal case the DIP should be Load balancer IP a.k.a VIP which is  24.114.118.166).ACK-RST is generated because somehow client didn't liked the previous packet it got and it failed to process it.One case is, It opened connection to LB ip but it got a response directly from server instead of LB ip.
Is asymmetric flow triggered(Forward traffic hits LB-A and Reverse hit LB-B and LB-B instead of translation do a plain routing which will break the session)</p>
<p>"Then the client received a ACK (and not a SYN ACK as expected) from the server, which the server sent in replay to a SYN"
I didn't get this part.</p>
<p>Why syn-ack is not expected?</p>
<p>SYN/SYN-ACK and ACK are must and should for any TCP Based communication right?How come client will send an ACK with out seeing SYN-ACK from server?</p>
<p>Better to wait for some expert analysis here. I am sure you will get.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/21541/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>28 May '13, 15:08</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2b038237e64839261fcc88e9fdef2b68?s=32&amp;d=identicon&amp;r=g" alt="krishnayeddula's gravatar image" />
    <p><a href="/users/4450/krishnayeddula">krishnayeddula</a><br/>
    <span class="score" title="629 reputation points">629</span><span title="35 badges"><span class="badge1">&#9679;</span><span class="badgecount">35</span></span><span title="41 badges"><span class="silver">&#9679;</span><span class="badgecount">41</span></span><span title="48 badges"><span class="bronze">&#9679;</span><span class="badgecount">48</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="krishnayeddula has 3 accepted answers">6&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/21541/">
                edited
                <strong>28 May '13, 15:45</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-21541">
    
</div>
<div id="comment-tools-21541" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-21541-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="21553"></a>
                    <div id="answer-container-21553" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-21553-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21553/up/" rel="nofollow"> </a>
<div id="post-21553-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-21553-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21553/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>It looks as if the server ignores the first SYN packet and then answers with ACK (Frame #134). <br>
</p>
<p><strong>Possible Reason:</strong> Asymmetric routing. You see only one half of the communication and the other half is router through a different interface/path. This usually happens in cluster environments (Firewalls, Loadbalancers, etc.), hence the different IP addresses. They are either NATed (Firewall) or balanced (Loadbalancer).</p>
<p><strong>Questions:</strong> </p>
<ul>
<li>Is there any cluster tool involved? </li>
<li>Where exactly did you take the server capture? </li>
</ul>
<p>If the capture was taken <strong>on</strong>  the server itself, then there must be two interfaces in the server (possibly with an IP address in the same subnet) and the OS does send the replies to the same interface where the requests came into the system. You don't see the SNY-ACK for the SYN in Frame #132, as it may have taken a route you did not monitor. </p>
<p>The strange thing here is Frame #134, which should not exist in this conversation at all, as it is an ACK from the server to the client.</p>
<p>If the capture was taken on a TAP or switch, there is most certainly a cluster tool involved. You see the requests coming from one cluster node and you don't see the answers as they are sent to the second cluster node. The second node possibly drops those packets, and that's why you don't see the SYN-ACK at the client.</p>
<p><strong>Suggestion</strong>: Check your environment for misconfigured clustered devices (Firewalls, Loadbalancers) and/or a misconfigured server with dual interfaces (possibly in the same subnet - some versions of windows do allow that!).</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/21553/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>28 May '13, 23:35</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/21553/">
                edited
                <strong>28 May '13, 23:45</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-21553">
    
        <a name="21569"></a>
        <div class="comment" id="comment-21569">
            <div id="post-21569-score" class="comment-score"></div>
            <div class="comment-text"><p>I think i ought to better describe the environment.</p>

<p>I have a client application sitting behind a FW and a LB.
The LB has a VIP (24.114.118.166) and it balances the client traffic to either of two clustered servers. 
192.168.140.26 is the payload IP from which a particular server rx\tx with LB.</p>

<p>I run the capture on both servers monitoring the payload IP on which it communicates with the LB and on the client.</p>

<p>One more comment is that this problem occurs not 100% of the time - this is about 1/30 attempts to establish a 3 way handshake that fails.</p>

<p>As you, I am also puzzled why we are seeing frame 134, i am not sure why this ACK is sent (i can see that it has a seq num=1 which is different but im not sure what it means)</p>

<p>The other thing which i find weird is that the server receives the first SYN packet - but since i didnt start the capture on the client and server at synchronized times i dont know how long after it was sent</p>

<p>After receiving the second SYN we see that odd ACK, and then a SYN ACK and 3 seconds after both client and server get a RST ...</p></div>
            <div class="comment-info" id="comment-21569-info">
                
                
                
                

                

                <span class="comment-age">(29 May '13, 09:00)</span>
                <a class="comment-user userinfo" href="/users/5025/romanm">RomanM</a>
                
            </div>
        </div>
    
        <a name="21574"></a>
        <div class="comment" id="comment-21574">
            <div id="post-21574-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>I run the capture on both servers monitoring the payload IP on which it communicates with the LB and on the client.</p>
</blockquote>

<p>was there any capture filter in place? If so, what was it?</p></div>
            <div class="comment-info" id="comment-21574-info">
                
                
                
                

                

                <span class="comment-age">(29 May '13, 09:54)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="21575"></a>
        <div class="comment" id="comment-21575">
            <div id="post-21575-score" class="comment-score"></div>
            <div class="comment-text"><p>On the server snoop -d e1000g1 port 8080 src 47.29.0.122 or dst 47.29.0.122 
(anything leaving or coming to payload IP on port 8080)</p>

<p>On client tcpdump./tcpdump -i dav0 tcp port 8080 
(just anything on port 8080 since traffic is light)</p></div>
            <div class="comment-info" id="comment-21575-info">
                
                
                
                

                

                <span class="comment-age">(29 May '13, 09:59)</span>
                <a class="comment-user userinfo" href="/users/5025/romanm">RomanM</a>
                
            </div>
        </div>
    
        <a name="21664"></a>
        <div class="comment" id="comment-21664">
            <div id="post-21664-score" class="comment-score"></div>
            <div class="comment-text"><p>Are there several interfaces in the server, possibly with interface bonding?<br>
</p>

<p>If so, can you please capture the traffic on <strong>all</strong> interface in parallel. I still suspect, that the SYN-ACK for the first SYN, was sent through another interface and was then blocked/dropped somewehere (Firewall, LB, etc.)</p></div>
            <div class="comment-info" id="comment-21664-info">
                
                
                
                

                

                <span class="comment-age">(31 May '13, 08:11)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-21553" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-21553-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/21540/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='FL1a82Slr34KJmsLEH2foDvhvNHB8ZZE' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/21540/rst-ack-sent-to-both-server-and-client-but-neither-is-the-sender?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tcp/"
            class="tag-link-tcp"
            title="see questions tagged'tcp'using tags"
            rel="tag">tcp</a> <span class="tag-number">&#215;752</span><br/>
        
        <a href="/tags/ip/"
            class="tag-link-ip"
            title="see questions tagged'ip'using tags"
            rel="tag">ip</a> <span class="tag-number">&#215;178</span><br/>
        
        <a href="/tags/rst/"
            class="tag-link-rst"
            title="see questions tagged'rst'using tags"
            rel="tag">rst</a> <span class="tag-number">&#215;81</span><br/>
        
        <a href="/tags/networking/"
            class="tag-link-networking"
            title="see questions tagged'networking'using tags"
            rel="tag">networking</a> <span class="tag-number">&#215;27</span><br/>
        
    </p>
    <p>
        question asked: <strong title="May 28, 2013, 2:53 p.m.">28 May '13, 14:53</strong>
    </p>
    <p> 
     	question was seen: <strong>11,366 times</strong>
    </p>
    <p> 
        last updated: <strong title="May 31, 2013, 8:11 a.m.">31 May '13, 08:11</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/26597/why-do-i-see-tcp-packets-on-the-network">Why do I see TCP packets on the network?</a>
        </p>
        
        <p>
            <a href="/questions/14212/router-replies-with-rst-after-fin-ack">Router replies with [RST] after [FIN, ACK]</a>
        </p>
        
        <p>
            <a href="/questions/25374/server-sending-rst-message">Server sending RST Message</a>
        </p>
        
        <p>
            <a href="/questions/29913/strange-tcp-rst-with-sslscan">Strange TCP RST with sslscan</a>
        </p>
        
        <p>
            <a href="/questions/7082/what-does-the-8-stand-for-in-tcpstream-eq-8">What does the 8 stand for in (tcp.stream eq 8)?</a>
        </p>
        
        <p>
            <a href="/questions/60799/modbus-tcp-connection-drops-after-7-hours-and-20-minutes">Modbus TCP connection drops after 7 hours and 20 minutes</a>
        </p>
        
        <p>
            <a href="/questions/6872/zero-window-and-rst">Zero window and RST</a>
        </p>
        
        <p>
            <a href="/questions/19124/is-it-possible-to-find-how-data-are-encoded-on-a-lan-connection">Is it possible to find how data are encoded on a LAN connection?</a>
        </p>
        
        <p>
            <a href="/questions/32323/tcp-how-many-re-transmissions-are-acceptable-embedded-device">TCP: How many re-transmissions are acceptable (embedded device)</a>
        </p>
        
        <p>
            <a href="/questions/61417/ie11-sent-rst-flag">IE11 sent RST flag</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
