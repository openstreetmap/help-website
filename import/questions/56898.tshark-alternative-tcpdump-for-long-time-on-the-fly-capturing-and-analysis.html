<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>tshark alternative (tcpdump?) for long-time on-the-fly capturing and analysis - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, I have developed a Java program, and one of its threads runs a tshark command and listens on its command-line output and performs analysis in real time.  The network topology is that dozens of clients request HTTP content from a server, and I&#39;m running the program on the server:8080.  The tshark..." />
        <meta name="keywords" content="capture,tcpdump,tshark" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='mwRqg9Y9E5JziSrTMaKRHcsLPvi5Xy29' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis">tshark alternative (tcpdump?) for long-time on-the-fly capturing and analysis</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-56898-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/56898/up/" rel="nofollow"> </a>
<div id="post-56898-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-56898-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/56898/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/56898/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi, I have developed a Java program, and one of its threads runs a tshark command and listens on its command-line output and performs analysis in real time. </p>
<p>The network topology is that dozens of clients request HTTP content from a server, and I'm running the program on the server:8080. </p>
<p>The tshark command I'm using is: </p>
<pre><code>tshark -B 40 -i any -l -f tcp -t e -n -Y tcp.port==8080
</code></pre>
<p>The requirements that made me chose tshark are: </p>
<ol>
<li>I need to identify packets that contain an HTTP GET request </li>
<li>I need to see each data packet that is sent from the server:8080 to any client (most likely with a length of 1516 bytes)</li>
</ol>
<p>I just discovered that tshark's memory footprint keeps increasing (which has been extensively discussed on this site), which makes it unsuitable for long-term running (months). For example, if I run tshark for 10 minutes on my server, its RAM usage will reach 4GB (according to "top"). Note that I need to analyse each packet on-the-fly, so ring buffer is not an option either. </p>
<p>I understand that many folks on this site recommends tcpdump as an alternative to tshark. However, for performance requirement, I cannot afford to let tcpdump output every single packet's payload and then look for HTTP GET. </p>
<p>Ideally, I'm looking for a program that can produce output like this to command-line (I'm using tcpdump output as a template): </p>
<pre><code>[timestamp] IP user1.38572 &gt; server.8080 ...
HTTP GET url/url...
[timestamp] IP server.8080 &gt; user1.38572 flags [.] ack xxx, length 1516
[timestamp] IP server.8080 &gt; user1.38572 flags [.] ack xxx, length 1516
[timestamp] IP server.8080 &gt; user1.38572 flags [.] ack xxx, length 1516
</code></pre>
<p>Is there a one-liner for tcpdump that can do this, or any other advice is highly appreciated. </p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/capture/" class="post-tag tag-link-capture"
                                        title="see questions tagged 'capture'" rel="tag">capture</a>
                                
                                    <a href="/tags/tcpdump/" class="post-tag tag-link-tcpdump"
                                        title="see questions tagged 'tcpdump'" rel="tag">tcpdump</a>
                                
                                    <a href="/tags/tshark/" class="post-tag tag-link-tshark"
                                        title="see questions tagged 'tshark'" rel="tag">tshark</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>01 Nov '16, 06:11</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/5b505a91634dbad2eb6c081340c7197f?s=32&amp;d=identicon&amp;r=g" alt="Chang's gravatar image" />
    <p><a href="/users/24624/chang">Chang</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">&#9679;</span><span class="badgecount">3</span></span><span title="7 badges"><span class="bronze">&#9679;</span><span class="badgecount">7</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Chang has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-56898">
    
</div>
<div id="comment-tools-56898" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-56898-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="56954"></a>
                    <div id="answer-container-56954" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-56954-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/56954/up/" rel="nofollow"> </a>
<div id="post-56954-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-56954-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/56954/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>You can use tcpdump to do what you want.  The filters are pretty powerful and flexible.  In your case, you probably want anything headed for a given port (say 80), and with the string 'GET ' as the first 4 packets in the payload.  You can use the expression below to create such a filter:</p>
<pre><code>( dst port 80 ) and ( tcp[20:4] == 0x47455420 )
</code></pre>
<p>the tcp[20:4] == 0x47455420 tells tcpdump to save anything where the 4 packets starting at byte #20 in the TCP packet equal the bytes 0x47 0x45 0x54 0x20 (which is just hex for 'GET '.  The number of packets to match must be an even power of 2, so you need that 4th byte corresponding to the space).  This assumes, of course, that you have a 20 byte tcp header with no options.</p>
<p>As far as performance goes (if you are running a modern linux system) tcpdump should be compiling the filter into bytecode and handing it off to the kernel to execute against packets as the come in.  If you are interested, you can actually see the little program it creates using the -d option.  If you are load/latency tolerant enough that you were considering running tshark on the server anyway, you will probably be OK</p>
<pre><code>tcpdump -d '( dst port 80 ) and ( tcp[20:4] == 0x47455420 )'
(000) ldh      [12]
(001) jeq      #0x86dd          jt 14   jf 2
(002) jeq      #0x800           jt 3    jf 14
(003) ldb      [23]
(004) jeq      #0x84            jt 14   jf 5
(005) jeq      #0x6             jt 6    jf 14
(006) ldh      [20]
(007) jset     #0x1fff          jt 14   jf 8
(008) ldxb     4*([14]&amp;0xf)
(009) ldh      [x + 16]
(010) jeq      #0x50            jt 11   jf 14
(011) ld       [x + 34]
(012) jeq      #0x47455420      jt 13   jf 14
(013) ret      #65535
(014) ret      #0
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/56954/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>03 Nov '16, 14:00</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/ba1199f4d360c53a6cc8aa6aa5da37c8?s=32&amp;d=identicon&amp;r=g" alt="ryber's gravatar image" />
    <p><a href="/users/10072/ryber">ryber</a><br/>
    <span class="score" title="146 reputation points">146</span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="5 badges"><span class="silver">&#9679;</span><span class="badgecount">5</span></span><span title="9 badges"><span class="bronze">&#9679;</span><span class="badgecount">9</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="ryber has one accepted answer">16&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-56954">
    
        <a name="56955"></a>
        <div class="comment" id="comment-56955">
            <div id="post-56955-score" class="comment-score">1</div>
            <div class="comment-text"><p>I'm afraid the filter suggested above fails to match GET packets whose TCP header is augmented with some options. On <a href="https://wiki.wireshark.org/CaptureFilters">Wireshark wiki page on capture filters</a>, there is a capture filter which addresses this:</p>

<p><code>port 80 and tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420</code></p>

<p>Even with this filter, there is still a theoretical chance to get some false positives if a <code>GET</code> string occurs somewhere in the headers of a http request which spans more than a single segment and falls at the beginning of a TCP segment. Also, I would add <code>dst</code> before <code>port 80</code> as we are not interested in packets carrying http responses and their bodies - there are much more likely to contain a <code>GET</code> string than the headers of requests.</p></div>
            <div class="comment-info" id="comment-56955-info">
                
                
                
                

                

                <span class="comment-age">(03 Nov '16, 14:42)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="56956"></a>
        <div class="comment" id="comment-56956">
            <div id="post-56956-score" class="comment-score"></div>
            <div class="comment-text"><p>Good suggestion about handling the possibility of TCP options.<br>
</p>

<p>The filter as written above does already have 'dst' before 'port'.</p>

<p>Good point about the chance of false positives in the event of a fragmented HTTP request that starts with 'GET ' as the first four bytes.  How to handle that (as well as requests fragmented across multiple TCP packets) would come down to the use case.  It might be easier to handle when the data is being analyzed.</p>

<p><a href="/users/24624/chang">@Chang</a> could also build a more complex filter that looks for a few more characters following GET (such as '/...') to reduce false positives.</p></div>
            <div class="comment-info" id="comment-56956-info">
                
                
                
                

                

                <span class="comment-age">(03 Nov '16, 14:55)</span>
                <a class="comment-user userinfo" href="/users/10072/ryber">ryber</a>
                
            </div>
        </div>
    
        <a name="56958"></a>
        <div class="comment" id="comment-56958">
            <div id="post-56958-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>The filter as written above does already have <code>dst</code> before <code>port</code>.</p>
</blockquote>

<p>Yours did, but the one at the wiki page didn't, that's why I've mentioned that.</p></div>
            <div class="comment-info" id="comment-56958-info">
                
                
                
                

                

                <span class="comment-age">(03 Nov '16, 15:00)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="56968"></a>
        <div class="comment not_top_scorer" id="comment-56968">
            <div id="post-56968-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks <a href="/users/10072/ryber">@ryber</a> and <a href="/users/19586/sindy">@sindy</a>, I have tried the capture filters you mentioned above, and I can see that TCP packets containing HTTP GET requests are correctly captured. </p>

<p>However, this still does not meet my requirements: </p>

<ul>
<li>I need to see the URL of the GET request. </li>
<li>I need to see all other data packets sent from server:8080 to client printed out too (in the format of ACKs sent as segmented HTTP response). </li>
</ul>

<p>Any advice?</p></div>
            <div class="comment-info" id="comment-56968-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 02:29)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
        <a name="56969"></a>
        <div class="comment not_top_scorer" id="comment-56969">
            <div id="post-56969-score" class="comment-score"></div>
            <div class="comment-text"><p>I just tried using the filter below (changed "and" to "or): </p>

<pre><code>port 8080 or tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420
</code></pre>

<p>and used -A option of tcpdump to print out the payload content. </p>

<p>Now I can see the GET request content (great!), but I can also see tons of data of HTTP response printed out (yuck!). For the HTTP response packets, I just need to see one line showing the packet without the payload (like when there is no -A option).</p></div>
            <div class="comment-info" id="comment-56969-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 02:41)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
        <a name="56970"></a>
        <div class="comment not_top_scorer" id="comment-56970">
            <div id="post-56970-score" class="comment-score"></div>
            <div class="comment-text"><p>To see the url of the GET request, it should be enough to use tcpdump's command line options making it print the contents of the packets, and apply a sed or awk filter on it to extract only the url.</p>

<p>But to see the contents of the server responses, you need to track the context (state), and tracking state is exactly what causes the continuous growth of memory consumption in tshark. So I'm afraid that your only way out is to let tcpdump or dumpcap capture into a circular buffer of files, using a only a basic capture filter like <code>tcp port 8080</code>, and some automated post-processing of these files.</p></div>
            <div class="comment-info" id="comment-56970-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 02:45)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="56971"></a>
        <div class="comment" id="comment-56971">
            <div id="post-56971-score" class="comment-score">1</div>
            <div class="comment-text"><blockquote>
<p>I can also see tons of data of HTTP response printed out</p>
</blockquote>

<p>In fact, the <code>or</code> between the <code>port 8080</code> and the rest of the filter expression effectively masks out the rest of the expression for packets which have source or destination port 8080. Also, you cannot use <code>-A</code> for some packets and not use it for others for the same instance of tcpdump.</p></div>
            <div class="comment-info" id="comment-56971-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 02:51)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="56974"></a>
        <div class="comment not_top_scorer" id="comment-56974">
            <div id="post-56974-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/19586/sindy">@sindy</a> I don't need to track the states of HTTP response - all I need to see is the packets themselves that are being sent from server to client (so that I can manually add up packet-by-packet how many bytes have been sent in response to a previous GET request). </p>

<p>Based on your comments so far, I think sed might be the way to do this - I just need to filter &amp; print 2 types of lines: </p>

<ul>
<li>All tcpdump regular output (i.e., the output without -A)</li>
<li>The line containing GET and URL</li>
</ul>

<p>Unfortunately I'm not very good at regex...can you please provide some initial guidelines on where I should start, thanks!</p></div>
            <div class="comment-info" id="comment-56974-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 03:14)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
        <a name="56977"></a>
        <div class="comment" id="comment-56977">
            <div id="post-56977-score" class="comment-score">2</div>
            <div class="comment-text"><p>We are getting close to the edge of the site scope...</p>

<p>I'm afraid you neglect the possibility of packet loss and subsequent retransmissions, i.e. you assume that each GET request in client-&gt;server direction is followed by properly ordered packets of a matching response in the server-&gt;client direction. This is not always the case, that's why I've mentioned the context - HTTP uses TCP as transport, and in tshark or wireshark, the TCP dissector takes care of hiding network problems from the HTTP dissector, not giving it any piece of data until all previous ones have been completely received, and not giving it any retransmitted data once again.</p>

<p>Leaving that aside, you may use <code>-x</code> rather than <code>-A</code>, making tcpdump print out hex dumps of the packets rather than their text representations, as the contents of the responses may be encoded in many ways, not all of them printable. Your post-process would then evaluate the headers and handle the requests one way and the responses another way.</p>

<p>Or, if you software can handle two input pipes, you can feed one with the GETs as ASCII and the other one with the responses as hex dumps.</p>

<p>To answer your question, if the request packet looks as follows:</p>

<p><code>GET some/url/ HTTP/1.1\r\n
HeaderX: ...\r\n
HeaderY: ...\r\n</code></p>

<p>you may use <code>sed 's/^GET \([^ ]*\) HTTP.*/\1/'</code> to extract only <code>some/url/</code> from the first line, but I cannot tell you how to get rid of the rest of the lines as it largely depends on your system, handling of control characters differs a lot.</p></div>
            <div class="comment-info" id="comment-56977-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 04:07)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="56978"></a>
        <div class="comment not_top_scorer" id="comment-56978">
            <div id="post-56978-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/19586/sindy">@sindy</a> when I was using tshark, I have already disabled all dissecting options and I have already built my software to handle retransmissions on per-segment level. </p>

<p>I think I will follow your suggestion on using 2 tcpdump input pipes in parallel and work something out...thanks again.</p></div>
            <div class="comment-info" id="comment-56978-info">
                
                
                
                

                

                <span class="comment-age">(04 Nov '16, 04:32)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-56954" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 10
        </span>
        <a href="#" class="show-all-comments-link">show 5 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-56954-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="56900"></a>
                    <div id="answer-container-56900" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-56900-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/56900/up/" rel="nofollow"> </a>
<div id="post-56900-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-56900-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/56900/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Seems to me like you should be looking at a tool like <a href="https://www.snort.org/">Snort</a>, <a href="https://suricata-ids.org/">Suricata</a> or <a href="https://www.bro.org/">Bro</a> instead, which are made for on-the-fly packet content matching and alerting.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/56900/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>01 Nov '16, 07:47</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
    <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
    <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jasper has 263 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-56900">
    
        <a name="56901"></a>
        <div class="comment" id="comment-56901">
            <div id="post-56901-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks, I've looked at Snort's "sniffer mode" - how is this different from plain tcpdump?</p></div>
            <div class="comment-info" id="comment-56901-info">
                
                
                
                

                

                <span class="comment-age">(01 Nov '16, 08:06)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
        <a name="56902"></a>
        <div class="comment" id="comment-56902">
            <div id="post-56902-score" class="comment-score"></div>
            <div class="comment-text"><p>I think the sniffer mode isn't that much different. What you need is the pattern matching capabilities of Snort which can run for years without running into the same memory trouble while being able to match patterns on-the-fly. I think you'll need to do a full packet capture at the same time, and then script something to use the hits found by Snort to extract all packets belonging to that hit.</p></div>
            <div class="comment-info" id="comment-56902-info">
                
                
                
                

                

                <span class="comment-age">(01 Nov '16, 08:11)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="56924"></a>
        <div class="comment" id="comment-56924">
            <div id="post-56924-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/145/jasper">@Jasper</a> are you suggesting that there's no way to do "sniffer" and "alert" mode at the same time? I.e., I might need to start 2 separate threads with one running on sniffer mode and the other one that alerts me when an HTTP GET is detected?</p></div>
            <div class="comment-info" id="comment-56924-info">
                
                
                
                

                

                <span class="comment-age">(02 Nov '16, 02:50)</span>
                <a class="comment-user userinfo" href="/users/24624/chang">Chang</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-56900" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-56900-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/56898/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='mwRqg9Y9E5JziSrTMaKRHcsLPvi5Xy29' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/56898/tshark-alternative-tcpdump-for-long-time-on-the-fly-capturing-and-analysis?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tshark/"
            class="tag-link-tshark"
            title="see questions tagged'tshark'using tags"
            rel="tag">tshark</a> <span class="tag-number">&#215;832</span><br/>
        
        <a href="/tags/capture/"
            class="tag-link-capture"
            title="see questions tagged'capture'using tags"
            rel="tag">capture</a> <span class="tag-number">&#215;549</span><br/>
        
        <a href="/tags/tcpdump/"
            class="tag-link-tcpdump"
            title="see questions tagged'tcpdump'using tags"
            rel="tag">tcpdump</a> <span class="tag-number">&#215;97</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Nov. 1, 2016, 6:11 a.m.">01 Nov '16, 06:11</strong>
    </p>
    <p> 
     	question was seen: <strong>5,748 times</strong>
    </p>
    <p> 
        last updated: <strong title="Nov. 4, 2016, 4:32 a.m.">04 Nov '16, 04:32</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/56873/blank-output-when-applying-reading-filter">Blank output when applying reading filter</a>
        </p>
        
        <p>
            <a href="/questions/61406/tcp-state-of-incoming-packets-tcpdump">TCP state of incoming packets - tcpdump</a>
        </p>
        
        <p>
            <a href="/questions/15146/bytes-missing-in-capture-file">bytes missing in capture file</a>
        </p>
        
        <p>
            <a href="/questions/34231/no-root-privileges-packet-size-limited-during-capture">No root privileges: Packet size limited during capture</a>
        </p>
        
        <p>
            <a href="/questions/59484/mergecap-combine-multiple-named-pipes">Mergecap combine multiple named pipes</a>
        </p>
        
        <p>
            <a href="/questions/61350/capture-simultaneously-in-tshark">capture simultaneously in tshark</a>
        </p>
        
        <p>
            <a href="/questions/8301/can-tshark-be-used-without-wireshark">Can TShark be used without WireShark</a>
        </p>
        
        <p>
            <a href="/questions/10423/rolling-packet-data-capture-using-tshark-live">Rolling packet data capture using tshark live.</a>
        </p>
        
        <p>
            <a href="/questions/38848/commandline-capture-filter-for-only-get-requests-that-contain-exe-or-jar">Commandline Capture Filter for only GET Requests that contain &quot;.exe&quot; or &quot;.jar&quot;  ?</a>
        </p>
        
        <p>
            <a href="/questions/55417/tshark-trying-to-capture-image-urls-to-text-file">TSHARK trying to capture image URLs to text file</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
