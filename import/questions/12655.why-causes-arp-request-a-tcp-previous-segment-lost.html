<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Why causes ARP request  a &quot;TCP previous segment lost&quot;? - Wireshark Q&amp;A</title>
        <meta name="description" content="We have two windows XP pc&#39;s 10.10.10.1 and 10.10.10.2 with a direct connection to each other (So not via a router). These both have a user application running, which continuously exchange information via TCP/IP. When the communication between the 2 pc&#39;s is logged with wireshark, it shows every 10 mi..." />
        <meta name="keywords" content="arp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='EgFtLjTW8CrIVyC6WycupMY1KBIxnaPt' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost">Why causes ARP request  a &quot;TCP previous segment lost&quot;?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-12655-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12655/up/" rel="nofollow"> </a>
<div id="post-12655-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-12655-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12655/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/12655/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>We have two windows XP pc's 10.10.10.1 and 10.10.10.2 with a direct connection to each other (So not via a router). These both have a user application running, which continuously exchange information via TCP/IP. When the communication between the 2 pc's is logged with wireshark, it shows every 10 minutes a ARP request is broadcast to refresh the arp cache. However once in a while, the ARP message exchange seems to set off the whole network communication. In wireshark it is followed by a TCP previous segment lost message. Here an example:</p>
<pre><code>26893 1578.844599 10.10.10.2            10.10.10.1            TCP      146    kyoceranetdev &gt; scol [PSH, ACK] Seq=3613653 Ack=402623 Win=65280 Len=92 2012-06-06 15:22:02.178605 146

26894 1579.029143 IntelCor_8d:0c:6d     Broadcast             ARP      42     Who has 10.10.10.1?  Tell 10.10.10.2                            2012-06-06 15:22:02.363149 42

26895 1579.030506 IntelCor_8d:0c:4f     IntelCor_8d:0c:6d     ARP      60     10.10.10.1 is at 00:15:17:8d:0c:4f                              2012-06-06 15:22:02.364512 60

26896 1579.030511 10.10.10.2            10.10.10.1            TCP      191    [TCP Previous segment lost] kyoceranetdev &gt; scol [PSH, ACK] Seq=3615205 Ack=402623 Win=65280 Len=137 2012-06-06 15:22:02.364517 191

26897 1579.030666 10.10.10.1            10.10.10.2            TCP      66     scol &gt; kyoceranetdev [ACK] Seq=402623 Ack=3613745 Win=64538 Len=0 SLE=3615205 SRE=3615342 2012-06-06 15:22:02.364672 66

26898 1579.291510 10.10.10.2            10.10.10.1            TCP      1514   kyoceranetdev &gt; scol [PSH, ACK] Seq=3615342 Ack=402623 Win=65280 Len=1460 2012-06-06 15:22:02.625516 1514

26899 1579.291522 10.10.10.2            10.10.10.1            TCP      62     kyoceranetdev &gt; scol [PSH, ACK] Seq=3616802 Ack=402623 Win=65280 Len=8 2012-06-06 15:22:02.625528 62

26900 1579.298290 10.10.10.1            10.10.10.2            TCP      66     [TCP Dup ACK 26897#1] scol &gt; kyoceranetdev [ACK] Seq=402623 Ack=3613745 Win=64538 Len=0 SLE=3615205 SRE=3616802 2012-06-06 15:22:02.632296 66

26901 1579.298296 10.10.10.1            10.10.10.2            TCP      66     [TCP Dup ACK 26897#2] scol &gt; kyoceranetdev [ACK] Seq=402623 Ack=3613745 Win=64538 Len=0 SLE=3615205 SRE=3616810 2012-06-06 15:22:02.632302 66

26902 1579.298306 10.10.10.2            10.10.10.1            TCP      210    [TCP Fast Retransmission] kyoceranetdev &gt; scol [PSH, ACK] Seq=3613745 Ack=402623 Win=65280 Len=156 2012-06-06 15:22:02.632312 210

26903 1579.298306 10.10.10.2            10.10.10.1            TCP      218    kyoceranetdev &gt; scol [PSH, ACK] Seq=3616810 Ack=402623 Win=65280 Len=164 2012-06-06 15:22:02.632312 218
</code></pre>
<p>Anyone any idea why this is happening?</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/arp/" class="post-tag tag-link-arp"
                                        title="see questions tagged 'arp'" rel="tag">arp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>12 Jul '12, 05:18</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/26cc90089fc8501812ad5225b214f8d3?s=32&amp;d=identicon&amp;r=g" alt="rv_deventer's gravatar image" />
    <p><a href="/users/3054/rv_deventer">rv_deventer</a><br/>
    <span class="score" title="21 reputation points">21</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="5 badges"><span class="bronze">&#9679;</span><span class="badgecount">5</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="rv_deventer has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-12655">
    
        <a name="13005"></a>
        <div class="comment" id="comment-13005">
            <div id="post-13005-score" class="comment-score"></div>
            <div class="comment-text"><p>Can you post a capture file somewhere (perhaps <a href="http://www.cloudshark.org">www.cloudshark.org</a>) that shows the problem? It's hard to tell much from a text printout with only a single ARP request/response pair and only 11 packets total. It's likely that the ARP and the lost segment are unrelated and it's just coincidence that the lost segment sometimes comes right after an ARP.</p></div>
            <div class="comment-info" id="comment-13005-info">
                
                
                
                

                

                <span class="comment-age">(25 Jul '12, 17:30)</span>
                <a class="comment-user userinfo" href="/users/527/jim-aragon">Jim Aragon</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-12655" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12655-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="13065"></a>
                    <div id="answer-container-13065" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-13065-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/13065/up/" rel="nofollow"> </a>
<div id="post-13065-score" class="post-score"
    title="current number of votes">
    3
</div>
<a id="post-13065-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/13065/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="rv_deventer has selected this answer as the correct answer"
        href="/accept_answer/13065/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Let's sum it up in an answer.<br>
</p>
<p>Based on the information gathered during analyzing the problem, I conclude: </p>
<p><strong>Windows:</strong> ARP Behavior </p>
<blockquote>
<p><code><a href="http://technet.microsoft.com/en-us/library/cc940021.aspx">http://technet.microsoft.com/en-us/library/cc940021.aspx</a></code><br>
</p>
</blockquote>
<p>Look at the end. </p>
<blockquote>
<p>Cite: <strong>ARP queues only one outbound IP datagram</strong> for a given destination address <strong>while that IP address is being resolved to a MAC address</strong>. .... An application <strong>can compensate for this</strong> by <strong>calling the Iphlpapi.dll routine SendArp()</strong> to establish an arp cache entry, before sending the stream of packets. </p>
</blockquote>
<p>Also this: </p>
<blockquote>
<p><code><a href="http://support.microsoft.com/kb/194881/en-us">http://support.microsoft.com/kb/194881/en-us</a></code> <br>
</p>
<p>Cite: While Windows NT awaits an ARP Response, <strong>ARP will "queue" the IP packet that needs to be sent</strong>. When Windows NT <strong>receives the ARP Response</strong>, it will <strong>only transmit the "latest" or last packet</strong> that it received in its "ARP Packet Queue" for any given destination host. </p>
</blockquote>
<p><strong>Conclusion</strong>: It looks like Windows dropped one (ore more) of your TCP packets, ALTHOUGH the information above seems to be only related to UDP. Maybe the information in the first link is wrong or the behavior is the same for TCP and other protocols.<br>
</p>
<p>HOWEVER, This behavior does not fully comply with the explanation above. At least one packet should have been queued and sent, after ARP finished. But maybe that's just the packet Wireshark marks with "TCP Previous segment was not captured" and another packet with payload data was dropped. Without insight into the application, we will never know.<br>
</p>
<p><strong>Question:</strong> Why does it happen only once in a while? <br>
<strong>Answer:</strong> It's simply a timing issue. There may be short time frames where the application does not transmit any data. If the ARP refresh takes place in that time frame, you won't see any problems, as no packets need to be queued. </p>
<p><strong>Solution</strong> for your problem, in the order I would recommend:</p>
<ul>
<li>do nothing, as TCP recovers from that situation by itself</li>
<li>call <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366358%28v=vs.85%29.aspx">SendArp()</a> from time to time in your application to update the arp cache before the entry expires </li>
<li>set a static ARP entry, verified by yourself. However, that's not a good idea </li>
</ul>
<p>It's apparently the same for other operation systems, however the "ARP queue length" is different. </p>
<p><strong>Linux:</strong> You can configured the ARP queue len with the parameter <strong><code>unres_qlen</code></strong> via systcl (Default: 3). </p>
<blockquote>
<p><code><a href="http://www.kernel.org/doc/man-pages/online/pages/man7/arp.7.html">http://www.kernel.org/doc/man-pages/online/pages/man7/arp.7.html</a></code> <br>
<code><a href="http://www.6test.edu.cn/~lujx/linux_networking/0131777203_ch15lev1sec3.html">http://www.6test.edu.cn/~lujx/linux_networking/0131777203_ch15lev1sec3.html</a></code><br>
</p>
</blockquote>
<p><strong>AIX:</strong> Same for AIX with <strong><code>arpqsize</code></strong> (Default: 12). </p>
<blockquote>
<p><code><a href="http://publib.boulder.ibm.com/infocenter/pseries/v5r3/index.jsp?topic=/com.ibm.aix.prftungd/doc/prftungd/arp_cache_tuning.htm">http://publib.boulder.ibm.com/infocenter/pseries/v5r3/index.jsp?topic=/com.ibm.aix.prftungd/doc/prftungd/arp_cache_tuning.htm</a></code> <br>
</p>
</blockquote>
<p>Regards <br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/13065/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>27 Jul '12, 02:15</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-13065">
    
        <a name="13181"></a>
        <div class="comment" id="comment-13181">
            <div id="post-13181-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks Kurt for this extensive 'research',
I understand it is some kind of default behaviour. Still strange that it looks like windows drops packets, except the last one.</p>

<p>Anyway, we think we have 'fixed' it as follows:
Every time at start-up of our application the application uses SendARP etc. to once discover the mac address of the other pc. Then it adds a static entry to the arp cache.</p>

<p>Thanks,
Rudy
PS. I tried to award points to you, but in some way I cannot set the award points slider to a value different from 1. (?)</p></div>
            <div class="comment-info" id="comment-13181-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '12, 05:56)</span>
                <a class="comment-user userinfo" href="/users/3054/rv_deventer">rv_deventer</a>
                
            </div>
        </div>
    
        <a name="13184"></a>
        <div class="comment" id="comment-13184">
            <div id="post-13184-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Thanks Kurt for this extensive 'research', </p>
</blockquote>

<p>You're welcome and I learned something too ;-))</p>

<blockquote>
<p>Still strange that it looks like windows drops packets, except the last one.</p>
</blockquote>

<p>That's the way the Windows stack seems to work. It will only buffer one packet during the ARP request. So, if there are severeal packets sent during that time, all are dropped, except the last one.</p>

<blockquote>
<p>Every time at start-up of our application the application uses SendARP etc. to once discover the mac address of the other pc. Then it adds a static entry to the arp cache.</p>
</blockquote>

<p>SendArp() is O.K, but <strong>the static ARP entry is problematic</strong>!! </p>

<p>This entry will be there until the machine reboots. Imagine, the NIC of the computer for which you have a static entry needs to be replaced (or the whole machine needs to be replaced). After it boots up, you will still try to contact the old MAC address due to the static ARP cache entry. It will take you (your admins, customers) quite some time to figure out what's going wrong. It's certainly better to use SendArp() throughout your application, triggered by a timer.</p>

<blockquote>
<p>I tried to award points to you, but in some way I cannot set the award points slider to a value different from 1. (?)</p>
</blockquote>

<p>That's because you only have 1 karma point yourself. Just accept the answer (check mark) and if you like vote it up.</p></div>
            <div class="comment-info" id="comment-13184-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '12, 06:14)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="13185"></a>
        <div class="comment" id="comment-13185">
            <div id="post-13185-score" class="comment-score"></div>
            <div class="comment-text"><p>I agree with your suggestion that SendARp throughout the application is better solution. With our solution, we are aware that we have an issue when the computer for which we have the static entry needs to be replaced. As a first approach we are going to instruct our service department (who does replacements) to reboot both computers. That will then prevent it.
We then can still decide in the future to implement the timer triggered refresh...</p></div>
            <div class="comment-info" id="comment-13185-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '12, 06:25)</span>
                <a class="comment-user userinfo" href="/users/3054/rv_deventer">rv_deventer</a>
                
            </div>
        </div>
    
        <a name="13187"></a>
        <div class="comment" id="comment-13187">
            <div id="post-13187-score" class="comment-score"></div>
            <div class="comment-text"><p>BTW: Why do you need to do anything at all? TCP recovers from the situation by its retransmission mechanism.</p></div>
            <div class="comment-info" id="comment-13187-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '12, 07:03)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-13065" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-13065-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="13001"></a>
                    <div id="answer-container-13001" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-13001-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/13001/up/" rel="nofollow"> </a>
<div id="post-13001-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-13001-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/13001/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <blockquote>
<p>Anyone any idea why this is happening?</p>
</blockquote>
<p>Not a real idea, just some guessing for now.</p>
<blockquote>
<p>However once in a while, the ARP message exchange seems to set off the whole network communication</p>
</blockquote>
<p>Is that "once in a while" in the regular 10 minute schedule (Windows XP ARP cache renewal time for used entries)? </p>
<p><strong>If NO</strong>: You say, the computers are connected directly to each other. I assume a CAT5/6 cable. Maybe the RJ45 connector is not plugged in fully (at either end) and due to small movements (vibrations) the connector loses contact with some pins, which could cause packet loss. Maybe even the link state is lost. However: the time difference between the last TCP packet and the ARP request is probalby to short to reestablish the link. Anyway, can you please check the physical connection (unplug/plug) at both ends?</p>
<p><strong>If YES</strong>: I have no idea (yet) what causes the loss of at least one packet (10.10.10.2 -&gt; 10.10.10.1).</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/13001/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>25 Jul '12, 13:40</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/13001/">
                edited
                <strong>25 Jul '12, 13:43</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-13001">
    
        <a name="13056"></a>
        <div class="comment" id="comment-13056">
            <div id="post-13056-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Kurt,</p>

<p>Thanks for your answer.</p>

<p>ARP broadcast and ARP cache renewal is every 10 minutes. Most renewals do not set off communication, it's just once in a while.
We did replace the UTP cable between the pc's. Did not help.
Further we do see the same issue at different customers (we have several systems in the field).</p>

<p>We also did the following test: we added a static entry to the arp cache. That fixed the communication problem. It proved that the ARP renewal causes the communication is been set off.</p>

<p>I uploaded 4 dump files, which shows the issue:</p>

<pre><code>PC 10.10.10.1 Dump6.pcap    <a href="http://www.cloudshark.org/captures/380ef7488e8e">http://www.cloudshark.org/captures/380ef7488e8e</a>
PC 10.10.10.2 Dump6.pcap    <a href="http://www.cloudshark.org/captures/6539364bc235">http://www.cloudshark.org/captures/6539364bc235</a>
Dump6
 PC 10.10.10.1       PC 10.10.10.2
   Packet no           Packet no
     2046               2326   ARP
    14544              14824   ARP   -&gt; Sets off communication

PC 10.10.10.1 Dump8.pcap   <a href="http://www.cloudshark.org/captures/d550e87c5451">http://www.cloudshark.org/captures/d550e87c5451</a>
PC 10.10.10.2 Dump8.pcap   <a href="http://www.cloudshark.org/captures/51a6c13672d1">http://www.cloudshark.org/captures/51a6c13672d1</a>
Dump8
 PC 10.10.10.1       PC 10.10.10.2
   Packet no           Packet no
      687                267   ARP
    11311              10891   ARP
    20314              19894   ARP   -&gt; Sets off communication
    32437              32017   ARP
</code></pre>

<p>Regards
Rudy</p></div>
            <div class="comment-info" id="comment-13056-info">
                
                
                
                

                

                <span class="comment-age">(27 Jul '12, 00:10)</span>
                <a class="comment-user userinfo" href="/users/3054/rv_deventer">rv_deventer</a>
                
            </div>
        </div>
    
        <a name="13063"></a>
        <div class="comment" id="comment-13063">
            <div id="post-13063-score" class="comment-score">1</div>
            <div class="comment-text"><p>looking at capture Dump6.cap I can see the following:</p>

<p>Wireshark shows "TCP previous segment not captured" for BOTH capture files (Frame #2329 PC_10.10.10.2_Dump6.cap and Frame #2049 PC_10.10.10.1_Dump6.cap). </p>

<p>I conclude: The Windows TCP/IP stack must have dropped the packet internally, before it was sent to the network, maybe due to the ARP request.</p>

<p>A quick search on google revealed a similar problem (with UDP). </p>

<blockquote>
<p><code><a href="http://www.groupsrv.com/computers/about668311.html">http://www.groupsrv.com/computers/about668311.html</a></code><br>
</p>
</blockquote>

<p>Unfortunately the link to <a href="http://experts-exchange.com">experts-exchange.com</a> is void. </p>

<p>I guess it's either a bug in Windows or "works as designed" ;-))</p>

<p><strong>UPDATE</strong>: A rather old link from microsoft itself, pointing at a similar problem. Maybe it's not just a problem in routing mode and still not fixed in Windows XP.</p>

<blockquote>
<p><code><a href="http://support.microsoft.com/kb/194881/en-us">http://support.microsoft.com/kb/194881/en-us</a></code><br>
</p>
<p>Cite: While Windows NT awaits an ARP Response, <strong>ARP will "queue" the IP packet that needs to be sent</strong>. When Windows NT <strong>receives the ARP Response</strong>, it will <strong>only transmit the "latest" or last packet</strong> that it received in its "ARP Packet Queue" for any given destination host.</p>
</blockquote>

<p>Doing a bit more "research" ... There needs (should) to be a queue in the TCP/IP stack that holds packets until the ARP request finished.</p>

<p>Linux: Take a look at this description of ARP handling in the kernel.</p>

<blockquote>
<p><code><a href="http://www.6test.edu.cn/~lujx/linux_networking/0131777203_ch15lev1sec3.html">http://www.6test.edu.cn/~lujx/linux_networking/0131777203_ch15lev1sec3.html</a></code><br>
</p>
</blockquote>

<p>You can configured the ARP queue len with the parameter <strong><code>unres_qlen</code></strong> via systcl (Default: 3).</p>

<blockquote>
<p><code><a href="http://www.kernel.org/doc/man-pages/online/pages/man7/arp.7.html">http://www.kernel.org/doc/man-pages/online/pages/man7/arp.7.html</a></code> </p>
</blockquote>

<p>AIX: Same for AIX with <strong><code>arpqsize</code></strong> (Default: 12).</p>

<blockquote>
<p><code><a href="http://publib.boulder.ibm.com/infocenter/pseries/v5r3/index.jsp?topic=/com.ibm.aix.prftungd/doc/prftungd/arp_cache_tuning.htm">http://publib.boulder.ibm.com/infocenter/pseries/v5r3/index.jsp?topic=/com.ibm.aix.prftungd/doc/prftungd/arp_cache_tuning.htm</a></code><br>
</p>
</blockquote>

<p>Maybe there is also a parameter for Windows, however I was not able to find one (yet).</p>

<p>I guess this pretty much explains it: </p>

<blockquote>
<p><code><a href="http://technet.microsoft.com/en-us/library/cc940021.aspx">http://technet.microsoft.com/en-us/library/cc940021.aspx</a></code><br>
</p>
</blockquote>

<p>Cite: <strong>ARP queues only one outbound IP datagram</strong> for a given destination address while that IP address is being resolved to a MAC address. .... An application can <strong>compensate for this by calling the Iphlpapi.dll routine <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa366358%28v=vs.85%29.aspx">SendArp()</a></strong> to establish an arp cache entry, before sending the stream of packets.</p>

<p><strong>Solution for your problem:</strong></p>

<ul>
<li>set a static ARP entry (not a good idea)</li>
<li>calling SendArp() from time to time to update the arp cache before the entry expires</li>
</ul></div>
            <div class="comment-info" id="comment-13063-info">
                
                
                
                

                

                <span class="comment-age">(27 Jul '12, 01:25)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-13001" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-13001-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/12655/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='EgFtLjTW8CrIVyC6WycupMY1KBIxnaPt' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12655/why-causes-arp-request-a-tcp-previous-segment-lost?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/arp/"
            class="tag-link-arp"
            title="see questions tagged'arp'using tags"
            rel="tag">arp</a> <span class="tag-number">&#215;78</span><br/>
        
    </p>
    <p>
        question asked: <strong title="July 12, 2012, 5:18 a.m.">12 Jul '12, 05:18</strong>
    </p>
    <p> 
     	question was seen: <strong>7,930 times</strong>
    </p>
    <p> 
        last updated: <strong title="Nov. 29, 2013, 10:24 a.m.">29 Nov '13, 10:24</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/2639/arp-question">ARP Question</a>
        </p>
        
        <p>
            <a href="/questions/15792/arp-replies-appear-with-delay-in-wireshark-output">ARP replies appear with delay in Wireshark output</a>
        </p>
        
        <p>
            <a href="/questions/37712/show-the-arp-data-and-the-dhcp-data-and-show-which-data-is-from-the-client-and-which-from-the-server">Show the ARP data and the DHCP data and show which data is from the client and which from the server?</a>
        </p>
        
        <p>
            <a href="/questions/46343/help-troubleshooting-network-connectivity-with-arp-packets">Help troubleshooting network connectivity with ARP packets</a>
        </p>
        
        <p>
            <a href="/questions/56306/intermittent-lan-issues">Intermittent LAN issues</a>
        </p>
        
        <p>
            <a href="/questions/5178/why-gratuitous-arps-for-0000">Why gratuitous ARPs for 0.0.0.0?</a>
        </p>
        
        <p>
            <a href="/questions/16137/excessive-arp-requests-from-one-pc">Excessive ARP requests from one PC</a>
        </p>
        
        <p>
            <a href="/questions/37945/how-to-identify-the-protocol-after-arp">How to identify the protocol after ARP</a>
        </p>
        
        <p>
            <a href="/questions/46350/a-lot-of-who-hasip-tell-ip-arp-packets">a lot of &quot;who has(IP)?&quot; &quot;tell (IP)&quot; ARP packets</a>
        </p>
        
        <p>
            <a href="/questions/57174/seeing-lots-of-arp-requests-even-though-the-hosts-have-the-mac-address-in-their-arp-cache-already">Seeing lots of ARP requests even though the hosts have the MAC address in their ARP cache already</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
