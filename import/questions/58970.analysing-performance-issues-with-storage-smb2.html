<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Analysing Performance Issues with Storage (SMB2) - Wireshark Q&amp;A</title>
        <meta name="description" content="Hello, i&#39;m Windows-Server-Admin and not a network-technican and even not a WireShark-User. I&#39;m analysing a performance-problem of an application. The application reads and writes to a small config-file (ini) on a Network-Share. If the mentioned config-file is placed on our 3rd-Party-Storage the appl..." />
        <meta name="keywords" content="smb2,smb" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/58970/analysing-performance-issues-with-storage-smb2" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/58970/analysing-performance-issues-with-storage-smb2?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='h5Fw6vPxJtjHWiDcRjF2IOdasgmHM048' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/58970/analysing-performance-issues-with-storage-smb2">Analysing Performance Issues with Storage (SMB2)</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-58970-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/58970/up/" rel="nofollow"> </a>
<div id="post-58970-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-58970-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/58970/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/58970/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hello,</p>
<p>i'm Windows-Server-Admin and not a network-technican and even not a WireShark-User.
I'm analysing a performance-problem of an application.</p>
<p>The application reads and writes to a small config-file (ini) on a Network-Share.
If the mentioned config-file is placed on our 3rd-Party-Storage the application-performance is bad. If the config-file is placed on a normal Microsoft Windows Share the application-performance is good.</p>
<p>I am trying to analyse and compare the szenarios with WireShark and I see big differences.
Please find below a graphical comparison:</p>
<p><img alt="alt text" src="http://www.fotos-hochladen.net/uploads/wiresharkcqgx07prlf.png"></p>
<p>Link to full comparison-picture: <a href="http://www.fotos-hochladen.net/uploads/wiresharkcqgx07prlf.png">http://www.fotos-hochladen.net/uploads/wiresharkcqgx07prlf.png</a>
The comparison shows the same process. (Application-Start)</p>
<p>The traffic looks like this when the config-file is on the 3rd-party-storage the whole time.</p>
<p><img alt="alt text" src="http://www.fotos-hochladen.net/uploads/packetsyq1d5j0s96.png"></p>
<p>Link to full picture: <a href="http://www.fotos-hochladen.net/uploads/packetsyq1d5j0s96.png">http://www.fotos-hochladen.net/uploads/packetsyq1d5j0s96.png</a></p>
<p>When I "follow the TCP-Stream" in WireShark, I can see the content of the file xxxx times.</p>
<p>Does anybody has an idea on this?
I can see, that something is wrong, but I don't know how to analyse this further ...</p>
<p>Thank you!</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/smb2/" class="post-tag tag-link-smb2"
                                        title="see questions tagged 'smb2'" rel="tag">smb2</a>
                                
                                    <a href="/tags/smb/" class="post-tag tag-link-smb"
                                        title="see questions tagged 'smb'" rel="tag">smb</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>23 Jan '17, 03:18</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7bd872f6d79eb92fe508ef3de9ff3c7b?s=32&amp;d=identicon&amp;r=g" alt="Panteraa's gravatar image" />
    <p><a href="/users/27550/panteraa">Panteraa</a><br/>
    <span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="4 badges"><span class="bronze">&#9679;</span><span class="badgecount">4</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Panteraa has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/58970/">
                edited
                <strong>23 Jan '17, 03:22</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-58970">
    
</div>
<div id="comment-tools-58970" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-58970-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/58970/analysing-performance-issues-with-storage-smb2?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/58970/analysing-performance-issues-with-storage-smb2?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/58970/analysing-performance-issues-with-storage-smb2?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/58970/analysing-performance-issues-with-storage-smb2?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="58990"></a>
                    <div id="answer-container-58990" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-58990-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/58990/up/" rel="nofollow"> </a>
<div id="post-58990-score" class="post-score"
    title="current number of votes">
    4
</div>
<a id="post-58990-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/58990/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Hi Panteraa</p>
<p>I assume that your screenshot shows the connection of a single workstation to the server.</p>
<p>A good starting point for the analysis is the function Statistics -&gt; Service Response Times -&gt; SMB2 (or SMB, if your filer does not support SMB2).</p>
<p>The screenshot shows that the client is running in a tight loop and constantly repeats three operations </p>
<ul>
<li>Open file</li>
<li>Read file</li>
<li>Close file</li>
</ul>
<p>The time stamps from the second picture document delta times of a few milliseconds between the loop iterations. Although your question mentions write activities, they are not visible in the trace.</p>
<p>Tuning is not too hard:</p>
<ol>
<li>Make sure that your client caches the contents. This is the most important advise here.</li>
<li>Really, stop running these tight loops. It causes a lot of overhead on your workstation, the server and the network.</li>
</ol>
<p>Ok, you can't cache. It must just another stupid application. Here are a few more options:</p>
<ol>
<li>Use file notifications (SMB2 IoCtl Notify), if the file changes and the client needs to process an update right away.</li>
<li>Try to use a file or directory lease, if your application, your developer, your client (Win 8.1 or higher), your Server (Win 2012 or newer) and most importantly you as an Admin understand it.</li>
<li>Make sure, that the client uses proper locking mechanisms (since the file is only read the Create statement should specifiy "Read access").</li>
</ol>
<p>There are a number of reasons, why the 3rd-party storage server could be slower than the Windows server. Among the possible reasons are:</p>
<ul>
<li>The 3rd-party server uses SMB, and not SMB2</li>
<li>If SMB2 is used: The server does not grant sufficient credits (unlikely, given the small I/O sizes)</li>
<li>The 3rd-party server uses some virus scanner, which is overloaded</li>
<li>Half Duplex / Full Duplex mismatch on the switch port (only for 10/100 MBit)</li>
<li>The 3rd-party server is overloaded (Windows servers dedicate "all" (cough) memory to caching. With this I/O-frequency the file will never be squeezed out of the cache).</li>
<li>The 3rd-party server uses a poor TCP or Samba implementation (unlikely for EMC, NetApp etc.)</li>
<li>Disk architecture (RAID-5 with a lot of writes from another session, critical disk connected to USB 2 ...)</li>
<li>Excessive hardware errors (run diagnostics to be sure)</li>
</ul>
<p>More details would require a closer look at trace files from both systems, the network architecture and the configuration of the two servers.</p>
<p>Good Hunting</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/58990/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>23 Jan '17, 12:40</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/3b60e92020a427bb24332efc0b560943?s=32&amp;d=identicon&amp;r=g" alt="packethunter's gravatar image" />
    <p><a href="/users/416/packethunter">packethunter</a><br/>
    <span class="score" title="2137 reputation points"><span class="">2.1k</span></span><span title="7 badges"><span class="badge1">&#9679;</span><span class="badgecount">7</span></span><span title="15 badges"><span class="silver">&#9679;</span><span class="badgecount">15</span></span><span title="48 badges"><span class="bronze">&#9679;</span><span class="badgecount">48</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="packethunter has 8 accepted answers">8&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-58990">
    
        <a name="59002"></a>
        <div class="comment" id="comment-59002">
            <div id="post-59002-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi packethunter,</p>

<p>thank you for the effort and the extensive Information.</p>

<blockquote>
<blockquote>
<blockquote>
<p>A good starting point for the analysis is the function Statistics -&gt; Service Response Times -&gt; SMB2</p>
</blockquote>
</blockquote>
</blockquote>

<p>The filer supports SMB2. The stats look like this:</p>

<p><a href="http://www.fotos-hochladen.net/uploads/stats7eckw51vqr.png">http://www.fotos-hochladen.net/uploads/stats7eckw51vqr.png</a></p>

<blockquote>
<blockquote>
<blockquote>
<p>Really, stop running these tight loops. It causes a lot of overhead on your workstation, the server and the network.</p>
</blockquote>
</blockquote>
</blockquote>

<p>That's my target, but I don't think the application is the cause, because when the configuration-file is placed on a Windows-Share it doesn't show the open-read-close loop behaviour.</p>

<p>.</p>

<p>I will have a closer look on your other suggestions, but I think I will need to get some paid consulting on this.</p>

<p>Thank you</p></div>
            <div class="comment-info" id="comment-59002-info">
                
                
                
                

                

                <span class="comment-age">(24 Jan '17, 01:32)</span>
                <a class="comment-user userinfo" href="/users/27550/panteraa">Panteraa</a>
                
            </div>
        </div>
    
        <a name="59021"></a>
        <div class="comment" id="comment-59021">
            <div id="post-59021-score" class="comment-score">1</div>
            <div class="comment-text"><p>One last thing to try before you fill out that purchase request:</p>

<p>The most likely candidat for your experience is the branch cache. This feature is described by multiple articles on MSDN. Here is a good introduction: <a href="https://technet.microsoft.com/en-us/library/dd637832(v=ws.10).aspx">https://technet.microsoft.com/en-us/library/dd637832(v=ws.10).aspx</a></p>

<p>Please compare the TreeConnect Responses from the storage server and the Windows system. There might be a few tiny differences, including individual bits which Wireshark may not (yet) interpret correctly.</p>

<p>The cache has to be enabled on a per-share base.</p>

<p>Good luck</p></div>
            <div class="comment-info" id="comment-59021-info">
                
                
                
                

                

                <span class="comment-age">(24 Jan '17, 13:16)</span>
                <a class="comment-user userinfo" href="/users/416/packethunter">packethunter</a>
                
            </div>
        </div>
    
        <a name="59043"></a>
        <div class="comment not_top_scorer" id="comment-59043">
            <div id="post-59043-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi packethunter,</p>

<p>I know Branch-Cache. I came into contact with it in a course for a Microsoft exam. We don't use it in our Company at all. The service ist not running and the role is not activated on the client. Would you say, that there is a setting on the storage that we could try to control the behaviour?</p>

<p>I have prepared a comparison between the TreeConnect of the two szenarios ...</p>

<p>Tree Connect Request:
<a href="http://www.fotos-hochladen.net/uploads/01treeconnecq7wamg48io.png">http://www.fotos-hochladen.net/uploads/01treeconnecq7wamg48io.png</a></p>

<p>Tree Connect Response:
<a href="http://www.fotos-hochladen.net/uploads/02treeconnecth839ialsf1.png">http://www.fotos-hochladen.net/uploads/02treeconnecth839ialsf1.png</a></p>

<p>Are you able to see anything suspicious?</p>

<p>I noticed, that the client requests 71 Credits from the 3rd-Party-Storage. The 3rd-Party-Storage grants 1 Credit.</p>

<p>In the other szenario the clients requests 95 Credits from the Windows-Server. The Windows-Server grants 33 Credits.
Could this have anything to do with the issue?</p>

<p>Thank you!</p></div>
            <div class="comment-info" id="comment-59043-info">
                
                
                
                

                

                <span class="comment-age">(25 Jan '17, 03:51)</span>
                <a class="comment-user userinfo" href="/users/27550/panteraa">Panteraa</a>
                
            </div>
        </div>
    
        <a name="59066"></a>
        <div class="comment" id="comment-59066">
            <div id="post-59066-score" class="comment-score">1</div>
            <div class="comment-text"><p>There are only two extra bits set by the 3rd-party storage. I'm not aware, that any of the two bits would cause some client side caching. </p>

<p>It is noteworthy, that the Windows server is a lot faster (680 microseconds vs. 1400). The delay might be caused by the two extra hops between client and 3rd-party storage, at least partially (IP TTL 127 vs. 125 indicates 1 vs. 3 hops --- or a rather strange IP stack).</p>

<p></p><hr>
<p>The Credits would be a limiting factor if the client issues either multiple requests or requests dealing with more than 64 kByte.</p>
<p>If you are interested in a quick way to visualize credits you might want to check my blog posting on packet-foo.com: <a href="https://blog.packet-foo.com/2016/10/trace-file-case-files-smb2-performance/">https://blog.packet-foo.com/2016/10/trace-file-case-files-smb2-performance/</a></p>
<p>Please note, that the blog post discusses a different problem.</p>
<hr>
<p>I am afraid, that I can not help you further without a full trace starting with the SMB protocol negotiation.</p>
<p>Good luck</p><p></p></div>
            <div class="comment-info" id="comment-59066-info">
                
                
                
                

                

                <span class="comment-age">(25 Jan '17, 13:57)</span>
                <a class="comment-user userinfo" href="/users/416/packethunter">packethunter</a>
                
            </div>
        </div>
    
        <a name="59076"></a>
        <div class="comment" id="comment-59076">
            <div id="post-59076-score" class="comment-score">1</div>
            <div class="comment-text"><p>As <a href="/users/416/packethunter">@packethunter</a> says, it's diffcult to analyse this type of problem without visibility of the trace.  I did have one thought regarding the difference between the two devices, in particular regarding the amount of data moved across the network.</p>

<p>SMB2 has a mechanism called Leasing (in SMB1 it was called OpLock).  A workstation can request to lease the data it gets from a file server.  Leasing means that a workstation can hold file data in a memory buffer where an application can perform repeated operations on it before eventually flushing it to the file server.  This improves application performance and reduces network load.</p>

<p>The Lease is requested when the file is opened (SMB2 Create Request) and granted in the Create Response.  Wireshark still labels the fields involved as Oplock.</p>

<p>Try comparing the Oplock values in the Create Req and Rsp on the Windows share with that on the NAS.</p>

<p>If you want to analyze the SMB2 performance in detail, check out the TRANSUM plugin for Wireshark at <a href="https://community.tribelab.com/mod/page/view.php?id=492">https://community.tribelab.com/mod/page/view.php?id=492</a></p>

<p>TRANSUM gives you a breakdown of the response time of each SMB2 command, splitting it into server time and network time.</p>

<p>Best regards...Paul</p></div>
            <div class="comment-info" id="comment-59076-info">
                
                
                
                

                

                <span class="comment-age">(26 Jan '17, 00:11)</span>
                <a class="comment-user userinfo" href="/users/7690/paulofford">PaulOfford</a>
                
            </div>
        </div>
    
        <a name="59103"></a>
        <div class="comment not_top_scorer" id="comment-59103">
            <div id="post-59103-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi,</p>

<p>I think I would be able to sanitize the trace-files and upload it, but I don't want you to make a time-consuming analysis of my data for free.</p>

<blockquote>
<blockquote>
<blockquote>
<p>If you are interested in a quick way to visualize credits you might want to check my blog posting ...</p>
</blockquote>
</blockquote>
</blockquote>

<p>Nice. I have visualized the credits in the trace:</p>

<p><a href="https://picload.org/image/roawpgaa/iograph.png">https://picload.org/image/roawpgaa/iograph.png</a>
(<a href="https://img3.picload.org/image/roawcowp/iograph.png)">https://img3.picload.org/image/roawcowp/iograph.png)</a></p>

<blockquote>
<blockquote>
<blockquote>
<p>Leasing means that a workstation can hold file data in a memory buffer where ...</p>
</blockquote>
</blockquote>
</blockquote>

<p>I also thought about a caching-issue. I find it strange, because I did also try to disable OpLocks on the Windows-Server and made a test again, but it was fast too ...!?</p>

<blockquote>
<blockquote>
<blockquote>
<p>Try comparing the Oplock values in the Create Req and Rsp on the Windows share with that on the NAS.</p>
</blockquote>
</blockquote>
</blockquote>

<p>I have compared the values. I noticed, that the client requests a "SMB2_CREATE_DURABLE_HANDLE_REQUEST" (DHnQ) in both szenarios. The Windows-Server contains the "DHnQ" in the Response, but the 3rd-party-storage not:</p>

<p><a href="https://picload.org/image/roawclgg/requestresponse.png">https://picload.org/image/roawclgg/requestresponse.png</a></p>

<p>All in all your answers were all helpfull. I will mark them, so you get reputation. I think I have collected enough material to give the case to the storage-team/manufacturer.</p>

<p>.</p>

<p>At <strong>Packethunter</strong>:</p>

<p>Erlauben Sie mir Sie unter der angegebenen E-Mail auf Ihrem Blog betreffend eines Angebots f√ºr eine Analyse in einer anderen Sache zu kontaktieren? Machen Sie so etwas? (mit Rechnung usw.)</p>

<p>Thank you</p></div>
            <div class="comment-info" id="comment-59103-info">
                
                
                
                

                

                <span class="comment-age">(27 Jan '17, 01:33)</span>
                <a class="comment-user userinfo" href="/users/27550/panteraa">Panteraa</a>
                
            </div>
        </div>
    
        <a name="59148"></a>
        <div class="comment" id="comment-59148">
            <div id="post-59148-score" class="comment-score">1</div>
            <div class="comment-text"><p>Sounds like a good time to engage with the storage manufacturer.</p>

<p>If you want quick start to SMB analysis you might want to take a look at the SMB2 Overview page on TribeLab - <a href="https://community.tribelab.com/mod/page/view.php?id=608">https://community.tribelab.com/mod/page/view.php?id=608</a></p></div>
            <div class="comment-info" id="comment-59148-info">
                
                
                
                

                

                <span class="comment-age">(30 Jan '17, 06:57)</span>
                <a class="comment-user userinfo" href="/users/7690/paulofford">PaulOfford</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-58990" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-58990-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/58970/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='h5Fw6vPxJtjHWiDcRjF2IOdasgmHM048' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/58970/analysing-performance-issues-with-storage-smb2?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/58970/analysing-performance-issues-with-storage-smb2?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/smb/"
            class="tag-link-smb"
            title="see questions tagged'smb'using tags"
            rel="tag">smb</a> <span class="tag-number">&#215;52</span><br/>
        
        <a href="/tags/smb2/"
            class="tag-link-smb2"
            title="see questions tagged'smb2'using tags"
            rel="tag">smb2</a> <span class="tag-number">&#215;27</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Jan. 23, 2017, 3:18 a.m.">23 Jan '17, 03:18</strong>
    </p>
    <p> 
     	question was seen: <strong>8,219 times</strong>
    </p>
    <p> 
        last updated: <strong title="Jan. 30, 2017, 6:57 a.m.">30 Jan '17, 06:57</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/58884/loads-of-nbss-messages-from-dns-servers">Loads of NBSS messages from DNS servers</a>
        </p>
        
        <p>
            <a href="/questions/38512/file-transfer-cature-question-runs-slow">File transfer cature question runs slow</a>
        </p>
        
        <p>
            <a href="/questions/22131/ioctl-response-error-file_system-function-0x006b">Ioctl Response, Error: FILE_SYSTEM Function: 0x006b</a>
        </p>
        
        <p>
            <a href="/questions/35460/smb2-error-troubleshooting">SMB2 Error Troubleshooting</a>
        </p>
        
        <p>
            <a href="/questions/37818/smb-troubleshooting-status_lock_not_granted">SMB Troubleshooting STATUS_LOCK_NOT_GRANTED</a>
        </p>
        
        <p>
            <a href="/questions/56304/how-can-smb2-srt-sum-be-higher-than-the-whole-capture">How can SMB2 SRT sum be higher than the whole capture</a>
        </p>
        
        <p>
            <a href="/questions/71/smb-troubleshooting">SMB troubleshooting</a>
        </p>
        
        <p>
            <a href="/questions/12113/save-the-smb-object-list">Save the SMB object list?</a>
        </p>
        
        <p>
            <a href="/questions/40218/strange-issue-with-cifs-client">strange issue with cifs client</a>
        </p>
        
        <p>
            <a href="/questions/48488/analyzing-slow-file-transfers">Analyzing slow file transfers</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
