<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Wireless Partial Virtual Bitmap - Wireshark Q&amp;A</title>
        <meta name="description" content="Does anyone know of an easy way to filter on a specific AID (association ID) for a WLAN client to see if it is in the partial virtual bitmap (PVM)? With a only a limited number of devices and low AID values, I can do some simple comparisons, if I know how large the bitmap could be: ((wlan_mgt.tim.pa..." />
        <meta name="keywords" content="tim,beacon,partialvirtualbitmap" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/49130/wireless-partial-virtual-bitmap" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/49130/wireless-partial-virtual-bitmap?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='oRzLawLOfZW7nVwmgTSUWfAbtWVwp9Sl' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/49130/wireless-partial-virtual-bitmap">Wireless Partial Virtual Bitmap</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-49130-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/49130/up/" rel="nofollow"> </a>
<div id="post-49130-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-49130-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/49130/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/49130/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Does anyone know of an easy way to filter on a specific AID (association ID) for a WLAN client to see if it is in the partial virtual bitmap (PVM)?  With a only a limited number of devices and low AID values, I can do some simple comparisons, if I know how large the bitmap could be:</p>
<pre><code>((wlan_mgt.tim.partial_virtual_bitmap &amp; 02) or (wlan_mgt.tim.partial_virtual_bitmap &amp; 2:00))
</code></pre>
<p>However, on some systems, my AID values could be in the 100s, so I want to filter on AID == 132 (or whatever), and have it match if that bit is high.  The problem is the IE for TIM includes a length and an offset, so I may get a couple of bytes or many bytes, depending on how many stations have data waiting for them, and we need the offset to determine where this particular device is.  I can decode by hand, but would be great if Wireshark could tell me.</p>
<p>The natural choice is wlan.aid == 132 (or whatever), but this does not match the partial virtual bitmap.  However, this filter works well to pick up the PS-Poll frames, but to verify proper 802.11 operation, I should see the device AID in the PVM, then the PS-Poll frame.  <br>
</p>
<p>Some sample results:<br>
</p>
<p>One beacon might give this to me as the PVM</p>
<pre><code>Length: 15
Offset: 4
PVM: 0x020000000000000010002000

 AID   64 -&gt;    01000000
 AID   72 -&gt;    00000000
 AID   80 -&gt;    00000000
 AID   88 -&gt;    00000000
 AID   96 -&gt;    00000000
 AID  104 -&gt;    00000000
 AID  112 -&gt;    00000000
 AID  120 -&gt;    00000000
 AID  128 -&gt;    00001000    &lt;-- device 132 indicates data waiting
 AID  136 -&gt;    00000000
 AID  144 -&gt;    00000100
 AID  152 -&gt;    00000000
</code></pre>
<p>So I know device 132 has data waiting. </p>
<p>Another beacon a little while later - </p>
<pre><code>Length: 7
Offset: 8
PVM: 0x10000000

 AID  128 -&gt;    00001000   &lt;-- device 132 indicates data waiting
 AID  136 -&gt;    00000000
 AID  144 -&gt;    00000000
 AID  152 -&gt;    00000000
</code></pre>
<p>Again, device 132 has data waiting.</p>
<p>Reference: <a href="http://processors.wiki.ti.com/index.php/OMAP_Wireless_Connectivity_Power_Save">http://processors.wiki.ti.com/index.php/OMAP_Wireless_Connectivity_Power_Save</a></p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/tim/" class="post-tag tag-link-tim"
                                        title="see questions tagged 'tim'" rel="tag">tim</a>
                                
                                    <a href="/tags/beacon/" class="post-tag tag-link-beacon"
                                        title="see questions tagged 'beacon'" rel="tag">beacon</a>
                                
                                    <a href="/tags/partialvirtualbitmap/" class="post-tag tag-link-partialvirtualbitmap"
                                        title="see questions tagged 'partialvirtualbitmap'" rel="tag">partialvirtualbitmap</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>12 Jan '16, 09:51</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/0a47ef51dd9c9996d194a4983295f5a4?s=32&amp;d=identicon&amp;r=g" alt="Bob%20Jones's gravatar image" />
    <p><a href="/users/112/bob-jones">Bob Jones</a><br/>
    <span class="score" title="1014 reputation points"><span class="">1.0k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="5 badges"><span class="silver">&#9679;</span><span class="badgecount">5</span></span><span title="15 badges"><span class="bronze">&#9679;</span><span class="badgecount">15</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Bob Jones has 19 accepted answers">21&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-49130">
    
        <a name="49134"></a>
        <div class="comment" id="comment-49134">
            <div id="post-49134-score" class="comment-score"></div>
            <div class="comment-text"><p>can you provide a small sample pcap?</p></div>
            <div class="comment-info" id="comment-49134-info">
                
                
                
                

                

                <span class="comment-age">(12 Jan '16, 10:32)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner â™¦</a>
                
            </div>
        </div>
    
        <a name="49142"></a>
        <div class="comment" id="comment-49142">
            <div id="post-49142-score" class="comment-score"></div>
            <div class="comment-text"><p>Trace is here:</p>

<p><a href="https://www.cloudshark.org/captures/169a75f46227">https://www.cloudshark.org/captures/169a75f46227</a></p>

<p>Two packets - a beacon with TIM IE, and a PS Poll frame.<br>
</p>

<p>For this example, this is what I have for the TIM map:</p>

<pre><code>     length  15
     offset  4
     pvm     200000000000000010002000
     Bytes:  [12] 8...19
     Bits:   64...159
     pvm as decimal: 9903520314283042199461437440
</code></pre>

<p>AID   64 -&gt;    00000100
 AID   72 -&gt;    00000000
 AID   80 -&gt;    00000000
 AID   88 -&gt;    00000000
 AID   96 -&gt;    00000000
 AID  104 -&gt;    00000000
 AID  112 -&gt;    00000000
 AID  120 -&gt;    00000000
 AID  128 -&gt;    00001000    &lt;--- device 132, per AID in PS-Poll
 AID  136 -&gt;    00000000
 AID  144 -&gt;    00000100
 AID  152 -&gt;    00000000</p>

<p>None of the anonymizer tools seemed to work on wlan addresses.  I had to edit hex manually.  Know of a tool like tracewrangler for 802.11 capture files?</p></div>
            <div class="comment-info" id="comment-49142-info">
                
                
                
                

                

                <span class="comment-age">(12 Jan '16, 12:10)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
        <a name="53211"></a>
        <div class="comment" id="comment-53211">
            <div id="post-53211-score" class="comment-score"></div>
            <div class="comment-text"><p>Bump.<br>
</p>

<p>I ran into this again at a customer site last week with a large wifi infrastructure - more than 1200 APs.  I have to feed the packet captures into OmniPeek as it decodes the actual AIDs in the TIM map.  Any tips for Wireshark, or would this be a new feature request to enhance the TIM IE decoding?</p></div>
            <div class="comment-info" id="comment-53211-info">
                
                
                
                

                

                <span class="comment-age">(05 Jun '16, 10:11)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
        <a name="53212"></a>
        <div class="comment" id="comment-53212">
            <div id="post-53212-score" class="comment-score"></div>
            <div class="comment-text"><p>Would a Lua post-dissector creating up to thousands of individual pseudo-fields out of the individual bits of the TIM submap help you? Display filters do not support arithmetic to calculate offsets and protocol fields cannot be organized into arrays.</p>

<p>Or, as I think about it, rather a duplicate copy of the original bitmap which would be left-stuffed with 0s to allow use of a fixed offset, so for AID 132, you could always use <code>xxx.xxx.my_bitmap[16:1] &amp; 8</code></p></div>
            <div class="comment-info" id="comment-53212-info">
                
                
                
                

                

                <span class="comment-age">(05 Jun '16, 11:45)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="53225"></a>
        <div class="comment" id="comment-53225">
            <div id="post-53225-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<blockquote>
<p>Or, as I think about it, rather a duplicate copy of the original bitmap which would be left-stuffed with 0s to allow use of a fixed offset, so for AID 132, you could always use xxx.xxx.my_bitmap[16:1] &amp; 8</p>
</blockquote>
</blockquote>

<p>This sounds like it would do.  What I observe is something like this...</p>

<ol>
<li>There is WiFi data loss</li>
<li>So I ... capture  WiFi traffic</li>
<li>Notice client stops sending PS-Poll frames for a period off time</li>
</ol>

<p>So root cause of data loss is that no data is sent FromDS for this period, as client is not requesting it.  But it's not really root cause: client will only send PS-Poll if informed that data is buffered at the AP with the TIM map entry, so to figure which device is at fault, we need to look at the TIM map to see if the AP is indicating data is waiting.  If the bit is set, and no PS-Poll, it's a client issue.  If not set, then need a wired trace to prove wired data arrives at AP, but it does not set the TIM map.<br>
</p>

<p>So a Lua dissector, as you describe, would allow me to filter by PS-Poll and then by Beacons that had this bit set, so Wireshark will easily show periods of no PS-Poll - and then whether there are beacons or not during that period.<br>
</p>

<p>I have not done any Lua with Wireshark before, so sounds like I need to get on it.  I'll start the Lua tutorial for a dissector and see how far I get.</p></div>
            <div class="comment-info" id="comment-53225-info">
                
                
                
                

                

                <span class="comment-age">(06 Jun '16, 03:17)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
        <a name="53227"></a>
        <div class="comment not_top_scorer" id="comment-53227">
            <div id="post-53227-score" class="comment-score"></div>
            <div class="comment-text"><p>Well, I was afraid of posting an optimistic nonsense so I'd better checked I haven't... so if you don't want to use this as an impulse to dive into Lua, you may have my proof of concept code :-)</p></div>
            <div class="comment-info" id="comment-53227-info">
                
                
                
                

                

                <span class="comment-age">(06 Jun '16, 03:26)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="53233"></a>
        <div class="comment not_top_scorer" id="comment-53233">
            <div id="post-53233-score" class="comment-score"></div>
            <div class="comment-text"><p>Proof of concept code would be gladly accepted and greatly appreciated, but I don't want to expect that others would just do it if I won't try first.  Thanks for any help you could provide, anyway.  I am not sure what the learning curve might be...</p></div>
            <div class="comment-info" id="comment-53233-info">
                
                
                
                

                

                <span class="comment-age">(06 Jun '16, 05:19)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
        <a name="53237"></a>
        <div class="comment not_top_scorer" id="comment-53237">
            <div id="post-53237-score" class="comment-score"></div>
            <div class="comment-text"><p>OK. So I don't delete those 16 lines of Lua code until you state clearly either that you want them or that you have written your own ones.</p>

<p>Just an idea if you're going to take Lua programming seriously: I was thinking of an alternative solution consisting in creation of a value-less pseudofield for each bit which has a value of 1. This would make the addressing in the display filter expression more convenient as you wouldn't have to manually calculate the byte offset and bit position, but it could cost quite some CPU time. The display filter condition would then look just like <code>wlan_mgt.tim.data_waiting.aid_132</code> (no <code>== 1</code> necessary).</p></div>
            <div class="comment-info" id="comment-53237-info">
                
                
                
                

                

                <span class="comment-age">(06 Jun '16, 06:13)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="53257"></a>
        <div class="comment not_top_scorer" id="comment-53257">
            <div id="post-53257-score" class="comment-score"></div>
            <div class="comment-text"><p>Please share!</p></div>
            <div class="comment-info" id="comment-53257-info">
                
                
                
                

                

                <span class="comment-age">(06 Jun '16, 17:37)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-49130" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 9
        </span>
        <a href="#" class="show-all-comments-link">show 4 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-49130-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/49130/wireless-partial-virtual-bitmap?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/49130/wireless-partial-virtual-bitmap?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/49130/wireless-partial-virtual-bitmap?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/49130/wireless-partial-virtual-bitmap?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="53258"></a>
                    <div id="answer-container-53258" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-53258-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/53258/up/" rel="nofollow"> </a>
<div id="post-53258-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-53258-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/53258/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="Bob Jones has selected this answer as the correct answer"
        href="/accept_answer/53258/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>A Lua post-dissector, creating a pseudo-field which is a duplicate copy of the original bitmap left-stuffed with 0s in order to allow use of a fixed bit address in the display filter, is below.</p>
<p>The display filter condition is <code>tim.bitmap[X:1]&amp;x</code>, where</p>
<ul>
<li>
<p><code>X</code> is <code>AID div 8</code> in decadic notation (unless specified otherwise using <code>0x</code> or <code>0</code> prefix),</p>
</li>
<li>
<p>if I got the explanation regarding LSB/MSB meaning correctly from the reference, <code>x</code> is <code>2^(AID rem 8)</code>, this time hexadecimal notation is the only possibility and no prefix is required or possible.</p>
</li>
</ul>
<p>So for AID=132, it would be <code>tim.bitmap[16:1]&amp;10</code>.</p>
<p>The Lua script itself, to be placed into a .lua file in your plugin directory, is:</p>
<pre><code>-- Define functions to import already dissected values:
OrigBitmap=Field.new("wlan_mgt.tim.partial_virtual_bitmap")
OrigOffset=Field.new("wlan_mgt.tim.bmapctl.offset")

-- Export "protocol" 'tim' and its only field
MyProto = Proto("tim","TIM pseudo-protocol")
MyBitmap = ProtoField.bytes("tim.bitmap","Extended bitmap")
MyProto.fields = { MyBitmap }

-- The (post-)dissector function itself
function MyProto.dissector(buffer,pinfo,tree)
    if OrigBitmap() then
        local MyArray = ByteArray.new("00")
        MyArray:set_size(2*OrigOffset().value)
        MyArray:append(OrigBitmap().value)
        local MyTvb = ByteArray.tvb(MyArray,"extended bitmap")
        local subtree = tree:add(MyProto,"TIM buffer expanded")
        subtree:add(MyBitmap,MyTvb:range(0))
    end
end

-- register the postdissector for our "protocol"
register_postdissector(MyProto)
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/53258/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>06 Jun '16, 22:21</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" alt="sindy's gravatar image" />
    <p><a href="/users/19586/sindy">sindy</a><br/>
    <span class="score" title="6049 reputation points"><span class="">6.0k</span></span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">&#9679;</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">&#9679;</span><span class="badgecount">51</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="sindy has 110 accepted answers">24&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/53258/">
                edited
                <strong>11 Jun '16, 04:18</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-53258">
    
        <a name="53271"></a>
        <div class="comment" id="comment-53271">
            <div id="post-53271-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks - I owe you a beer.  I'm out of the office this week on business, but I will try this as soon as I get a chance.</p></div>
            <div class="comment-info" id="comment-53271-info">
                
                
                
                

                

                <span class="comment-age">(07 Jun '16, 03:09)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
        <a name="53356"></a>
        <div class="comment" id="comment-53356">
            <div id="post-53356-score" class="comment-score"></div>
            <div class="comment-text"><p>I tested this and it looks good.  Thanks for your help.</p>

<p>I validated with a couple of different cases: AID of 16 and AID of 1 - two simple cases I could inspect to be sure, it works.</p></div>
            <div class="comment-info" id="comment-53356-info">
                
                
                
                

                

                <span class="comment-age">(11 Jun '16, 01:21)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-53258" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-53258-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="53546"></a>
                    <div id="answer-container-53546" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-53546-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/53546/up/" rel="nofollow"> </a>
<div id="post-53546-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-53546-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/53546/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Please open an enhancement bug at bugs.wireshark.org, attach a sample capture that contains (at least) two beacons: one with no offset into the tim map and one with an offset. If you are worried about keeping the information non-public set the attachment to private. Last but not least: assign the bug to me: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a3c9cec2dac6d1e3cfccd3cfccc58dc7c68d">[email&#160;protected]</a> I will add proper decoding and thus filtering but I need some captures to test against.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/53546/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>17 Jun '16, 16:26</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/f1397f7833ee927f0c26a9fcb92fff11?s=32&amp;d=identicon&amp;r=g" alt="jmayer's gravatar image" />
    <p><a href="/users/5586/jmayer">jmayer</a><br/>
    <span class="score" title="26 reputation points">26</span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="jmayer has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-53546">
    
        <a name="53549"></a>
        <div class="comment" id="comment-53549">
            <div id="post-53549-score" class="comment-score"></div>
            <div class="comment-text"><p>This is great, thanks.  Enhancement request is done:</p>

<p>Bug 12545 - Enhancement: Decode TIM Map in 802.11 Beacon Frame</p>

<p>If you need a tester, let me know.  I have <em>plenty</em> of traces to test against.</p></div>
            <div class="comment-info" id="comment-53549-info">
                
                
                
                

                

                <span class="comment-age">(18 Jun '16, 02:02)</span>
                <a class="comment-user userinfo" href="/users/112/bob-jones">Bob Jones</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-53546" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-53546-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/49130/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='oRzLawLOfZW7nVwmgTSUWfAbtWVwp9Sl' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/49130/wireless-partial-virtual-bitmap?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/49130/wireless-partial-virtual-bitmap?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/beacon/"
            class="tag-link-beacon"
            title="see questions tagged'beacon'using tags"
            rel="tag">beacon</a> <span class="tag-number">&#215;6</span><br/>
        
        <a href="/tags/partialvirtualbitmap/"
            class="tag-link-partialvirtualbitmap"
            title="see questions tagged'partialvirtualbitmap'using tags"
            rel="tag">partialvirtualbitmap</a> <span class="tag-number">&#215;1</span><br/>
        
        <a href="/tags/tim/"
            class="tag-link-tim"
            title="see questions tagged'tim'using tags"
            rel="tag">tim</a> <span class="tag-number">&#215;1</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Jan. 12, 2016, 9:51 a.m.">12 Jan '16, 09:51</strong>
    </p>
    <p> 
     	question was seen: <strong>3,773 times</strong>
    </p>
    <p> 
        last updated: <strong title="June 18, 2016, 2:02 a.m.">18 Jun '16, 02:02</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/2618/client-access-point-association-handshake-sample">Client &amp;  Access Point association handshake sample</a>
        </p>
        
        <p>
            <a href="/questions/11804/using-rawshark-or-tshark-for-wireless-traffic">Using Rawshark or tshark for wireless traffic</a>
        </p>
        
        <p>
            <a href="/questions/44591/time-delta-between-80211-beacon-frames">Time delta between 802.11 beacon frames</a>
        </p>
        
        <p>
            <a href="/questions/47338/my-system-only-capturing-the-probe-requests-but-its-not-showing-the-beacon-frames">My system only capturing the probe requests but its not showing the beacon frames.</a>
        </p>
        
        <p>
            <a href="/questions/53720/capturing-gsm-identification-or-beacon-frames">Capturing GSM identification or beacon frames</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
