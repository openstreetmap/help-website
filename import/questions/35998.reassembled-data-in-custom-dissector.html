<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Reassembled data in custom dissector - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, Iam in the process of developing my custom dissector on top of UDP(wireshark).  I have a packet data spli in many packets and reassembled together when i get &quot;end of message&quot; key. I have 3 keys 1. beginning of message 2. continuation of message 3. end of message.  I have to display the data (rea..." />
        <meta name="keywords" content="reassembled,data" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/35998/reassembled-data-in-custom-dissector" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/35998/reassembled-data-in-custom-dissector?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='QK7OhFWsBxowrc29gYoXc3tr7Vix26gb' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/35998/reassembled-data-in-custom-dissector">Reassembled data in custom dissector</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-35998-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/35998/up/" rel="nofollow"> </a>
<div id="post-35998-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-35998-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/35998/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/35998/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   1
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi,</p>
<p>Iam in the process of developing my custom dissector on top of UDP(wireshark).<br>
</p>
<p>I have a packet data spli in many packets and reassembled together when i get "end of message" key. I have 3 keys 1. beginning of message 2. continuation of message 3. end of message. </p>
<p>I have to display the data (reassembled ) in a seperate TAB. (only when i get end of message key i have to do this)</p>
<p>I have gone through the below code and could not understand </p>
<pre><code>              #include &lt;epan/reassemble.h&gt;
                ...
               save_fragmented = pinfo-&gt;fragmented;
            flags = tvb_get_guint8(tvb, offset); offset++;
            if (flags &amp; FL_FRAGMENT) { /* fragmented */
            tvbuff_t* new_tvb = NULL;
           fragment_data *frag_msg = NULL;
              guint16 msg_seqid = tvb_get_ntohs(tvb, offset); offset += 2;
              guint16 msg_num = tvb_get_ntohs(tvb, offset); offset += 2;
              pinfo-&gt;fragmented = TRUE;
               frag_msg = fragment_add_seq_check(tvb, offset, pinfo,
              msg_seqid, /* ID for fragments belonging together */
                  msg_fragment_table, /* list of message fragments */
                 msg_reassembled_table, /* list of reassembled messages */
                 msg_num, /* fragment sequence number */
                tvb_length_remaining(tvb, offset), /* fragment length - to the end */
                flags &amp; FL_FRAG_LAST); /* More fragments? */

                new_tvb = process_reassembled_data(tvb, offset, pinfo,"Reassembled      Message", frag_msg, msg_frag_items,NULL, msg_tree);

       if (frag_msg) { /* Reassembled */
       col_append_str(pinfo-&gt;cinfo, COL_INFO," (Message Reassembled)");
       } else { /* Not last packet of reassembled Short Message */
       col_append_fstr(pinfo-&gt;cinfo, COL_INFO,
        " (Message fragment %u)", msg_num);
                        }
      if (new_tvb) { /* take it all */
        next_tvb = new_tvb;
        } else { /* make a new subset */
        next_tvb = tvb_new_subset(tvb, offset, -1, -1);
          }
        }
              else { /* Not fragmented */
                      next_tvb = tvb_new_subset(tvb, offset, -1, -1);
                        }
                       .....
                      pinfo-&gt;fragmented = save_fragmented;
</code></pre>
<p>Please suggest!
Note: I do not have any seq number for each packet data..</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/reassembled/" class="post-tag tag-link-reassembled"
                                        title="see questions tagged 'reassembled'" rel="tag">reassembled</a>
                                
                                    <a href="/tags/data/" class="post-tag tag-link-data"
                                        title="see questions tagged 'data'" rel="tag">data</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>04 Sep '14, 03:52</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/1339589a92af9455063c09e56bfc6299?s=32&amp;d=identicon&amp;r=g" alt="umar's gravatar image" />
    <p><a href="/users/7392/umar">umar</a><br/>
    <span class="score" title="26 reputation points">26</span><span title="22 badges"><span class="badge1">&#9679;</span><span class="badgecount">22</span></span><span title="24 badges"><span class="silver">&#9679;</span><span class="badgecount">24</span></span><span title="27 badges"><span class="bronze">&#9679;</span><span class="badgecount">27</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="umar has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/35998/">
                edited
                <strong>10 Sep '14, 00:46</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-35998">
    
</div>
<div id="comment-tools-35998" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-35998-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/35998/reassembled-data-in-custom-dissector?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/35998/reassembled-data-in-custom-dissector?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/35998/reassembled-data-in-custom-dissector?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/35998/reassembled-data-in-custom-dissector?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="36148"></a>
                    <div id="answer-container-36148" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-36148-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/36148/up/" rel="nofollow"> </a>
<div id="post-36148-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-36148-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/36148/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Go into epan/reassemble.h and epan/reassemble.c. There you'll find all the details in which you can reassemble fragments in a way suitable for your protocol.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/36148/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>10 Sep '14, 04:12</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" alt="Jaap's gravatar image" />
    <p><a href="/users/4/jaap">Jaap ♦</a><br/>
    <span class="score" title="11680 reputation points"><span class="">11.7k</span></span><span title="16 badges"><span class="silver">&#9679;</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">&#9679;</span><span class="badgecount">101</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jaap has 155 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-36148">
    
        <a name="36388"></a>
        <div class="comment" id="comment-36388">
            <div id="post-36388-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Jaap , Thanks for your reply. my requirement is , i have n number of frames and i have three different data .. 1. beginning of message 2. continuation of message 3, end of message. when beginning of message i have to store the data and continuation of message data alo be included and when it comes to end of data i have to display it in a separate tab (reassembled data and process it). i have gone through reassemble.c and could not understand. can you help me on this. </p>

<p>my packet dissection is byte by byte...</p>

<p>Thanks</p></div>
            <div class="comment-info" id="comment-36388-info">
                
                
                
                

                

                <span class="comment-age">(16 Sep '14, 19:57)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-36148" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-36148-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="36506"></a>
                    <div id="answer-container-36506" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-36506-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/36506/up/" rel="nofollow"> </a>
<div id="post-36506-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-36506-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/36506/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>To reassemble your packets you need some information such as the ID of your fragment, the offset of the current segment in the reassembled packet, if it's the last fragment or not, and more (It depend on your protocol).
All these information are passed to the fragment_add_seq_check() to attempt a reassembly.</p>
<p>You can also see exemple of reassemble interface in the epan/dissectors folder (packet-ipv6.c, packet-6lowpan.c, etc.)</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/36506/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>22 Sep '14, 05:49</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/4ec6105789137df01b9abed5fcb9ab95?s=32&amp;d=identicon&amp;r=g" alt="Afrim's gravatar image" />
    <p><a href="/users/5483/afrim">Afrim</a><br/>
    <span class="score" title="160 reputation points">160</span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="11 badges"><span class="silver">&#9679;</span><span class="badgecount">11</span></span><span title="16 badges"><span class="bronze">&#9679;</span><span class="badgecount">16</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Afrim has 2 accepted answers">22&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-36506">
    
        <a name="37028"></a>
        <div class="comment" id="comment-37028">
            <div id="post-37028-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Afrim ,</p>

<p>do i need to create ID on my own? because i have raw data which does not comes with ID . Can \you help me to explain step by step procedure. (define table, init table add data to reassemble data etc..) I tried to understand the existing code and could not understand.How to display the reassembled data in a separate tab ? below image for reference.</p>

<p>I have 3 diff type of packet pdu  1. beginning of message 2. continuation of message 3, end of message each type contain data in it. for example beginning of message got 20 octets and continuation of message got 10 octets and end of message got 15 octets. I need to reassemble all these 45 octets of data in End of message sequence. Please suggest </p>

<p>Thanks</p>

<p>RAj</p></div>
            <div class="comment-info" id="comment-37028-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 01:58)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37030"></a>
        <div class="comment not_top_scorer" id="comment-37030">
            <div id="post-37030-score" class="comment-score"></div>
            <div class="comment-text"><p><img alt="alt text" src="https://osqa-ask.wireshark.org/upfiles/ws_qs.bmp"></p></div>
            <div class="comment-info" id="comment-37030-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 02:39)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37031"></a>
        <div class="comment" id="comment-37031">
            <div id="post-37031-score" class="comment-score">1</div>
            <div class="comment-text"><p>The ID is needed cause when you receive your packets in Wireshark they are not sorted by fragmentation order.
For exemple you will not receive :<br>
Packet 1 : fragmentation, beginning of message<br>
Packet 2 : fragmentation, continuation of message<br>
Packet 3 : fragmentation, end of message<br>
</p>

<p>But it will be something like :<br>
Packet 1 : fragmentation, beginning of message<br>
Packet 2 : fragmentation, continuation of message<br>
Packet 3 : fragmentation, beginning of message<br>
Packet 4 : fragmentation, beginning of message<br>
Packet 5 : fragmentation, continuation of message<br>
Packet 6 : fragmentation, end of message<br>
etc...<br>
In this case you dont know if packet 6 is end of message of packet 5 or packet 2. Neither you know if packet 5 is continuation of packet 4 or 3. That's why we use IDs. But it realy depend on your protocol, if your protocol does not allow multiple "beginning of message" you can set ID to any value.</p>

<p>Then all what you need is to tell if there is more fragments(you have this information) to wait for this ID, if no the ressembly will occur. Ofc you have to tell the length of the fragment as the code of your first post says.</p></div>
            <div class="comment-info" id="comment-37031-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 03:04)</span>
                <a class="comment-user userinfo" href="/users/5483/afrim">Afrim</a>
                
            </div>
        </div>
    
        <a name="37032"></a>
        <div class="comment not_top_scorer" id="comment-37032">
            <div id="post-37032-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Afrim,</p>

<p>Thanks for the reply . Got it, Thanks. for my protocol only one beginning of message and may be multiple continuation of message and 1 end of message.  Now i have gone through many protocols to understand how to add the data into reassemble table. As iam new to this , could you help me to guide step by step procedure to add data to table and display in a separate tab like in the image. when it comes to end of message!</p>

<pre><code>         Packet 1 : fragmentation,                         beginning of message

         Packet 23 : fragmentation, continuation of message
         Packet 44 : fragmentation, continuation of message
         Packet 57 : fragmentation, continuation of message
         Packet 69 : fragmentation,                           end of message
</code></pre></div>
            <div class="comment-info" id="comment-37032-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 03:11)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37037"></a>
        <div class="comment" id="comment-37037">
            <div id="post-37037-score" class="comment-score">1</div>
            <div class="comment-text"><p><a href="/users/7392/mrajsekar">@mrajsekar</a></p>

<p>Unfortunately all the protocols that do reassembly in this way are somewhat complicated, if you search for all files in epan\dissectors that include <code>fragment_add_seq_next</code>, you will see all the current dissectors that use the method  you need.  Try looking at those, but be aware they are all likely to have a lot of "extras" that you'll have to work through.</p>

<p>You'll need to understand "conversations" (README.dissector sect 2.2) and reassembly (in epan\reassemble.h) to complete your dissector.</p>

<p>I think you need to use <code>fragment_add_seq_next</code> as you don't have a fragment id, so must assume all fragments come in order, first to last.</p></div>
            <div class="comment-info" id="comment-37037-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 05:27)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="37046"></a>
        <div class="comment not_top_scorer" id="comment-37046">
            <div id="post-37046-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks Grahamb!I will try this.</p></div>
            <div class="comment-info" id="comment-37046-info">
                
                
                
                

                

                <span class="comment-age">(14 Oct '14, 18:49)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37326"></a>
        <div class="comment not_top_scorer" id="comment-37326">
            <div id="post-37326-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi, 
What is the difference between conversation and reassembly and fragmentation??? </p>

<p>for me iam developing dissector to ruunnning on top of UDP port XXXX and my PDU data comes in many packets.. </p>

<p>Not from other destination port.. </p>

<p>Can you please Clarify?</p>

<p>for me i have beginning of message in that i have a data length field :  ex. 24 bytes  in that beginning of message contains 15 Bytes pdu data </p>

<p>continuation of message contains 5 bytes and another continuaton of message contains 2 bytes and then End of Message contains 2 bytes. </p>

<p>How can i achieve this reassembly . using conversation or using reassembly?? </p>

<p>i have gone through RTP and some other files but i get confuse with it. please help me on this</p>

<p>Thanks</p></div>
            <div class="comment-info" id="comment-37326-info">
                
                
                
                

                

                <span class="comment-age">(24 Oct '14, 01:17)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37328"></a>
        <div class="comment" id="comment-37328">
            <div id="post-37328-score" class="comment-score">1</div>
            <div class="comment-text"><p>Fragmentation (and subsequent reassembly) occurs when an application pdu can be split across multiple transport layer segments, e.g. your pdu arrives split over multiple tcp segments.  The application dissector can tell the tcp dissector how much data it needs (read from the application pdu header) and the tcp dissector then reassembles incoming data until it has enough to hand back to the application dissector.  Wireshark has built-in support for tcp reassembly, for other transport protocols the application dissector will have to manage reassembly itself.</p>

<p>Conversation is where the application dissector may be interested in multiple application pdu's, e.g request\response.</p></div>
            <div class="comment-info" id="comment-37328-info">
                
                
                
                

                

                <span class="comment-age">(24 Oct '14, 02:01)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="37331"></a>
        <div class="comment not_top_scorer" id="comment-37331">
            <div id="post-37331-score" class="comment-score"></div>
            <div class="comment-text"><p>Should i add id to each byte of the data ? please help me on this i really could not understand this. i got stuck in this for long time. i have completed 95% of the dissector and once i did this i can complete my work.</p></div>
            <div class="comment-info" id="comment-37331-info">
                
                
                
                

                

                <span class="comment-age">(24 Oct '14, 02:42)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37368"></a>
        <div class="comment not_top_scorer" id="comment-37368">
            <div id="post-37368-score" class="comment-score"></div>
            <div class="comment-text"><p>Is this code will satisfy my requirement?      <br>
</p>

<pre><code>      dissect_proto(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree) {
        while [bytes remain in tvb from offset]
            if [pdu length is unknown]
        found = fragment_get(pinfo, 0, fragment_table);
        if [fragment was found]
            [loop through found-&gt;next and add total_length and data]
            buffer = tvb_new_real_data(data, total_length, total_length);
        else
            buffer = tvb_new_subset(tvb, offset, ...);

        bytes_available = tvb_length(buffer);
        pdu_length = get_pdu_length(buffer, &amp;pdu_offset);
        if [pdu length is known and is smaller than bytes remaining]
            complete = TRUE;
        /* bytes_to_consume is min(pdu_length, bytes_available) */
        pinfo-&gt;fragmented = !complete;
        head = fragment_add(tvb, offset, pinfo, 0, fragment_table,
                offset, bytes_to_consume, !complete);
        next_tvb = process_reassembled_data(tvb, offset,                             pinfo, "Reassembled packet", head, &amp;proto_frag_items, NULL, tree);
        offset += bytes_to_consume;
</code></pre></div>
            <div class="comment-info" id="comment-37368-info">
                
                
                
                

                

                <span class="comment-age">(26 Oct '14, 23:34)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37371"></a>
        <div class="comment" id="comment-37371">
            <div id="post-37371-score" class="comment-score">1</div>
            <div class="comment-text"><p>I don't really understand the purpose of your while loop and I think in your case you  dont need conversation interface.So, as Grahamb said, assuming your data comes in order you dont need an ID, then use fragment_add_seq_next().<br>
</p>

<p>Here is the prototype of this function </p>

<pre>fragment_head <em>
fragment_add_seq_next(reassembly_table </em>table, tvbuff_t <em>tvb, const int offset,
              const packet_info </em>pinfo, const guint32 id,
              const void *data, const guint32 frag_data_len,
              const gboolean more_frags);</pre>

<p></p>

<p>So you got the reassembly table, tvb buffer, the current offset, pinfo structure, as you dont need ID I would have set it to 0 (or any other value), set data* to NULL, frag_data_len is the length of your fragment and more_frag is a flag to tell if there is more fragment to wait. You got all these information so just fill in.</p></div>
            <div class="comment-info" id="comment-37371-info">
                
                
                
                

                

                <span class="comment-age">(27 Oct '14, 04:25)</span>
                <a class="comment-user userinfo" href="/users/5483/afrim">Afrim</a>
                
            </div>
        </div>
    
        <a name="37424"></a>
        <div class="comment not_top_scorer" id="comment-37424">
            <div id="post-37424-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Afrim,</p>

<p>Thank you so much! This will be really helpful. I will Try this!</p>

<p>Thanks Grahamb!</p></div>
            <div class="comment-info" id="comment-37424-info">
                
                
                
                

                

                <span class="comment-age">(28 Oct '14, 20:33)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37453"></a>
        <div class="comment not_top_scorer" id="comment-37453">
            <div id="post-37453-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Afrim grahamb,</p>

<p>Need your help. </p>

<pre><code>             process_reassembled_data( next_tvb, offset_payload, pinfo, "Reassembled PDU", bgan_frag_msg,&amp;ALSIGPDU, NULL, FT_BCnPDU_tree );
</code></pre>

<p>In this parameter 6 i need to pass a function ALSIG PDU How it is possible?</p>

<p>Those tvb i have reassemblesd had to be proceessed in ALSIG PDU function. Please suggest some idea,</p></div>
            <div class="comment-info" id="comment-37453-info">
                
                
                
                

                

                <span class="comment-age">(29 Oct '14, 23:10)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37455"></a>
        <div class="comment not_top_scorer" id="comment-37455">
            <div id="post-37455-score" class="comment-score"></div>
            <div class="comment-text"><p>save_fragmented = pinfo-&gt;fragmented;</p>

<pre><code>                                        pinfo-&gt;fragmented = TRUE;

                                my_frag_msg = fragment_add_seq_check(&amp;my_reassembly_table,tvb, offset, pinfo, my_seqid, NULL,0, reassebled_data_total_length, more_frags);

                                    my_tvb = process_reassembled_data( tvb, offset, pinfo, "Reassembled PDU", my_frag_msg,&amp;my_frag_items, NULL, FT_PDU_tree );

SIGPDU(my_tvb, pinfo, tree);
</code></pre>

<p>What is wrong my reassembly not happening?</p></div>
            <div class="comment-info" id="comment-37455-info">
                
                
                
                

                

                <span class="comment-age">(30 Oct '14, 01:15)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37456"></a>
        <div class="comment not_top_scorer" id="comment-37456">
            <div id="post-37456-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi,</p>

<p>I have </p>

<p>beginning of the message  (in this pdu i have info about total msg length) 
continuation of the message 
end of message </p>

<p>I have set a global variable to take the total length and substract it from pdu length of beginning of msg and continuation of message when it comes to end of message  i have added the pdu data to the reassembled table and then used process_reassembled_data to process.
But its not happening</p>

<p>beginning of message and continuation of message shows correct for me. I dont know whether reassembled table got data added or not. please suggest!</p>

<p>I have used </p>

<pre><code>           fragment_add_seq_next(&amp;bgan_reassembly_table,next_tvb, offset_payload, pinfo, bgan_seqid, NULL,reassebled_data_total_length, more_frags);
</code></pre></div>
            <div class="comment-info" id="comment-37456-info">
                
                
                
                

                

                <span class="comment-age">(30 Oct '14, 02:09)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37482"></a>
        <div class="comment not_top_scorer" id="comment-37482">
            <div id="post-37482-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi,</p>

<p>My comple re assembly code is below</p>

<p>Please suggest what i have missed or issue </p>

<pre><code>        static reassembly_table mine_reassembly_table;

        static int hf_mine_fragments = -1;
        static int hf_mine_fragment = -1;
        static int hf_mine_fragment_overlap = -1;
        static int hf_mine_fragment_overlap_conflicts = -1;
        static int hf_mine_fragment_multiple_tails = -1;
        static int hf_mine_fragment_too_long_fragment = -1;
        static int hf_mine_fragment_error = -1;
        static int hf_mine_fragment_count = -1;
        static int hf_mine_reassembled_in = -1;
        static int hf_mine_reassembled_length = -1;

        static gint ett_mine_fragment = -1;
        static gint ett_mine_fragments = -1;

        static const fragment_items mine_frag_items = {
        /* Fragment subtrees */
        &amp;ett_mine_fragment,
        &amp;ett_mine_fragments,
        /* Fragment fields */
        &amp;hf_mine_fragments,
        &amp;hf_mine_fragment,
        &amp;hf_mine_fragment_overlap,
        &amp;hf_mine_fragment_overlap_conflicts,
        &amp;hf_mine_fragment_multiple_tails,
        &amp;hf_mine_fragment_too_long_fragment,
        &amp;hf_mine_fragment_error,
        &amp;hf_mine_fragment_count,
        /* Reassembled in field */
        &amp;hf_mine_reassembled_in,
        /* Reassembled length field */
        &amp;hf_mine_reassembled_length,
        /* Reassembled data field */
        NULL,
        /* Tag */
        "mine fragments"
        };

        static void mine_init_protocol(void)
            {

                /* fragment_table_init(&amp;mine_fragment_table); */
                /* reassembled_table_init(&amp;mine_reassembled_table); */
                reassembly_table_init(&amp;mine_reassembly_table, &amp;addresses_reassembly_table_functions);
            }

        save_fragmented = pinfo-&gt;fragmented;

        pinfo-&gt;fragmented = TRUE;

        mine_frag_msg = fragment_add_seq_next(&amp;mine_reassembly_table,next_tvb, offset_payload, pinfo, mine_seqid, NULL,
                                                     reassebled_data_total_length, more_frags);

        mine_tvb = process_reassembled_data( next_tvb, offset_payload, pinfo, "Reassembled PDU", mine_frag_msg,
            &amp;mine_frag_items, NULL, FT_BCnPDU_tree );

        reassebled_data_total_length =0;

        proto_tree_add_text(FT_BCnPDU_tree, mine_tvb, offset_payload, 1, " reassebled data ");

        ALSIGPDU(mine_tvb, pinfo, tree);
</code></pre></div>
            <div class="comment-info" id="comment-37482-info">
                
                
                
                

                

                <span class="comment-age">(30 Oct '14, 19:26)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="37483"></a>
        <div class="comment not_top_scorer" id="comment-37483">
            <div id="post-37483-score" class="comment-score"></div>
            <div class="comment-text"><p>Also How to calculate the length of the reassembled table? because i have set a variable reassebled_data_total_length and get the total length. Then when beginning continuation of msg pdu data i hv substract the pdu data length from the total length. Here when i open wireshark and open the capture file, if i go directly to the end of message pdu reassebled_data_total_length  it shows as zero. but if i open beginning of msg and then open end of msg pdu it shows corrrect. please help</p></div>
            <div class="comment-info" id="comment-37483-info">
                
                
                
                

                

                <span class="comment-age">(30 Oct '14, 19:48)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
        <a name="39905"></a>
        <div class="comment not_top_scorer" id="comment-39905">
            <div id="post-39905-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Afrim and Grahamb,</p>

<p>Sorry . My message comes with sequence Number . based on the seq num i need to reassemble. </p>

<p>i have used fragment_add_seq_check 
but my fragment table itself always returning NULL. </p>

<p>Can i hae your mail id so that i can share my code. i think you can solve that in minute, please help</p>

<p>My latest question posted here </p>

<p><a href="https://ask.wireshark.org/questions/39824/fragmentation-error-status-access-violation">https://ask.wireshark.org/questions/39824/fragmentation-error-status-access-violation</a></p>

<p><a href="https://ask.wireshark.org/questions/39885/pdcp-layer-pdu-rfc-2507-arq-mechanism">https://ask.wireshark.org/questions/39885/pdcp-layer-pdu-rfc-2507-arq-mechanism</a></p></div>
            <div class="comment-info" id="comment-39905-info">
                
                
                
                

                

                <span class="comment-age">(17 Feb '15, 00:47)</span>
                <a class="comment-user userinfo" href="/users/7392/umar">umar</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-36506" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 18
        </span>
        <a href="#" class="show-all-comments-link">show 13 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-36506-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/35998/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='QK7OhFWsBxowrc29gYoXc3tr7Vix26gb' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/35998/reassembled-data-in-custom-dissector?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/35998/reassembled-data-in-custom-dissector?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/data/"
            class="tag-link-data"
            title="see questions tagged'data'using tags"
            rel="tag">data</a> <span class="tag-number">&#215;122</span><br/>
        
        <a href="/tags/reassembled/"
            class="tag-link-reassembled"
            title="see questions tagged'reassembled'using tags"
            rel="tag">reassembled</a> <span class="tag-number">&#215;11</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Sept. 4, 2014, 3:52 a.m.">04 Sep '14, 03:52</strong>
    </p>
    <p> 
     	question was seen: <strong>3,905 times</strong>
    </p>
    <p> 
        last updated: <strong title="Feb. 17, 2015, 12:49 a.m.">17 Feb '15, 00:49</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/672/does-wireshark-work-on-plc-network">Does Wireshark Work on PLC Network?</a>
        </p>
        
        <p>
            <a href="/questions/8357/protocol-hierarchy-meaning">Protocol Hierarchy Meaning</a>
        </p>
        
        <p>
            <a href="/questions/14078/decapsulation-of-data">Decapsulation of data</a>
        </p>
        
        <p>
            <a href="/questions/20480/wireshark-with-impinj-readers">Wireshark with Impinj readers</a>
        </p>
        
        <p>
            <a href="/questions/30957/tcp-data-size-sizeip-packet-sizeip-header-sizetcp-header">TCP data size &lt; size(IP Packet) - size(IP Header) - size(TCP Header) ???</a>
        </p>
        
        <p>
            <a href="/questions/38582/unreadable-data-in-follow-tcp-stream">Unreadable data in &quot;Follow TCP stream&quot;</a>
        </p>
        
        <p>
            <a href="/questions/51101/mpls-te-shown-as-raw-data">[closed] MPLS TE shown as raw data</a>
        </p>
        
        <p>
            <a href="/questions/59983/extract-syslog-payload-in-ascii">Extract syslog payload in ASCII</a>
        </p>
        
        <p>
            <a href="/questions/40935/get-reassembled-information-with-command-line-tools">Get reassembled information with command line tools</a>
        </p>
        
        <p>
            <a href="/questions/1146/can-i-take-specific-log-in-data-field-46-1500">Can I take specific log in data field (46-1500)?</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
