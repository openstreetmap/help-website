<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>TCP previous segment not captured, why? - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, I have a software who dumps data from a remote controller. The dump is made though a tcp connection that is not stable; my software is telling me &quot;communication stopped&quot; after 5-6 seconds  I run Wireshark to understand what was going on, but I&#39;m not able to spot the reason behind this. All I see..." />
        <meta name="keywords" content="prev_seg_lost,tcp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/12943/tcp-previous-segment-not-captured-why" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/12943/tcp-previous-segment-not-captured-why?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='yquMzzOPY1hsymfVdXvigEicom6kW6zR' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/12943/tcp-previous-segment-not-captured-why">TCP previous segment not captured, why?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-12943-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12943/up/" rel="nofollow"> </a>
<div id="post-12943-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-12943-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12943/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/12943/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi,
I have a software who dumps data from a remote controller. The dump is made though a tcp connection that is not stable; my software is telling me "communication stopped" after 5-6 seconds </p>
<p>I run Wireshark to understand what was going on, but I'm not able to spot the reason behind this. All I see in the pcap trace is that when the connection ends, I have a general error "tcp previous segment not captured".</p>
<p>my software runs in a hyperV machine. for tests I tried to install the software on my computer and the connection never stops.</p>
<p>I uploaded the trace here <a href="http://www.cloudshark.org/captures/c256982bb42d">http://www.cloudshark.org/captures/c256982bb42d</a></p>
<p>Can anyone help?</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/prev_seg_lost/" class="post-tag tag-link-prev_seg_lost"
                                        title="see questions tagged 'prev_seg_lost'" rel="tag">prev_seg_lost</a>
                                
                                    <a href="/tags/tcp/" class="post-tag tag-link-tcp"
                                        title="see questions tagged 'tcp'" rel="tag">tcp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>24 Jul '12, 02:24</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/0b0e2876fa46e2f356fad310b51b6d8e?s=32&amp;d=identicon&amp;r=g" alt="GlobalS's gravatar image" />
    <p><a href="/users/3126/globals">GlobalS</a><br/>
    <span class="score" title="0 reputation points">0</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="GlobalS has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-12943">
    
</div>
<div id="comment-tools-12943" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12943-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/12943/tcp-previous-segment-not-captured-why?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/12943/tcp-previous-segment-not-captured-why?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/12943/tcp-previous-segment-not-captured-why?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/12943/tcp-previous-segment-not-captured-why?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="12945"></a>
                    <div id="answer-container-12945" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-12945-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12945/up/" rel="nofollow"> </a>
<div id="post-12945-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-12945-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12945/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The server 82.117.201.86 is not following the TCP RFC. In closing the session the FIN should come from the next expected sequence number and when the FIN gets ACKed, it should send an ACK that acknowledges one phantom byte. However, the server is sending the FIN with a sequence number that already incorporates the phantom byte. This is not correct and the client correctly sends a duplicate ACK asking for a packet with the correct sequence number.</p>
<p>So either, there is indeed one byte of data being sent and the packet got lost. Or the TCP stack of the server has a bug in it.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/12945/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>24 Jul '12, 03:22</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-12945">
    
</div>
<div id="comment-tools-12945" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12945-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="12946"></a>
                    <div id="answer-container-12946" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-12946-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12946/up/" rel="nofollow"> </a>
<div id="post-12946-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-12946-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12946/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>"tcp previous segment not captured" is an expert message created by Wireshark when it didn't see a packet that should have been in the trace; this warning was previously called "tcp previous segment lost". It basically means that either the packet really wasn't seen on the wire (which would be a packet loss) or Wireshark wasn't capturing "fast enough" to record the packet even though it <strong>had been</strong> on the wire.</p>
<p>I looked at your trace file and it looks like the device with the IP 82.117.201.86 behaves a little strange - is this some embedded device with a rudimentary stack implementation? It sends packet 136 with a sequence number that is one byte too high to be valid, so that the FIN-ACK-FIN-ACK sequence doesn't work as it should. I think the TCP stack of the node with the IP 82.117.201.86 is doing the session shutdown wrong, but I may be mistaken. I doubt that there really is a missing packet - my guess is that it is just a bad sequence number calculation that is giving you trouble.</p>
<p>Anyway, this protocol looks pretty problematic when run over high latency links. It is constantly exchanging small packets with push flags, which leads to quickly adding up the round trip times since it is basically a serialized communication. 137 packets in 13 seconds isn't going to win any throughput championships - but then again maximizing throughput is probably not an issue for this communication I guess.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/12946/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>24 Jul '12, 03:28</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
    <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
    <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jasper has 263 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-12946">
    
        <a name="12947"></a>
        <div class="comment" id="comment-12947">
            <div id="post-12947-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks you for your answers!
The server at 81.117.201.86 is an access control controller (the device that open the door automatically with a smart card, just to understand) and it records the entrance and exits. 
On 10.8.0.24 we have the software that collect the data and let us see who's going in and out.</p>

<p>Unfortunately I cannot change any setting on the controller; So as I understood correctly the only possibility here is to move the receiving server closer to the controller?</p>

<p>[converted to a comment to keep the Q&amp;A nature going]</p></div>
            <div class="comment-info" id="comment-12947-info">
                
                
                
                

                

                <span class="comment-age">(24 Jul '12, 03:49)</span>
                <a class="comment-user userinfo" href="/users/3126/globals">GlobalS</a>
                
            </div>
        </div>
    
        <a name="12949"></a>
        <div class="comment" id="comment-12949">
            <div id="post-12949-score" class="comment-score"></div>
            <div class="comment-text"><p>No, moving receiving server and controller closer to each other will probably not help. Your problem is that the access control controller most likely runs a faulty TCP stack implementation, which means you need the vendor of that device to update it.</p></div>
            <div class="comment-info" id="comment-12949-info">
                
                
                
                

                

                <span class="comment-age">(24 Jul '12, 03:57)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="13327"></a>
        <div class="comment" id="comment-13327">
            <div id="post-13327-score" class="comment-score"></div>
            <div class="comment-text"><p>Hello, just for information, we upgraded the firmware on the router and everything works fine now. 
Unfortunately the router is a black box and I can't tell what setting changed. That is why we are switching to a better one :)</p></div>
            <div class="comment-info" id="comment-13327-info">
                
                
                
                

                

                <span class="comment-age">(02 Aug '12, 14:23)</span>
                <a class="comment-user userinfo" href="/users/3126/globals">GlobalS</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-12946" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12946-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="12948"></a>
                    <div id="answer-container-12948" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-12948-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12948/up/" rel="nofollow"> </a>
<div id="post-12948-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-12948-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12948/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>I second what <a href="/users/5/syn-bit"><a href="/users/5/syn-bit">@SYN-bit</a></a> and <a href="/users/145/jasper"><a href="/users/145/jasper">@Jasper</a></a> said about the FIN behaviour of the server.</p>
<p>But you say:</p>
<blockquote>
<p>my software is telling me "communication stopped" after 5-6 seconds </p>
</blockquote>
<p>This does not match the capture file. The client actively closes the connection after ~ 12 seconds (Frame: 134). So, why does your software say "communication stopped" after 5-6 seconds? Maybe there is a another problem with the application.</p>
<p>You say: </p>
<blockquote>
<p>for tests I tried to install the software on my computer and the connection never stops.</p>
</blockquote>
<p>Does that mean, you have constant data flow for more than a few seconds in that case? If so, then the problem is not a network problem, as the client actively closed the connection in your capture sample. </p>
<p>Regards<br>
Kurt </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/12948/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>24 Jul '12, 03:54</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/12948/">
                edited
                <strong>03 Aug '12, 02:37</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
            <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
            <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span></p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-12948">
    
        <a name="12952"></a>
        <div class="comment" id="comment-12952">
            <div id="post-12952-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for the asnwer. </p>

<p>The capture file is recording only one stop. I didn't start the communication for this pcap because the output is always the same. The communication always ends when wireshark tells me "segment lost".</p>

<p>Yes, if I move the server locally (2 ms latency) the data flow is constant. This afternoon I'm planning to move the server on vmware rather than hyperV to see if it helps</p></div>
            <div class="comment-info" id="comment-12952-info">
                
                
                
                

                

                <span class="comment-age">(24 Jul '12, 04:38)</span>
                <a class="comment-user userinfo" href="/users/3126/globals">GlobalS</a>
                
            </div>
        </div>
    
        <a name="12953"></a>
        <div class="comment" id="comment-12953">
            <div id="post-12953-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Yes, if I move the server locally (2 ms latency) the data flow is constant.</p>
</blockquote>

<p>Without the client closing the connection (FIN)?</p>

<p>If so, it's a problem within the application (maybe latency, as Jasper mentioned) and not the network, because in your sample capture the client closes the connection actively. The sole purpose of that is to end the communication, so there should'nt be any error message ("communication stopped") if the client voluntarily ends the communication. </p>

<p>But that's just speculation. With the information provided so far, it's hard to come to a conclusion. There are two questions open:</p>

<ol>
<li>Why does the client close the TCP connection in one case and why not in the other case (2ms latency)?</li>
<li>Does the client report the error message ("communication stopped") as a result of the FIN behaviour of the server, or is that just something that happens anyway, after the client application decided to close the connection. In that case the FIN behaviour (as bad as it is) would be unrelated to your problem.</li>
</ol></div>
            <div class="comment-info" id="comment-12953-info">
                
                
                
                

                

                <span class="comment-age">(24 Jul '12, 04:47)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="13328"></a>
        <div class="comment" id="comment-13328">
            <div id="post-13328-score" class="comment-score"></div>
            <div class="comment-text"><p>Hello, just for information, we upgraded the firmware on the router and everything works fine. 
Unfortunately the router is a black box and I can't tell what setting changed. That is why we are switching to a better one :)</p></div>
            <div class="comment-info" id="comment-13328-info">
                
                
                
                

                

                <span class="comment-age">(02 Aug '12, 14:23)</span>
                <a class="comment-user userinfo" href="/users/3126/globals">GlobalS</a>
                
            </div>
        </div>
    
        <a name="13338"></a>
        <div class="comment" id="comment-13338">
            <div id="post-13338-score" class="comment-score"></div>
            <div class="comment-text"><p>O.K. now I'm curious :-). Did you upgrade the "internet router" between 10.8.0.24 (client) and 81.117.201.86 (server)? If so, that would be kind of "interesting". As I mentioned, the client closes the connection actively and only then we see the bad FIN behaviour of the server (or maybe the router, interfering in the connection?). If the client stopped closing the connetion after the firmware upgrade (you mentioned that also for the case where the server was placed on the LAN), that would be kind of "strange" :-)</p></div>
            <div class="comment-info" id="comment-13338-info">
                
                
                
                

                

                <span class="comment-age">(03 Aug '12, 01:10)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-12948" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12948-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/12943/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='yquMzzOPY1hsymfVdXvigEicom6kW6zR' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12943/tcp-previous-segment-not-captured-why?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12943/tcp-previous-segment-not-captured-why?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tcp/"
            class="tag-link-tcp"
            title="see questions tagged'tcp'using tags"
            rel="tag">tcp</a> <span class="tag-number">&#215;752</span><br/>
        
        <a href="/tags/prev_seg_lost/"
            class="tag-link-prev_seg_lost"
            title="see questions tagged'prev_seg_lost'using tags"
            rel="tag">prev_seg_lost</a> <span class="tag-number">&#215;7</span><br/>
        
    </p>
    <p>
        question asked: <strong title="July 24, 2012, 2:24 a.m.">24 Jul '12, 02:24</strong>
    </p>
    <p> 
     	question was seen: <strong>112,935 times</strong>
    </p>
    <p> 
        last updated: <strong title="Aug. 3, 2012, 2:37 a.m.">03 Aug '12, 02:37</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/25593/tcp-previous-segment-not-captured-is-that-a-connectivity-issue">TCP:  Previous segment not captured, Is that a connectivity issue?</a>
        </p>
        
        <p>
            <a href="/questions/13741/how-do-we-start-analyzing-tcp-traffic">How do we start analyzing TCP Traffic.</a>
        </p>
        
        <p>
            <a href="/questions/14082/weird-behavior-when-connecting-to-googlecom-tcp-previous-segment-not-captured">Weird behavior when connecting to google.com (TCP previous segment not captured)</a>
        </p>
        
        <p>
            <a href="/questions/230/displaying-all-tcp-connections-with-syn-packets">Displaying all TCP connections with SYN packets</a>
        </p>
        
        <p>
            <a href="/questions/1698/tcp-out-of-order-what-does-it-means">&quot;TCP out of order &quot; what does it means ?!!!</a>
        </p>
        
        <p>
            <a href="/questions/3235/adding-custom-tcp-options">Adding custom TCP options</a>
        </p>
        
        <p>
            <a href="/questions/4932/not-honoring-own-mss">Not honoring own MSS?</a>
        </p>
        
        <p>
            <a href="/questions/7043/is-there-any-way-to-find-the-tcp-stream-number-based-on-packet-number">Is there any way to find the tcp stream number based on packet number?</a>
        </p>
        
        <p>
            <a href="/questions/7972/acked-lost-segments-false-positive">ACKed lost segments - false positive?</a>
        </p>
        
        <p>
            <a href="/questions/9281/lua-dissector-failing-occasionally-returns-nil-values-instead-of-tcp-endpoints-for-valid-packets">Lua dissector failing: occasionally returns nil values instead of TCP endpoints for valid packets</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
