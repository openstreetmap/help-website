<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>How do I have my dissector handle a protocol running on top of UDP? - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi all, I&#39;m using tshark for some specific dissectors. I have to modify the function dissect_data(...) in packet-data.c. In my scenario, most of the packet must go through this function. My objective is: at the end of this function, I want to clear all data of this packet before going to the next in..." />
        <meta name="keywords" content="udp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='rRMHYmTNUVoQVe2cExs9WpZ480nH4JrG' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp">How do I have my dissector handle a protocol running on top of UDP?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-38703-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38703/up/" rel="nofollow"> </a>
<div id="post-38703-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-38703-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38703/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/38703/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi all, I'm using tshark for some specific dissectors. I have to modify the function <strong>dissect_data(...)</strong> in packet-data.c. In my scenario, most of the packet must go through this function. My objective is: at the end of this function, I want to clear all data of this packet before going to the next in order to free memory. So, my question is:</p>
<ul>
<li>Is it possible to clear all data at the end of this function (<strong>dissect_data</strong>)? if YES, how can I do this?</li>
<li>Can I free the tree by <strong>proto_tree_free(proto_tree *tree)</strong> after processing each packet?</li>
<li>Is it possible to use some functions like: <strong>epan_cleanup</strong>();<strong>packet_cleanup</strong>();<strong>cleanup_dissection</strong>();</li>
</ul>
<p>Here is the function dissect_data(...)</p>
<pre><code>static void
dissect_data(tvbuff_t *tvb, packet_info *pinfo _U_ , proto_tree *tree)
{
    gint bytes;

        bytes = tvb_length_remaining(tvb, 0);
        if (bytes &gt; 0) {
            tvbuff_t   *data_tvb;
            proto_item *ti;
            proto_tree *data_tree;

            // This is my modification. The output tvb is the same, nothing change.
            tvb = decode_sonnh(tvb,pinfo,tree);

            if (new_pane) {
                guint8 *real_data = (guint8 *)tvb_memdup(tvb, 0, bytes);
                data_tvb = tvb_new_child_real_data(tvb,real_data,bytes,bytes);
                tvb_set_free_cb(data_tvb, g_free);
                add_new_data_source(pinfo, data_tvb, "Not dissected data bytes");
            } else {
                data_tvb = tvb;
            }
            ti = proto_tree_add_protocol_format(tree, proto_data, tvb,
                0,
                bytes, "Data (%d byte%s)", bytes,
                plurality(bytes, "", "s"));
            data_tree = proto_item_add_subtree(ti, ett_data);

            proto_tree_add_item(data_tree, hf_data_data, data_tvb, 0, bytes, ENC_NA);

            if (show_as_text) {
                proto_tree_add_item(data_tree, hf_data_text, data_tvb, 0, bytes, ENC_ASCII|ENC_NA);
            }

            if(generate_md5_hash) {
                const guint8 *cp;
                md5_state_t   md_ctx;
                md5_byte_t    digest[16];
                const gchar  *digest_string;

                cp = tvb_get_ptr(tvb, 0, bytes);

                md5_init(&amp;md_ctx);
                md5_append(&amp;md_ctx, cp, bytes);
                md5_finish(&amp;md_ctx, digest);

                digest_string = bytestring_to_str(digest, 16, '\0');
                ti = proto_tree_add_string(data_tree, hf_data_md5_hash, tvb, 0, 0, digest_string);
                PROTO_ITEM_SET_GENERATED(ti);
            }

            ti = proto_tree_add_int(data_tree, hf_data_len, data_tvb, 0, 0, bytes);
            PROTO_ITEM_SET_GENERATED (ti);
        }

}
</code></pre>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/udp/" class="post-tag tag-link-udp"
                                        title="see questions tagged 'udp'" rel="tag">udp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>24 Dec '14, 20:30</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/824a7342f59ff90e6040505b38626416?s=32&amp;d=identicon&amp;r=g" alt="hoangsonk49's gravatar image" />
    <p><a href="/users/5593/hoangsonk49">hoangsonk49</a><br/>
    <span class="score" title="81 reputation points">81</span><span title="28 badges"><span class="badge1">&#9679;</span><span class="badgecount">28</span></span><span title="29 badges"><span class="silver">&#9679;</span><span class="badgecount">29</span></span><span title="33 badges"><span class="bronze">&#9679;</span><span class="badgecount">33</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="hoangsonk49 has 2 accepted answers">28&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/38703/">
                edited
                <strong>27 Dec '14, 15:38</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" alt="Guy%20Harris's gravatar image" />
            <p><a href="/users/79/guy-harris">Guy Harris ♦♦</a><br/>
            <span class="score" title="17443 reputation points"><span class="">17.4k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">&#9679;</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">&#9679;</span><span class="badgecount">196</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-38703">
    
        <a name="38720"></a>
        <div class="comment" id="comment-38720">
            <div id="post-38720-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>I have to modify the function dissect_data(...) in packet-data.c. In my scenario, most of the packet must go through this function. </p>
</blockquote>

<p>Why must it go through that function?  <code>dissect_data()</code> is what's used when the data being dissected is of an unknown protocol or is raw data (such as that transported by "read" and "write" requests in remote file system protocols such as SMB, NFS, or AFP).  If you're trying to dissect the data, it's <em>not</em> of an unknown protocol, it's of whatever protocol you're trying to dissect - hacking <code>dissect_data()</code> to call another dissector is <em>always</em> the wrong answer, you should be hacking whatever's calling <code>dissect_data()</code> so that it calls your dissector instead.</p></div>
            <div class="comment-info" id="comment-38720-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 17:00)</span>
                <a class="comment-user userinfo" href="/users/79/guy-harris">Guy Harris ♦♦</a>
                
            </div>
        </div>
    
        <a name="38723"></a>
        <div class="comment" id="comment-38723">
            <div id="post-38723-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Harris, the data stream I received from the network is unknown protocol. After my decode function, it becomes the data of sccp. I know It should be better to create a new dissector to decode so that it can be recognized as sccp data and should not go through dissect_data(...) function as described in the method [1]: </p>

<ul>
<li>[1] Expected: data stream -&gt; my dissector to decode -&gt; sccp -&gt; ...</li>
<li>[2] In fact:  data stream -&gt; [unknown protocol] packet-data -&gt; my dissector to decode -&gt; sccp -&gt; ...</li>
</ul>

<p>But I choose [2] because I don't know how to get the data stream before it goes to dissect_data(...) in the source code. So, I have to use the data in dissect_data(...) of packet-data.c as as described in the method [2].</p></div>
            <div class="comment-info" id="comment-38723-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 17:39)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="38724"></a>
        <div class="comment" id="comment-38724">
            <div id="post-38724-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Hi Harris, the data stream I received from the network is unknown protocol. After my decode function, it becomes the data of sccp.</p>
</blockquote>

<p>The data stream you receive from the network is for <em>some</em> known protocol, otherwise you wouldn't have a decode function to apply to it!</p>

<blockquote>
<p>But I choose [2] because I don't know how to get the data stream before it goes to dissect_data(...) in the source code.</p>
</blockquote>

<p>In what protocol is your data stream encapsulated?  TCP?  IP?  Ethernet?  If you read a capture file into Wireshark <em>without</em> your decode function, presumably, in the "packet details" pane, there will be <em>some</em> protocol that appears before it.  <em>That's</em> the place where <code>dissect_data()</code> gets called.</p></div>
            <div class="comment-info" id="comment-38724-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 18:01)</span>
                <a class="comment-user userinfo" href="/users/79/guy-harris">Guy Harris ♦♦</a>
                
            </div>
        </div>
    
        <a name="38725"></a>
        <div class="comment" id="comment-38725">
            <div id="post-38725-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Harris. The protocol before it is UDP . <a href="https://www.fshare.vn/file/STJVHL7XSZ9Y">Here</a> is the pcap file. Thanks for suggestion. I 'll try to rewrite the dissector.</p></div>
            <div class="comment-info" id="comment-38725-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 18:22)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-38703" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-38703-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="38757"></a>
                    <div id="answer-container-38757" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-38757-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38757/up/" rel="nofollow"> </a>
<div id="post-38757-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-38757-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38757/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="hoangsonk49 has selected this answer as the correct answer"
        href="/accept_answer/38757/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>You need to either:</p>
<ol>
<li>have your dissector register in the "udp" dissector table, with <code>dissector_add_uint()</code>, for the UDP ports it uses, if it uses the same UDP ports all the time;</li>
<li>have your dissector have a preference to specify the UDP ports, and have it register in the "udp" dissector table using those port numbers;</li>
<li>have your dissector register in the "udp" dissector table with <code>dissector_add_for_decode_as()</code>, so that you can use the "decode as" mechanisms to specify that a particular UDP conversation should be dissected using your protocol;</li>
<li>if your protocol's packets have some data pattern at the beginning if the protocol's packet that makes it possible to guess what packets are packets with that protocol, make your dissector a "heuristic" dissector and register it in the "udp" heuristic dissector list with <code>heur_dissector_add()</code>.</li>
</ol>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/38757/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>27 Dec '14, 15:37</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" alt="Guy%20Harris's gravatar image" />
    <p><a href="/users/79/guy-harris">Guy Harris ♦♦</a><br/>
    <span class="score" title="17443 reputation points"><span class="">17.4k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">&#9679;</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">&#9679;</span><span class="badgecount">196</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Guy Harris has 216 accepted answers">19&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/38757/">
                edited
                <strong>28 Dec '14, 02:16</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-38757">
    
</div>
<div id="comment-tools-38757" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-38757-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="38708"></a>
                    <div id="answer-container-38708" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-38708-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38708/up/" rel="nofollow"> </a>
<div id="post-38708-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-38708-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38708/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>No you cannot, because the dissection engine memory is owned by the dissection engine, not you dissector. The engine knows when memory can be freed, or not, and does so when appropriate. There have been some serious work in this area with current versions of Wireshark, so this might relieve you situation.</p>
<p>If you are looking at the out-of-memory problems you can encounter when having a long capture, or large file, there are other ways to address this. The root cause is that Wireshark accumulates 'state' from the network traffic it sees. This allows Wireshark to do all the amazing things it does. On the downside, this state data cannot be freed until the capture file is closed. </p>
<p>So, either capture using dumpcap for long term captures, or use editcap to split your large capture file in order for it to be loaded. But these are only general recommendation. There could be more specific suggestions possible for your particular situation. </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/38708/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>25 Dec '14, 08:06</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" alt="Jaap's gravatar image" />
    <p><a href="/users/4/jaap">Jaap ♦</a><br/>
    <span class="score" title="11680 reputation points"><span class="">11.7k</span></span><span title="16 badges"><span class="silver">&#9679;</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">&#9679;</span><span class="badgecount">101</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jaap has 155 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-38708">
    
        <a name="38712"></a>
        <div class="comment" id="comment-38712">
            <div id="post-38712-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Jaap, I split file by using : </p>

<p><strong>tshark -i 6 -P -w logs/call_log.pcap -b filesize:655350</strong></p>

<p>In another situation, I dissected the CAMEL packet successfully without any problem of memory.In the current situation,the packet is not a standard so it must be decoded before going through SCCP dissector to be output as CAMEL standard.If CAMEL packet has no problem of memory,so I think there is something wrong in my decode function which are related to the memory allocation. It increases about 1.5% of 32GB in 10 minutes until reach 95% before Stop. Here is the decode function: </p>

<pre><code>decode_sonnh(tvbuff_t *tvb, packet_info *pinfo _U_ , proto_tree *tree)
{
        tvbuff_t *tvb_sonnh;
        tvbuff_t *tvb_tmp;
        ...    
        if (...)
        {    
             ...    
            guint8 sccp_sonnh[1000];
            guint8 sccp_sonnh_tmp[1000];
            guint8 real_data_sonnh[1000];

            for(i=0;i&lt;bytes;i++)
            {
            value = tvb_get_guint8(tvb, i);
                value1= tvb_get_guint8(tvb, i+1);

                if(...)
                {
                    nStart = ...
                    break;
                }
            }

            if(...)
            {       
                ...
                tvb_tmp = tvb_new_subset_remaining(tvb, nStart);                
                ...
                bytes = tvb_length_remaining(tvb_tmp,0);
                real_data_sonnh[0]=...;
                real_data_sonnh[1]=...;
                real_data_sonnh[2]=...;
                real_data_sonnh[3]=... + nSccp_Called_Length;
                real_data_sonnh[4]=real_data_sonnh[3] + nSccp_Calling_Length;
                for(...)
                {
                    real_data_sonnh[5+i]=sccp_sonnh[i];
                }
                    real_data_sonnh[5+nSccp_length]=...;

                for(...)
                {
                    real_data_sonnh[6+nSccp_length+i]=tvb_get_guint8(tvb_tmp, i);
                }
                    tvb_sonnh = tvb_new_real_data(&amp;real_data_sonnh,bytes+nSccp_length+6,bytes+nSccp_length+6); 
                    dissect_sccp(tvb_sonnh,pinfo,tree ); // Wireshark takes care this dissection.Result is CAMEL packet
                    if(tvb_sonnh)
                    {
                        tvb_free(tvb_sonnh);
                        tvb_sonnh = NULL;
                    }
                    ...

            }
            else
            {
                ...
            }
        }
        else
        {
            ...
        }
     }
</code></pre>

<p>is there any problem with the memory allocation? Please correct me if I did something wrong. Thank you.</p></div>
            <div class="comment-info" id="comment-38712-info">
                
                
                
                

                

                <span class="comment-age">(25 Dec '14, 18:53)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
        <a name="38713"></a>
        <div class="comment" id="comment-38713">
            <div id="post-38713-score" class="comment-score"></div>
            <div class="comment-text"><p>It could be related to the SCCP dissector keeping state information. If you are using the 1.99 branch, you can have a look at the -b switch, as described here: <a href="https://blog.wireshark.org/2014/07/to-infinity-and-beyond-capturing-forever-with-tshark/">https://blog.wireshark.org/2014/07/to-infinity-and-beyond-capturing-forever-with-tshark/</a></p></div>
            <div class="comment-info" id="comment-38713-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 00:50)</span>
                <a class="comment-user userinfo" href="/users/1538/pascal-quantin">Pascal Quantin</a>
                
            </div>
        </div>
    
        <a name="38714"></a>
        <div class="comment" id="comment-38714">
            <div id="post-38714-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Pascal, I'm using the -b switch as mentioned at the top of the comment</p>

<blockquote>
<p>tshark -i 6 -P -w logs/call_log.pcap -b filesize:655350</p>
</blockquote></div>
            <div class="comment-info" id="comment-38714-info">
                
                
                
                

                

                <span class="comment-age">(26 Dec '14, 01:27)</span>
                <a class="comment-user userinfo" href="/users/5593/hoangsonk49">hoangsonk49</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-38708" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-38708-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/38703/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='rRMHYmTNUVoQVe2cExs9WpZ480nH4JrG' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/38703/how-do-i-have-my-dissector-handle-a-protocol-running-on-top-of-udp?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/udp/"
            class="tag-link-udp"
            title="see questions tagged'udp'using tags"
            rel="tag">udp</a> <span class="tag-number">&#215;166</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Dec. 24, 2014, 8:30 p.m.">24 Dec '14, 20:30</strong>
    </p>
    <p> 
     	question was seen: <strong>2,396 times</strong>
    </p>
    <p> 
        last updated: <strong title="Dec. 28, 2014, 2:16 a.m.">28 Dec '14, 02:16</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/500/capturing-udp-packets-from-the-same-computer">Capturing UDP packets from the same computer</a>
        </p>
        
        <p>
            <a href="/questions/7284/udp-checksum-error-on-ipv4-frame-with-loose-source-route">UDP checksum error on IPv4 frame with loose source route.</a>
        </p>
        
        <p>
            <a href="/questions/12837/udp-packets-jitter-and-delay">UDP packets&#39; jitter and delay</a>
        </p>
        
        <p>
            <a href="/questions/20057/wireshark-fixes-network-issue-but-how">Wireshark &#39;fixes&#39; network issue - but how?</a>
        </p>
        
        <p>
            <a href="/questions/23221/bacnet-messages-on-udp-ports-other-than-47808-can-they-be-decoded">BACnet messages on UDP ports other than 47808, can they be decoded?</a>
        </p>
        
        <p>
            <a href="/questions/28516/unknown-udp-traffic-from-unknown-process-on-port-60129">Unknown UDP traffic from unknown process on port 60129</a>
        </p>
        
        <p>
            <a href="/questions/34729/time-stamping-outgoing-packets-versus-actual-on-packet-on-wire-time">Time-stamping outgoing packets versus actual on packet-on-wire time.</a>
        </p>
        
        <p>
            <a href="/questions/45152/no-packets-being-displayed-on-wireshark-however-packets-are-being-transmitted">No packets being displayed on Wireshark however packets are being transmitted.</a>
        </p>
        
        <p>
            <a href="/questions/50318/how-to-filter-out-unwanted-icmp-packets">How to filter out unwanted ICMP packets?</a>
        </p>
        
        <p>
            <a href="/questions/56633/decoding-udp-to-rtp-in-old-versions-of-tshark">Decoding UDP to RTP in old versions of tshark</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
