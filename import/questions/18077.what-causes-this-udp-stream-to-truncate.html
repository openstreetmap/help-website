<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>What causes this UDP stream to truncate? - Wireshark Q&amp;A</title>
        <meta name="description" content="We have a server sending a large UDP stream to another server for processing. The server is connected to a Layer3 switch. From there, the packets pass through another internal router to get to the destination server. By the time it gets to the proper network segment, a Wireshark capture shows the UD..." />
        <meta name="keywords" content="udp,routing,truncated" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/18077/what-causes-this-udp-stream-to-truncate" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/18077/what-causes-this-udp-stream-to-truncate?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='aRY6IkAUC2ANDXeB9l84w5TDBUuTCOJl' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/18077/what-causes-this-udp-stream-to-truncate">What causes this UDP stream to truncate?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-18077-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18077/up/" rel="nofollow"> </a>
<div id="post-18077-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-18077-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18077/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/18077/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>We have a server sending a large UDP stream to another server for processing.  The server is connected to a Layer3 switch.  From there, the packets pass through another internal router to get to the destination server.</p>
<p>By the time it gets to the proper network segment, a Wireshark capture shows the UDP stream is truncated by about 100 bytes. It starts off from the sending server at 1558 bytes (this is data only) and arrives at 1458 bytes.  Captures at the Layer 3 switch ports involved all show the data at 1558 bytes, but another capture at the incoming port of the router shows the data truncated to 1458 bytes.</p>
<p>How can this be?  How can the data leaving the switch port disappear at the receiving router port?  Or am I misinterpreting the captures maybe?</p>
<p>The L3 switch is an old 3Com SSII 3300 with an L3 module.  The router is a pfSense Dell SC1425 that supports jumbo frames.  I'm inclined to suspect the 3Com switch, but the captures seem to exonerate it.</p>
<p>Can anyone shed some light on this?</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/udp/" class="post-tag tag-link-udp"
                                        title="see questions tagged 'udp'" rel="tag">udp</a>
                                
                                    <a href="/tags/routing/" class="post-tag tag-link-routing"
                                        title="see questions tagged 'routing'" rel="tag">routing</a>
                                
                                    <a href="/tags/truncated/" class="post-tag tag-link-truncated"
                                        title="see questions tagged 'truncated'" rel="tag">truncated</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>30 Jan '13, 00:01</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/bcdfec82062d17f11f8c7e5696720a1e?s=32&amp;d=identicon&amp;r=g" alt="praevidium's gravatar image" />
    <p><a href="/users/4295/praevidium">praevidium</a><br/>
    <span class="score" title="2 reputation points">2</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="praevidium has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-18077">
    
</div>
<div id="comment-tools-18077" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18077-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    3 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/18077/what-causes-this-udp-stream-to-truncate?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/18077/what-causes-this-udp-stream-to-truncate?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/18077/what-causes-this-udp-stream-to-truncate?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/18077/what-causes-this-udp-stream-to-truncate?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="18151"></a>
                    <div id="answer-container-18151" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18151-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18151/up/" rel="nofollow"> </a>
<div id="post-18151-score" class="post-score"
    title="current number of votes">
    2
</div>
<a id="post-18151-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18151/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>As <a href="/users/2593/kurt">@Kurt</a> already suggested, there is fragmentation. The server that receives the packets over TCP sends them out over UDP. It sends the whole content in one datagram, which needs to be fragmented to fit the MTU.</p>
<p>I'm not sure why you don't see both fragments at the pfSense side, but I suspect that you used a capture filter with a udp port, as the second fragment does not contain the udp header, the capture filter will drop it. You can make another trace where you use only ip addresses in the filter on the pfSense.</p>
<p>There seemed to have been a problem in pfSense will fragmentation, which version do you use? </p>
<p>It would be best if the server that sends the UDP packets will do fragmentation at the UDP layer. But that might not be compatible with the receiving end.</p>
<p>Could you make traces (with only an IP cpature filter and full snaplength) on both sides of the pfSense?</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18151/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>31 Jan '13, 01:07</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18151">
    
        <a name="18154"></a>
        <div class="comment" id="comment-18154">
            <div id="post-18154-score" class="comment-score"></div>
            <div class="comment-text"><p>You are absolutely correct.  I just did another series of captures and filtered them differently and now I see the fragmentation all the way to the receiving server's switch port.  However, both the UDP packet and the IP4 fragment show IP checksum errors at both switch ports involved (pfSense LAN and receiving server).  Is this a concern or is it a false error due to IP checksum offload?  (I'm not sure how to interpret the warning on the IP checksum line.)  There are no checksum errors on the pfSense box LAN port, but I'm pretty sure its nic driver supports checksum offloading.</p>

<p>The switch is very old. Could it be that the switch can't handle what the pfSense box is sending it in this case?</p></div>
            <div class="comment-info" id="comment-18154-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 01:31)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18156"></a>
        <div class="comment" id="comment-18156">
            <div id="post-18156-score" class="comment-score"></div>
            <div class="comment-text"><p>(I converted your "answer" to a "comment", please see the FAQ on how to use this site best)</p>

<p>When checksum offloading is enabled you will normally only see bad checksums when capturing on the host itself and only for the outgoing frames.</p>

<p>I assume the checksums on the LAN side of the pfSense are OK. Is that correct? Now on the WAN side you see bad checksums? Also when the server receives the packets? Then it is indeed a pfSense issue. You will find some more info when googling for "pfSense" and "fragment".</p></div>
            <div class="comment-info" id="comment-18156-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 01:45)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18164"></a>
        <div class="comment" id="comment-18164">
            <div id="post-18164-score" class="comment-score"></div>
            <div class="comment-text"><p>OK.  That's good to know.</p>

<p>I didn't re-check the WAN-side port of the pfSense box because the packets are moving from the WAN to the LAN and, yes, there are no errors at that LAN-side port.  From there, they move through a switch to the receiving server.  It is at that switch that I see the checksum errors.  So those errors are probably real and the switch is likely the problem?</p></div>
            <div class="comment-info" id="comment-18164-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 02:29)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18165"></a>
        <div class="comment" id="comment-18165">
            <div id="post-18165-score" class="comment-score"></div>
            <div class="comment-text"><p>Is there checksum offloading enabled on the NIC's in your pfSense box? If you don't see errors on the box itself (packets are captured between the IP stack and the NIC driver), but you do see them on the network, then something along the way (only the NIC in your case) has modified the packets.</p></div>
            <div class="comment-info" id="comment-18165-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 02:40)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18167"></a>
        <div class="comment" id="comment-18167">
            <div id="post-18167-score" class="comment-score"></div>
            <div class="comment-text"><p>I just checked on a pfSense box (v1.2.3) in my lab:</p>

<pre><code>11:53:08.552925 IP 192.168.20.10 &gt; 192.168.21.1: ICMP echo request, id 512, seq 3072, length 1480
11:53:08.552944 IP 192.168.20.10 &gt; 192.168.21.1: icmp
11:53:08.552964 IP 192.168.21.1 &gt; 192.168.20.10: ICMP echo reply, id 512, seq 3072, length 1480
11:53:08.552969 IP 192.168.21.1 &gt; 192.168.20.10: icmp
</code></pre>

<p>(running a ping -l 2024 from 192.168.20.10 to 192.168.21.1, tcpdump output is from 192.168.21.1)</p>

<p>It looks like it is having no problems with the fragments. Which version of pfSense are you running?</p></div>
            <div class="comment-info" id="comment-18167-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 02:57)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18168"></a>
        <div class="comment not_top_scorer" id="comment-18168">
            <div id="post-18168-score" class="comment-score"></div>
            <div class="comment-text"><p>'Hardware checksum offloading' is disabled in pfSense.  So, the results that I'm talking about are with checksum offloading turned off.</p></div>
            <div class="comment-info" id="comment-18168-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:05)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18170"></a>
        <div class="comment not_top_scorer" id="comment-18170">
            <div id="post-18170-score" class="comment-score"></div>
            <div class="comment-text"><p>How are you making the traces on the 3Com switch on the lan side, do you use a monitor/mirror/span port? Do you have a TAP at hand to place in between the pfSense and the 3Com switch? Or are you able to switch switches (pun intended)?</p></div>
            <div class="comment-info" id="comment-18170-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:12)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18171"></a>
        <div class="comment not_top_scorer" id="comment-18171">
            <div id="post-18171-score" class="comment-score"></div>
            <div class="comment-text"><p>I have 'hardware checksum offloading' disabled on my pfSense 1.2.2 box.  So, the results I'm talking about are with no checksum offloading.</p></div>
            <div class="comment-info" id="comment-18171-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:17)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18172"></a>
        <div class="comment not_top_scorer" id="comment-18172">
            <div id="post-18172-score" class="comment-score"></div>
            <div class="comment-text"><p>Sorry, the 'echo' was not intended.  A couple of comments got hidden on me.</p>

<p>I'm using the switch's 'Roving Analysis Port' (monitoring one port at another).  No TAP at the moment and no switch replacement, either.  But, to be clear, there's only the wire between the pfSense LAN port and the switch port at which I captured the packets.</p></div>
            <div class="comment-info" id="comment-18172-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:34)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18173"></a>
        <div class="comment not_top_scorer" id="comment-18173">
            <div id="post-18173-score" class="comment-score"></div>
            <div class="comment-text"><p>You might want to upgrade pfSense to 1.2.3 (or 2.0.2, but that's a bigger step) as I see a couple of people reporting fragmentation issues when I google for pfSense 1.2.2 and fragmentation.</p>

<p>The 3Com switch will not look at the IP checksum let alone touch it (unless it's natting, which is not the case looking at your earlier traces).</p></div>
            <div class="comment-info" id="comment-18173-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:40)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18174"></a>
        <div class="comment not_top_scorer" id="comment-18174">
            <div id="post-18174-score" class="comment-score"></div>
            <div class="comment-text"><p>It has been on my mind.</p>

<p>I'll upload those last captures to my Google Drive.  The errors are with the IP checksum.  But that'll have to wait until later today.  I need at least a few hours sleep. It's coming up to 0500 here.  Signing off for a bit...</p></div>
            <div class="comment-info" id="comment-18174-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:50)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
        <a name="18175"></a>
        <div class="comment not_top_scorer" id="comment-18175">
            <div id="post-18175-score" class="comment-score"></div>
            <div class="comment-text"><p>Oops, I meant IP instead of UDP (I just corrected it in my last comment).</p>

<p>Sorry for keeping you awake, it's about 13:00 here :-)</p></div>
            <div class="comment-info" id="comment-18175-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 03:53)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="18218"></a>
        <div class="comment not_top_scorer" id="comment-18218">
            <div id="post-18218-score" class="comment-score"></div>
            <div class="comment-text"><p>OK. I'm back. I did a capture at the receiving server nic and uploaded both it and the new captures to:
<a href="https://docs.google.com/folder/d/0BxSuHyrWOanUeW0tamg3b21YUWM/edit?usp=sharing">https://docs.google.com/folder/d/0BxSuHyrWOanUeW0tamg3b21YUWM/edit?usp=sharing</a></p>

<p>The stream leaves the pfSense box fragmented but with no checksum errors.  All the subsequent captures right up to the receiving server show both packets but with IP checksum errors.</p>

<p>It's only these packets that have any problem.  All the other network traffic is pretty normal.</p>

<p>As I understand it, the errors must be introduced somewhere between: LLC-MAC-Physical NIC ---&gt; Physical NIC-MAC-LLC.  Could the switch port driver be the culprit?</p></div>
            <div class="comment-info" id="comment-18218-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 22:28)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-18151" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 13
        </span>
        <a href="#" class="show-all-comments-link">show 8 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-18151-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="18127"></a>
                    <div id="answer-container-18127" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18127-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18127/up/" rel="nofollow"> </a>
<div id="post-18127-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-18127-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18127/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <blockquote>
<p>It starts off from the sending server at 1558 bytes (this is data only) and arrives at 1458 bytes</p>
</blockquote>
<p>did you check if the packets have been fragmented (IP fragmentation)? </p>
<p>Another option would be padding bytes in the ethernet frame (1558 Bytes), although 100 bytes of padding are a bit "uncommon". Can you post those two packets in pcap format somewhere?</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18127/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>30 Jan '13, 12:59</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18127">
    
        <a name="18148"></a>
        <div class="comment" id="comment-18148">
            <div id="post-18148-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for your reply, Kurt.  I'll check on the fragmentation.  Here's a link with the packets and a little explanation:
<a href="https://docs.google.com/folder/d/0BxSuHyrWOanUeW0tamg3b21YUWM/edit">https://docs.google.com/folder/d/0BxSuHyrWOanUeW0tamg3b21YUWM/edit</a></p>

<p>John</p></div>
            <div class="comment-info" id="comment-18148-info">
                
                
                
                

                

                <span class="comment-age">(31 Jan '13, 00:14)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-18127" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18127-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="18318"></a>
                    <div id="answer-container-18318" class="answer answered-by-owner">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-18318-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/18318/up/" rel="nofollow"> </a>
<div id="post-18318-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-18318-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/18318/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Well, here's the end of the story:</p>
<p>The actual problem turned out not to be a stream truncation at all.  A different Wireshark filter showed it had to do with IP fragmentation.  The UDP packet was being fragmented and somehow the IP headers were altered and the checksums were incorrect by the time the packets hit the LAN.  A packet capture at the LAN nic didn't show any errors, but one at the corresponding switch port did, which was very difficult to figure out.</p>
<p>I resolved it by upgrading both the switch firmware and then pfSense (to 2.0.2).  It was after the pfSense upgrade that the packets in question finally got to the destination server application.  So, the problem really was in pfSense 1.2.2's IP fragmentation.  Fortunately, pfSense 2.0.2 does IP fragmentation correctly (at least, so far).  I'm relieved.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/18318/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>05 Feb '13, 05:28</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/bcdfec82062d17f11f8c7e5696720a1e?s=32&amp;d=identicon&amp;r=g" alt="praevidium's gravatar image" />
    <p><a href="/users/4295/praevidium">praevidium</a><br/>
    <span class="score" title="2 reputation points">2</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="praevidium has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-18318">
    
        <a name="18319"></a>
        <div class="comment" id="comment-18319">
            <div id="post-18319-score" class="comment-score"></div>
            <div class="comment-text"><p>So pfSense IP fragmentation was at fault, as suggested by <a href="/users/5/syn-bit"></a><a href="/users/5/syn-bit">@SYN-bit</a> in his answer.</p></div>
            <div class="comment-info" id="comment-18319-info">
                
                
                
                

                

                <span class="comment-age">(05 Feb '13, 05:44)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="18320"></a>
        <div class="comment" id="comment-18320">
            <div id="post-18320-score" class="comment-score"></div>
            <div class="comment-text"><p>Indeed.  However, to reiterate, pfSense 2.0.2 does not have the same issue.</p></div>
            <div class="comment-info" id="comment-18320-info">
                
                
                
                

                

                <span class="comment-age">(05 Feb '13, 07:14)</span>
                <a class="comment-user userinfo" href="/users/4295/praevidium">praevidium</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-18318" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-18318-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/18077/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='aRY6IkAUC2ANDXeB9l84w5TDBUuTCOJl' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/18077/what-causes-this-udp-stream-to-truncate?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/18077/what-causes-this-udp-stream-to-truncate?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/udp/"
            class="tag-link-udp"
            title="see questions tagged'udp'using tags"
            rel="tag">udp</a> <span class="tag-number">&#215;166</span><br/>
        
        <a href="/tags/truncated/"
            class="tag-link-truncated"
            title="see questions tagged'truncated'using tags"
            rel="tag">truncated</a> <span class="tag-number">&#215;13</span><br/>
        
        <a href="/tags/routing/"
            class="tag-link-routing"
            title="see questions tagged'routing'using tags"
            rel="tag">routing</a> <span class="tag-number">&#215;7</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Jan. 30, 2013, 12:01 a.m.">30 Jan '13, 00:01</strong>
    </p>
    <p> 
     	question was seen: <strong>9,703 times</strong>
    </p>
    <p> 
        last updated: <strong title="Feb. 5, 2013, 7:14 a.m.">05 Feb '13, 07:14</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/500/capturing-udp-packets-from-the-same-computer">Capturing UDP packets from the same computer</a>
        </p>
        
        <p>
            <a href="/questions/7284/udp-checksum-error-on-ipv4-frame-with-loose-source-route">UDP checksum error on IPv4 frame with loose source route.</a>
        </p>
        
        <p>
            <a href="/questions/12837/udp-packets-jitter-and-delay">UDP packets&#39; jitter and delay</a>
        </p>
        
        <p>
            <a href="/questions/20139/capturing-udp-packets-sent-from-my-own-app">Capturing UDP packets sent from my own app</a>
        </p>
        
        <p>
            <a href="/questions/23278/fragmented-udp-packets-in-rtp-session">Fragmented UDP Packets in RTP Session</a>
        </p>
        
        <p>
            <a href="/questions/28524/tcp-dissector-being-called-on-udp">TCP dissector being called on UDP</a>
        </p>
        
        <p>
            <a href="/questions/36845/is-it-still-possible-to-listen-to-google-hangouts-voip-calls-like-it-was-in-the-past-when-the-rtp-protocol-was-used">Is it still possible to listen to Google Hangouts VoIP calls like it was in the past when the RTP protocol was used...</a>
        </p>
        
        <p>
            <a href="/questions/45152/no-packets-being-displayed-on-wireshark-however-packets-are-being-transmitted">No packets being displayed on Wireshark however packets are being transmitted.</a>
        </p>
        
        <p>
            <a href="/questions/50318/how-to-filter-out-unwanted-icmp-packets">How to filter out unwanted ICMP packets?</a>
        </p>
        
        <p>
            <a href="/questions/56633/decoding-udp-to-rtp-in-old-versions-of-tshark">Decoding UDP to RTP in old versions of tshark</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
