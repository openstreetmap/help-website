<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>get NULL if field does not exist in protocol - Wireshark Q&amp;A</title>
        <meta name="description" content="Hello! I have no idea how to solve one problem:  with the help of dumpcap I capture pcap file after that I parse pcap file with tshark  some frames are muti-chunk. For example mapping of the frame is the following: SCTP -&amp;gt; MTP3 -&amp;gt; SCCP -&amp;gt; TCAP -&amp;gt; GSM_MAP -&amp;gt; GSM_SMS -&amp;gt; SCTP -&amp;gt; MT..." />
        <meta name="keywords" content="lua,ss7,gsm_map" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/45194/get-null-if-field-does-not-exist-in-protocol" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='HAFotVGhmI0iDyDUTnsbvwcyjkozH4jM' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/45194/get-null-if-field-does-not-exist-in-protocol">get NULL if field does not exist in protocol</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-45194-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/45194/up/" rel="nofollow"> </a>
<div id="post-45194-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-45194-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/45194/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/45194/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hello!</p>
<p>I have no idea how to solve one problem:</p>
<ol>
<li>with the help of dumpcap I capture pcap file</li>
<li>after that I parse pcap file with tshark</li>
<li>
<p>some frames are muti-chunk. For example mapping of the frame is the following:</p>
<p><code>SCTP -&gt; MTP3 -&gt; SCCP -&gt; TCAP -&gt; GSM_MAP -&gt; GSM_SMS -&gt;</code></p>
<p><code>SCTP -&gt; MTP3 -&gt; SCCP -&gt; TCAP -&gt; GSM_MAP -&gt;</code></p>
<p><code>SCTP -&gt; MTP3 -&gt; SCCP -&gt; TCAP -&gt; GSM_MAP -&gt; GSM_SMS -&gt;</code></p>
<p><code>SCTP -&gt; MTP3 -&gt; SCCP -&gt; TCAP -&gt; GSM_MAP -&gt; GSM_SMS</code></p>
</li>
</ol>
<p>And with the help of lua script I devide multi-chunk in separate strings</p>
<p>Code of LUA script:</p>
<hr>
<pre><code>local logfile = "/en_"..os.date("%Y%m%d%H%M%S")..".lua"
io.output(logfile)

local frame_time = Field.new("frame.time")
local frame_protocols = Field.new("frame.protocols")
local gsm_map_tbcd_digits = Field.new("gsm_map.tbcd_digits")

local gsm_map_cap = Listener.new(nil,"gsm_map")

function gsm_map_cap.packet(pinfo,tvb)

    local Mas_frame_time = frame_time()
    XMas_frame_time = string.gsub(tostring(Mas_frame_time),"  "," ")
    local Mas_frame_protocols = frame_protocols()
    local Mas_gsm_map_tbcd_digits = {gsm_map_tbcd_digits()}
    p="(%a+) (%d+), (%d+) (%d+):(%d+):(%d+).(%d+) (%a+)"
    MON={Jan=1,Feb=2,Mar=3,Apr=4,May=5,Jun=6,Jul=7,Aug=8,Sep=9,Oct=10,Nov=11,Dec=12}

    Max_count = 0
    count = 0
    for k,v in ipairs(Mas_gsm_map_tbcd_digits) do
        count = count + 1
    end

    for i=1,Max_count do
        xmonth,xday,xyear,xhour,xmin,xsec,xmlsec,xtz=tostring(XMas_frame_time):match(p)
        month=MON[xmonth]
        local convertedTimestamp = os.date("%Y-%m-%d %H:%M:%S",os.time({year = xyear, month = month, day = xday, hour = xhour, min = xmin, sec = xsec}))
        io.write(tostring(convertedTimestamp) .. "\t" ..  tostring(Mas_frame_protocols) .. "\t" .. tostring(Mas_gsm_map_tbcd_digits[i]) .. "\n")
        end
    end

end
</code></pre>
<hr>
<p>But the problem is that in one multi-chunk frame one field (<code>gsm_map.tbcd_digits</code>) could exit in one <code>GSM_MAP</code> and in another <code>GSM_MAP</code> in the same frame this field does not exist.</p>
<p>Somebody may be knows how to write listener in LUA to get NULL for the field even if this field does not exist in one of the protocol in multi-chunk frame?</p>
<p>As the result a want to have from lua the following array for field “ <code>gsm_map.tbcd_digits</code> “:</p>
<pre><code>123123123123123123

456456456456456456

NUL

678768678678678678
</code></pre>
<p>But now a have only following:</p>
<pre><code>123123123123123123

456456456456456456

678768678678678678
</code></pre>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/lua/" class="post-tag tag-link-lua"
                                        title="see questions tagged 'lua'" rel="tag">lua</a>
                                
                                    <a href="/tags/ss7/" class="post-tag tag-link-ss7"
                                        title="see questions tagged 'ss7'" rel="tag">ss7</a>
                                
                                    <a href="/tags/gsm_map/" class="post-tag tag-link-gsm_map"
                                        title="see questions tagged 'gsm_map'" rel="tag">gsm_map</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>18 Aug '15, 04:17</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/2d7d6eacf9c502b9188b233cb3e1d8ff?s=32&amp;d=identicon&amp;r=g" alt="domeno's gravatar image" />
    <p><a href="/users/4703/domeno">domeno</a><br/>
    <span class="score" title="21 reputation points">21</span><span title="6 badges"><span class="badge1">&#9679;</span><span class="badgecount">6</span></span><span title="6 badges"><span class="silver">&#9679;</span><span class="badgecount">6</span></span><span title="11 badges"><span class="bronze">&#9679;</span><span class="badgecount">11</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="domeno has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/45194/">
                edited
                <strong>18 Aug '15, 04:49</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" alt="Hadriel's gravatar image" />
            <p><a href="/users/4318/hadriel">Hadriel</a><br/>
            <span class="score" title="2652 reputation points"><span class="">2.7k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">&#9679;</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">&#9679;</span><span class="badgecount">39</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-45194">
    
</div>
<div id="comment-tools-45194" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-45194-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="45255"></a>
                    <div id="answer-container-45255" class="answer accepted-answer">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-45255-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/45255/up/" rel="nofollow"> </a>
<div id="post-45255-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-45255-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/45255/down/" rel="nofollow"> </a>

                                        


    
      <a class="accept-answer on"
        title="domeno has selected this answer as the correct answer"
        href="/accept_answer/45255/" rel="nofollow">
      </a>
    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Try something like this - this doesn't do your whole thing, but should give you the idea:</p>
<pre><code>-- creates a Proto object, but doesn't register it yet
local proxy = Proto("tcap_proxy","TCAP-Proxy Fake Protocol")

-- these protofields are only used for debugging this thing
local total_tbcd_pf = ProtoField.uint16("tcap_proxy.total_tbcd",
                                        "Number of TBCD entries created (real and NULL)")
local real_tbcd_pf  = ProtoField.uint16("tcap_proxy.real_tbcd", 
                                        "Number of real TBCD entries created")
local null_tbcd_pf  = ProtoField.uint16("tcap_proxy.null_tbcd", 
                                        "Number of null TBCD entries created")
proxy.fields = { total_tbcd_pf, real_tbcd_pf, null_tbcd_pf }

-- this is the field we're going to keep track of
local tbcd_digits_field = Field.new("gsm_map.tbcd_digits")

-- this will be the tcap dissector, once we get it later
local tcap_dissector

-- this holds all of counts, in subtables per packet number
local packets = {}

function proxy.dissector(tvbuf,pinfo,root)

    if not pinfo.visited then
        -- first time for this packet, but might not be the first time we've
        -- been invoked in this packet; let's find out
        local counts = packets[pinfo.number]

        if not counts then
            -- ok, it's the first time we've been invoked for this packet, ever.
            -- so create a subtable for this packet's tbcd_digit counts
            counts = { ["number_real_entries"] = 0 }
            packets[pinfo.number] = counts
        end

        local current_count = #counts

        -- for debugging, we're going to add our proxy protocol to the tree
        local tree = root:add(proxy, tvbuf:range(0,pktlen))
        tree:add(total_tbcd_pf, current_count):set_generated()
        tree:add(real_tbcd_pf, counts.number_real_entries):set_generated()
        tree:add(null_tbcd_pf, current_count - counts.number_real_entries):set_generated()

        -- call the TCAP dissector
        tcap_dissector:call(tvbuf,pinfo,root)

        local num_fields = { tbcd_digits_field() }

        if #num_fields &gt; counts.number_real_entries then
            -- we got a new one; it must be the last one in the num_fields table
            counts[current_count + 1] = num_fields[#num_fields].value
            counts.number_real_entries = counts.number_real_entries + 1
        else
            -- no tbcd digits, add a &lt;NONE&gt; entry
            counts[current_count + 1] = "&lt;NONE&gt;"
        end
    else
        -- we've processed this whole packet before; just show the debug info
        -- of the counts and invoke the TCAP dissector
        local counts = packets[pinfo.number]

        -- for debugging, we're going to add our proxy protocol to the tree
        local tree = root:add(proxy, tvbuf:range(0,pktlen))
        tree:add(total_tbcd_pf, #counts):set_generated()
        tree:add(real_tbcd_pf, counts.number_real_entries):set_generated()
        tree:add(null_tbcd_pf, #counts - counts.number_real_entries):set_generated()

        -- call the TCAP dissector
        tcap_dissector:call(tvbuf,pinfo,root)
    end

end

-- we're intercepting SSN range 6-9 for GSM MAP
local sccp_tbl = DissectorTable.get("sccp.ssn")
-- get the TCAP dissector
tcap_dissector = sccp_tbl:get_dissector(6)
-- replace it with our proxy dissector, for the 6-9 range
sccp_tbl:set("6-9", proxy)
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/45255/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>19 Aug '15, 20:19</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" alt="Hadriel's gravatar image" />
    <p><a href="/users/4318/hadriel">Hadriel</a><br/>
    <span class="score" title="2652 reputation points"><span class="">2.7k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">&#9679;</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">&#9679;</span><span class="badgecount">39</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Hadriel has 30 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-45255">
    
        <a name="45286"></a>
        <div class="comment" id="comment-45286">
            <div id="post-45286-score" class="comment-score"></div>
            <div class="comment-text"><p>Hadriel,</p>

<p>Could you please explain for what is calling "tcap_dissector" inside of "proxy.dissector" (artificial dissector for uor needs)?</p>

<p>Thanks for help!</p></div>
            <div class="comment-info" id="comment-45286-info">
                
                
                
                

                

                <span class="comment-age">(20 Aug '15, 23:04)</span>
                <a class="comment-user userinfo" href="/users/4703/domeno">domeno</a>
                
            </div>
        </div>
    
        <a name="45295"></a>
        <div class="comment" id="comment-45295">
            <div id="post-45295-score" class="comment-score"></div>
            <div class="comment-text"><p>If you look at the bottom of the script, you'll see I'm getting the "sccp.ssn" dissector table, and then from within that I'm getting the dissector registered for SCCP SSN number 6, and I'm <em>replacing</em> it with this "proxy" protocol's dissector. (in fact, I'm replacing the whole 6-9 range of SSNs) That dissector I'm <strong>replacing</strong> is the TCAP dissector - the one written in C-code built into wireshark.</p>

<p>So basically whenever SCCP goes to decode a message of SSN 6-9, instead of invoking TCAP like it would normally do, it invokes our proxy dissector instead. So within the proxy dissector I invoke the original TCAP dissector with the "<code>tcap_dissector:call(tvbuf,pinfo,root)</code>" line.</p>

<p>The reason I'm doing all that is that I can see if the number of GSM MAP TBCD fields has changed. If it's change, then we've got a new TBCD in the message to save; if it has <strong>not</strong> changed, then I add a "&lt;none&gt;" entry instead.</p>

<p>The reason I'm replacing the range 6-9 is that those are the GSM MAP SSN numbers, I think.</p></div>
            <div class="comment-info" id="comment-45295-info">
                
                
                
                

                

                <span class="comment-age">(21 Aug '15, 05:58)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-45255" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-45255-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="45198"></a>
                    <div id="answer-container-45198" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-45198-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/45198/up/" rel="nofollow"> </a>
<div id="post-45198-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-45198-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/45198/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>See the <a href="https://ask.wireshark.org/questions/43543/how-to-iterating-though-a-bundled-ss7-sctp-packet-in-lua">answer to question 43543</a> which is similar.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/45198/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>18 Aug '15, 05:12</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" alt="Hadriel's gravatar image" />
    <p><a href="/users/4318/hadriel">Hadriel</a><br/>
    <span class="score" title="2652 reputation points"><span class="">2.7k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">&#9679;</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">&#9679;</span><span class="badgecount">39</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Hadriel has 30 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-45198">
    
        <a name="45200"></a>
        <div class="comment" id="comment-45200">
            <div id="post-45200-score" class="comment-score"></div>
            <div class="comment-text"><p>Hadriel, thanks for the reply. </p>

<p>I am a little bit newbie in LUA and WireShark. That’s why I could not understand how to read every protocol in one frame successively. </p>

<p>Here is the code  of LUA script for my experiments:</p>

<p></p><hr>
<p>local logfile = "en_"..os.date("%Y%m%d%H%M%S")..".lua"
io.output(logfile)</p>
<p>local gsm_map_tbcd_digits = Field.new("gsm_map.tbcd_digits")
local m3ua = Listener.new(nil,"m3ua")</p>
<p>function m3ua.packet(pinfo,tvb)</p>
<p>local Mas_gsm_map_tbcd_digits = {gsm_map_tbcd_digits()}
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[0]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[1]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[2]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[3]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[4]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[5]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[6]) .."\n")
io.write("imsi:" .. tostring( Mas_gsm_map_tbcd_digits[7]) .."\n")</p>
<p>End</p>
<hr>
<p>I run it by the command:</p>
<p>Tshark –r /file.pcap –X lua_script:devide_imsi.lua</p>
<p>As far as I can judge I get the whole array of all “gsm_map.tbcd_digits” write in the beginning of the function m3ua.packet.
Would you be so kind and explain how to read every protocol in one frame successively? May be you some usefull examples?!</p>
<p>Thanks for any help!</p><p></p></div>
            <div class="comment-info" id="comment-45200-info">
                
                
                
                

                

                <span class="comment-age">(18 Aug '15, 06:43)</span>
                <a class="comment-user userinfo" href="/users/4703/domeno">domeno</a>
                
            </div>
        </div>
    
        <a name="45201"></a>
        <div class="comment" id="comment-45201">
            <div id="post-45201-score" class="comment-score"></div>
            <div class="comment-text"><p>Oh yeah I keep forgetting the taps aren't invoked until after the whole packet's been dissected. Crap.</p>

<p>Hmmm... the only way to do it might be to create a "proxy" Lua protocol, remove the "<code>gsm_map</code>" dissector from TCAP's table, register the proxy Lua dissector in its place for TCAP, and within the proxy one invoke the <code>gsm_map</code> dissector and after it returns see what's changed about the fields you're interested in. Yuck.</p>

<p>Can you share an example capture file for this problem? I might have some time later today to see if I can get the info you want using a Lua script.</p></div>
            <div class="comment-info" id="comment-45201-info">
                
                
                
                

                

                <span class="comment-age">(18 Aug '15, 07:30)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="45237"></a>
        <div class="comment" id="comment-45237">
            <div id="post-45237-score" class="comment-score"></div>
            <div class="comment-text"><p>Hadriel, thanks for the reply.</p>

<p>Could you please give me an advise how can i share the pcap file with example for you? Is it possible to send you this file personally as this file has some private information?</p>

<p>Thanks for any help!</p></div>
            <div class="comment-info" id="comment-45237-info">
                
                
                
                

                

                <span class="comment-age">(19 Aug '15, 05:23)</span>
                <a class="comment-user userinfo" href="/users/4703/domeno">domeno</a>
                
            </div>
        </div>
    
        <a name="45239"></a>
        <div class="comment" id="comment-45239">
            <div id="post-45239-score" class="comment-score"></div>
            <div class="comment-text"><p>Sure, my email is either <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="721a1316001b171e19320b131a1d1d5c111d1f">[email&#160;protected]</a>, or <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="512539347f2334303d7f3930352338343d11363c30383d7f323e3c7f">[email&#160;protected]</a></p></div>
            <div class="comment-info" id="comment-45239-info">
                
                
                
                

                

                <span class="comment-age">(19 Aug '15, 05:31)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="45243"></a>
        <div class="comment" id="comment-45243">
            <div id="post-45243-score" class="comment-score"></div>
            <div class="comment-text"><p>Wiresharks export-pdu function can do SCTP dechunking if that's of any use, this patch in gerrit implements it for tshark but I think the work on it may have stalled <a href="https://code.wireshark.org/review/#/c/5890/">https://code.wireshark.org/review/#/c/5890/</a></p></div>
            <div class="comment-info" id="comment-45243-info">
                
                
                
                

                

                <span class="comment-age">(19 Aug '15, 07:59)</span>
                <a class="comment-user userinfo" href="/users/42/anders">Anders ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-45198" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-45198-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/45194/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='HAFotVGhmI0iDyDUTnsbvwcyjkozH4jM' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/45194/get-null-if-field-does-not-exist-in-protocol?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/lua/"
            class="tag-link-lua"
            title="see questions tagged'lua'using tags"
            rel="tag">lua</a> <span class="tag-number">&#215;431</span><br/>
        
        <a href="/tags/ss7/"
            class="tag-link-ss7"
            title="see questions tagged'ss7'using tags"
            rel="tag">ss7</a> <span class="tag-number">&#215;21</span><br/>
        
        <a href="/tags/gsm_map/"
            class="tag-link-gsm_map"
            title="see questions tagged'gsm_map'using tags"
            rel="tag">gsm_map</a> <span class="tag-number">&#215;13</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Aug. 18, 2015, 4:17 a.m.">18 Aug '15, 04:17</strong>
    </p>
    <p> 
     	question was seen: <strong>2,440 times</strong>
    </p>
    <p> 
        last updated: <strong title="Aug. 21, 2015, 5:58 a.m.">21 Aug '15, 05:58</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/43543/how-to-iterating-though-a-bundled-ss7-sctp-packet-in-lua">How to iterating though a bundled SS7 SCTP packet in Lua</a>
        </p>
        
        <p>
            <a href="/questions/45287/get-value-of-the-field-in-every-protocol-in-frame">Get value of the field in every protocol in frame</a>
        </p>
        
        <p>
            <a href="/questions/570/crashing-issue-when-running-lua-dissector-after-upgrading-from-wireshark-100">Crashing issue when running Lua dissector after upgrading from wireshark 1.0.0</a>
        </p>
        
        <p>
            <a href="/questions/4410/create-my-own-dissector">Create my own dissector</a>
        </p>
        
        <p>
            <a href="/questions/5868/how-do-i-setup-wireshark-to-run-luas-clrpackage">How do I setup Wireshark to run Lua&#39;s CLRPackage</a>
        </p>
        
        <p>
            <a href="/questions/8328/order-of-entries-in-dissector-tables-at-startup-and-lua">Order of entries in dissector tables at startup and lua</a>
        </p>
        
        <p>
            <a href="/questions/9353/wireshark-lua-wireshark-version-problem">Wireshark Lua - Wireshark Version problem</a>
        </p>
        
        <p>
            <a href="/questions/11330/lua-binding-integration-documentation">Lua binding / integration - documentation</a>
        </p>
        
        <p>
            <a href="/questions/15776/check-sequentiality-in-destination-addresses-from-a-specific-source-address">check sequentiality in destination addresses from a specific source address</a>
        </p>
        
        <p>
            <a href="/questions/19340/tcpdstat-for-wireshark">TCPdSTAT for Wireshark?</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
