<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>tcp mss inconsistency in different capture points - Wireshark Q&amp;A</title>
        <meta name="description" content="Analysis process, the client is found in the TCP connection is established, the MSS value is not the same in different capture points. client side packet: http://www.cloudshark.org/captures/0c7d36890433 server side packet: http://www.cloudshark.org/captures/1d460ea5291d Help to explain thanks." />
        <meta name="keywords" content="mss,tcp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/20633/tcp-mss-inconsistency-in-different-capture-points" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='z6JHwzOnO2fV4wj2de3uXuvkOcITeEyP' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points">tcp mss inconsistency in different capture points</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-20633-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/20633/up/" rel="nofollow"> </a>
<div id="post-20633-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-20633-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/20633/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/20633/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Analysis process, the client is found in the TCP connection is established, the MSS value is not the same in different capture points.
client side packet:
<a href="http://www.cloudshark.org/captures/0c7d36890433">http://www.cloudshark.org/captures/0c7d36890433</a>
server side packet:
<a href="http://www.cloudshark.org/captures/1d460ea5291d">http://www.cloudshark.org/captures/1d460ea5291d</a></p>
<p>Help to explain</p>
<p>thanks.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/mss/" class="post-tag tag-link-mss"
                                        title="see questions tagged 'mss'" rel="tag">mss</a>
                                
                                    <a href="/tags/tcp/" class="post-tag tag-link-tcp"
                                        title="see questions tagged 'tcp'" rel="tag">tcp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>19 Apr '13, 09:55</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c66d8077ef5f4d265694332542e2fbd4?s=32&amp;d=identicon&amp;r=g" alt="mengsunny's gravatar image" />
    <p><a href="/users/4613/mengsunny">mengsunny</a><br/>
    <span class="score" title="11 reputation points">11</span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">&#9679;</span><span class="badgecount">4</span></span><span title="6 badges"><span class="bronze">&#9679;</span><span class="badgecount">6</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mengsunny has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-20633">
    
        <a name="20634"></a>
        <div class="comment" id="comment-20634">
            <div id="post-20634-score" class="comment-score"></div>
            <div class="comment-text"><p>In the client side capture MSS value is 1460.
In the server side capture MSS value is 1380.
Whether the intermediate network device to change the TCP MSS</p></div>
            <div class="comment-info" id="comment-20634-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 09:58)</span>
                <a class="comment-user userinfo" href="/users/4613/mengsunny">mengsunny</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-20633" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-20633-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="20635"></a>
                    <div id="answer-container-20635" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-20635-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/20635/up/" rel="nofollow"> </a>
<div id="post-20635-score" class="post-score"
    title="current number of votes">
    3
</div>
<a id="post-20635-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/20635/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>There has to be a device sitting in the middle has changed the MSS value, since not only the MSS is changed but also the initial sequence number. So this looks like a transparent proxy of some sort, which you may be able to verify by sending an HTTP TRACE request. If the server responds to it it will echo back the request parameters the server got and display them in your browser (guessing that it is a Web server from port 443 being used).</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/20635/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>19 Apr '13, 10:02</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
    <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
    <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jasper has 263 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-20635">
    
        <a name="20637"></a>
        <div class="comment" id="comment-20637">
            <div id="post-20637-score" class="comment-score"></div>
            <div class="comment-text"><p>In the middle of the client and the server in a IPSEC VPN tunnel,but not have a transparent proxy.</p></div>
            <div class="comment-info" id="comment-20637-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 10:11)</span>
                <a class="comment-user userinfo" href="/users/4613/mengsunny">mengsunny</a>
                
            </div>
        </div>
    
        <a name="20638"></a>
        <div class="comment" id="comment-20638">
            <div id="post-20638-score" class="comment-score"></div>
            <div class="comment-text"><p>This environment will cause the change of MSS value</p></div>
            <div class="comment-info" id="comment-20638-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 10:12)</span>
                <a class="comment-user userinfo" href="/users/4613/mengsunny">mengsunny</a>
                
            </div>
        </div>
    
        <a name="20640"></a>
        <div class="comment" id="comment-20640">
            <div id="post-20640-score" class="comment-score"></div>
            <div class="comment-text"><ul>
<li>edited: [IPSEC tunnels (basically routers with next hop encryption) usually do not modify layer 4 information, but it may be still possible] not correct, see comment of <a href="/users/5/syn-bit"></a><a href="/users/5/syn-bit">@SYN-bit</a> - . You need to determine all devices in the path and what they're configured to do with layer 4 information.</li>
</ul></div>
            <div class="comment-info" id="comment-20640-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 11:08)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="20641"></a>
        <div class="comment" id="comment-20641">
            <div id="post-20641-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/145/jasper"></a><a href="/users/145/jasper">@Jasper</a>, it is best practice in IPsec tunneling to adjust the MSS of TCP sessions to prevent fragmentation at the IP layer due to the encapsulation.</p>

<p>Cisco even takes this further and by default changes the MSS of TCP sessions to 1380 on the FWSM and ACE blades.</p>

<p>See for instance:</p>

<ul>
<li><a href="http://www.cisco.com/en/US/tech/tk827/tk369/technologies_white_paper09186a00800d6979.shtml">http://www.cisco.com/en/US/tech/tk827/tk369/technologies_white_paper09186a00800d6979.shtml</a></li>
<li><a href="http://www.firstdigest.com/2010/09/cisco-how-can-mss-help-to-solve-issues-in-vpn-communication/">http://www.firstdigest.com/2010/09/cisco-how-can-mss-help-to-solve-issues-in-vpn-communication/</a></li>
<li><a href="http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB6346">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB6346</a></li>
</ul></div>
            <div class="comment-info" id="comment-20641-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 12:18)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="20644"></a>
        <div class="comment" id="comment-20644">
            <div id="post-20644-score" class="comment-score"></div>
            <div class="comment-text"><p>Makes sense, I guess, I just haven't seen many traces like that before :) I was just wondering why a device would also create a new inital sequence number - and it led me to the assumption that there is some kind of proxying involved.</p></div>
            <div class="comment-info" id="comment-20644-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 15:03)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="20645"></a>
        <div class="comment not_top_scorer" id="comment-20645">
            <div id="post-20645-score" class="comment-score"></div>
            <div class="comment-text"><p>That's also a cisco FW feature for the ol'days when systems still used 0 as ISN. Cisco firewalls randomize the ISN for the internal hosts... And guess what, that's why they could not handle SACK in the past (or maybe they still don't?). You can turn the ISN randomization of though :-)</p></div>
            <div class="comment-info" id="comment-20645-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 16:19)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="20648"></a>
        <div class="comment not_top_scorer" id="comment-20648">
            <div id="post-20648-score" class="comment-score"></div>
            <div class="comment-text"><p>Thank you very much for your help, I will continue to eliminate do operation for 4 layer equipment possible path.</p></div>
            <div class="comment-info" id="comment-20648-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '13, 20:17)</span>
                <a class="comment-user userinfo" href="/users/4613/mengsunny">mengsunny</a>
                
            </div>
        </div>
    
        <a name="20651"></a>
        <div class="comment not_top_scorer" id="comment-20651">
            <div id="post-20651-score" class="comment-score"></div>
            <div class="comment-text"><p>Your answer has been converted to a comment as that's how this site works. Please read the FAQ for more information.</p>

<p>If an answer has solved your issue, please accept the answer for the benefit of other users by clicking the checkmark icon next to the answer. Please read the FAQ for more information.</p></div>
            <div class="comment-info" id="comment-20651-info">
                
                
                
                

                

                <span class="comment-age">(20 Apr '13, 05:23)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="20669"></a>
        <div class="comment not_top_scorer" id="comment-20669">
            <div id="post-20669-score" class="comment-score"></div>
            <div class="comment-text"><p>Hm, interesting to see that the windows client is NOT honoring the reduced MSS of 1380 but sends a tcp.len==1477 segment in frame.number 13. This packet also exceeds the client's MTU size by 17 bytes...
The re-transmission in #15 after 314 ms is then using the smaller - learned by PMTUD? - MTU size and this packet goes  through. 
Is this 'segmentation offload' or is this normal windows behaviour?</p></div>
            <div class="comment-info" id="comment-20669-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 06:07)</span>
                <a class="comment-user userinfo" href="/users/4708/mreede2">mrEEde2</a>
                
            </div>
        </div>
    
        <a name="20670"></a>
        <div class="comment not_top_scorer" id="comment-20670">
            <div id="post-20670-score" class="comment-score"></div>
            <div class="comment-text"><p>It does honor it as far as I can tell. Keep in mind that the trace taken on the client side was taken <strong>on the client</strong>. That means that you deal with "oversized" segments because of segmentation offloading. Check the server side to see that the MSS of 1380 is never violated.</p></div>
            <div class="comment-info" id="comment-20670-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 06:14)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="20671"></a>
        <div class="comment not_top_scorer" id="comment-20671">
            <div id="post-20671-score" class="comment-score"></div>
            <div class="comment-text"><p>The large segment never makes it to the server. 
So if TSO is enabled, the ethernet card does not look at the 'learned' MSS but sends out too large segments requiring a retransmission with the new (PMTUD learned) MTU size. So we'll always have to wait for the retransmission timer to pop - not good for performance.</p></div>
            <div class="comment-info" id="comment-20671-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 06:26)</span>
                <a class="comment-user userinfo" href="/users/4708/mreede2">mrEEde2</a>
                
            </div>
        </div>
    
        <a name="20673"></a>
        <div class="comment not_top_scorer" id="comment-20673">
            <div id="post-20673-score" class="comment-score"></div>
            <div class="comment-text"><p>I agree with <a href="/users/145/jasper">@Jasper</a> that TSO is indeed enabled, as you can see that the 1477 bytes of TCP data from (clienttrace) frame 13 is split into 1380 bytes (missing in the server trace) and 97 bytes in frame 25 (servertrace).</p>

<p>The real problem is why the frame with 1380 bytes of TCP data did not get through, as this is conform the advertised MSS. Please see my separate answer for a possible cause.</p></div>
            <div class="comment-info" id="comment-20673-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 06:37)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="20674"></a>
        <div class="comment not_top_scorer" id="comment-20674">
            <div id="post-20674-score" class="comment-score"></div>
            <div class="comment-text"><p>Right, I was only checking tcp.len on the server side, and ignore the packet loss - my bad. Looks indeed like the segmentation offloading of the client doesn't consider MSS until it is forced to retransmit. Or it does, as SYN-bit mentioned - I think I need to clear my head and look through this again some time. These sequence number replacement mechanisms give me a headache :)</p></div>
            <div class="comment-info" id="comment-20674-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 06:40)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="20677"></a>
        <div class="comment not_top_scorer" id="comment-20677">
            <div id="post-20677-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/4613/mengsunny">@mengsunny</a>: What kind (brand, modell) of VPN device is involved?</p></div>
            <div class="comment-info" id="comment-20677-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 08:04)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="20678"></a>
        <div class="comment not_top_scorer" id="comment-20678">
            <div id="post-20678-score" class="comment-score"></div>
            <div class="comment-text"><p>to answer my own question :-)</p>

<p>Based on the ICMP "fragmentation needed" message (frame #57), I conclude, that the sending device (21.238.5.11) used a TTL of 255. <a href="http://www.netresec.com/?page=Blog&amp;month=2011-11&amp;post=Passive-OS-Fingerprinting">As Cisco routers (and possibly Cisco ASA as well) are using that TTL value</a>, I assume it's some Cisco IPSEC device and then the explanation of <a href="/users/5/syn-bit"></a><a href="/users/5/syn-bit">@SYN-bit</a> sounds pretty reasonable.</p></div>
            <div class="comment-info" id="comment-20678-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '13, 08:17)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-20635" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 15
        </span>
        <a href="#" class="show-all-comments-link">show 10 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-20635-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="20672"></a>
                    <div id="answer-container-20672" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-20672-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/20672/up/" rel="nofollow"> </a>
<div id="post-20672-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-20672-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/20672/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The traces look a lot like traces I have made before for a customer where things did not work properly. In the end it was the IPsec configuration on the Cisco routers that caused the issue. You could check whether the crypto map is applied to the tunnel interface instead (or as well as) the physical interface. In my case the solution was to have the crypto map on the physical interface only.</p>
<p>Please look for "ICMP Fragmentation needed but DF bit set" messages on the client side which suggest an MTU of 1433 (which corresponds to an MSS of 1379 instead of 1380). That was what we were facing back then and we created a Cisco case.</p>
<p>This was the response from Cisco-TAC in my case:</p>
<pre><code>So here's what we are seeing on the show crypto ipsec sa:
interface: Tunnel0
    Crypto map tag: GENVPN, local addr x.x.x.141 ...
     local crypto endpt.: x.x.x.141, remote crypto endpt.: y.y.y.206
     path mtu 1476, ip mtu 1476, ip mtu idb Tunnel0
     current outbound spi: 0x0(0)

This is incorrect. The ipsec SADB should only be associated with the physical interface, and not the Tunnel interface.
Because of that, we see that even for the g0/1 interface, the MTU is being computed from the Tunnel interface mtu:

interface: GigabitEthernet0/1
    Crypto map tag: GENVPN, local addr x.x.x.141

...
     local crypto endpt.: x.x.x.141, remote crypto endpt.: y.y.y.206
     path mtu 1476, ip mtu 1476, ip mtu idb Tunnel0
     current outbound spi: 0x0(0)

This is one of the "unexpected" results of having the crypto-map applied to the Tunnel interface. Because of that all the MTU computations are being done with basis the MTU of the GRE tunnel, wich is 24 less than the physical interface. 
I could reproduce the issue in the lab, and by provisioning the crypto-map on the physical interface, before provisionning it on the Tunnel, the MTU will be derived from the physical interface, until next reload. This is most probably what happened in your case, given the crash that we have identified.
Therefore the solution is quite simple, simply remove the crypto map statement from the tunnel interface configuration. You might need to clear all the crypto tunnels or reload the box, if the removal is not enough. In the lab removing the crypto map was enough, but I did not have redundancy configured, so please keep that in mind. Please keep in mind that this is an unsupported configuration as it is right now.
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/20672/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>21 Apr '13, 06:34</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/20672/">
                edited
                <strong>21 Apr '13, 06:52</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-20672">
    
</div>
<div id="comment-tools-20672" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-20672-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/20633/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='z6JHwzOnO2fV4wj2de3uXuvkOcITeEyP' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/20633/tcp-mss-inconsistency-in-different-capture-points?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tcp/"
            class="tag-link-tcp"
            title="see questions tagged'tcp'using tags"
            rel="tag">tcp</a> <span class="tag-number">&#215;752</span><br/>
        
        <a href="/tags/mss/"
            class="tag-link-mss"
            title="see questions tagged'mss'using tags"
            rel="tag">mss</a> <span class="tag-number">&#215;23</span><br/>
        
    </p>
    <p>
        question asked: <strong title="April 19, 2013, 9:55 a.m.">19 Apr '13, 09:55</strong>
    </p>
    <p> 
     	question was seen: <strong>6,304 times</strong>
    </p>
    <p> 
        last updated: <strong title="April 21, 2013, 8:30 a.m.">21 Apr '13, 08:30</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/4932/not-honoring-own-mss">Not honoring own MSS?</a>
        </p>
        
        <p>
            <a href="/questions/24316/tcp-window-size">TCP window Size</a>
        </p>
        
        <p>
            <a href="/questions/21491/how-tcp-handle-small-packets">How TCP handle small packets</a>
        </p>
        
        <p>
            <a href="/questions/32709/tcplen-and-datalen-missmatch">Tcp.len and data.len missmatch</a>
        </p>
        
        <p>
            <a href="/questions/42691/mss-value-negotiated-during-ftp-data-session-establishment-but-wireshark-shows-larger-blocks-sent-by-server">MSS value negotiated during ftp-data session establishment but wireshark shows larger blocks sent by server</a>
        </p>
        
        <p>
            <a href="/questions/63683/tcp-mss-in-uplink-and-downlink-speed">TCP MSS in uplink and downlink speed</a>
        </p>
        
        <p>
            <a href="/questions/9573/windows-7-ignores-tcp-mss">Windows 7 ignores TCP MSS</a>
        </p>
        
        <p>
            <a href="/questions/20917/tcp-mss-not-advertised-win2k8-r2-capture">TCP MSS not advertised Win2k8 r2 Capture</a>
        </p>
        
        <p>
            <a href="/questions/7659/tcp-packet-size">TCP packet size</a>
        </p>
        
        <p>
            <a href="/questions/230/displaying-all-tcp-connections-with-syn-packets">Displaying all TCP connections with SYN packets</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
