<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Wireshark SSL and TLSv1 protocol - Wireshark Q&amp;A</title>
        <meta name="description" content="Hello guys, I&#39;m working on the issue with my Nagios server. Nagios monitoring was working fine, but for few days already I see these errors: &quot;CHECK_NRPE: Error - Could not complete SSL handshake. &quot; But theses error not consistent. So, first it gives this error, but after 5 minutes check became OK. S..." />
        <meta name="keywords" content="ssl,wireshark,tlsv1" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/23449/wireshark-ssl-and-tlsv1-protocol" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='usGXCxZRBsq2w1idPsHG7Ti8gipZy1rb' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/23449/wireshark-ssl-and-tlsv1-protocol">Wireshark SSL and TLSv1 protocol</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-23449-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/23449/up/" rel="nofollow"> </a>
<div id="post-23449-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-23449-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/23449/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/23449/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hello guys,</p>
<p>I'm working on the issue with my Nagios server.
Nagios monitoring was working fine, but for few days already I see these errors:</p>
<p>"CHECK_NRPE: Error - Could not complete SSL handshake. "
But theses error not consistent. So, first it gives this error, but after 5 minutes check became OK.</p>
<p>So, I check my configuration, but as no changes was made in last time, find no issues as well.</p>
<p>So I try to analyse Nagios traffic with Wireshark. Mostly it look ok for me, but I find strange thing - when Nagios try to establish SSL handshake it sends packet with protocol shows in Wireshark as "SSL". It receive no answer. Then after a minute it sends the same packet for SSL handshake, but with TLSv1 ptotocol. And then it works fine.
<a href="http://piccy.info/view3/4921610/583ca764bdb98d778b0f605c3e0b3a22/orig/">http://piccy.info/view3/4921610/583ca764bdb98d778b0f605c3e0b3a22/orig/</a></p>
<p>So, question is - what is the difference between this SSL and TLSv1 protocols? As they look the same for me.</p>
<p><a href="http://www.cloudshark.org/captures/e957011a18ef">http://www.cloudshark.org/captures/e957011a18ef</a></p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/ssl/" class="post-tag tag-link-ssl"
                                        title="see questions tagged 'ssl'" rel="tag">ssl</a>
                                
                                    <a href="/tags/wireshark/" class="post-tag tag-link-wireshark"
                                        title="see questions tagged 'wireshark'" rel="tag">wireshark</a>
                                
                                    <a href="/tags/tlsv1/" class="post-tag tag-link-tlsv1"
                                        title="see questions tagged 'tlsv1'" rel="tag">tlsv1</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>30 Jul '13, 08:51</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/66025c5c90824d797445af9049474b81?s=32&amp;d=identicon&amp;r=g" alt="Macumazan's gravatar image" />
    <p><a href="/users/5372/macumazan">Macumazan</a><br/>
    <span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Macumazan has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-23449">
    
</div>
<div id="comment-tools-23449" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-23449-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="23458"></a>
                    <div id="answer-container-23458" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-23458-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/23458/up/" rel="nofollow"> </a>
<div id="post-23458-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-23458-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/23458/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The Client Hello is a TLS 1.0 handshake in both - tcp.stream eq 10 or tcp.stream eq 11 - connections.</p>
<p>The difference in the Protocol interpretation (SSL vs. TLSv1) is due to the fact that in stream 11 the negotiation does not complete and wireshark sets SSL in this case.</p>
<p>I extracted only the first 5 packets of tcp stream 10 and the Protocol field then changed to SSL also, when it was TLSv1 before with the full handshake.</p>
<p>So the real question is, why does the "server" send a FIN in the middle of the SSL handshake.
Looking at the RTT and TTL it is probably NOT the real server but maybe the riverbed appliance, but this is just a guess.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/23458/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>31 Jul '13, 00:05</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d6607c3aca20db751d019d8bbd2da893?s=32&amp;d=identicon&amp;r=g" alt="mrEEde2's gravatar image" />
    <p><a href="/users/4708/mreede2">mrEEde2</a><br/>
    <span class="score" title="336 reputation points">336</span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="6 badges"><span class="silver">&#9679;</span><span class="badgecount">6</span></span><span title="14 badges"><span class="bronze">&#9679;</span><span class="badgecount">14</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mrEEde2 has 5 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-23458">
    
        <a name="23470"></a>
        <div class="comment" id="comment-23470">
            <div id="post-23470-score" class="comment-score"></div>
            <div class="comment-text"><p>Thank you for a great explanation.</p></div>
            <div class="comment-info" id="comment-23470-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 01:54)</span>
                <a class="comment-user userinfo" href="/users/5372/macumazan">Macumazan</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-23458" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-23458-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="23464"></a>
                    <div id="answer-container-23464" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-23464-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/23464/up/" rel="nofollow"> </a>
<div id="post-23464-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-23464-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/23464/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>As <a href="/users/4708/mreede2">@mrEEde2</a> points out, the SSL version of the client hello is actually the same, it is the interpretation of Wireshark based on the rest of the session that makes it show SSL or TLSv1. So that is not the issue.</p>
<p>What I do see in your trace is that all traffic is sent to a TyanComp system with the mac address 00:e0:81:45:5c:a8 and that the return traffic either comes from a Cisco device with mac address 64:00:f1:c1:da:01 or from a Riverbed device with mac address 00:0e:b6:99:9e:e4. There is only one session that fails in the trace file. It is after a couple of sessions over the Cisco and before a couple of sessions over the Riverbed. As the Riverbed device is most likely a WAN optimizer, could it be that the tunnel to the remote location is flapping and that when Nagios polls while the tunnel is being rebuilt, the SSL session to the server 10.49.32.186 fails?</p>
<p>What is the LAN setup at the nagios side of the connection? </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/23464/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>31 Jul '13, 01:38</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" alt="SYN-bit's gravatar image" />
    <p><a href="/users/5/syn-bit">SYN-bit ♦♦</a><br/>
    <span class="score" title="17094 reputation points"><span class="">17.1k</span></span><span title="9 badges"><span class="badge1">&#9679;</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">&#9679;</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">&#9679;</span><span class="badgecount">245</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="SYN-bit has 174 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-23464">
    
        <a name="23471"></a>
        <div class="comment" id="comment-23471">
            <div id="post-23471-score" class="comment-score"></div>
            <div class="comment-text"><p>Thank you for the reply.
Traffic from Nagios goes to the router. Router sends packets to the WAN provider router through the Riverbed hardware. The same setup on the other side of the WAN.</p>

<p>I don't think that tunnel to other location is flapping, but is there a way to check this? I have access to routers before the Riverbed, but WAN provider routers is not accessible for me.</p></div>
            <div class="comment-info" id="comment-23471-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 02:01)</span>
                <a class="comment-user userinfo" href="/users/5372/macumazan">Macumazan</a>
                
            </div>
        </div>
    
        <a name="23472"></a>
        <div class="comment" id="comment-23472">
            <div id="post-23472-score" class="comment-score"></div>
            <div class="comment-text"><p>As the return packets from the Riverbed in stream 11 have a ip.ttl of 64, it looks like the Riverbed is directly connected to (in the same vlan/ip-subnet as) the Nagios server. Are you sure it is <em>behind</em> the router with the TyanComp mac-address (as seen from the Nagios server)?</p>

<p>Can you identify all mac-addresses in the trace (TyanComp and Cisco) and tell me which device uses which mac-address? What does a traceroute from Nagios to the server show and what does a traceroute from the server to Nagios show? Are the routers redundant? What kind of first hop redundancy protocol do you use (HSRP, VRRP, etc)?</p></div>
            <div class="comment-info" id="comment-23472-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 02:18)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="23473"></a>
        <div class="comment" id="comment-23473">
            <div id="post-23473-score" class="comment-score"></div>
            <div class="comment-text"><p>So, network is look like this:</p>

<p>Nagios -&gt; Host with Linux as router(<em>) -&gt; HP switch -&gt; Riverbed hardware -&gt; Verizon router(</em>) -&gt; ... WAN ... -&gt; Verizon router -&gt; Riverbed hardware -&gt; HP switch -&gt; Linux host as router -&gt; Nagios client</p>

<p>Cisco is the Verizon router(<em>)  <br>
TyanComp is Host with Linux as router(</em>)   <br>
</p>

<p>Traceroute from Nagios:    <br>
traceroute to 10.49.32.186 (10.49.32.186), 30 hops max, 40 byte packets    <br>
 1  10.32.240.92  0.197 ms  0.194 ms  0.191 ms -&gt; Linux router   <br>
 2  10.32.255.99  0.606 ms  0.605 ms  1.072 ms  -&gt; Verizon router   <br>
 3  *  3.579 ms  3.587 ms  3.586 ms   <br>
 4  *  19.380 ms  19.384 ms  19.873 ms   <br>
 5  *  37.538 ms  37.776 ms  38.008 ms   <br>
 6  10.49.32.186  37.529 ms  37.382 ms  37.359 ms   <br>
</p>

<p>Tracerouter from Nagios client:   <br>
traceroute to 10.32.241.141 (10.32.241.141), 30 hops max, 40 byte packets    <br>
 1  10.49.32.202  0.081 ms  0.062 ms  0.063 ms   <br>
 2  10.49.47.99  1.229 ms  1.451 ms  1.467 ms    <br>
 3  *  15.417 ms  15.539 ms  15.446 ms    <br>
 4  *  38.673 ms  38.908 ms  38.912 ms   <br>
 5  *  34.135 ms  34.131 ms  34.355 ms    <br>
 6  10.32.241.141  37.851 ms  38.078 ms  38.076 ms   <br>
</p>

<p>I think we don't use any redundancy protocols.</p></div>
            <div class="comment-info" id="comment-23473-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 03:54)</span>
                <a class="comment-user userinfo" href="/users/5372/macumazan">Macumazan</a>
                
            </div>
        </div>
    
        <a name="23474"></a>
        <div class="comment" id="comment-23474">
            <div id="post-23474-score" class="comment-score"></div>
            <div class="comment-text"><p>Is the Nagios host connected on the same HP switch? And is it on the same vlan as the Linux Router and the Riverbed?</p>

<p>What is the subnetmask used on the Nagios host, the linux router and the Verizon router? I suspect a subnet mask of 255.255.240.0, putting all devices in the same IP subnet and therefor creating asymetric routing. I bet step 5 in the reverse nagios trace was actually a response from the Verizon router (public interface).</p>

<p>Does the Verizon router point back to the Linux router (if it's subnet mask is smaller than 255.255.240.0)?</p>

<p>Regarding the flapping of the Riverbed tunnel, do you have access to the Riverbed device? Or can you contact someone with access to it to check whether there is anything in the logging at the times Nagios reports the server as down?</p></div>
            <div class="comment-info" id="comment-23474-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 04:11)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="23475"></a>
        <div class="comment" id="comment-23475">
            <div id="post-23475-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes, vlan the same for them. Nagios connected to the same switch.
Subnet mask is 255.255.240.0, yes.
5 step is Verizon router. It point to the Linux router.</p>

<p>Yes, I find that when Nagios show this error, Riverbed gives the error as well:</p>

<p>[io/inner/prod.ERR] 128089795 {10.32.241.141:60513 10.49.32.192:5666} Err while reading: Connection reset by peer</p>

<p>It's other host with the same error from today.</p></div>
            <div class="comment-info" id="comment-23475-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 04:30)</span>
                <a class="comment-user userinfo" href="/users/5372/macumazan">Macumazan</a>
                
            </div>
        </div>
    
        <a name="23476"></a>
        <div class="comment not_top_scorer" id="comment-23476">
            <div id="post-23476-score" class="comment-score"></div>
            <div class="comment-text"><p>OK, that indeed explains the asymmetric routing seen in the tracefile, as the verizon host is in the same subnet as the Nagios host it will send the return traffic straight to the Nagios host instead of the Linux router. </p>

<p>Although the reason for this design is not clear to me, I don't think it is the reason for the failing connections. It would be interesting to see a packet capture made on the Riverbed when this problem occurs. On both the inside interface (connected to the switch) and the outside interface (connected to the Verizon router). </p>

<p>I still suspect the Riverbed tunnel as the response time for the FIN after the Client Hello is ~11 ms, while the RTT in the 3-way-handshake was ~45 ms. This means the Riverbed must have decided to send the FIN without waiting on the response to the ClientHello from the other side.</p>

<p>Did you also make a packet capture on the remote side? It would be interesting to see what is seen on the network there (preferably also before and after the riverbed device).</p></div>
            <div class="comment-info" id="comment-23476-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 05:09)</span>
                <a class="comment-user userinfo" href="/users/5/syn-bit">SYN-bit ♦♦</a>
                
            </div>
        </div>
    
        <a name="23478"></a>
        <div class="comment not_top_scorer" id="comment-23478">
            <div id="post-23478-score" class="comment-score"></div>
            <div class="comment-text"><p>I think I found what was the cause -&gt; Riverbed hardware.
So after I check logs from Riverbed I find that it gives these type of errors sometime:</p>

<p>[admission_control.NOTICE] - {- -} Connection limit achieved. Total Connections 611,Branched Warmed Connections 0     <br>
Jul 31 15:37:38 sport[7943]: [admission_control.WARN] - {- -} Pausing intercept: Connection limit achieved;     <br>
Jul 31 15:37:38 sport[7943]: [admission_control.NOTICE] - {- -} Memory Usage: 1341 Current Connections: 611 TCP Memory Usage: 114;    <br>
</p>

<p>So looks like we have a limits of optimize connections - 611.
I put Nagios server to passthrough the optimize tunnel - don't see any ssl issues for now.</p>

<p>I will check this until tomorrow to see if issue is fixed.</p>

<p>It was very nice of you to help me figure this out!
It was like a lesson and vector to point me where I need to develop my network debugging skills :)</p></div>
            <div class="comment-info" id="comment-23478-info">
                
                
                
                

                

                <span class="comment-age">(31 Jul '13, 08:16)</span>
                <a class="comment-user userinfo" href="/users/5372/macumazan">Macumazan</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-23464" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-23464-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/23449/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='usGXCxZRBsq2w1idPsHG7Ti8gipZy1rb' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/23449/wireshark-ssl-and-tlsv1-protocol?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/wireshark/"
            class="tag-link-wireshark"
            title="see questions tagged'wireshark'using tags"
            rel="tag">wireshark</a> <span class="tag-number">&#215;1,620</span><br/>
        
        <a href="/tags/ssl/"
            class="tag-link-ssl"
            title="see questions tagged'ssl'using tags"
            rel="tag">ssl</a> <span class="tag-number">&#215;319</span><br/>
        
        <a href="/tags/tlsv1/"
            class="tag-link-tlsv1"
            title="see questions tagged'tlsv1'using tags"
            rel="tag">tlsv1</a> <span class="tag-number">&#215;23</span><br/>
        
    </p>
    <p>
        question asked: <strong title="July 30, 2013, 8:51 a.m.">30 Jul '13, 08:51</strong>
    </p>
    <p> 
     	question was seen: <strong>25,094 times</strong>
    </p>
    <p> 
        last updated: <strong title="July 31, 2013, 8:43 a.m.">31 Jul '13, 08:43</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/45220/having-trouble-decrypting-tlsv1-traffic-using-private-key-of-the-server">Having trouble decrypting TLSV1 traffic using private key of the server</a>
        </p>
        
        <p>
            <a href="/questions/21341/cant-save-the-decrypted-data-in-wireshark">Can&#39;t save the decrypted data in wireshark</a>
        </p>
        
        <p>
            <a href="/questions/38718/getting-strange-ssl-record-size">Getting strange SSL record size</a>
        </p>
        
        <p>
            <a href="/questions/15117/tls_empty_renegotiation_info_scsv-query">TLS_EMPTY_RENEGOTIATION_INFO_SCSV query</a>
        </p>
        
        <p>
            <a href="/questions/35600/not-able-to-configure-wireshark-with-gnutls">Not able to configure Wireshark with gnutls!</a>
        </p>
        
        <p>
            <a href="/questions/28145/cant-decrypt-ssl-in-capture-from-windump">Can&#39;t decrypt ssl in capture from windump</a>
        </p>
        
        <p>
            <a href="/questions/13610/problem-decoding-sip-tls-only-one-side-decoded">problem decoding SIP TLS - only one side decoded</a>
        </p>
        
        <p>
            <a href="/questions/17341/wireshark-fails-to-decipher-application-data-out-of-ssl">Wireshark fails to decipher application data out of SSL</a>
        </p>
        
        <p>
            <a href="/questions/37949/examples-of-wireshark-dissectors-run-on-top-of-ssl">Examples of Wireshark dissectors run on top of SSL</a>
        </p>
        
        <p>
            <a href="/questions/40386/some-detective-expert-help-needed-puzzle-with-lost-packets">Some detective expert help needed: puzzle with lost packets</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
