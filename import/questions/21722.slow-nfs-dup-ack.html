<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Slow NFS dup ack - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, I am experiencing slow performance from my VNX NFS server (primarily reads). When performing a TCP capture on the VNX (server) and HP (client) I notice there are many &quot;dup ack&quot; and &quot;out of order&quot; packets. Currently I have jumbo frames configured on both the VNX and HP servers, I have been assure..." />
        <meta name="keywords" content="dup-ack" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/21722/slow-nfs-dup-ack" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/21722/slow-nfs-dup-ack?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='sV5BMulR8xVhY363dEFkpbQfsfYbyS2x' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/21722/slow-nfs-dup-ack">Slow NFS dup ack</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-21722-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21722/up/" rel="nofollow"> </a>
<div id="post-21722-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-21722-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21722/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/21722/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi,</p>
<p>I am experiencing slow performance from my VNX NFS server (primarily reads).
When performing a TCP capture on the VNX (server) and HP (client) I notice there are many "dup ack" and "out of order" packets.
Currently I have jumbo frames configured on both the VNX and HP servers, I have been assured that jumbo frames are configured on all switches between the devices.  The only verification I can perform is a ping? (I'm not sure if this is a valid test?)</p>
<pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b4c6dbdbc0f4fce4">[email&#160;protected]</a> ~]# ping -s 9000 10.230.61.77
PING 10.230.61.77 (10.230.61.77) 9000(9028) bytes of data.
9008 bytes from 10.230.61.77: icmp_seq=1 ttl=255 time=0.384 ms
9008 bytes from 10.230.61.77: icmp_seq=2 ttl=255 time=0.380 ms
9008 bytes from 10.230.61.77: icmp_seq=3 ttl=255 time=0.364 ms
</code></pre>
<p>Here is a sample output from the client and server, any ideas what is causing this?</p>
<pre><code>NFS Server (VNX 5300)
New Column Time        Source                Destination           Protocol Length Info                                                            No.
   163 4.527343    10.230.61.77          10.230.61.9           TCP      62702  [TCP segment of a reassembled PDU]                              62702
   164 4.527343    10.230.61.77          10.230.61.9           NFS      3098   V3 READ Reply (Call In 162) Len:65536                           3098
   165 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=545641 Win=10183 Len=0 TSval=326998566 TSecr=30912434 66
   166 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=563537 Win=10183 Len=0 TSval=326998566 TSecr=30912434 66
   167 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=581433 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   168 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=593413 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   169 4.527343    10.230.61.9           10.230.61.77          NFS      230    V3 READ Call (Reply In 243), FH:0x0eefae18 Offset:1572864 Len:65536 230
   170 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6905 Ack=611309 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   171 4.527343    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6905 Ack=629205 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   172 4.527343    10.230.61.77          10.230.61.9           TCP      62702  [TCP segment of a reassembled PDU]                              62702
   173 4.527343    10.230.61.77          10.230.61.9           NFS      3098   V3 READ Reply (Call In 107) Len:65536                           3098
   174 4.527343    10.230.61.9           10.230.61.77          TCP      78     760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=668029 78
   175 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#1] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=676977 78
   176 4.527343    10.230.61.77          10.230.61.9           TCP      9014   [TCP Out-Of-Order] [TCP segment of a reassembled PDU]           9014
   177 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#2] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=685925 78
   178 4.527343    10.230.61.77          10.230.61.9           TCP      9014   [TCP Out-Of-Order] [TCP segment of a reassembled PDU]           9014
   179 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#3] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=694873 78
   180 4.527343    10.230.61.77          10.230.61.9           TCP      3098   [TCP Out-Of-Order] [TCP segment of a reassembled PDU]           3098
   181 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#4] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=703821 78
   182 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#5] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=712769 78
   183 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#6] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=721717 78
   184 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#7] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=724749 78
   185 4.527343    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 174#8] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=733697 78

NFS Client (HP ProLiant DL360p Gen8)
New Column Time        Source                Destination           Protocol Length Info                                                            No.
   209 4.527618    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=545641 Win=10183 Len=0 TSval=326998566 TSecr=30912434 66
   210 4.527678    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   211 4.527750    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   212 4.527763    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=563537 Win=10183 Len=0 TSval=326998566 TSecr=30912434 66
   213 4.527822    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   214 4.527894    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   215 4.527907    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=581433 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   216 4.527978    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   217 4.527990    10.230.61.77          10.230.61.9           NFS      3098   V3 READ Reply (Call In 126) Len:65536                           3098
   218 4.527998    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6741 Ack=593413 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   219 4.528012    10.230.61.9           10.230.61.77          NFS      230    V3 READ Call (Reply In 340), FH:0x0eefae18 Offset:1572864 Len:65536 230
   220 4.528064    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   221 4.528136    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   222 4.528149    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6905 Ack=611309 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   223 4.528209    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   224 4.528281    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   225 4.528294    10.230.61.9           10.230.61.77          TCP      66     760 &gt; nfs [ACK] Seq=6905 Ack=629205 Win=10183 Len=0 TSval=326998567 TSecr=30912434 66
   226 4.528353    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   227 4.528426    10.230.61.77          10.230.61.9           TCP      9014   [TCP Previous segment not captured] [TCP segment of a reassembled PDU] 9014
   228 4.528438    10.230.61.9           10.230.61.77          TCP      78     760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=668029 78
   229 4.528498    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   230 4.528509    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#1] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=676977 78
   231 4.528570    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   232 4.528580    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#2] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=685925 78
   233 4.528642    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   234 4.528652    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#3] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=694873 78
   235 4.528715    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   236 4.528725    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#4] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998567 TSecr=30912434 SLE=659081 SRE=703821 78
   237 4.528787    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   238 4.528798    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#5] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=712769 78
   239 4.528870    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   240 4.528880    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#6] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=721717 78
   241 4.528884    10.230.61.77          10.230.61.9           NFS      3098   V3 READ Reply (Call In 206) Len:65536                           3098
   242 4.528889    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#7] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=724749 78
   243 4.528959    10.230.61.77          10.230.61.9           TCP      9014   [TCP segment of a reassembled PDU]                              9014
   244 4.528970    10.230.61.9           10.230.61.77          TCP      78     [TCP Dup ACK 228#8] 760 &gt; nfs [ACK] Seq=6905 Ack=638153 Win=10164 Len=0 TSval=326998568 TSecr=30912434 SLE=659081 SRE=733697 78
</code></pre>
<ul>
<li>edit - akismet thinks im pasting spam :/ so here is my reply *</li>
</ul>
<p>Packet captures:-
VNX
<a href="http://cloudshark.org/captures/1f8ff433f45c">http://cloudshark.org/captures/1f8ff433f45c</a>
HP server
<a href="http://cloudshark.org/captures/5d0ae1a8c89f">http://cloudshark.org/captures/5d0ae1a8c89f</a></p>
<p>Here are the new pings, it looks like the packets are being fragmented after 8973 bytes?
I know the servers are set to 9000 MTU and the switches are said to be set to 9044 MTU.</p>
<pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bfcdd0d0cbfff7ef">[email&#160;protected]</a> ~]# ping -M do -s 8972 10.230.61.77
PING 10.230.61.77 (10.230.61.77) 8972(9000) bytes of data.
8980 bytes from 10.230.61.77: icmp_seq=1 ttl=255 time=0.351 ms
8980 bytes from 10.230.61.77: icmp_seq=2 ttl=255 time=0.367 ms
8980 bytes from 10.230.61.77: icmp_seq=3 ttl=255 time=0.347 ms

[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cab8a5a5be8a829a">[email&#160;protected]</a> ~]# ping -M do -s 8973 10.230.61.77
PING 10.230.61.77 (10.230.61.77) 8973(9001) bytes of data.
From 10.230.61.9 icmp_seq=1 Frag needed and DF set (mtu = 9000)
From 10.230.61.9 icmp_seq=1 Frag needed and DF set (mtu = 9000)
From 10.230.61.9 icmp_seq=1 Frag needed and DF set (mtu = 9000)
</code></pre>
<ul>
<li>edit 05/06/2013*</li>
</ul>
<p>Thanks very much for the input so far, it is evident that packets are being lost from 10.230.61.77 (VNX) to 10.230.61.9 (HP Server).
I have managed to get the switch config for the ports where these devices patch into and I have noticed that we have flow control (pause enabled) for all the ports except the VNX which has flow control disabled.
Isn't it best to enable flow control throughout?</p>
<p>The setup is as follows:-
VNX -(10Gb)- switch -(10 Gb)- switch -(1 Gb)- HP Server</p>
<p>EMC VNX:-</p>
<pre><code>Broadcom 10 Gigabit Ethernet Controller
0:  fxg-1-0  IRQ: 24
txflowctl=disable rxflowctl=disable
Link: Up
0:  fxg-1-1  IRQ: 25
txflowctl=disable rxflowctl=disable
Link: Up
</code></pre>
<p>VNX switch port:-</p>
<pre><code>interface port 1/28
pause enable
switchport mode trunk
switchport trunk add 10-11,20-21,4078
flooding dlf enable
flooding mc enable
flooding bc enable
flooding limit 100000
</code></pre>
<p>HP switch port:-</p>
<pre><code>interface port 1/8
pause enable
switchport mode trunk
switchport trunk native 11
switchport trunk add 10
</code></pre>
<p>HP Server:-</p>
<pre><code>[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aedcc1c1daeee6fe">[email&#160;protected]</a> ~]# ethtool -a eth4
Pause parameters for eth4:
Autonegotiate:  on
RX:             on
TX:             on
</code></pre>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/dup-ack/" class="post-tag tag-link-dup-ack"
                                        title="see questions tagged 'dup-ack'" rel="tag">dup-ack</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>03 Jun '13, 19:19</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/1ce649a675fca2f5c781be34d79582c8?s=32&amp;d=identicon&amp;r=g" alt="elfelvin's gravatar image" />
    <p><a href="/users/5063/elfelvin">elfelvin</a><br/>
    <span class="score" title="11 reputation points">11</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">&#9679;</span><span class="badgecount">3</span></span><span title="4 badges"><span class="bronze">&#9679;</span><span class="badgecount">4</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="elfelvin has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/21722/">
                edited
                <strong>04 Jun '13, 22:17</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-21722">
    
        <a name="21724"></a>
        <div class="comment" id="comment-21724">
            <div id="post-21724-score" class="comment-score"></div>
            <div class="comment-text"><p>Could you upload the capture from a file to cloudshark and post the URL? Should be a lot easier to read through (<a href="http://cloudshark.org/).">http://cloudshark.org/).</a> Duplicate acks here effectively mean that 10.230.61.9 detects packet loss for this TCP session and is pushing for a retransmission.</p>

<p>For the ping test, could you try setting the do-not-fragment flag? I believe that's either <code>-M dont</code> or <code>-D</code> flag depending.</p></div>
            <div class="comment-info" id="comment-21724-info">
                
                
                
                

                

                <span class="comment-age">(03 Jun '13, 19:32)</span>
                <a class="comment-user userinfo" href="/users/4985/quadratic">Quadratic</a>
                
            </div>
        </div>
    
        <a name="21725"></a>
        <div class="comment" id="comment-21725">
            <div id="post-21725-score" class="comment-score"></div>
            <div class="comment-text"><p>I cannot add a comment, akismet thinks im pasting spam.  I have edited the main post with details</p></div>
            <div class="comment-info" id="comment-21725-info">
                
                
                
                

                

                <span class="comment-age">(03 Jun '13, 20:20)</span>
                <a class="comment-user userinfo" href="/users/5063/elfelvin">elfelvin</a>
                
            </div>
        </div>
    
        <a name="21726"></a>
        <div class="comment" id="comment-21726">
            <div id="post-21726-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks.</p>

<p>10.232.61.9 is saying that it has to fragment, which I believe is your HP client, since it's the IP with the false checksum errors in the client-side trace file. It might have negotiated PMTU from upstream, otherwise I'd check the network card settings and support for jumbo frames on that client.</p>

<p>From the "edited" name in the files, how have they been changed? There are ACKs for missing segments through the VNX trace, meaning that the traffic actually did happen but this capture file didn't get it. There is definitely actual packet loss observed from the client too, with those duplicate ACKs, despite the trace file not having all the packets that the two systems actually saw.</p>

<p>How is CPU looking on these systems during the performance issues? With a large amount of packets, all fragmented, the processor may be being taxed which could also explain why the local packet capture is missing packets that had to have happened (the acks for segments not in the trace).</p></div>
            <div class="comment-info" id="comment-21726-info">
                
                
                
                

                

                <span class="comment-age">(03 Jun '13, 21:52)</span>
                <a class="comment-user userinfo" href="/users/4985/quadratic">Quadratic</a>
                
            </div>
        </div>
    
        <a name="21757"></a>
        <div class="comment" id="comment-21757">
            <div id="post-21757-score" class="comment-score"></div>
            <div class="comment-text"><p>I still cannot post responses. I have updated my main post.</p></div>
            <div class="comment-info" id="comment-21757-info">
                
                
                
                

                

                <span class="comment-age">(04 Jun '13, 22:23)</span>
                <a class="comment-user userinfo" href="/users/5063/elfelvin">elfelvin</a>
                
            </div>
        </div>
    
        <a name="21939"></a>
        <div class="comment" id="comment-21939">
            <div id="post-21939-score" class="comment-score"></div>
            <div class="comment-text"><p>I have compared a working NFS pcap to my "slow" one and noticed that after packet 30 (ie where the export gets mounted) there is no 3 way handshake with the NFS server and it seems like the window size is about ~24000 whereas the working capture is using a window size of ~139000.
I am using the same client but to different VNX servers to test this scenario.</p>

<p>My question is, why / how is the NFS client still talking with the server even though there is no 3 way handshake?
Is it possible that because this handshake is missing that the TCP window size was never updated, and this is what is causing my slow response?</p>

<p>The capture starts before I mount the export so there is no chance I would have missed it.</p>

<p>Any NFS gurus out there?</p></div>
            <div class="comment-info" id="comment-21939-info">
                
                
                
                

                

                <span class="comment-age">(11 Jun '13, 19:25)</span>
                <a class="comment-user userinfo" href="/users/5063/elfelvin">elfelvin</a>
                
            </div>
        </div>
    
        <a name="21940"></a>
        <div class="comment not_top_scorer" id="comment-21940">
            <div id="post-21940-score" class="comment-score"></div>
            <div class="comment-text"><p>If you don't have the three-way handshake in the trace, how are you determining the receive window size? You need the handshake to say what the window scale factor is.</p>

<p>Was the session ever actually torn down? If you don't have the three-way handshake but see TCP data sent between the hosts, either the session already existed before you started the trace or the trace somehow did not capture the handshake. Rest assured, if there is no three-way handshake there is no TCP session, so it definitely happened if you're seeing TCP data segments.</p>

<p>Edit: I'm also going to delete my old answer since this isn't quite answered conclusively yet it appears. Can you post the comparison traces of good and bad? The "bad" trace you first uploaded definitely had packet loss, and determining the source of that will hopefully lead to the source of the problem. Moving Wireshark to the switch upstream from the client may be one possible way to start pinpointing it.</p></div>
            <div class="comment-info" id="comment-21940-info">
                
                
                
                

                

                <span class="comment-age">(11 Jun '13, 20:16)</span>
                <a class="comment-user userinfo" href="/users/4985/quadratic">Quadratic</a>
                
            </div>
        </div>
    
        <a name="26997"></a>
        <div class="comment not_top_scorer" id="comment-26997">
            <div id="post-26997-score" class="comment-score"></div>
            <div class="comment-text"><p>elfelvin - did you resolve this and if so, how? We have a similar issue with our VNX using 10Gb to talk to "HP" boxes. </p></div>
            <div class="comment-info" id="comment-26997-info">
                
                
                
                

                

                <span class="comment-age">(14 Nov '13, 05:20)</span>
                <a class="comment-user userinfo" href="/users/6078/ou812">ou812</a>
                
            </div>
        </div>
    
        <a name="38367"></a>
        <div class="comment not_top_scorer" id="comment-38367">
            <div id="post-38367-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi,
Sorry for taking so long to reply, but the issue was with a buffer on the switch.
Basically VNX 10G -&gt; 10G Swith -&gt; 1G Switch -&gt; 1G HP interface</p>

<p>I can't remember the exact switch metric but looking at the switch port statistics where the HP server was patched into I could see a metric relating to dropped packets incrementing.  We spoke to the vendor and they acknowledged that going from a 10G switch to a 1G switch had this affect as the memory / buffer on the switch was not large enough to cope and thus it dropped the packets.</p>

<p>Regards,
Elvin</p></div>
            <div class="comment-info" id="comment-38367-info">
                
                
                
                

                

                <span class="comment-age">(05 Dec '14, 08:34)</span>
                <a class="comment-user userinfo" href="/users/5063/elfelvin">elfelvin</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-21722" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 8
        </span>
        <a href="#" class="show-all-comments-link">show 3 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-21722-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/21722/slow-nfs-dup-ack?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/21722/slow-nfs-dup-ack?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/21722/slow-nfs-dup-ack?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/21722/slow-nfs-dup-ack?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="21749"></a>
                    <div id="answer-container-21749" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-21749-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/21749/up/" rel="nofollow"> </a>
<div id="post-21749-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-21749-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/21749/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>The traffic is going from the server (VNX) 10.230.61.77:2049 towards the client (HP) .
The server is using tcp segmentation offload leaving it to the ethernet card to segment the data when it is sent over the ethernet. This actually does happen as the largest tcp.len that arrives at the client is tcp.len==8948 which fills the ip.len to a full jumbo frame.
As the session negotiated the tcp sack option we can use the tcp.options.sack_le gt 0 filter to find all reports of a lost segment. </p>
<p>The first lost segment reported missing by the client is is  tcp.seq == 638153. This 'segment' however was never seen as such at the VNX trace as tcp.dstport==760 and tcp.seq le 638153 shows. It was part of the 'large_send' segment with tcp.seq == 593413 and tcp.len == 62636. This is causing the wireshark logic to flag it as an "Out-of-Order" segment. BTW. "tcp segmentation offload" will also confuse wireshark by incoming acks for seq numbers that we never saw being sent...</p>
<p>Summary: The client trace clearly shows that packets are not arriving in the client's TCP stack. They are also missing in the clients trace, meaning they were never received from the interface. The missing packets are at the very end (#22-24) of a batch of 24 packets arriving basically at the same time.
So, a good guess is that they are dropped because of a insufficient queue size on the interfaces along the path - possibly at the HP client. </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/21749/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>04 Jun '13, 13:59</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d6607c3aca20db751d019d8bbd2da893?s=32&amp;d=identicon&amp;r=g" alt="mrEEde2's gravatar image" />
    <p><a href="/users/4708/mreede2">mrEEde2</a><br/>
    <span class="score" title="336 reputation points">336</span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="6 badges"><span class="silver">&#9679;</span><span class="badgecount">6</span></span><span title="14 badges"><span class="bronze">&#9679;</span><span class="badgecount">14</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mrEEde2 has 5 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-21749">
    
</div>
<div id="comment-tools-21749" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-21749-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/21722/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='sV5BMulR8xVhY363dEFkpbQfsfYbyS2x' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/21722/slow-nfs-dup-ack?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/21722/slow-nfs-dup-ack?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/dup-ack/"
            class="tag-link-dup-ack"
            title="see questions tagged'dup-ack'using tags"
            rel="tag">dup-ack</a> <span class="tag-number">&#215;42</span><br/>
        
    </p>
    <p>
        question asked: <strong title="June 3, 2013, 7:19 p.m.">03 Jun '13, 19:19</strong>
    </p>
    <p> 
     	question was seen: <strong>8,595 times</strong>
    </p>
    <p> 
        last updated: <strong title="Dec. 5, 2014, 8:34 a.m.">05 Dec '14, 08:34</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/17859/router-retransmitting-packets">router retransmitting packets</a>
        </p>
        
        <p>
            <a href="/questions/37738/what-is-causing-unable-to-write-data-to-the-transport-connection-an-existing-connection-was-forcibly-closed-by-the-remote-host">What is causing &quot;Unable to write data to the transport connection: An existing connection was forcibly closed by the remote host.&quot;</a>
        </p>
        
        <p>
            <a href="/questions/57901/slow-responses-between-2-servers">Slow responses between 2 servers</a>
        </p>
        
        <p>
            <a href="/questions/19975/lan-slowdown">LAN slowdown</a>
        </p>
        
        <p>
            <a href="/questions/37992/ack-packets-are-getting-dropped-causing-a-ftp-session-reset">Ack packets are getting dropped, causing a FTP session reset</a>
        </p>
        
        <p>
            <a href="/questions/58187/tcp-dup-ack">tcp dup ack</a>
        </p>
        
        <p>
            <a href="/questions/21006/tcp-dup-acktcp-retransmission">TCP DUP ACK/TCP Retransmission</a>
        </p>
        
        <p>
            <a href="/questions/38380/duplicate-ack-packets-being-received">Duplicate ACK packets being received.</a>
        </p>
        
        <p>
            <a href="/questions/58026/http-connection-reset">HTTP connection reset</a>
        </p>
        
        <p>
            <a href="/questions/22465/weird-stall-in-tcp-on-ps3">Weird stall in TCP on PS3</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
