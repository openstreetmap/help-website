<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Tshark Uses All Memory on Mavericks Triggering Out Of Application Memory Errors - Wireshark Q&amp;A</title>
        <meta name="description" content="I use tshark extensively to process pcap/pcapng files captures with wireshark. While tshark has always been a nasty memory hog, prior to Mavericks, this has not been an issue. Running tshark against even moderate captures files (&amp;lt;1GB) will trigger all kinds of nasty Mavericks specific memory issu..." />
        <meta name="keywords" content="out-of-memory,mavericks" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='Xej6pZK9NJjTquOZRpCib4EFWaMMMnRE' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors">Tshark Uses All Memory on Mavericks Triggering Out Of Application Memory Errors</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-31648-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/31648/up/" rel="nofollow"> </a>
<div id="post-31648-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-31648-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/31648/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/31648/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I use tshark extensively to process pcap/pcapng files captures with wireshark.</p>
<p>While tshark has always been a nasty memory hog, prior to Mavericks, this has not been an issue.</p>
<p>Running tshark against even moderate captures files (&lt;1GB) will trigger all kinds of nasty Mavericks specific memory issues.</p>
<p>For example, on Mavericks Quad Core MacPro with 22GB physical memory, processing a single 800MB for a single ip address filer will:</p>
<ul>
<li>drive tshark memory usage to 18GB</li>
<li>allocate a total of 80GB of virtual memory</li>
<li>trigger memory compression of other apps</li>
<li>lock tshark on an IO call, so it never actually finished</li>
<li>trigger a "Out of Application memory error" where Mavericks wants you to kill apps</li>
<li>killing tshark will return the memory stage of the system back to normal</li>
</ul>
<p>Is there an upcoming Mavericks specific build that may address this. 
At this stage, tshark is no longer usable on Mavericks.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/out-of-memory/" class="post-tag tag-link-out-of-memory"
                                        title="see questions tagged 'out-of-memory'" rel="tag">out-of-memory</a>
                                
                                    <a href="/tags/mavericks/" class="post-tag tag-link-mavericks"
                                        title="see questions tagged 'mavericks'" rel="tag">mavericks</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>08 Apr '14, 18:24</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/813ad867c1b9ae106790137c188eba50?s=32&amp;d=identicon&amp;r=g" alt="mhpcto's gravatar image" />
    <p><a href="/users/7077/mhpcto">mhpcto</a><br/>
    <span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="mhpcto has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/31648/">
                edited
                <strong>10 Apr '14, 11:50</strong>
            </a>
        </p>
        
            <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" alt="Hadriel's gravatar image" />
            <p><a href="/users/4318/hadriel">Hadriel</a><br/>
            <span class="score" title="2652 reputation points"><span class="">2.7k</span></span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">&#9679;</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">&#9679;</span><span class="badgecount">39</span></span></p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-31648">
    
        <a name="31650"></a>
        <div class="comment" id="comment-31650">
            <div id="post-31650-score" class="comment-score"></div>
            <div class="comment-text"><p>What exact release of wireshark?
Can you paste the output of "<code>tshark -v</code>" here?</p></div>
            <div class="comment-info" id="comment-31650-info">
                
                
                
                

                

                <span class="comment-age">(08 Apr '14, 19:32)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="31651"></a>
        <div class="comment" id="comment-31651">
            <div id="post-31651-score" class="comment-score"></div>
            <div class="comment-text"><p>Oh, and what command-line options are you giving tshark?</p></div>
            <div class="comment-info" id="comment-31651-info">
                
                
                
                

                

                <span class="comment-age">(08 Apr '14, 19:32)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="31724"></a>
        <div class="comment" id="comment-31724">
            <div id="post-31724-score" class="comment-score"></div>
            <div class="comment-text"><p>kumarogg:WiFi-Tests roland$ tshark -v
TShark 1.10.3 (SVN Rev 53022 from /trunk-1.10)</p>

<p>Copyright 1998-2013 Gerald Combs <a href="/cdn-cgi/l/email-protection#ee898b9c8f828aae99879c8b9d868f9c85c0819c89"><span class="__cf_email__" data-cfemail="7a1d1f081b161e3a0d13081f09121b08115415081d">[email&#160;protected]</span></a> and contributors.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>

<p>Compiled (64-bit) with GLib 2.36.0, with libpcap, with libz 1.2.3, without POSIX
capabilities, without libnl, with SMI 0.4.8, without c-ares, without ADNS, with
Lua 5.1, without Python, with GnuTLS 2.12.19, with Gcrypt 1.5.0, with MIT
Kerberos, with GeoIP.</p>

<p>Running on Mac OS X 10.9.2, build 13C64 (Darwin 13.1.0), with locale
en_US.UTF-8, with libpcap version 1.3.0 - Apple version 41, with libz 1.2.5.
Intel(R) Xeon(R) CPU           E5620  @ 2.40GHz</p>

<p>Built using llvm-gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build
2336.9.00).</p>

<p>Typically, I am extracting a range of stats, but the issue shows up even in the most simple case of a single IP address and transfer stats:</p>

<p>tshark -q -z 'io,stat,0.1,ip.addr==172.24.110.175' -r UDP_Sequence_10.pcapng &gt; UDP_Sequence_10.txt</p></div>
            <div class="comment-info" id="comment-31724-info">
                
                
                
                

                

                <span class="comment-age">(10 Apr '14, 10:48)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
        <a name="31726"></a>
        <div class="comment" id="comment-31726">
            <div id="post-31726-score" class="comment-score"></div>
            <div class="comment-text"><p>Can you try it with 1.10.6?  I have no idea if it would help, but there were bug fixes between 1.10.3 and 1.10.6.</p>

<p>Also, you said they were "Mavericks specific" - do you mean running the exact same Wireshark version on a non-Mavericks OSX doesn't have this problem?</p></div>
            <div class="comment-info" id="comment-31726-info">
                
                
                
                

                

                <span class="comment-age">(10 Apr '14, 11:50)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="31946"></a>
        <div class="comment" id="comment-31946">
            <div id="post-31946-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes, this is specific to Mavericks. I have been using the same version of tshark on both OSX 10.6 and 10.8 without the runaway memory consumption.</p>

<p>Using 1.10.6 only slightly changes behavior:</p>

<ol>
<li>tshark peak memory consumption is around 6GB (18GB with 1.10.3)</li>
<li>peak memory is 68GB (80GB with 1.10.3)</li>
<li>memory use increments slower (by about 50%)</li>
<li>kernel_task still peaks at 10GB</li>
<li>memory compression still kicks in</li>
<li>memory pressure still eventually reaches the red-zone and the system grinds to a halt</li>
<li>tshark itself still eventually goes down to 0% CPU and never completes and must be killed to restore </li>
</ol>

<p>What exacerbates the problem under Mavericks is the new "App Nap" feature. Due to tshark memory usage ballooning to 18GB, Mavericks will start to suspend a lot of apps and many of them (firefox, for example) will not gracefully wake. </p>

<p>As a workaround I can run tshark in a Parallels VM (allocated 4 cores and 4GB) running Debian, Fedora or CentOS and tshark will cleanly and quickly process the input file.</p></div>
            <div class="comment-info" id="comment-31946-info">
                
                
                
                

                

                <span class="comment-age">(17 Apr '14, 14:14)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
        <a name="31992"></a>
        <div class="comment not_top_scorer" id="comment-31992">
            <div id="post-31992-score" class="comment-score"></div>
            <div class="comment-text"><p>Sounds like a bug.  I suggest you submit a bug at <a href="https://bugs.wireshark.org">bugs.wireshark.org</a>, with all of the above information. And also attach an example pcap file if you're able to.</p></div>
            <div class="comment-info" id="comment-31992-info">
                
                
                
                

                

                <span class="comment-age">(19 Apr '14, 10:40)</span>
                <a class="comment-user userinfo" href="/users/4318/hadriel">Hadriel</a>
                
            </div>
        </div>
    
        <a name="32032"></a>
        <div class="comment not_top_scorer" id="comment-32032">
            <div id="post-32032-score" class="comment-score"></div>
            <div class="comment-text"><p>To further clarify that this is tshark only.</p>

<p>I can read the same pcapng file into wireshark 1.10.6 and that has no measurable impact on the memory footprint. wireshark-bin will allocate a bit under 1GB and fluctuate around that number regardless of how many filters I use, stats and IO graphs I generate, etc.</p>

<p>Does not increase what Apple calls memory pressure not does it affect app memory.</p></div>
            <div class="comment-info" id="comment-32032-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '14, 10:47)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-31648" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-31648-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="31997"></a>
                    <div id="answer-container-31997" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-31997-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/31997/up/" rel="nofollow"> </a>
<div id="post-31997-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-31997-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/31997/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>While this behavior <strong>could</strong> be a bug, I'm not sure it is one. Wireshark and tshark are known to consume large amount of memory with large capture files.</p>
<blockquote>
<p><a href="http://wiki.wireshark.org/KnownBugs/OutOfMemory">http://wiki.wireshark.org/KnownBugs/OutOfMemory</a></p>
</blockquote>
<p>However, a ratio 1:80 (1 Gig Capture file -&gt; 80 Gig RAM) look more like a big than anything else.</p>
<p><strong>Solution</strong>: Here is what you can do while the (possible) bug is under investigation. Besides your workaround with the virtual machine, you can run tcpdump to pre-filter the capture file.</p>
<blockquote>
<p>tcpdump -nr input.pcap -w output.pcap "host x.x.x.x or port y.y.y.y" </p>
</blockquote>
<p>Use whatever <strong>capture filter</strong> you may need to pre-filter the capture file and only then run tshark for statistics and/or other analysis tasks. That should at least make tshark again usable for you.</p>
<p>Regards <br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/31997/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>19 Apr '14, 15:08</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-31997">
    
        <a name="32043"></a>
        <div class="comment" id="comment-32043">
            <div id="post-32043-score" class="comment-score"></div>
            <div class="comment-text"><p>Unfortunately, I already tried this by:</p>

<pre><code>Using a minimal complexity capture (single IP source address filter)
Using a shortened capture file (10MB instead of the 800MB original)
Simplifying the io stat expression to once per second on the single IP address
</code></pre>

<p>The results are consistent in that:</p>

<pre><code>Size of the file doesn't matter
Samples extracted (1s vs 0.1s sampling) doesn't matter.
</code></pre>

<p>The following example is for sampling a 10MB PCAPNG file at 1s. I am showing the Memory allocation for tshark-bin and kernal_task at an interval of 5 seconds in GB:</p>

<p>Tshark - kernel_task</p>

<p></p><hr>
0 - 1.7 <hr> 0.4 - 1.7 <hr>4.0 - 1.7 <hr>6.6 - 1.7 <hr>10.3 - 1.7<hr> 10.7 - 1.7 <hr>10.1 - 1.7<hr> 9.5 - 1.7<hr> 8.9 - 1.7<hr> 7.5 - 5.7<hr> 6.9 - 5.7<hr> 5.8 - 5.7 <hr>5.2 - 5.7<hr> 4.6 - 5.7<hr> 4.1 - 9.7 <hr>3.1 - 9.7<hr> 2.8 - 9.7 <hr>2.9 - 9.7<hr> 3.1 - 9.8<hr> 3.1 - 9.8<hr> .... <hr>2.0 - 9.8<p></p>
<p>Repeated runs show that tshark, on this file, can peak at up to 14GB. This does not caus an increase in memory pressure. Memory pressure starts increasing as soon as memory growth of tshark and kernel_task invert. In other words, as soon as tshark memory allocation decreases and kernel_task memory increases, memory pressure shoots up, virtuall memory allocation and compressed memory start increasing until memory pressure reaches the red zoneand starts ti impact the whoile system.</p><p></p></div>
            <div class="comment-info" id="comment-32043-info">
                
                
                
                

                

                <span class="comment-age">(21 Apr '14, 17:00)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
        <a name="32048"></a>
        <div class="comment" id="comment-32048">
            <div id="post-32048-score" class="comment-score"></div>
            <div class="comment-text"><p>O.K. now it sounds like a problem with the tshark io stats function. </p>

<p>Can you please run the following command and check the RAM usage?</p>

<blockquote>
<p>tshark -nr input.pcapng -q</p>
</blockquote>

<p>while <strong>input.pcap</strong> is the already 'pre-filtered' capture file.</p>

<p>I just want to check if tshark (actually the dissector for the protocol) is exhausting the RAM or if it's the io stats function. If you don't see the same RAM usage with the above command, it's a problem with the io stats function. If you see the same problem, it's probably related to the dissector of the protocol.</p></div>
            <div class="comment-info" id="comment-32048-info">
                
                
                
                

                

                <span class="comment-age">(22 Apr '14, 01:48)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="32066"></a>
        <div class="comment" id="comment-32066">
            <div id="post-32066-score" class="comment-score"></div>
            <div class="comment-text"><p>Running tshark with the -qnr options, on any size capture file, does not lead to the described symptoms. Memory allocation is constant at  ~50MB. </p>

<p>Using tshark to capture live traffic, with or w/o capture filters, works fine as well, with a stable memory footprint. Simple, non io stat operations, like "-n -r /tmp/xxxf.pcap -T fields -e ip.src" are also stable.</p>

<p>I want to throw in a piece of tangential information:</p>

<p>I downloaded and build tshark 1.11.4. to build it on 10.8 and 10.9 and profile it. Didn't get around to that yet, but what I discovered is that 1.11.4 does not handle the simple test I used above for 1.10.6 -  "-n -r /tmp/xxxf.pcap -T fields -e ip.src" will not terminate and slowly increase memory by approx 1MB/sec. 1.10.6 parses the same 3MB capture in about 5sec. Guess I'll grab 1.10.6 instead.</p></div>
            <div class="comment-info" id="comment-32066-info">
                
                
                
                

                

                <span class="comment-age">(22 Apr '14, 11:52)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
        <a name="32118"></a>
        <div class="comment" id="comment-32118">
            <div id="post-32118-score" class="comment-score"></div>
            <div class="comment-text"><p>O.K. sounds like a bug in the io stats function of tshark. As <a href="/users/4318/hadriel">@Hadriel</a> already mentioned: Please file a bug report at <a href="https://bugs.wireshark.org">https://bugs.wireshark.org</a></p></div>
            <div class="comment-info" id="comment-32118-info">
                
                
                
                

                

                <span class="comment-age">(23 Apr '14, 12:00)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="32540"></a>
        <div class="comment" id="comment-32540">
            <div id="post-32540-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=10068">Bug #10068</a> filed.</p></div>
            <div class="comment-info" id="comment-32540-info">
                
                
                
                

                

                <span class="comment-age">(05 May '14, 11:47)</span>
                <a class="comment-user userinfo" href="/users/7077/mhpcto">mhpcto</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-31997" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-31997-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/31648/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='Xej6pZK9NJjTquOZRpCib4EFWaMMMnRE' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/31648/tshark-uses-all-memory-on-mavericks-triggering-out-of-application-memory-errors?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/mavericks/"
            class="tag-link-mavericks"
            title="see questions tagged'mavericks'using tags"
            rel="tag">mavericks</a> <span class="tag-number">&#215;18</span><br/>
        
        <a href="/tags/out-of-memory/"
            class="tag-link-out-of-memory"
            title="see questions tagged'out-of-memory'using tags"
            rel="tag">out-of-memory</a> <span class="tag-number">&#215;10</span><br/>
        
    </p>
    <p>
        question asked: <strong title="April 8, 2014, 6:24 p.m.">08 Apr '14, 18:24</strong>
    </p>
    <p> 
     	question was seen: <strong>3,102 times</strong>
    </p>
    <p> 
        last updated: <strong title="May 5, 2014, 4 p.m.">05 May '14, 16:00</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/8618/out-of-memory">Out Of Memory</a>
        </p>
        
        <p>
            <a href="/questions/29174/os-x-tens-of-bpf-devices">OS X tens of BPF devices</a>
        </p>
        
        <p>
            <a href="/questions/18052/capturing-on-windows-server-2003-runs-out-of-memory-very-quickly">Capturing on Windows Server 2003 runs out of memory very quickly</a>
        </p>
        
        <p>
            <a href="/questions/29345/wrong-start-file-chosen-for-x11-on-osx">Wrong start file chosen for X11 on OSX</a>
        </p>
        
        <p>
            <a href="/questions/20954/tshark-memory-consumption-increasing-continuously">tshark memory consumption increasing continuously</a>
        </p>
        
        <p>
            <a href="/questions/30979/can-i-move-the-wireshark-window-in-os-x-mavericks">Can I move the Wireshark window in OS X Mavericks?</a>
        </p>
        
        <p>
            <a href="/questions/25091/wireshark-tshark-out-of-memory-problem">Wireshark, tshark - Out of memory problem</a>
        </p>
        
        <p>
            <a href="/questions/31834/unable-to-launch-wireshark-in-mavericks">Unable to launch Wireshark in Mavericks</a>
        </p>
        
        <p>
            <a href="/questions/30873/some-workaround-about-out-of-memory-problem">Some workaround about out of memory problem</a>
        </p>
        
        <p>
            <a href="/questions/32065/unable-to-use-wireshark-gui-on-mavericks-1092">Unable to use Wireshark GUI on Mavericks 10.9.2</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
