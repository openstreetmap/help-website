<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>TCP Retransmission sending wrong sequence - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi,  I hope someone here can help. I have seen a strange problem where our server seems to be retransmitting the segment prior to the one being requested by the Duplicate ACKs sent by the client. The Duplicate ACK is requesting re-transmission: Acknowledgement number: 422281 (relative ack number) So..." />
        <meta name="keywords" content="retransmission" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/12145/tcp-retransmission-sending-wrong-sequence" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/12145/tcp-retransmission-sending-wrong-sequence?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='nfLtzz0y4BsIrpxFwoj3rdeEknPzUKql' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/12145/tcp-retransmission-sending-wrong-sequence">TCP Retransmission sending wrong sequence</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-12145-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12145/up/" rel="nofollow"> </a>
<div id="post-12145-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-12145-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12145/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/12145/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi, </p>
<p>I hope someone here can help. I have seen a strange problem where our server seems to be retransmitting the segment prior to the one being requested by the Duplicate ACKs sent by the client.</p>
<p>The Duplicate ACK is requesting re-transmission:
Acknowledgement number: 422281    (relative ack number)</p>
<p>Sometimes I see an ICMP packet being sent by the server after receipt of the Duplicate ACK, usually in response to the first five of these Duplicate ACKs, but can be later as well, in this particular case the last five received too :<br>
ICMP    94  Destination unreachable (Host administratively prohibited)</p>
<p>Then the server retransmit sends the previous sequence:<br>
Sequence number: 420901    (relative sequence number)<br>
Next sequence number: 422281    (relative sequence number)</p>
<p>This continues until the conversation peters out after about a minute. Has anyone seen anything like this before?</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/retransmission/" class="post-tag tag-link-retransmission"
                                        title="see questions tagged 'retransmission'" rel="tag">retransmission</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>25 Jun '12, 04:46</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/939e0e9467e1fd794cf46c50a73c7973?s=32&amp;d=identicon&amp;r=g" alt="Christian's gravatar image" />
    <p><a href="/users/2911/christian">Christian</a><br/>
    <span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="bronze">&#9679;</span><span class="badgecount">1</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Christian has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-12145">
    
        <a name="12146"></a>
        <div class="comment" id="comment-12146">
            <div id="post-12146-score" class="comment-score"></div>
            <div class="comment-text"><p>I should add that the ACK and duplicates mentioned above are SACK packets with the SRE incrementing with each DupACK until all in-flight data is received and the server starts to retransmit the packet in the sequence prior to number requested.</p></div>
            <div class="comment-info" id="comment-12146-info">
                
                
                
                

                

                <span class="comment-age">(25 Jun '12, 04:53)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12149"></a>
        <div class="comment" id="comment-12149">
            <div id="post-12149-score" class="comment-score"></div>
            <div class="comment-text"><p>Further I suspect that something between client and server is meddling with the packets as the SLE and SRE transmitted by the client in the SACK is not the same as the SLE and SRE seen by the server.</p>

<p>Sent by client:<br>
96194   TCP 66  tksocket &gt; http [ACK] Seq=883 Ack=422281 Win=65535 Len=0 SLE=447121 SRE=448501</p>

<p>Received by server:<br>
340552  TCP 66  25882 &gt; http [ACK] Seq=883 Ack=422281 Win=65535 Len=0 SLE=1186682302 SRE=1186683682</p></div>
            <div class="comment-info" id="comment-12149-info">
                
                
                
                

                

                <span class="comment-age">(25 Jun '12, 06:32)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-12145" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-12145-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/12145/tcp-retransmission-sending-wrong-sequence?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/12145/tcp-retransmission-sending-wrong-sequence?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/12145/tcp-retransmission-sending-wrong-sequence?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/12145/tcp-retransmission-sending-wrong-sequence?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="12147"></a>
                    <div id="answer-container-12147" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-12147-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/12147/up/" rel="nofollow"> </a>
<div id="post-12147-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-12147-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/12147/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Where did you capture? I guess at the client side. Do you have verified the behavior by capturing on the server side as well? I suspect there's a firewall or similar device with ACLs in the communication path  between client and server (the ICMP administratively prohibited indicates a "reject" rule existing somewhere). </p>
<p>If there is a firewall you need to verify first that the server actually gets the same TCP details that the client sent. A firewall might modify the TCP header in flight so that the server does not actually get the ACK numbers the client sent. Maybe it even removes the SACK options for whatever reason. So you need to make sure that the server sends data from before the last ACK number by verifying that behavior as close to the server as possible (but please not by capturing on the server itself, because that could give funny results, too). Don't forget to inspect and compare the SYN-SYN/ACK sequence at the beginning of the communication on both sides, because you might see that some TCP option negotiation is being influenced as well.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/12147/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>25 Jun '12, 06:09</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
    <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
    <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jasper has 263 accepted answers">18&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-12147">
    
        <a name="12150"></a>
        <div class="comment" id="comment-12150">
            <div id="post-12150-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks Jasper, I managed to get traces simultaneously from both client and server. The problem is the web server is virtual, in a hosted location in London and the client is accessing through the internet so I am restricted to captures on the endpoints. I'm trying to pinpoint what I think is problem in a local authorities ISP making it even harder to get details about what is happening to the packets en-route.</p>

<p>There are some differences in the SYN, SYN-ACK packets, the MSS is different at either end, the server MSS is 1380, the clients is 1460 , TTL is different too, 121 to 128. Otherwise the rest seems the same</p>

<p>The ICMP is being sent by the server, and seems to relate to some of the SACK packets with the rubbish SLE/SRE (ports 80 and 443 are open). I was wondering whether the ICMP was produced because the SLE/SRE can't possibly be correct for the file being transmitted? I can see no other purpose for this ICMP as the host is reachable. This ICMP is also not reaching the client. I know the ISP blocks ICMP through its network on 'security' grounds. </p></div>
            <div class="comment-info" id="comment-12150-info">
                
                
                
                

                

                <span class="comment-age">(25 Jun '12, 07:33)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12159"></a>
        <div class="comment" id="comment-12159">
            <div id="post-12159-score" class="comment-score"></div>
            <div class="comment-text"><p>what is the payload of the ICMP packet? What is your OS at the server? Is there any security software installed on that server? Reason: That ICMP message is rather seldom (even for firewalls), so there must be a reason for this, IF it belongs to your problem (TCP connection), hence the question about the payload.</p></div>
            <div class="comment-info" id="comment-12159-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 00:14)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12161"></a>
        <div class="comment" id="comment-12161">
            <div id="post-12161-score" class="comment-score"></div>
            <div class="comment-text"><p>regarding the broken SRE/SLE values. </p>

<p>Does this happen</p>

<ul>
<li>with every connection</li>
<li>some connections</li>
<li>some frames of one connection</li>
</ul></div>
            <div class="comment-info" id="comment-12161-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 01:38)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12162"></a>
        <div class="comment" id="comment-12162">
            <div id="post-12162-score" class="comment-score"></div>
            <div class="comment-text"><p>CentOS 6.2 patched to last month, no extra security, just the default firewall allowing ssh, http and https set using system-config-firewall-tui. The ping contains the nonsense SLE/SRE from the previously received SACK packet in Options.
SACK: 1186682302-1186685062</p>

<p>340552 (server)
Arrival Time: Jun 20, 2012 15:56:38.036203000 BST
Epoch Time: 1340204198.036203000 seconds</p>

<p>96194 (client)
Arrival Time: Jun 20, 2012 15:56:38.021608000 BST
Epoch Time: 1340204198.021608000 seconds</p></div>
            <div class="comment-info" id="comment-12162-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 01:54)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12163"></a>
        <div class="comment" id="comment-12163">
            <div id="post-12163-score" class="comment-score"></div>
            <div class="comment-text"><p>can you please upload just those two packets to <a href="http://cloudshark.org">cloudshark.org</a>? I want to take a look at the SACK options in detail, not just the "Info Summary". You can change the IP addresses with '<a href="http://tcpreplay.synfin.net/wiki/tcprewrite">tcprewrite</a>'</p>

<p>HINT: You cannot delete anonymous uploads to cloudshark!</p></div>
            <div class="comment-info" id="comment-12163-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 01:59)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12164"></a>
        <div class="comment not_top_scorer" id="comment-12164">
            <div id="post-12164-score" class="comment-score"></div>
            <div class="comment-text"><p>With every connection after data is lost in transit, SLE/SRE is always broken for connections passing through this service provider. The packets passing through the network are NATed by something and I suspect this device. As for the ICMP, I think it is trying to communicate the root of the problem, but as the network in question drops all ICMP "for security reasons", the packet mangling box is never getting to hear about it.</p></div>
            <div class="comment-info" id="comment-12164-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 02:13)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12166"></a>
        <div class="comment not_top_scorer" id="comment-12166">
            <div id="post-12166-score" class="comment-score"></div>
            <div class="comment-text"><p>Are the packets NATed at the client side (Firewall/Router) or somewhere within the ISP network? If at the client side, is the NATed source port the same as in the packet at the server side (possible double NAT)?</p></div>
            <div class="comment-info" id="comment-12166-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 02:20)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12167"></a>
        <div class="comment not_top_scorer" id="comment-12167">
            <div id="post-12167-score" class="comment-score"></div>
            <div class="comment-text"><p>Had to do this with two files, the first for the server I also included the ICMP response:
<a href="http://cloudshark.org/captures/39ca99695903">http://cloudshark.org/captures/39ca99695903</a> </p>

<p>The second for the client:
<a href="http://cloudshark.org/captures/578b446be516">http://cloudshark.org/captures/578b446be516</a></p></div>
            <div class="comment-info" id="comment-12167-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 02:32)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12168"></a>
        <div class="comment not_top_scorer" id="comment-12168">
            <div id="post-12168-score" class="comment-score"></div>
            <div class="comment-text"><p>I don't know the details of the NATing on their network, but it is not beyond the realms of possibility that it is a double NAT, however I notice their clients have 10.0.0.0 series IPs rather than the more usual 192.168 or 176. so potentially they could be just one big network.</p></div>
            <div class="comment-info" id="comment-12168-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 02:36)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12169"></a>
        <div class="comment not_top_scorer" id="comment-12169">
            <div id="post-12169-score" class="comment-score"></div>
            <div class="comment-text"><p>tcprewrite seems to have messed up the SACK numbers in the ICMP packet. In my original file the SACK data contained in Options is as follows:<br>
SACK: 1186260022-1186261402<br>
   left edge = 1186260022 (relative)<br>
   right edge = 1186261402 (relative)</p></div>
            <div class="comment-info" id="comment-12169-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 03:11)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12171"></a>
        <div class="comment not_top_scorer" id="comment-12171">
            <div id="post-12171-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>tcprewrite seems to have messed up the SACK numbers in the ICMP packet.</p>
</blockquote>

<p>the values in the ICMP packet are the real (absolute SEQ numbers). Wireshark uses relative SEQ numbers per default. If you change that, the values in the TCP packet and the ICMP packet are identical.</p>

<blockquote>
<p><code>Edit -&gt; Preferences -&gt; Protocols -&gt; TCP -&gt; Relative Sequence Numbers</code></p>
</blockquote></div>
            <div class="comment-info" id="comment-12171-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 03:40)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12172"></a>
        <div class="comment not_top_scorer" id="comment-12172">
            <div id="post-12172-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>is always broken for connections passing through this service provider.
The packets passing through the network are NATed by something and I suspect this device.</p>
</blockquote>

<p>there could be WAN accelerators in place that modify the values due to a bug. Without knowledge of the network architecture, it can be virtually anything :-( </p>

<p>It would be interesting to see if you can find a "pattern" for the SRE/SLE value changes (client versus server), like: always same delta, slightly changing delta, etc. You can do that with tshark: -T fields -e tcp.options.sack_le -e tcp.options.sack_re</p></div>
            <div class="comment-info" id="comment-12172-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 03:43)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="12173"></a>
        <div class="comment not_top_scorer" id="comment-12173">
            <div id="post-12173-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for your expert help, I'm going to recommend to the chaps in the ISP that they review their blanket ban on ICMP and investigate what is corrupting the SLE/SRE data in the packets. I don't know how they manage to get anything across their network!</p></div>
            <div class="comment-info" id="comment-12173-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 03:49)</span>
                <a class="comment-user userinfo" href="/users/2911/christian">Christian</a>
                
            </div>
        </div>
    
        <a name="12174"></a>
        <div class="comment not_top_scorer" id="comment-12174">
            <div id="post-12174-score" class="comment-score"></div>
            <div class="comment-text"><p>If you provide the information about SRE/SLE to the ISP, give them the absolute SEQ numbers, not the relative ones. </p>

<p>Good luck!</p></div>
            <div class="comment-info" id="comment-12174-info">
                
                
                
                

                

                <span class="comment-age">(26 Jun '12, 03:51)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-12147" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 14
        </span>
        <a href="#" class="show-all-comments-link">show 9 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-12147-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/12145/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='nfLtzz0y4BsIrpxFwoj3rdeEknPzUKql' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12145/tcp-retransmission-sending-wrong-sequence?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/12145/tcp-retransmission-sending-wrong-sequence?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/retransmission/"
            class="tag-link-retransmission"
            title="see questions tagged'retransmission'using tags"
            rel="tag">retransmission</a> <span class="tag-number">&#215;56</span><br/>
        
    </p>
    <p>
        question asked: <strong title="June 25, 2012, 4:46 a.m.">25 Jun '12, 04:46</strong>
    </p>
    <p> 
     	question was seen: <strong>8,934 times</strong>
    </p>
    <p> 
        last updated: <strong title="June 26, 2012, 4:05 a.m.">26 Jun '12, 04:05</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/6706/basic-question-on-tcp-function">basic question on tcp function</a>
        </p>
        
        <p>
            <a href="/questions/24701/handling-tcp-retransmission-in-a-wireshark-dissector">Handling TCP Retransmission in a Wireshark Dissector</a>
        </p>
        
        <p>
            <a href="/questions/39185/tcp-ack-and-retransmission">tcp ack and retransmission</a>
        </p>
        
        <p>
            <a href="/questions/54591/transmitting-a-spreadsheet-of-wi-fi-mac-addresses-for-bulk-validation-testing">Transmitting a spreadsheet of Wi-Fi MAC addresses for bulk validation testing</a>
        </p>
        
        <p>
            <a href="/questions/8490/tcp-retransmission-is-detected-instead-of-a-duplicate-ip-packet">TCP Retransmission is detected instead of a duplicate ip packet</a>
        </p>
        
        <p>
            <a href="/questions/25609/how-does-wireshark-detect-tcp-retransmissions">How does wireshark detect TCP retransmissions?</a>
        </p>
        
        <p>
            <a href="/questions/39587/why-is-there-a-big-delay-between-ack-and-pshack-segment">why is there a big delay between ACK and [PSH,ACK] segment</a>
        </p>
        
        <p>
            <a href="/questions/54959/too-many-retransmission-packets-defect-ok-or-bad">Too many retransmission packets defect - ok or bad?</a>
        </p>
        
        <p>
            <a href="/questions/9765/how-to-know-the-maximum-number-of-tcp-retransmission">how to know the maximum number of TCP retransmission?</a>
        </p>
        
        <p>
            <a href="/questions/27044/mac-conversation-filter">MAC conversation filter</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
