<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Packet Capture Cures DNS timeouts - Wireshark Q&amp;A</title>
        <meta name="description" content="Hello, I have a basic DNS setup (defaults) and one forwarder setup to my ISP. (the box has 2 NICs, only one is enabled) My problem is that DNS requests are timing out (2 seconds) intermittently on various the machines looking to this server. There doesn&#39;t seem to be any patterns or triggers... DNS r..." />
        <meta name="keywords" content="dnsquery" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/48241/packet-capture-cures-dns-timeouts" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/48241/packet-capture-cures-dns-timeouts?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='kjtbB9Kc2Ht3AKSQEfpWjF9wAr8BgFB4' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/48241/packet-capture-cures-dns-timeouts">Packet Capture Cures DNS timeouts</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-48241-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/48241/up/" rel="nofollow"> </a>
<div id="post-48241-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-48241-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/48241/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/48241/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hello,</p>
<p>I have a basic DNS setup (defaults) and one forwarder setup to my ISP.  (the box has 2 NICs, only one is enabled)</p>
<p>My problem is that DNS requests are timing out (2 seconds) intermittently on various the machines looking to this server.  There doesn't seem to be any patterns or triggers... DNS requests succeed when made by one machine while failing from another.  Then they might switch...</p>
<p>A very odd thing happened when I started to do packet capturing on the server using Wireshark.... The moment I started the capture, the problem went away.  I confirmed it, first, by letting the capture run all day... no DNS requests failed.  Then I stopped the capture and loaded YouTube on one of my machines... the DNS lookup failed.</p>
<p>The moment I started the capture... the page refreshed and loaded.</p>
<p>How can this be and how do I end my server's dependency on this tool ;)</p>
<p>Thank you!</p>
<p>-Scott</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/dnsquery/" class="post-tag tag-link-dnsquery"
                                        title="see questions tagged 'dnsquery'" rel="tag">dnsquery</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>03 Dec '15, 19:34</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/a22ecb9404028d45e587804260835f40?s=32&amp;d=identicon&amp;r=g" alt="CogitoErgoBibo's gravatar image" />
    <p><a href="/users/21535/cogitoergobibo">CogitoErgoBibo</a><br/>
    <span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">&#9679;</span><span class="badgecount">3</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="CogitoErgoBibo has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-48241">
    
</div>
<div id="comment-tools-48241" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-48241-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/48241/packet-capture-cures-dns-timeouts?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/48241/packet-capture-cures-dns-timeouts?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/48241/packet-capture-cures-dns-timeouts?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/48241/packet-capture-cures-dns-timeouts?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="48242"></a>
                    <div id="answer-container-48242" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-48242-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/48242/up/" rel="nofollow"> </a>
<div id="post-48242-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-48242-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/48242/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Please capture with promiscuous mode off. I would suspect an issue with arp so some DNS queries may be sent to the proper IP but wrong MAC, and promiscuous mode allows such packets to be seen and processed.</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/48242/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>03 Dec '15, 22:28</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" alt="sindy's gravatar image" />
    <p><a href="/users/19586/sindy">sindy</a><br/>
    <span class="score" title="6049 reputation points"><span class="">6.0k</span></span><span title="4 badges"><span class="badge1">&#9679;</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">&#9679;</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">&#9679;</span><span class="badgecount">51</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="sindy has 110 accepted answers">24&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-48242">
    
        <a name="48253"></a>
        <div class="comment" id="comment-48253">
            <div id="post-48253-score" class="comment-score"></div>
            <div class="comment-text"><p>well the other strategy may be to look at the promiscuous capture and determine which MAC appears that shouldn't ;-)</p></div>
            <div class="comment-info" id="comment-48253-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 01:36)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="48259"></a>
        <div class="comment" id="comment-48259">
            <div id="post-48259-score" class="comment-score"></div>
            <div class="comment-text"><p>I sure will try both suggestions, thank you.</p>

<p>I am wondering, though, why would all DNS queries succeed when the capture is on, yet fail when the capture is off?</p></div>
            <div class="comment-info" id="comment-48259-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 06:36)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48260"></a>
        <div class="comment" id="comment-48260">
            <div id="post-48260-score" class="comment-score"></div>
            <div class="comment-text"><p>The suspicion is that although the DNS requests (or responses from the master DNS server, whatever) are sent to proper IP address, there is some issue in MAC address resolution and thus those which get lost while you do not capture are not processed by the DNS daemon because a network card normally ignores packets for other MAC addresses than its own and does not pass them to higher processing layers.</p>

<p>When you capture in promiscuous mode, you remove this barrier by telling the network card to ignore destination MAC and give to the upper layers every packet it gets.</p></div>
            <div class="comment-info" id="comment-48260-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 06:42)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="48261"></a>
        <div class="comment" id="comment-48261">
            <div id="post-48261-score" class="comment-score"></div>
            <div class="comment-text"><p>Got it!  Thanks.. I'll run some tests now.</p></div>
            <div class="comment-info" id="comment-48261-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 06:57)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48262"></a>
        <div class="comment not_top_scorer" id="comment-48262">
            <div id="post-48262-score" class="comment-score"></div>
            <div class="comment-text"><p>It seems you were right!  When I turned off promiscuous mode, the next DNS request from the client failed.  So, what now?  I've been in tech for quite a while, but I've never encountered an ARP issue!</p></div>
            <div class="comment-info" id="comment-48262-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 07:06)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48264"></a>
        <div class="comment not_top_scorer" id="comment-48264">
            <div id="post-48264-score" class="comment-score"></div>
            <div class="comment-text"><p>Can you give us a more detailed layout of your network? Hosts, networks, interfaces, addresses, that sort of thing.</p></div>
            <div class="comment-info" id="comment-48264-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 07:23)</span>
                <a class="comment-user userinfo" href="/users/4/jaap">Jaap ♦</a>
                
            </div>
        </div>
    
        <a name="48265"></a>
        <div class="comment not_top_scorer" id="comment-48265">
            <div id="post-48265-score" class="comment-score"></div>
            <div class="comment-text"><p>Now follow Jasper's suggestion: if you have saved the captures done with promiscuous mode on, use display filter like <code>ip.dst == 172.22.238.241 and eth.dst != 00:e6:42:77:7e:71</code> on them, where the IP address and MAC would belong to the used NIC of your DNS forwarder. It should show you some packets which came with proper IP and wrong MAC.</p>

<p>My audacious guess would be that your DNS forwarder occasionally responds to ARP requests coming through the used NIC with MAC of the other NIC.</p></div>
            <div class="comment-info" id="comment-48265-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 07:28)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="48266"></a>
        <div class="comment not_top_scorer" id="comment-48266">
            <div id="post-48266-score" class="comment-score"></div>
            <div class="comment-text"><p>Sure...  Pretty simple:</p>

<p>Cable Modem-&gt;Firewall Appliance-&gt;Gigabit Switch</p>

<p>Off the switch:
- One Windows SBS 2011 (server 2008 R2) (new install, *DNS server)
- Several desktops/laptops/tablets with various OS's.
- Linksys EA8500 wireless router configured as an AP.</p></div>
            <div class="comment-info" id="comment-48266-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 07:40)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48267"></a>
        <div class="comment not_top_scorer" id="comment-48267">
            <div id="post-48267-score" class="comment-score"></div>
            <div class="comment-text"><p>I applied the filter as you suggested sindy... I found several hundred packets.  Wow!  I've never heard of this... what now?  The dual NIC's are onboard... Is there a standard solution to this?  (other than my hope that I can disable the non-active NIC in BIOS)</p></div>
            <div class="comment-info" id="comment-48267-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 07:49)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48269"></a>
        <div class="comment not_top_scorer" id="comment-48269">
            <div id="post-48269-score" class="comment-score"></div>
            <div class="comment-text"><p>I don't know any "standard" solution, and I still don't know what exactly happens.</p>

<p>So first of all:</p>

<ul>
<li>
<p>can you confirm that the other MAC you can see with my display filter is really the MAC of the other NIC? It is not clear from what you wrote so far.</p>
</li>
<li>
<p>if so, is it "not used" (i.e. the cable is not connected) or "disabled" in Windows? Go to the "Center for networking" window and look whether the unused NIC is in full colour or grayscale; if in full colour, right-click it and choose "disable", then try again (but bear in mind that the records in ARP tables have expiration time of minutes so don't try too quickly)</p>
</li>
</ul>

<p>If the above fails, the next step would be to try the BIOS, and if BIOS would not offer any means to disable the card, we'd have to invert the strategy. It should be enough to enable the 2nd NIC, give it an IP address from the same subnet like the other one, and connect it to the switch. This way, the IP stack would get the packet through one NIC or the other, and as it doesn't (and actually cannot) check whether IP and MAC addresses match each other, it would process it in any case.</p></div>
            <div class="comment-info" id="comment-48269-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 09:07)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="48271"></a>
        <div class="comment not_top_scorer" id="comment-48271">
            <div id="post-48271-score" class="comment-score"></div>
            <div class="comment-text"><p>Just got back from lunch so I'm going to check to see what the other address is...<br>
</p>

<p>As to the NIC, when I first setup the server I disabled the second NIC, but when I looked this morning it was enabled.  I disabled it, but I have wait until Windows Update completes before I can reboot.  (assuming this is necessary since just disabling didn't do the trick)</p>

<p>(thank you so much, again, for all your help)</p></div>
            <div class="comment-info" id="comment-48271-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 10:40)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48272"></a>
        <div class="comment not_top_scorer" id="comment-48272">
            <div id="post-48272-score" class="comment-score"></div>
            <div class="comment-text"><p>I was trying some filters to make the search easier and I noticed something... In the capture I made with promiscuous mode turned off (failed name requests), there was no traffic with a destination port of 53.  All the name resolution requests coming from the client were made over NBNS!</p></div>
            <div class="comment-info" id="comment-48272-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 10:58)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48274"></a>
        <div class="comment not_top_scorer" id="comment-48274">
            <div id="post-48274-score" class="comment-score"></div>
            <div class="comment-text"><p>Well, as I think about it now, maybe I've overestimated your knowledge about how MAC addresses should look like, and I forgot to include broadcast MAC address into my display filter. So the new version would contain also <code>and eth.dst != ff:ff:ff:ff:ff:ff</code>, and the ff:ff:... must not be replaced. If you add this to the end of my original filter, do you still get hundreds of packets which match the filter condition? And what is the "legal" MAC and the one which is seen as destination in the packets shown with the extended filter?</p></div>
            <div class="comment-info" id="comment-48274-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 13:12)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="48278"></a>
        <div class="comment not_top_scorer" id="comment-48278">
            <div id="post-48278-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks sindy... as I understand a DNS inquiry, the first thing that happens is that the client makes an ARP request on the IP address of the DNS server.  Once the ARP request comes back with the MAC address, the client uses that address for the DNS query.  Is that correct?</p>

<p>I using MS Network Monitor before a friend told me about Wireshark.  From the client I captured a successful resolve request, but I think I see the problem.</p>

<p>When the client sent the ARP request on the IP address of the server, there were two responses.  With two active NICs, I figured this wasn't so odd.  However, the first address returned was wrong... but oddly wrong (at least to me).</p>

<p>The two NICs in the machine have almost identical MAC addresses... The first five octets are the same (understandable), with only the last octet differing.  One of the ARP responses was correct... it was that of the active NIC.  However, the second not that of the disabled NIC.... the first five octets were the same, but the last octet was off by two.  (Lets say the disable's NIC's last octet is 42... this one ended in 44.</p></div>
            <div class="comment-info" id="comment-48278-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 18:42)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48279"></a>
        <div class="comment not_top_scorer" id="comment-48279">
            <div id="post-48279-score" class="comment-score"></div>
            <div class="comment-text"><p>In a MS Net Monitor capture of a failed attempt, I can see that the DNS query was made using the ::::44 address.  The one that doesn't exist.</p></div>
            <div class="comment-info" id="comment-48279-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 18:44)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48280"></a>
        <div class="comment not_top_scorer" id="comment-48280">
            <div id="post-48280-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>as I understand a DNS inquiry, the first thing that happens is that the client makes an ARP request on the IP address of the DNS server. Once the ARP request comes back with the MAC address, the client uses that address for the DNS query. Is that correct?</p>
</blockquote>

<p>Mostly yes, except that</p>

<ul>
<li>
<p>it applies for any packet you want to send to a given IP, i.e. is not limited to DNS inquiry,</p>
</li>
<li>
<p>it only happens if the MAC address for a given IP is not available in the ARP cache. So if you are sending packets to a given IP address often enough, the ARP request is only sent once in the beginning. Depending on the operating system, if packets are <em>coming</em> from that IP often enough, you usually do not need to send an ARP request either because the incoming packets' IP and MAC are stored in the ARP cache.</p>
</li>
</ul>

<p>The important part is that you get two MACs for a single ARP query, and either the first one to arrive or more likely the second one to arrive is ARP-cached and used as destination for outgoing packets to that IP.</p>

<p>I would say it is time to use a bigger hammer. I'd disconnect the DNS server from the network completely (including the IPMI if present and including the WiFi adaptor if it has one), and connect a notebook with wireshark to its NIC which is normally in use, using a direct cable (no switches). At the notebook, this must be the only active network interface too. The IP of the DNS <strong>must not</strong> be set as default gateway at the notebook. When the ethernet link comes up, start a Wireshark capture on the NIC of the notebook, and in command line send "ping IP_of_the_DNS". You should see an ARP request and one or two answers.</p>

<p>If you still can see two, it is a Windows Server OS issue (with one exception); if you can see only the correct one, I assume one of the following:</p>

<ul>
<li>
<p>the IPMI was connected to the switch and has got the same IP like the NIC.</p>
</li>
<li>
<p>your wireless AP is in bridge mode and the wireless card of the DNS server was active before but Windows firewall did not let the requests in through it,</p>
</li>
<li>
<p>(least likely) there is another machine on your network which has been manufactured right next to the one running the DNS server (so it has got the :::44 MAC) and has the same IP.</p>
</li>
</ul>

<p>The exception mentioned above is the following: To make life funnier, some servers can be configured so that the NIC and the IPMI use the same physical connector. So before opening a ticket with Microsoft, please change the IP of the server's NIC and do the test above again.</p></div>
            <div class="comment-info" id="comment-48280-info">
                
                
                
                

                

                <span class="comment-age">(04 Dec '15, 23:46)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
        <a name="48312"></a>
        <div class="comment not_top_scorer" id="comment-48312">
            <div id="post-48312-score" class="comment-score"></div>
            <div class="comment-text"><p>Are you familiar with Dell's DRAC?  It's Dell's platform based on IPMI.  I think you are right that this might be the root of the problem because both address come from the server.  I have to pull the ol' monitor out of the closet tomorrow so I can get into BIOS and disable it.</p>

<p>If it ends up being the case...  at least I learned a bit.  And also, I think I may have a snoop on one of my Windows 8.1 machines... it sends out near continuous ARP requests!</p></div>
            <div class="comment-info" id="comment-48312-info">
                
                
                
                

                

                <span class="comment-age">(06 Dec '15, 18:54)</span>
                <a class="comment-user userinfo" href="/users/21535/cogitoergobibo">CogitoErgoBibo</a>
                
            </div>
        </div>
    
        <a name="48321"></a>
        <div class="comment" id="comment-48321">
            <div id="post-48321-score" class="comment-score">1</div>
            <div class="comment-text"><blockquote>
<p>Are you familiar with Dell's DRAC</p>
</blockquote>

<p>I'm not (my IPMI experience comes from IBM/intel servers), but I'd say it is either a really funny coincidence (i.e. that you've used the same IP address for the NIC like was set on the DRAC and the DRAC is connected to the LAN, either by its own cable or because it uses the same Ethernet connector like the NIC), or a bug of the server's firmware, and in the latter case, it may not be curable by disabling the DRAC in BIOS settings but you may have to remove it physically.</p>

<p>But I'd think Dell provides an utility application allowing you to configure DRAC while the main operating system is on, so maybe you should try to use it to check the DRAC's IP (and possibly also check its MAC once there).</p>

<p>Or simply start by assigning to the NIC a different IP than it has now, as I've already suggested, to avoid the supposed address conflict with the DRAC.</p></div>
            <div class="comment-info" id="comment-48321-info">
                
                
                
                

                

                <span class="comment-age">(07 Dec '15, 00:40)</span>
                <a class="comment-user userinfo" href="/users/19586/sindy">sindy</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-48242" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 18
        </span>
        <a href="#" class="show-all-comments-link">show 13 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-48242-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="48337"></a>
                    <div id="answer-container-48337" class="answer answered-by-owner">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-48337-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/48337/up/" rel="nofollow"> </a>
<div id="post-48337-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-48337-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/48337/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Well.. so far so good.  I'll mark yours the answer after a day goes by with no problems just to be sure.  You setup DRAC as part of the initial machine setup, but the license to use it isn't included in the price (actually I couldn't find a place to even buy one)... it asks you for the machine's IP address but I didn't see a place to specify which NIC to use.  So, yes, it assigned itself to the same NIC I happened to use.  Once I disabled the "DRAC NIC", the problem seems to have been solved.<br>
</p>
<p>I'll update the thread as I mentioned... thank you for all your help!</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/48337/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>07 Dec '15, 12:30</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/a22ecb9404028d45e587804260835f40?s=32&amp;d=identicon&amp;r=g" alt="CogitoErgoBibo's gravatar image" />
    <p><a href="/users/21535/cogitoergobibo">CogitoErgoBibo</a><br/>
    <span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">&#9679;</span><span class="badgecount">3</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="CogitoErgoBibo has no accepted answers">0&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-48337">
    
</div>
<div id="comment-tools-48337" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-48337-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/48241/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='kjtbB9Kc2Ht3AKSQEfpWjF9wAr8BgFB4' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/48241/packet-capture-cures-dns-timeouts?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/48241/packet-capture-cures-dns-timeouts?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/dnsquery/"
            class="tag-link-dnsquery"
            title="see questions tagged'dnsquery'using tags"
            rel="tag">dnsquery</a> <span class="tag-number">&#215;10</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Dec. 3, 2015, 7:34 p.m.">03 Dec '15, 19:34</strong>
    </p>
    <p> 
     	question was seen: <strong>2,354 times</strong>
    </p>
    <p> 
        last updated: <strong title="Dec. 7, 2015, 6:37 p.m.">07 Dec '15, 18:37</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/21754/dns-query-for-ssh-hostname">DNS query for ssh hostname</a>
        </p>
        
        <p>
            <a href="/questions/29724/no-query-in-wireshark-packets">No Query in wireshark packets</a>
        </p>
        
        <p>
            <a href="/questions/31330/tcp-streams-and-their-dns-counterpart">TCP Streams and their DNS counterpart...</a>
        </p>
        
        <p>
            <a href="/questions/31573/question-on-dns-query-type">Question on DNS Query Type</a>
        </p>
        
        <p>
            <a href="/questions/38399/dns-queries-number-is-not-the-same-all-the-time">DNS queries number is not the same all the time</a>
        </p>
        
        <p>
            <a href="/questions/42845/dns-response-filter">DNS Response filter</a>
        </p>
        
        <p>
            <a href="/questions/43998/debug-dns-failure-no-such-namemalformed-packet">debug dns failure No such name[Malformed Packet]</a>
        </p>
        
        <p>
            <a href="/questions/50806/help-understanding-dns-packet-data">Help understanding DNS packet data</a>
        </p>
        
        <p>
            <a href="/questions/58983/how-to-capture-specific-dns-request-when-payload-pattern-changes-places">How to capture specific DNS request when payload pattern changes places</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
