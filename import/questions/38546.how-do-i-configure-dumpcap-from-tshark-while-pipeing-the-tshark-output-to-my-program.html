<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>how do I configure dumpcap from tshark while pipeing the tshark output to my program? - Wireshark Q&amp;A</title>
        <meta name="description" content="I&#39;m trying to configure tshark to instruct dumpcap to create a raw network data capture ring buffer in ram disk while pipeing the filtered packets output by tshark to my program. It worked fine UNTIL I tried to set up a ring buffer in ram. I now get this error message: tshark: Read filters aren&#39;t su..." />
        <meta name="keywords" content="tshark,ringbuffer,dumpcap" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='KXyafvWmNn2FdLU3LuSrJ8IB0dZHF85V' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program">how do I configure dumpcap from tshark while pipeing the tshark output to my program?</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-38546-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38546/up/" rel="nofollow"> </a>
<div id="post-38546-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-38546-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38546/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/38546/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I'm trying to configure tshark to instruct dumpcap to create a raw network data capture ring buffer in ram disk while pipeing the filtered packets output by tshark to my program. It worked fine UNTIL I tried to set up a ring buffer in ram. I now get this error message:</p>
<p>tshark: Read filters aren't supported when capturing and saving the captured packets.</p>
<p>Here's my tshark command line:</p>
<p>/usr/bin/tshark -nn -t e -i  wlan0 -R "wlan.fc.type==0 and wlan.fc.subtype==4"  -e frame.time -e wlan.sa -e radiotap.dbm_antsignal  -Tfields -E separator=, -l -b files:10 -b filesize:10000 -w /var/tmp/wlan0_capture | &lt;my_program&gt;.sh &amp;</p>
<p>I've set wlan0 into monitormode. I'm running all the latest code on Raspian.</p>
<p>How do I fix this ? Thank you in advance.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/tshark/" class="post-tag tag-link-tshark"
                                        title="see questions tagged 'tshark'" rel="tag">tshark</a>
                                
                                    <a href="/tags/ringbuffer/" class="post-tag tag-link-ringbuffer"
                                        title="see questions tagged 'ringbuffer'" rel="tag">ringbuffer</a>
                                
                                    <a href="/tags/dumpcap/" class="post-tag tag-link-dumpcap"
                                        title="see questions tagged 'dumpcap'" rel="tag">dumpcap</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>12 Dec '14, 17:54</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/a07a2459f82b7e0994552a4088be7857?s=32&amp;d=identicon&amp;r=g" alt="NewtownGuy's gravatar image" />
    <p><a href="/users/12597/newtownguy">NewtownGuy</a><br/>
    <span class="score" title="9 reputation points">9</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="4 badges"><span class="bronze">&#9679;</span><span class="badgecount">4</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="NewtownGuy has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-38546">
    
</div>
<div id="comment-tools-38546" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-38546-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="38568"></a>
                    <div id="answer-container-38568" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-38568-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38568/up/" rel="nofollow"> </a>
<div id="post-38568-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-38568-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38568/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Read filters are only supported when reading a capture from file. For capture filtering, you need to use a capture filter which uses the limited pcap filter format rather than the more expressive wireshark display filter format.</p>
<p>Have a look at the <code>pcap-filter</code> manual page. You probably need to replace <code>-R "wlan.fc.type == 0 and wlan.fc.subtype == 4"</code> by:</p>
<pre><code>-f 'type 0 subtype 4`
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/38568/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>15 Dec '14, 06:17</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/285b1f0f4caadc088a38c40aea22feba?s=32&amp;d=identicon&amp;r=g" alt="Lekensteyn's gravatar image" />
    <p><a href="/users/5644/lekensteyn">Lekensteyn</a><br/>
    <span class="score" title="2213 reputation points"><span class="">2.2k</span></span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="7 badges"><span class="silver">&#9679;</span><span class="badgecount">7</span></span><span title="24 badges"><span class="bronze">&#9679;</span><span class="badgecount">24</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Lekensteyn has 32 accepted answers">30&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-38568">
    
        <a name="38572"></a>
        <div class="comment" id="comment-38572">
            <div id="post-38572-score" class="comment-score"></div>
            <div class="comment-text"><p>Thank you, but the -R format works so long as I don't use the -b and -w options. Is there a performance difference between -R and -f ?</p>

<p>How do I tell dumpcap, through the tshark command line, to create a circular buffer at a particular location ? Maybe tshark is getting confused by -w, which I'm trying to use to create the capture buffer, rather than the output from tshark. The dumpcap spec says to use -w, and I'm assuming tshark passes commands through to dumpcap.</p></div>
            <div class="comment-info" id="comment-38572-info">
                
                
                
                

                

                <span class="comment-age">(15 Dec '14, 07:08)</span>
                <a class="comment-user userinfo" href="/users/12597/newtownguy">NewtownGuy</a>
                
            </div>
        </div>
    
        <a name="38573"></a>
        <div class="comment" id="comment-38573">
            <div id="post-38573-score" class="comment-score"></div>
            <div class="comment-text"><p><a href="/users/12597/newtownguy">@NewtownGuy</a></p>

<p>A display filter with the -R option is incompatible with -w, that's why you have to use the capture filter option -f and adapt the syntax accordingly.</p>

<p>For a circular buffer use the -b option, and as it is only usable with the -w option, again this is not compatible with a -R display filter, you have to use -f capture filter.</p></div>
            <div class="comment-info" id="comment-38573-info">
                
                
                
                

                

                <span class="comment-age">(15 Dec '14, 07:18)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="38580"></a>
        <div class="comment" id="comment-38580">
            <div id="post-38580-score" class="comment-score"></div>
            <div class="comment-text"><p>Thank you. How does tshark know that -w /path/filename, when used with -b filesize:10000 -b file:10, applies to dumpcap and not its outfile ?</p></div>
            <div class="comment-info" id="comment-38580-info">
                
                
                
                

                

                <span class="comment-age">(15 Dec '14, 08:15)</span>
                <a class="comment-user userinfo" href="/users/12597/newtownguy">NewtownGuy</a>
                
            </div>
        </div>
    
        <a name="38592"></a>
        <div class="comment" id="comment-38592">
            <div id="post-38592-score" class="comment-score"></div>
            <div class="comment-text"><p>Here's my revised command line using -f, -b and -w, but it does not work. It creates a 160-byte binary file at /var/tmp/capture_wlan0_xxx, but it's static. The manual for tshark says the -b and -w options control the (output?) file that tshark creates, but I want to control the file that dumpcap creates and feeds to tshark. I want to pipe the filtered output from tshark to myscript.sh, so if dumpcap -f does the filtering, why do I need tshark ?</p>

<p>/usr/bin/tshark -n -t e -i wlan0 -f "type 0 subtype 4" -e frame.time -e wlan.sa -e radiotap.dbm_antsignal -T fields -E separator=, -l -b files:10 -b filesize:10000 -w /var/tmp/capture_wlan0 | /path/myscript.sh &amp;</p>

<p>How should I fix this ?</p>

<p>Thank you.</p></div>
            <div class="comment-info" id="comment-38592-info">
                
                
                
                

                

                <span class="comment-age">(15 Dec '14, 15:06)</span>
                <a class="comment-user userinfo" href="/users/12597/newtownguy">NewtownGuy</a>
                
            </div>
        </div>
    
        <a name="38596"></a>
        <div class="comment" id="comment-38596">
            <div id="post-38596-score" class="comment-score"></div>
            <div class="comment-text"><p>What version of tshark are you using?  Using multiple files and -T fields output works for me with 1.99-2.</p>

<p>You need tshark to dissect the data and produce the fields you are piping to myscript.sh.  Dumpcap handles the capturing and file writing, and it pipes the data to tshark which then dissects the data and outputs the text.</p>

<p>You seem to be confused by the filtering.  You are using capture filtering (performed by dumpcap) using the -f option that filters what is fed to the dissection engine (libwireshark, which is part of tshark and Wireshark) and what is saved into the capture files, and then output field selection by tshark using the -T fields -e xxx options.</p>

<p>There are also display filters (tshark -R and -Y options) that restrict output, but do not affect what is captured.</p>

<p>See this <a href="https://ask.wireshark.org/questions/6660/what-is-the-difference-between-capture-filter-and-display-filter">question</a> on the differences between capture and display filters for more info.</p></div>
            <div class="comment-info" id="comment-38596-info">
                
                
                
                

                

                <span class="comment-age">(16 Dec '14, 05:28)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
        <a name="38609"></a>
        <div class="comment not_top_scorer" id="comment-38609">
            <div id="post-38609-score" class="comment-score"></div>
            <div class="comment-text"><p>I'm running tshark 1.8.2-5wheez. I looked for the dumpcap version, but it's not listed in dpkg --list, so it must be embedded in tshark.</p>

<p>I'm confused by the -w option because tshark uses it to write its output file, but dumpcap uses it to write its capture file. While I don't need tshark to write its output to a file (only a pipe), it's not clear to me if there's a way to write a tshark command line that pipes its output to a script, while using -w to control the capture file created by dumpcap. It seems to me that tshark needs one parameter to write its output file, and a different parameter to tell dumpcap where to write its capture file that is fed into tshark.</p>

<p>I'm also confused by dumpcap filtering. Unless the cpu is awfully fast, I don't see how it can process a high data rate without buffering to a file first, so it doesn't drop packets. I'm seeing occasional dropped packets now on my wireless interfaces, without any filtering.</p>

<p>If I were able to get dumpcap to write a filtered capture file to ram disk, and thus greatly reduce how much is written to disk, can tshark format it and pipe it to my script in real time ?</p></div>
            <div class="comment-info" id="comment-38609-info">
                
                
                
                

                

                <span class="comment-age">(17 Dec '14, 09:14)</span>
                <a class="comment-user userinfo" href="/users/12597/newtownguy">NewtownGuy</a>
                
            </div>
        </div>
    
        <a name="38610"></a>
        <div class="comment not_top_scorer" id="comment-38610">
            <div id="post-38610-score" class="comment-score"></div>
            <div class="comment-text"><p>Your answer has been converted to a comment as that's how this site works. Please read the FAQ for more information.</p>

<p>You're running a somewhat old version, current stable is 1.12.2, there may be some issues there.  Certainly what you are attempting to do works for me using 1.12.2.</p>

<p>When capturing, tshark (and Wireshark) start dumpcap to make the capture and write out the capture files.  dumpcap also feeds the packets to tshark (and Wireshark) over a pipe.  tshark (and Wireshark) then process the packets for output at their own rate, possibly leading to lag behind the actual capture.</p>

<p>A capture filter (or dumpcap filtering as you call it) is a high performance filter using bpf.  The high performance requirements dictate the less extensive filtering capabilities.  The packets are buffered by the kernel in the capturing mechanism and packets can be dropped, usually when using very high line rate, e.g. 10GBe.  The fact that line rates exceed disk I/O rates is one reason for capture filtering so that the torrent of packets from a high line rate can be reduced to something that the disk I/O can handle.</p>

<p>Dumpcap does write the capture filtered file to disk, but there is no mechanism for tshark (or Wireshark) to read that capture file, instead, as I've described, they consume packets from dumpcap via a pipe.</p>

<p>Hopefully you are aware that running tshark continuously in this manner will cause tshark to eventually run out of memory due to maintain state about conversations?</p></div>
            <div class="comment-info" id="comment-38610-info">
                
                
                
                

                

                <span class="comment-age">(17 Dec '14, 10:34)</span>
                <a class="comment-user userinfo" href="/users/1225/grahamb">grahamb ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-38568" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 7
        </span>
        <a href="#" class="show-all-comments-link">show 2 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-38568-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="38612"></a>
                    <div id="answer-container-38612" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-38612-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/38612/up/" rel="nofollow"> </a>
<div id="post-38612-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-38612-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/38612/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>If you don't mind a lag between when <code>dumpcap</code> finishes writing to a particular file of the ringbuffer and when <code>tshark</code> processes that file, then the following script <em>might</em> be of use to you.  I don't claim to be a script expert, so improvements are certainly possible.</p>
<p>This script was tested using Wireshark 1.12.1 command-line tools, so it may not run with your version of Wiresshark.  For example, you may need to replace the "<code>-Y</code>" option with "<code>-R</code>".</p>
<pre><code>
#!/bin/sh
# This script starts dumpcap with ring buffer settings and then feeds a
# completed capture file to tshark for further processing.
#
# The tshark output will lag because it must wait for a capture file to be
# fully written first.
#
# When dumpcap terminates, the last capture file in progress will be processed
# by tshark.

# Check usage
if (( $# &lt; 1 ))
then
    &lt;tab&gt;echo "Usage: $0 &lt; prefix &gt;"
    &lt;tab&gt;exit 0
fi

# Cleanup any old lingering files or processes ...
killall dumpcap tshark &amp;&gt; /dev/null

###################################
# Initialize stuff, edit as needed.
prefix=$1_`date +%s`

# dumpcap-specific
interface="eth0"
capfilter="icmp"
ringbuffer="-b files:10 -b filesize:10"

# tshark-specific
filter="icmp"
fields="-T fields -E separator=, -e frame.number -e frame.time_epoch"

########################################
# Start dumpcap and save its process ID
dumpcap -q -i $interface -f "$capfilter" $ringbuffer -w $prefix &amp;
sleep 1
dcpid=`pidof dumpcap`
pid=$dcpid

let count=1
let next=$(( (count + 1) % 100000))

curfile=$( ls -1 `printf ${prefix}_%05d_* $count` )

#################################################
# Process one complete ring buffer file at a time
while [[ $dcpid = $pid ]]
do
    sleep 1
    # See if dumpcap is done with the current file
    nextfile=$( ls -1 `printf ${prefix}_%05d_* $next` 2&gt; /dev/null )
    if [[ -f $nextfile ]]
    then
        tshark -r $curfile -Y "$filter" $fields | ./myscript.sh
        curfile=$nextfile
        let count=$next
        let next=$(( (count + 1) % 100000))
    fi
    pid=`pidof dumpcap`
done

tshark -r $curfile -Y "$filter" $fields | ./myscript.sh

# Final cleanup (useful during testing)
killall dumpcap tshark &amp;&gt; /dev/null
</code></pre>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/38612/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>17 Dec '14, 14:46</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" alt="cmaynard's gravatar image" />
    <p><a href="/users/402/cmaynard">cmaynard ♦♦</a><br/>
    <span class="score" title="9361 reputation points"><span class="">9.4k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">&#9679;</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">&#9679;</span><span class="badgecount">142</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="cmaynard has 108 accepted answers">20&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-38612">
    
        <a name="38614"></a>
        <div class="comment" id="comment-38614">
            <div id="post-38614-score" class="comment-score"></div>
            <div class="comment-text"><p>To: cmaynard</p>

<p>Wow. I appreciate the effort you put in to this. Thank you.</p>

<p>But there are three problems:</p>

<p>1) I need a real time output, so I can't wait for a file to fill.</p>

<p>2) I need to run multiple instances of tshark/dumpcap simultaneously, one for each of several wireless interfaces. I can't use killall because it would take all of them down. I can't use pidof because there are multiple instances of dumpcap.</p>

<p>3) Killing a top level process does not always kill its child processes. I get the pid from running the tshark command, and I've tried 'kill -1 pid' (that's minus one) and 'kill -9 pid', but they sometimes leave dumpcap running. Is there any guaranteed way to kill tshark and have it take down dumpcap, too ?</p></div>
            <div class="comment-info" id="comment-38614-info">
                
                
                
                

                

                <span class="comment-age">(17 Dec '14, 17:07)</span>
                <a class="comment-user userinfo" href="/users/12597/newtownguy">NewtownGuy</a>
                
            </div>
        </div>
    
        <a name="38616"></a>
        <div class="comment" id="comment-38616">
            <div id="post-38616-score" class="comment-score"></div>
            <div class="comment-text"><p>Regarding points 2 and 3:</p>

<pre><code>2. You really don't need to `killall` at all.  I only added it during testing, but it's not needed.  You can  pass the interface to the script.
3. To test if the `dumpcap` is still running, you can always pass the process ID of the `dumpcap` instance to the script. [EDIT: Passing the pid to the script naturally means starting up `dumpcap` outside of the script.  If you still wanted to launch `dumpcap` from within the script, then in order to obtain the pid of specific `dumpcap` instance just started, you could parse `pidof dumpcap` output by grepping each `/proc/pid/cmdline` for the relevant interface.  There may be other ways to accomplish the same thing.]
</code></pre>

<p>Unfortunately, I can't think of a way to address point #1.  Perhaps someone else has an idea?</p></div>
            <div class="comment-info" id="comment-38616-info">
                
                
                
                

                

                <span class="comment-age">(17 Dec '14, 19:33)</span>
                <a class="comment-user userinfo" href="/users/402/cmaynard">cmaynard ♦♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-38612" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-38612-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/38546/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='KXyafvWmNn2FdLU3LuSrJ8IB0dZHF85V' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/38546/how-do-i-configure-dumpcap-from-tshark-while-pipeing-the-tshark-output-to-my-program?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tshark/"
            class="tag-link-tshark"
            title="see questions tagged'tshark'using tags"
            rel="tag">tshark</a> <span class="tag-number">&#215;832</span><br/>
        
        <a href="/tags/dumpcap/"
            class="tag-link-dumpcap"
            title="see questions tagged'dumpcap'using tags"
            rel="tag">dumpcap</a> <span class="tag-number">&#215;89</span><br/>
        
        <a href="/tags/ringbuffer/"
            class="tag-link-ringbuffer"
            title="see questions tagged'ringbuffer'using tags"
            rel="tag">ringbuffer</a> <span class="tag-number">&#215;14</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Dec. 12, 2014, 5:54 p.m.">12 Dec '14, 17:54</strong>
    </p>
    <p> 
     	question was seen: <strong>3,055 times</strong>
    </p>
    <p> 
        last updated: <strong title="Dec. 17, 2014, 7:53 p.m.">17 Dec '14, 19:53</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/1297/wiresharkdumpcap-tshark-ringbuffer-problem-from-command-line">Wireshark(dumpcap, tshark), ringbuffer problem from command line</a>
        </p>
        
        <p>
            <a href="/questions/12348/how-to-calculate-the-total-network-traffic-pass-though-a-gigabit-nic-with-high-precision">How to calculate the total network traffic pass though a Gigabit NIC with high precision?</a>
        </p>
        
        <p>
            <a href="/questions/13822/capture-ring-buffer-problem">capture ring buffer problem</a>
        </p>
        
        <p>
            <a href="/questions/13850/how-to-capture-using-dumpcap">[closed] how to capture using dumpcap</a>
        </p>
        
        <p>
            <a href="/questions/62684/bypassing-dumpcap-with-tshark-and-pipes">Bypassing dumpcap with TShark and pipes</a>
        </p>
        
        <p>
            <a href="/questions/54667/error-attempting-to-capture-to-files-using-tshark">Error attempting to capture to files using tshark</a>
        </p>
        
        <p>
            <a href="/questions/18809/dumpcap-outfile-save-location">dumpcap outfile save location</a>
        </p>
        
        <p>
            <a href="/questions/24224/is-it-possible-to-filter-out-specific-fields-of-specific-packet-types-in-a-live-capture">Is it possible to filter out specific fields of specific packet types in a live capture?</a>
        </p>
        
        <p>
            <a href="/questions/28273/revivecontinue-ring-buffer">revive/continue ring buffer</a>
        </p>
        
        <p>
            <a href="/questions/49728/tshark-dumpcap-stops-writing-files-during-capture-red-hat-linux">tshark / dumpcap stops writing files during capture (Red Hat Linux)</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
