<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Why Do I Have Video Stutter Through Netgear MCAB1001 MoCA Adapters--Possibly Related to TCP Window - Wireshark Q&amp;A</title>
        <meta name="description" content="I use a pair of Netgear MCAB1001 MoCA (multimedia over coax cable) adapters for my home theater setup. The connections are: PC--&amp;gt;Cat6--&amp;gt;WNDR3700 router--&amp;gt;Cat6--&amp;gt;MoCA--&amp;gt;coax cable--&amp;gt;MoCA--&amp;gt;Cat6--&amp;gt;bluray player. LAN Speed Test (www.totusoft.com) indicates I have a sustained rea..." />
        <meta name="keywords" content="window,tcp" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='92gFj2OgI3FjdP8LmZwViyxW4AV52YpR' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window">Why Do I Have Video Stutter Through Netgear MCAB1001 MoCA Adapters--Possibly Related to TCP Window</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-11413-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/11413/up/" rel="nofollow"> </a>
<div id="post-11413-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-11413-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/11413/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/11413/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I use a pair of Netgear MCAB1001 MoCA (multimedia over coax cable) adapters for my home theater setup.  The connections are:  PC--&gt;Cat6--&gt;WNDR3700 router--&gt;Cat6--&gt;MoCA--&gt;coax cable--&gt;MoCA--&gt;Cat6--&gt;bluray player.  LAN Speed Test (<a href="http://www.totusoft.com">www.totusoft.com</a>) indicates I have a sustained read/write of 84Mbps over the adapters on large files.  Ping latency from my computer to the bluray player is less than 1ms.  However, I cannot stream video that is over 16Mbps (with regular surges to 25-30Mbps in high-detail scenes) without intolerable stutter.  Even though the MoCA adapters are only supposed to operate on Layer 2 (I think), I believe I have narrowed the problem down to some type of TCP Window problem or packet alteration.  Here are the troubleshooting steps I've taken so far:</p>
<ol>
<li>Verified there are no other equipment problems or incompatibilities.  Streamed the 16Mbps video directly to my LG BD670 and LG BD570 bluray players using 3 different sources (2 Win7 x64 PCs and a Netgear NAS)--no errors.  Streamed using CIFS and DLNA--no errors.  Played videos from a USB drive attached to the bluray player--no errors.  Swapped out all Cat6 ethernet cables--no errors.  Streamed other high bitrate videos to confirm that I don't have CODEC incompatibilities.  Swapped the MoCA adapters with two separate adapters.  Connected the MoCA adapters directly together to eliminate house coax cable problems.  Changed the communication frequencies on the MoCA adapters.  Essentially, <em>all</em> high bitrate videos play flawlessly in all configurations <em>except</em> when they are streamed through the MoCA adapters.</li>
<li>Changed the setup to:  PC--&gt;WNDR3700 router--&gt;MoCA--&gt;coax--&gt;MoCA--&gt;PC.  Then used Jperf to check throughput.  When the TCP Window is left at the default 8K, I only obtain about 20Mbps throughput, which--I think--is why the video stutters when it surges to 30Mbps during high-detail portions.  However, if I start increasing the TCP window size with Jperf, throughput starts to climb.  If I set the TCP Window at 128K, I obtain 90Mbps throughput.</li>
<li>Using TCP Optimizer, I've altered all settings--one at a time--in an attempt to discover the offending setting.  I performed the same tests on two separate computers (both Win7 x64) in an attempt to identify one of the PCs as the problem.  Stuttering still occurred.</li>
<li>I performed two captures.  I started the captures with the bluray player off in order to capture the initial handshake.</li>
<li>Capture 1 streams the video directly from my computer to the bluray player via Cat6 and static IPs.  It plays perfectly.  I cut out a significant chunk of the middle of the capture in order to meet the upload limits of my Windows SkyDrive.  The 140MB capture file is here: <a href="http://sdrv.ms/L6nQAR" title="Capture 1">Capture 1</a></li>
<li>Capture 2 streams the video from my computer through the MoCA adapters and then to the bluray player via Cat6 and static IPs.  Stuttering begins about 40 seconds into the capture and doesn't quit until it hits a lower bitrate portion of the video (at the very end of the capture).  Like Captue 1, I cut a significant portion of the middle out in order to meet my SkyDrive limits.  The 115MB capture file is here: <a href="http://sdrv.ms/MRLNA6" title="Capture 2">Capture 2</a></li>
</ol>
<p>(If the files are too large, just tell me what I should capture and I'll make new files).</p>
<p>After testing with Jperf, I'm inclined to believe that I have a TCP Window scaling problem.  When I stream the video(s) directly from my computer to the bluray player, TCP Window scaling works correctly and allows the video to play stutter-free.  However, when I stream the video through the MoCA adapters, something seems to prohibit the TCP Window from growing to the size it needs.  Either that or the MoCA adapters are somehow altering packets.</p>
<p>This is my first attempt at performing a detailed study of ethernet protocol.  I'm hungry for knowledge but I just don't know what I'm looking at in this case.  Are the MoCA adapters interfering with TCP window scaling?  Or, are they somehow altering packets?</p>
<p>Kurt--The captures you requested are linked below.<br>
<a href="http://sdrv.ms/KR3r0L" title="Catpure 3">Capture 3</a><br>
192.168.1.1--Static IP on laptop (Y530--Fast Ethernet).<br>
192.168.1.2--Static IP on BD670 bluray player (Fast Ethernet)<br>
Config:  Y530--&gt;Cat5e--&gt;MoCA--&gt;short coax--&gt;MoCA--&gt;Cat6--&gt;BD670 bluray player<br>
Capture started before BD670 turned on in order to capture handshake.<br>
Start of stutter marked with ping -l 444 192.168.1.2 (packet #115785)<br>
End of stutter marked with ping -l 444 192.168.1.2 (packet #279526)<br></p>
<p><a href="http://sdrv.ms/KR3r0L" title="Capture 4">Capture 4</a><br>
192.168.1.15--Dynamic IP on laptop (Y530--Fast Ethernet).<br>
192.168.1.9--Dynamic IP on desktop computer (INTEL64--GigE)<br>
Config:  Y530--&gt;Cat5e--&gt;MoCA--&gt;house coax--&gt;MoCA--&gt;Cat6--&gt;WNDR3700 router--&gt;Cat6--&gt;INTEL64<br>
Transfer rate indicated by Win7 dialog:  10.6MBps<br>
The video file is 6GB and produced a huge capture file.  I captured the first 13 seconds of the transfer (including the laptop handshake with the router).  There appeared to be no change in the remaining capture packets.</p>
<p>Kurt, Thanks for your initial analysis.  I don't yet have the capability to do multipoint captures.  In the meantime, I ran some captures under additional circumstances in the hopes that it might reveal something.</p>
<p>INTEL64:  Win7 x64 PC, IP=192.168.1.9<br>
Y530:  Win7 x64 PC, IP=192.168.1.15<br>
Handshake captured whenever possible</p>
<p><a href="http://sdrv.ms/L1gVXN">Capture 5: Y530 to INTEL64 No MoCA No IPV6 JPerf default settings</a><br>
Config:  Y530--&gt;WNDR3700--&gt;INTEL64.<br>
IPV6 disabled in Y530 NIC setup for all remaining captures to remove the possibility that IPV6 is interfering.  JPerf default settings, including the TCP Window.  I wanted to check to see how JPerf and the TCP Window behaved with no MoCA in the topology.  Wireshark statistics show about 90Mbps, nearly maxing out the fast ethernet NIC in the Y530.  The TCP Window in the capture expands rapidly and stops at 66560.  It is, however, the first time I've seen "Len=xxx" entries other than zero.</p>
<p><a href="http://sdrv.ms/Kw82Kj" title="Y530 to INTEL64 No MoCA No IPV6 Jperf TCP Window 8K">Capture 6: Y530 to INTEL64 No MoCA No IPV6 Jperf TCP Window 8K</a><br>
Config:  Y530--&gt;WNDR3700--&gt;INTEL64.  Same config as Capture 5 but with a forced starting TCP Window of 8K.<br>
The capture results appear almost identical to Capture 5.  Throughput reaches 90Mbps with a TCP Window of 66560.  The "Len=932" entries are also present again.  This result contradicts with 20Mbps throughput I obtained in this same configuration with the MoCAs in the topology.</p>
<p><a href="http://sdrv.ms/L0nBtj">Capture 7: Y530 to INTEL64 No MoCA No IPV6 Jperf TCP Window 128K</a><br>
Config:  Y530--&gt;WNDR3700--&gt;INTEL64.  Same config as Capture 5 but with a forced starting TCP Window of 128K.<br>
Throughput is erratic but generally about 70Mbps.  The TCP Window expands to 66560, and there are multiple "TCP Window Full" entries.  Len=1452.</p>
<p>More JPerf captures to come...</p>
<p>I'm hoping you might be able to identify why JPerf behaves one way when the MOCAs are in the topology and a different way when they are not.</p>
<p>The next test I performed was using VLC Media Player on my laptop (Y530) to stream the video from my desktop PC (INTEL64).  I'm hoping that by using a player different from the bluray player, we might be able to correlate something.</p>
<p><a href="http://sdrv.ms/LbIVu7">Capture 8: Y530 to INTEL64 No MoCA No IPV6 VLC Media Player</a><br>
Config:  INTEL64--&gt;WNDR3700--&gt;Y530.<br>
Video file on INTEL64 and played using VLC Media Player on Y530.  Statistics graph shows variable bitrate maxing out around 35Mbps.  TCP Window=65340.  No stutter.</p>
<p><a href="http://sdrv.ms/Kh1S2v">Capture 9: Y530 Through MoCA to INTEL64 No IPV6 VLC Media Player Stutter Range Marked with Pings (Abbreviated)</a><br>
Config:  INTEL64--&gt;WNDR3700--&gt;MoCA--&gt;house coax--&gt;MoCA--&gt;Y530<br>
I played the same video from Capture 8 but with the MoCAs added to the topology.  Stutter begin and end is marked with ping -l 444 192.168.1.9.  Stutter starts at packet #117542 and ends at #137810.  Throughput on the statistics chart takes a noticeable nosedive at the same time.  The capture also indicates dropped packets.</p>
<p><a href="http://sdrv.ms/KwfmFM">Capture 10: Y530 to BD670 No MoCA No IPV6 No Stutter Ping RTT Check</a><br>
Config:  Y530--&gt;Cat6--&gt;BD670 bluray<br>
Per your request, I performed pings while playing the video with no MoCA in the topology.  The pings are at #172494, #174473, #178838 and a couple other places.  What do you think the RTT says about possible delays?</p>
<p><a href="http://sdrv.ms/LmFW1I" title="Capture 11">Capture 11</a> and <a href="http://sdrv.ms/N4Wlfh" title="Capture 12">Capture 12</a> are dual sniff captures at each end of the topology that you requested.<br>
INTEL64:  192.168.1.9<br>
Y530:  192.168.1.15<br>
Config:  Y530--&gt;MoCA--&gt;house coax--&gt;MoCA--&gt;WNDR3700--&gt;INTEL64.  No IPV6<br>
I streamed the video from INTEL64 to VLC Media Player on my laptop (Y530).  I captured at both ends and marked the beginning and end of stutter with pings to 192.168.1.9.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/window/" class="post-tag tag-link-window"
                                        title="see questions tagged 'window'" rel="tag">window</a>
                                
                                    <a href="/tags/tcp/" class="post-tag tag-link-tcp"
                                        title="see questions tagged 'tcp'" rel="tag">tcp</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>27 May '12, 16:30</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/3f8d31d619be75e94ef82eb5864dbb4f?s=32&amp;d=identicon&amp;r=g" alt="Bob%20K's gravatar image" />
    <p><a href="/users/2737/bob-k">Bob K</a><br/>
    <span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">&#9679;</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="bronze">&#9679;</span><span class="badgecount">2</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Bob K has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/11413/">
                edited
                <strong>04 Jun '12, 21:22</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-11413">
    
        <a name="11422"></a>
        <div class="comment" id="comment-11422">
            <div id="post-11422-score" class="comment-score"></div>
            <div class="comment-text"><p>can you please create a new capture file and</p>

<ol>
<li>
<p>set a marker in the capture file as soon as stutter begins. You can do this by pinging one machine from the other with a certain payload length, like this: <code>ping -l 444 192.168.1.1</code>. Prepare the command at the CLI and then just press enter as soon as it happens.</p>
</li>
<li>
<p>set another marker, as soon as the stutter stops. Don't cut out that part. Rather limit the capture size at the end. <code>ping -l 445 192.168.1.1</code> </p>
</li>
<li>
<p>Copy the video file between two Winodws machines (from your share as you did in capture 2) and check the max. throughput (capture that traffic as well)</p>
</li>
</ol></div>
            <div class="comment-info" id="comment-11422-info">
                
                
                
                

                

                <span class="comment-age">(28 May '12, 05:02)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-11413" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-11413-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="11414"></a>
                    <div id="answer-container-11414" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-11414-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/11414/up/" rel="nofollow"> </a>
<div id="post-11414-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-11414-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/11414/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Take a look specifically at all packets with the SYN flag set, as these will be the ones doing window size and window scaling negotiations. Look for a situation in which the PC or the blueray player tries to enable scaling and the option is rejected. If the rejection comes from the MoCA you have part of the problem. If at the other end in the same time period you see the MoCA trying to negotiate a corresponding scaling and size with its device and being rejected by the PC or blueray, then you have the underlying problem. If not, then it is likely to be a problem with the MoCA implementation. On the other hand, if neither the PC nor the blueray try to set up scaling, then that is the problem. </p>
<p>Even if the ping latency is under 1ms, it could cause the time-bandwidth product to go too large without window scaling. 
For comparison, when doing the transfer without the MoCAs in the path, confirm that window scaling is being negotiated. </p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/11414/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>27 May '12, 17:08</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/b64129b7a3bf2a9f1760fbdee1b3b74c?s=32&amp;d=identicon&amp;r=g" alt="inetdog's gravatar image" />
    <p><a href="/users/2397/inetdog">inetdog</a><br/>
    <span class="score" title="167 reputation points">167</span><span title="1 badges"><span class="silver">&#9679;</span><span class="badgecount">1</span></span><span title="7 badges"><span class="bronze">&#9679;</span><span class="badgecount">7</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="inetdog has 3 accepted answers">14&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-11414">
    
        <a name="11418"></a>
        <div class="comment" id="comment-11418">
            <div id="post-11418-score" class="comment-score"></div>
            <div class="comment-text"><p>Thanks for the suggestion.  I've spent about 6 hours analyzing both captures linked above but see no discrepancies between the two.  As far as I can tell, the SYN and ACK entries match correctly.  If there are critical differences between the files, I am not currently able to detect them.  Any other suggestions?</p></div>
            <div class="comment-info" id="comment-11418-info">
                
                
                
                

                

                <span class="comment-age">(28 May '12, 01:05)</span>
                <a class="comment-user userinfo" href="/users/2737/bob-k">Bob K</a>
                
            </div>
        </div>
    
        <a name="11419"></a>
        <div class="comment" id="comment-11419">
            <div id="post-11419-score" class="comment-score"></div>
            <div class="comment-text"><p>More.  On both captures, the TCP Window grows as expected.  The maximum TCP Window size on the 'stutter' capture is 121856 and the non-stutter is 143168.  There are no indicated errors.</p></div>
            <div class="comment-info" id="comment-11419-info">
                
                
                
                

                

                <span class="comment-age">(28 May '12, 01:21)</span>
                <a class="comment-user userinfo" href="/users/2737/bob-k">Bob K</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-11414" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-11414-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="11434"></a>
                    <div id="answer-container-11434" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-11434-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/11434/up/" rel="nofollow"> </a>
<div id="post-11434-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-11434-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/11434/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Here's my analysis. </p>
<p><strong>relevant data</strong>:</p>
<blockquote>
<p>Capture #1: tcp.stream eq 13 <br>
Capture #2: tcp.stream eq 12<br>
Capture #3: tcp.stream eq 12<br>
Capture #4: tcp.stream eq 87<br>
</p>
</blockquote>
<p><strong>Some Results:</strong> </p>
<ol>
<li>Capture 4 is IPv6 and SMBv2, so it's not really comparable. The reported throughput in Wireshark is ~ 94 Mbit/s (Filter: tcp.stream eq 87, then Statistics -&gt; Summary). I assume the transfer rate shown in the windows 7 (10.6MBps) must be <strong>MByte</strong>/s instead of Mbit/s. This throughput is consistent with your speed measurements (jperf and totusoft). So, the MoCA are not (necessarily) the bottleneck (<strong>HOWEVER</strong> see also below - Conclusion).</li>
<li>There is no window size (or window scaling problem) in Capture #1 and #3. If you look at the "TCP Stream Graph -&gt; Window Scaling Graph" (for the related TCP streams), you will see a pretty "nice" picture with a "constant" window size (select the SYN packet, before you draw the graph). </li>
<li>All other TCP Stream Graphs look O.K., except the "Throughput Graph", which shows a pretty variable throughput for the LG player (not the windows copy operation - capture #4), with a "base" around 20 Mbit/s and a peak around 40 Mbit/s (Capture #3). There is a remarkable difference among the TCP Throughput Graph" of capture #1 (no MoCA) and Capture #2 and #3 (MoCA in place and stutter). The "base" of the throughput graph in capture #1 is remarkably higher than in the other two captures. The graph of capture #4 (file copy via MoCA), is very "smooth" at ~ 94 Mbit/s. There must be a reason for the difference among captures #1 (NO MoCA) and #2/#3 (MoCA). </li>
<li>Capture #3: Your LG player requests the data with a throughput of ~ 14.5 MBit/s (just wireshark summary - just the arithmetic average), although the windows size would permit a much higher throughput. I can only guess, but I believe, the player requests the data just "on demand", without much buffering. This is also true, if there is no MoCA involved (Capture #1). That would be O.K. for "streaming".</li>
</ol>
<p><strong>Facts:</strong> </p>
<ol>
<li>The problem is not related to TCP (windows size/scaling, etc.) </li>
<li>The problem is not related to packet loss (almost no re-transmits) </li>
<li>There is no problem if you download the file from Windows to Windows via the MoCA (94 Mbit/s) </li>
<li>There is no problem if you do speed measurements via the MoCA (jperf, etc. - 90 Mbit/s) </li>
<li>The LG player seems to request data only with the required bit rate, probably without much buffering in advance. O.K. for "streaming".</li>
<li>There is a slightly higher RTT with the MoCA in place. Look at the TCP 3-way handshake in capture #1, #2 and #3. If I assume that the capture was done on the Windows PC hosting the share, the RTT is ~ 1,5-2 ms higher than without the MoCA (Delta SYN-ACK -&gt; ACK). This matches with the RTT of the ping marker in capture #3 (~ 3 ms). The later (icmp) could also be a load problem on the LG player, while it's playing the movie (see TODO below).</li>
</ol>
<p><strong>Conclusion</strong>: </p>
<p>The problem is <strong>probably</strong> related to the MoCA, because it <strong>might add delay</strong> while trans-coding the data. Maybe it adds delay only in one direction. You can't tell with only one capture point. Unfortunately I have (yet) no idea why there is no problem in capture #4 (file copy via the MoCA). The suspected delay should have an effect there as well.<br>
</p>
<p><strong>TODO</strong>: </p>
<p>To verify my <strong>delay assumption</strong>, you could generate some more captures: </p>
<ol>
<li>repeat capture #1 and ping the LG player while the movie is beeing played. Then check the RTT of the ping. If it's the same RTT as in capture #3, it's a load problem on the player. If there is no higher RTT, it supports my delay assumption.</li>
<li>repeat capture #2/#3 with two data capture points. <ul>
<li>One in front of the client (or on the client if there is no other option)</li>
<li>one in front of the LG player (use a small switch with port mirroring capabilities, or a PC with 2 interfaces - bridge mode: <a href="http://wiki.wireshark.org/CaptureSetup/Ethernet).">http://wiki.wireshark.org/CaptureSetup/Ethernet).</a> <strong>Important</strong>: Synchronize the clocks of the capturing PCs with NTP before capturing. </li>
</ul>
</li>
</ol>
<p><strong>Possible Solution</strong>: </p>
<p>The LG player could compensate by downloading the file with a higher "bit rate" and by using a larger internal buffer, to prevent stutter, if there is not enough data. However, that's apparently not the case, even in capture #1 it requests the data with a much lower bit-rate than it would be possible according to the announced window size. Apparently it downloads just what is needed, which is O.K. for "streaming". </p>
<p>Maybe a firmware update of the LG player could help. </p>
<p>Any other thoughts on this?<br>
</p>
<p>BTW: If you think my analysis is plain wrong, please feel free to correct me. I'm willing to extend my knowledge by learning from "weird" real world problems :-) </p>
<p>Regards <br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/11434/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>29 May '12, 04:13</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/11434/">
                edited
                <strong>29 May '12, 05:34</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-11434">
    
        <a name="11515"></a>
        <div class="comment" id="comment-11515">
            <div id="post-11515-score" class="comment-score"></div>
            <div class="comment-text"><p>Wow. At lot of new captures :-)</p>

<blockquote>
<p>I don't yet have the capability to do multipoint captures</p>
</blockquote>

<p>At least for Capture #8 and #9 you can sniff on both your laptop and your PC. I'm not sure if that will help to track down the problem, but it's the best thing you can do for now.</p></div>
            <div class="comment-info" id="comment-11515-info">
                
                
                
                

                

                <span class="comment-age">(31 May '12, 20:25)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="11516"></a>
        <div class="comment" id="comment-11516">
            <div id="post-11516-score" class="comment-score"></div>
            <div class="comment-text"><p>Yes, I'm determined to figure this out!  Or, at least I will try to provide meaningful data to people who <em>can</em> figure it out!</p></div>
            <div class="comment-info" id="comment-11516-info">
                
                
                
                

                

                <span class="comment-age">(31 May '12, 20:31)</span>
                <a class="comment-user userinfo" href="/users/2737/bob-k">Bob K</a>
                
            </div>
        </div>
    
        <a name="11783"></a>
        <div class="comment" id="comment-11783">
            <div id="post-11783-score" class="comment-score"></div>
            <div class="comment-text"><p>Kurt--A double-sniff capture is now uploaded.  I'll be darned if I can detect any problems.</p>

<p>Notably, I get significant packet loss when streaming through the MoCAs to VLC Media Player, which should have enough buffer to make up for any delay problems.</p></div>
            <div class="comment-info" id="comment-11783-info">
                
                
                
                

                

                <span class="comment-age">(08 Jun '12, 22:14)</span>
                <a class="comment-user userinfo" href="/users/2737/bob-k">Bob K</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-11434" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-11434-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/11413/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='92gFj2OgI3FjdP8LmZwViyxW4AV52YpR' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/11413/why-do-i-have-video-stutter-through-netgear-mcab1001-moca-adapters-possibly-related-to-tcp-window?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/tcp/"
            class="tag-link-tcp"
            title="see questions tagged'tcp'using tags"
            rel="tag">tcp</a> <span class="tag-number">&#215;752</span><br/>
        
        <a href="/tags/window/"
            class="tag-link-window"
            title="see questions tagged'window'using tags"
            rel="tag">window</a> <span class="tag-number">&#215;55</span><br/>
        
    </p>
    <p>
        question asked: <strong title="May 27, 2012, 4:30 p.m.">27 May '12, 16:30</strong>
    </p>
    <p> 
     	question was seen: <strong>6,325 times</strong>
    </p>
    <p> 
        last updated: <strong title="June 8, 2012, 10:14 p.m.">08 Jun '12, 22:14</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/24316/tcp-window-size">TCP window Size</a>
        </p>
        
        <p>
            <a href="/questions/13275/i-am-seeing-lots-of-retransmission-between-two-nodes-in-same-subnet">I am seeing lots of retransmission between two nodes in same subnet.</a>
        </p>
        
        <p>
            <a href="/questions/42695/why-acknowledgments-sent-early-than-window-size-reached-during-tcp-session">Why acknowledgments sent early than window size reached during TCP session?</a>
        </p>
        
        <p>
            <a href="/questions/45146/tcp-transmission-deviates-from-receive-window-any-legitimate-reason">TCP transmission deviates from receive window - any legitimate reason</a>
        </p>
        
        <p>
            <a href="/questions/849/tcp-zerowindow">TCP ZeroWindow</a>
        </p>
        
        <p>
            <a href="/questions/42789/windows-7-tcp-window-auto-tuning">Windows 7 TCP Window &quot;Auto-Tuning&quot;</a>
        </p>
        
        <p>
            <a href="/questions/2365/tcp-window-size-and-scaling">TCP window size and scaling</a>
        </p>
        
        <p>
            <a href="/questions/7428/tcp-window-size-and-acknowledgment">Tcp Window Size and acknowledgment</a>
        </p>
        
        <p>
            <a href="/questions/22090/the-transmission-window-is-now-completely-full">The transmission window is now completely full</a>
        </p>
        
        <p>
            <a href="/questions/29339/tcp-window-size-reducing">TCP window size reducing</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
