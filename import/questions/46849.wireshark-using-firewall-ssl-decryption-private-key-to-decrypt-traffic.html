<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Wireshark using Firewall ssl decryption private key to decrypt traffic - Wireshark Q&amp;A</title>
        <meta name="description" content="Hi, WE have a cisco firewall that decrypts traffic by allowing us to install a server certificate on the firewall and also adding the client certificate to all the browsers keystore. I know wireshark can decrypt SSL traffic if we provide it the private key of the server hosting a website. My questio..." />
        <meta name="keywords" content="ssl,decryption" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='0sVOmGri1BVbyoucEZlI2sg6K7sAkELE' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic">Wireshark using Firewall ssl decryption private key to decrypt traffic</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-46849-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/46849/up/" rel="nofollow"> </a>
<div id="post-46849-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-46849-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/46849/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/46849/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>Hi,
WE have a cisco firewall that decrypts traffic by allowing us to install a server certificate on the firewall and also adding the client certificate to all the browsers keystore.</p>
<p>I know wireshark can decrypt SSL traffic if we provide it the private key of the server hosting a website. My question is can it decrypt the traffic going through the firewall using the firewalls private key that browsers in our office use? The problem I see is that the destination address is the external address not the firewall address and wireshark gives an error like the supplied private key is not for the correct server.</p>
<p>Is there a way to tell wireshark to use the gateway ip address and the address for decryption of the ssl traffic using the firewall certificates private key?</p>
<p>Thanks
Al</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/ssl/" class="post-tag tag-link-ssl"
                                        title="see questions tagged 'ssl'" rel="tag">ssl</a>
                                
                                    <a href="/tags/decryption/" class="post-tag tag-link-decryption"
                                        title="see questions tagged 'decryption'" rel="tag">decryption</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>22 Oct '15, 12:25</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c6ad098816c0b0afd0415f75e76ef68d?s=32&amp;d=identicon&amp;r=g" alt="aaghili's gravatar image" />
    <p><a href="/users/2713/aaghili">aaghili</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">&#9679;</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">&#9679;</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">&#9679;</span><span class="badgecount">6</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="aaghili has no accepted answers">0&#37;</span>
    </p>
</div>


                            </div>
                            




<div class="comments-container" id="comments-container-46849">
    
</div>
<div id="comment-tools-46849" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-46849-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    One Answer:
                    </div>
                    
<div class="tabsA"><a href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="46852"></a>
                    <div id="answer-container-46852" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-46852-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/46852/up/" rel="nofollow"> </a>
<div id="post-46852-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-46852-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/46852/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Here is how SSL/TLS inspection works on a firewall. It will explain why you can't decrypt the traffic.</p>
<ul>
<li>There is a CA cert (incl. private key) on the firewall, either generated on the Firewall or uploaded as PKCS#12 container.</li>
<li>The client tries to access an external HTTPS site</li>
<li>The firewall intercepts that request (explicit proxy or transparent proxy) and let's the client wait</li>
<li>The firewall itself opens a new SSL/TLS session to the target server S</li>
<li>As part of the handshake the firewall receives cert(S), which is the certificate of the server S</li>
<li>The Firewall on-the-fly generates a new certificate signed with it's own CA cert, with the whole content of the external cert, but with a different private key (obviously). So we have <strong>cert_fw(S)</strong> and <strong>privkey_fw(S)</strong>, the cert + the private key created by the firewall to be used in the handshake for the client</li>
<li>The firewall completes the SSL/TLS handshake using <strong>cert_fw(S)</strong> AND <strong>privkey_fw(S)</strong>. </li>
</ul>
<p>After that, you will have two SSL/TLS connections</p>
<ul>
<li>one: from Client -&gt; Firewall with privkey_fw(S)</li>
<li>two: from Firewall -&gt; Server with privkey(S)</li>
</ul>
<p>This enables the firewalls to inspect the data, because it has access to the clear text payload 'between' the two SSL/TLS connections.</p>
<p>To be able to decrypt a SSL/TLS session with Wireshark, you need the private key of the 'remote' SSL/TLS endpoint. </p>
<p>As you don't know the real private key of the server (unless you are the server admin), you cannot decrypt the connection between Firewall -&gt; Server.</p>
<p><strong>Now, here is your problem</strong>: You also don't know the <strong>temp</strong> private keys generated by the firewall privkey_fw(S), as that's only stored on the firewall itself. I know only one or two firewalls that expose these temp keys via CLI. I don't know it for your Cisco firewall. So, unless you can access those keys, there is no way to decrypt the SSL/TLS connections between Client -&gt; Firewall.</p>
<p>BTW: What you are installing on the clients is the CA cert of the firewall to prevent certificate warnings in the browser. But that's only the public key and won't help you.</p>
<p><strong>So to answer your question:</strong> I'm sorry, I don't see any way to decrypt the connections between the client and the firewall, because you don't have access to the temp private keys generated by the firewall.</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/46852/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>22 Oct '15, 13:04</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-46852">
    
        <a name="46859"></a>
        <div class="comment" id="comment-46859">
            <div id="post-46859-score" class="comment-score"></div>
            <div class="comment-text"><p>Hi Kurt,</p>

<p>Thank you for the answer. As I mentioned I do have access to the private key of the self signed cert generated by the firewall. But I still wasn't able to decrypt the traffic between the firewall and the client.</p>

<p>I think the issue was that the destination ip address of the packet is the server (not the firewall). How do I go about decrypting the traffic from the client to the firewall if I do have access to the private key of the self signed cert that the firewall creates?</p>

<p>The fierewall IP address is the gateway ip address in our network. </p>

<p>Thank again for your help.</p>

<p>Al</p></div>
            <div class="comment-info" id="comment-46859-info">
                
                
                
                

                

                <span class="comment-age">(22 Oct '15, 14:22)</span>
                <a class="comment-user userinfo" href="/users/2713/aaghili">aaghili</a>
                
            </div>
        </div>
    
        <a name="46864"></a>
        <div class="comment" id="comment-46864">
            <div id="post-46864-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>As I mentioned I do have access to the private key of the self signed cert generated by the firewall.</p>
</blockquote>

<p>sure? Where did you get that from? </p>

<p>As I said, those keys are only generated within the firewall (on-the-fly) and you (usually) won't have access to those keys. If you somehow have access, you'll have to pick the right key, because the firewall will generate a new private key for every external server your clients are connecting to. It does this the first time while a client connects to the external server. So usually you will end up with a few hundreds of thes temp private keys (and certs) on the firewall, for all sorts of external servers. So, you need to load each and every of them into Wireshark to be able to decrypt the connections to those sites, OR pick a certain key to decrypt only the traffic to that particular server. So, there is no <strong>single</strong> RSA key to decrypt the whole communication between clients and firewall, because the firewall will use different keys for every external server. Maybe I was unclear about this in my explanation.</p></div>
            <div class="comment-info" id="comment-46864-info">
                
                
                
                

                

                <span class="comment-age">(22 Oct '15, 15:34)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="46879"></a>
        <div class="comment" id="comment-46879">
            <div id="post-46879-score" class="comment-score"></div>
            <div class="comment-text"><p>ok maybe I misunderstood.</p>

<p>But this still doesn't make sense. Why does the firewall need to create a private key for every external server? The ssl handshake is between the browser (client using FW self signed cert public key) and the firewall (using a single private key from the self signed cert) for the 1st step of decryption. And then between the firewall (in this case the client) which uses the public key of the external server to complete the handshake with the external server private key.</p>

<p>See below</p>

<p>STEP 1 decryption at firewall.
browser (fw self signed cert public key) ---&gt; firewall (self signed cert private key) ssl handshake and decryption</p>

<p>STEP 2 re-encryption at firewall.
firewall (server public key) ---&gt; server (server private key) ssl handshake and encryption.</p>

<p>The browser uses the public key from the self signed server cert created by the firewall to complete the handshake and there is only a single private key for the self signed server cert.</p>

<p>Can you please let me know what the tshark command would be if I had the private key of the firewall self signed cert?</p>

<p>tshark -o "ssl.keys_list: 127.0.0.1,443,http,/home/privkey.pem" -o "ssl.debug_file: /home/.wireshark-log" -i eth0 -R "tcp.port == 443"</p>

<p>Is the ip address in the keylist the firewall ip address or the server ip address.</p>

<p>Thanks, I'm just trying to get a clearer picture of this.</p>

<p>Al</p></div>
            <div class="comment-info" id="comment-46879-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 07:11)</span>
                <a class="comment-user userinfo" href="/users/2713/aaghili">aaghili</a>
                
            </div>
        </div>
    
        <a name="46881"></a>
        <div class="comment" id="comment-46881">
            <div id="post-46881-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Why does the firewall need to create a private key for every external server?</p>
</blockquote>

<p>It does not <strong>have to</strong>, but all firewalls I know (about 5-6) do that. I guess your Cisco firewall is no exception. Reason why: It's good security practice to do that.</p>

<p>Can you post a pcap file with sessions to <a href="https://www.apple.com">https://www.apple.com</a>, <a href="https://www.wireshark.org">https://www.wireshark.org</a> and <a href="https://www.goole.com">https://www.goole.com</a>. In the capture file we will see, if there are different public keys (in the intermediate certs) or if it's allways the same (which I doubt). Different public keys, implies different private keys as well! If it's a different key for every domain, your firewall behaves like all others I know and then there is no way to decrypt the communication between client and firewall, as described in my answer.</p></div>
            <div class="comment-info" id="comment-46881-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 08:42)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="46885"></a>
        <div class="comment" id="comment-46885">
            <div id="post-46885-score" class="comment-score"></div>
            <div class="comment-text"><p>Sorry how do I attach a pcap file? Or did you want the tshark output of the pcap capture?</p></div>
            <div class="comment-info" id="comment-46885-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 09:43)</span>
                <a class="comment-user userinfo" href="/users/2713/aaghili">aaghili</a>
                
            </div>
        </div>
    
        <a name="46887"></a>
        <div class="comment not_top_scorer" id="comment-46887">
            <div id="post-46887-score" class="comment-score"></div>
            <div class="comment-text"><p>You can't. Please upload it somewhere (dropbox, etc.) and post the link here.</p></div>
            <div class="comment-info" id="comment-46887-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 10:44)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="46888"></a>
        <div class="comment not_top_scorer" id="comment-46888">
            <div id="post-46888-score" class="comment-score"></div>
            <div class="comment-text"><p>ok here is a link to dropbox pcap file. And actually <a href="https://www.dropbox.com">https://www.dropbox.com</a> is the site I went to and got the capture. The firewall has a self signed certificate that we import the public key into the browser or dropbox can't be accessed inside our firewall. Basically I'd like to know if wireshark could use the private key of this self signed certificate to do the decryption for analysis. Please let me know if you need anything else.
Thanks again.
Al</p>

<p><a href="https://www.dropbox.com/s/tkleshas3yrayzj/dropbox.pcap?dl=0">https://www.dropbox.com/s/tkleshas3yrayzj/dropbox.pcap?dl=0</a></p></div>
            <div class="comment-info" id="comment-46888-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 11:10)</span>
                <a class="comment-user userinfo" href="/users/2713/aaghili">aaghili</a>
                
            </div>
        </div>
    
        <a name="46896"></a>
        <div class="comment not_top_scorer" id="comment-46896">
            <div id="post-46896-score" class="comment-score"></div>
            <div class="comment-text"><p>O.K. there are several TLS conversations in that capture file, however only those to dropbox sites have been intercepted. You can see it, if you look at the certs in the handshake. The intercepted ones have been issued/signed by the "CA" 192.168.120.253.</p>

<p>All other TLS connections have not been intercepted. So, this file does not contain what I asked for: Intercepted TLS connections for different servers/domains (apple.com, google.com, wireshark.org, etc.). I wanted to check if the Firewall is going to use the same public/private key for all sites. If possible, please provide a pcap file for those sites (with interception) as well.</p>

<p><strong>Let's look at the TLS connections to dropbox.</strong></p>

<p>Apparently they are all using the same public key in the intermediate certs, so your firewall does <strong>NOT</strong> create a new private key for every domain, at least that's what I see for the dropbox domains: www.dropbox.com, marketing.dropbox.com and *.dropboxstatix.com.</p>

<pre>openssl.exe x509 -inform DER -in www.dropbox.com.cer -noout -modulus
Modulus=E8F1B13A6CC3AA83C1A285BABCCE43B831B9D9AEE04D63F9548BECFEFEEBF
0BEBFE075C08A16C761BBDABC7F9A80C4C1F724B4F7EA38FFEF7FF9A232A77304ABE2
500B2ED8DA5F699BE6B4CC2DF755E3DBDA5D11EFE78DCA9AED9CD0CCFDF92BC7B33F3
3842982270D99D77C190525D2DF0CF79BD963C80611BCEA5713A092C213C7195BF590
58860DCD8B2FAA48C41C002F204A5432E266F29FAA57650E7F356E15BEB2486779011
703BBC96E9113B318CEFA024B7C06B3E51CD0ED5881624E64753C7FF440EFED2C84A9
931A3FA022CCFEE89C5CED4146C8407466A9CC730E01CA2C209BDCFABA20D89C10B5B
9A8BCA18F4E6E3CD0F2BB29C5AC1594511D

openssl.exe x509 -inform DER -in star.dropboxstatic.com.cer -noout -modulus
Modulus=E8F1B13A6CC3AA83C1A285BABCCE43B831B9D9AEE04D63F9548BECFEFEEBF
0BEBFE075C08A16C761BBDABC7F9A80C4C1F724B4F7EA38FFEF7FF9A232A77304ABE2
500B2ED8DA5F699BE6B4CC2DF755E3DBDA5D11EFE78DCA9AED9CD0CCFDF92BC7B33F3
3842982270D99D77C190525D2DF0CF79BD963C80611BCEA5713A092C213C7195BF590
58860DCD8B2FAA48C41C002F204A5432E266F29FAA57650E7F356E15BEB2486779011
703BBC96E9113B318CEFA024B7C06B3E51CD0ED5881624E64753C7FF440EFED2C84A9
931A3FA022CCFEE89C5CED4146C8407466A9CC730E01CA2C209BDCFABA20D89C10B5B
9A8BCA18F4E6E3CD0F2BB29C5AC1594511D

openssl.exe x509 -inform DER -in marketing.dropbox.com.cer -noout -modulus
Modulus=E8F1B13A6CC3AA83C1A285BABCCE43B831B9D9AEE04D63F9548BECFEFEEBF
0BEBFE075C08A16C761BBDABC7F9A80C4C1F724B4F7EA38FFEF7FF9A232A77304ABE2
500B2ED8DA5F699BE6B4CC2DF755E3DBDA5D11EFE78DCA9AED9CD0CCFDF92BC7B33F3
3842982270D99D77C190525D2DF0CF79BD963C80611BCEA5713A092C213C7195BF590
58860DCD8B2FAA48C41C002F204A5432E266F29FAA57650E7F356E15BEB2486779011
703BBC96E9113B318CEFA024B7C06B3E51CD0ED5881624E64753C7FF440EFED2C84A9
931A3FA022CCFEE89C5CED4146C8407466A9CC730E01CA2C209BDCFABA20D89C10B5B
9A8BCA18F4E6E3CD0F2BB29C5AC1594511D

</pre>

<p><strong>Now</strong>, it would be interesting to see if you have the matching private key. So, either you run the following command and post the output here</p>

<blockquote>
<p>openssl rsa -in key.txt -noout -modulus</p>
</blockquote>

<p>Or you upload the key somewhere and post the link here (please consider security issues!).</p>

<p>If the <strong>Modulus</strong> is identical, you have the right private key and then you should be able to decrypt session, but only to those three domains!</p>

<p>In Wireshark, you'll have to define the RSA key as follows.</p>

<blockquote>
<p>IP, Port, Protocol, Key_File</p>
</blockquote>

<p>IP: real IP address of the external server, as that where your clients are connecting to.<br>
Port: 443 <br>
Protocol: http <br>
Key_File: the key file</p>

<p><strong>However</strong>, if the <strong>Modulus is different</strong>, you don't have the temp private key, generated by the firewall and thus you cannot decrypt the traffic.</p>

<p>We'll see ....</p></div>
            <div class="comment-info" id="comment-46896-info">
                
                
                
                

                

                <span class="comment-age">(23 Oct '15, 13:25)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-46852" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 8
        </span>
        <a href="#" class="show-all-comments-link">show 3 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-46852-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/46849/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='0sVOmGri1BVbyoucEZlI2sg6K7sAkELE' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/46849/wireshark-using-firewall-ssl-decryption-private-key-to-decrypt-traffic?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/ssl/"
            class="tag-link-ssl"
            title="see questions tagged'ssl'using tags"
            rel="tag">ssl</a> <span class="tag-number">&#215;319</span><br/>
        
        <a href="/tags/decryption/"
            class="tag-link-decryption"
            title="see questions tagged'decryption'using tags"
            rel="tag">decryption</a> <span class="tag-number">&#215;165</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Oct. 22, 2015, 12:25 p.m.">22 Oct '15, 12:25</strong>
    </p>
    <p> 
     	question was seen: <strong>2,844 times</strong>
    </p>
    <p> 
        last updated: <strong title="Oct. 23, 2015, 1:25 p.m.">23 Oct '15, 13:25</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/54975/issues-decrypting-ssl-traffic">issues decrypting SSL Traffic</a>
        </p>
        
        <p>
            <a href="/questions/6426/ssl-decryption-problems">SSL Decryption Problems</a>
        </p>
        
        <p>
            <a href="/questions/8373/dtls-decryption-not-working-on-wireshark-165-even-for-sample-capture">DTLS decryption not working on Wireshark 1.6.5, even for sample capture</a>
        </p>
        
        <p>
            <a href="/questions/28145/cant-decrypt-ssl-in-capture-from-windump">Can&#39;t decrypt ssl in capture from windump</a>
        </p>
        
        <p>
            <a href="/questions/36524/unable-to-decrypt-ssl-traffic-in-wireshark">unable to decrypt ssl traffic in wireshark</a>
        </p>
        
        <p>
            <a href="/questions/50305/how-does-wireshark-decrypt-ssltls-with-only-clientrandom">How does Wireshark decrypt SSL/TLS with only ClientRandom</a>
        </p>
        
        <p>
            <a href="/questions/50584/not-decrypting-all-http2-traffic-in-session">Not Decrypting all HTTP/2 traffic in session.</a>
        </p>
        
        <p>
            <a href="/questions/55099/tshark-decrypts-only-firsts-https-packets">Tshark decrypts only firsts https packets</a>
        </p>
        
        <p>
            <a href="/questions/4685/decrypting-ssl">Decrypting SSL</a>
        </p>
        
        <p>
            <a href="/questions/28503/decrypt-ssl-using-wildcard-ip-address">Decrypt SSL using wildcard IP address</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
