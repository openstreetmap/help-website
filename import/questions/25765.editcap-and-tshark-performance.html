<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base_content.html -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Editcap [and tshark] performance - Wireshark Q&amp;A</title>
        <meta name="description" content="I have a 9.59GB pcap that I am running editcap -D from 1 to 1000000 exponentially. There are 13751611 packets in the file. I have a dedicated Win 7 Ent. VM on an ESXi server with 26GB RAM with 2 dual-core 3GHz CPUs. It took 234991 seconds to process the command with a window of 1000000. The command ..." />
        <meta name="keywords" content="performance" />
        
        <link rel="canonical" href="https://osqa-ask.wireshark.org/questions/25765/editcap-and-tshark-performance" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/questions/25765/editcap-and-tshark-performance?type=rss">


        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        <meta name="google-site-verification" content="dqzpAlfsUDYClyC-7mNVrF11yfwuCZ0-uF7C4HApzkU" />
        
        <link rel="shortcut icon" href="/upfiles/favicon-ask_1.ico" />
        <link href="/m/default/media/style/style.css" rel="stylesheet" type="text/css" />
        
        <link href="/cstyle.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css" />
        <!--[if IE 6]>
        <style type="text/css">
        img, div, a { behavior: url(/m/default/media/iepngfix/iepngfix.htc) }
        </style>
        <![endif]-->
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
        
        <script type="text/javascript">
        /*<![CDATA[*/
            
            

            var i18nLang = 'en';
            var appUrl = 'https://osqa-ask.wireshark.org'
            var scriptUrl = '/'
            var osqaSkin = 'default';

            var messages = {
                username: '',
                confirm: "Are you sure?",
                yes: "Yes",
                no: "No",
                message: "Message:",
                cancel: "Cancel",
                close: "Close",
                ok: "Ok",
                matching_tags_url: "/matching_tags/",
                word: "word",
                words: "words",
                character: "character",
                characters: "characters"
            }
        /*]]>*/
        </script>
        <script type="text/javascript" src="/m/default/media/js/osqa.main.js"></script>
        
        <style type="text/css">
            body { margin-top:2.4em; }
        </style>
        <script type="text/javascript">
            $(document).ready(function() {
                var element = $('#validate_email_alert');
                element.click(function(){notify.close(true);})
                notify.show();
            });
        </script>
        
        
            <META name="y_key" content="af3ab95b28a8b14e">
<meta name="msvalidate.01" content="9EAF899765C0DD43A19EEF6EAFFA6A77" />
        
        
        
        <script type='text/javascript' src='/m/default/media/js/osqa.question.js'></script>
        <script type='text/javascript' src='/m/default/media/js/jquery.caret.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/showdown.js'></script>
        <script type='text/javascript' src='/m/default/media/js/wmd/wmd.js'></script>
        <script type='text/javascript' src='/m/default/media/js/html_sanitizer.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/wmd/wmd.css" />

        
        <script type='text/javascript' src='/m/default/media/js/viewbox_min.js'></script>
        <script type='text/javascript' src='/m/default/media/js/youtube.js'></script>
        <link rel="stylesheet" type="text/css" href="/m/default/media/js/viewbox.css" />
        
        

        <script type="text/javascript">
        $().ready(function(){
            $("#nav_questions").attr('className',"on");
            var answer_sort_tab = "";

            if (answer_sort_tab) {
                $("#" + answer_sort_tab).attr('className',"on");
            }

            $('#editor').TextAreaResizer();

            //toggle preview of editor
            var display = true;
            var txt = "[hide preview]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[show preview]" : "[hide preview]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });
        });

        function submitClicked(e, f) {
            if(!(browserTester('chrome') || browserTester('safari'))) {
                $("input.submit")[0].disabled=true;
            }
            window.removeEventListener('beforeunload', beforeUnload, true);
            if (f) {
                f.submit();
            }
        }

        function beforeUnload(e) {

            if($("textarea#editor")[0].value != "") {
                return yourWorkWillBeLost(e);
            }

            var commentBoxes = $("textarea.commentBox");
            for(var index = 0; index < commentBoxes.length; index++) {
                if(commentBoxes[index].value != "") {
                    return yourWorkWillBeLost(e);
                }
            }
        }
        window.addEventListener('beforeunload', beforeUnload, true);
        </script>
        <noscript>
            <style>
                .comment.not_top_scorer {
                    display: block;
                }
                .comment-form-container {
                    display: block;
                }
                .div.comment-tools {
                    display: none;
                }
            </style>
        </noscript>

        <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Wireshark Q&amp;A Search" />
        
    </head>
    <body>
        <div class="wrapper">
        
        <!-- template header.html -->


	<div id="roof">
	  
		<div id="logo">
			<a href="/">
				<img src="/upfiles/wsbadge@186x57.png" title="back to home page" alt="Wireshark Q&amp;A logo"/>
			</a>
		</div>
	  
		<div id="top">
		     <a href="/account/signin/" >login</a>  <a href="/about/" >about</a>  <a href="/faq/" >faq</a> 
		</div>

    <div id="nav">
        <a id="nav_questions" class="on" href="/questions/" >questions</a><a id="nav_tags" href="/tags/" >tags</a><a id="nav_users" href="/users/" >users</a><a id="nav_badges" href="/badges/" >badges</a><a id="nav_unanswered" href="/questions/unanswered/" >unanswered</a>
        
    </div>
  </div>

  <div class="clear"></div>
  
	<div id="searchBar">
    <form action="/search/" method="get">
        <input type='hidden' name='csrfmiddlewaretoken' value='jfctMg5eWCvAVvz6cb5sHaZpbP7ZrS7q' />
        <div>
            <input type="text" class="searchInput" value="" name="q" id="keywords" />
            <input type="submit" name="Submit" value="search" class="searchBtn" />
        </div>
        <div class="options">
            <input id="type-question" type="radio" value="question" name="t" 
                checked="checked" /><label for="type-question">questions</label>
            <input id="type-tag" type="radio" value="tag" name="t" /><label for="type-tag">tags</label>
            <input id="type-user" type="radio" value="user" name="t" /><label for="type-user">users</label>
        </div>
    </form>	
	</div>

	
  <div id="announcement">
      <div style="padding: 1em; margin-top: 5px; border-radius: 5px; border: 1px solid rgb(107, 43, 40); background: rgb(243, 227, 225);">
This is our old Q&amp;A Site. Please post any new questions and answers at <a href="https://ask.wireshark.org/">ask.wireshark.org</a>.
</div>
  </div>
  

<!-- end template header.html -->

        



<div id="wrapper">
    
    
    <div id="room">
        <div id="CALeft">
            
<div class="headNormal">
    <h1><a href="/questions/25765/editcap-and-tshark-performance">Editcap [and tshark] performance</a></h1>
</div>
<div id="main-body" class="">
    <div id="askform">
            <table style="width:100%;" id="question-table" >
                <tr>
                    <td style="width:30px;vertical-align:top">
                        <div class="vote-buttons">
                            

<a id="post-25765-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/25765/up/" rel="nofollow"> </a>
<div id="post-25765-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-25765-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/25765/down/" rel="nofollow"> </a>

                            

<a id="favorite-mark" title="mark/unmark this question as favorite (click again to cancel)"
    class="ajax-command favorite-mark "
    href="/mark_favorite/25765/" rel="nofollow"> </a>
<div id="favorite-count" class="favorite-count">
   
</div>

                        </div>
                    </td>
                    <td>
                        <div id="item-right">
                            <div class="question-body">
                                <p>I have a 9.59GB pcap that I am running editcap -D from 1 to 1000000 exponentially. There are 13751611 packets in the file. I have a dedicated Win 7 Ent. VM on an ESXi server with 26GB RAM with 2 dual-core 3GHz CPUs. It took 234991 seconds to process the command with a window of 1000000. The command took only 1.5 GB of RAM and the CPUs didn't seem very taxed. Is there a way to get this to finish faster? </p>
<p>I realize that BBP is to cut the files into smaller chunks when analyzing them for better speeds, but if I do it breaks the coherence of the -D window.</p>
                            </div>
                            <div id="question-tags" class="tags-container tags">
                                
                                    <a href="/tags/performance/" class="post-tag tag-link-performance"
                                        title="see questions tagged 'performance'" rel="tag">performance</a>
                                
                            </div>
                            <div id="question-controls" class="post-controls">
                                

                                

                            </div>
                            <div class="post-update-info-container">
                                    
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        asked
        <strong>08 Oct '13, 14:50</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/9231d57e09cb52e00e39dede07ab6ad3?s=32&amp;d=identicon&amp;r=g" alt="karl's gravatar image" />
    <p><a href="/users/5838/karl">karl</a><br/>
    <span class="score" title="16 reputation points">16</span><span title="2 badges"><span class="badge1">&#9679;</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">&#9679;</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">&#9679;</span><span class="badgecount">5</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="karl has no accepted answers">0&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/25765/">
                edited
                <strong>08 Oct '13, 14:51</strong>
            </a>
        </p>
        
    </div>


                            </div>
                            




<div class="comments-container" id="comments-container-25765">
    
</div>
<div id="comment-tools-25765" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-25765-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                        </div>

                    </td>
                </tr>
            </table>
            
            
                <hr/>
                <div class="tabBar">
                    <a name="sort-top"></a>
                    <div class="headQuestions">
                    2 Answers:
                    </div>
                    
<div class="tabsA"><a href="/questions/25765/editcap-and-tshark-performance?sort=active" title="most recently updated answers/comments will be shown first">active answers</a><a href="/questions/25765/editcap-and-tshark-performance?sort=oldest" title="oldest answers will be shown first">oldest answers</a><a href="/questions/25765/editcap-and-tshark-performance?sort=newest" title="newest answers will be shown first">newest answers</a><a href="/questions/25765/editcap-and-tshark-performance?sort=votes" class="on" title="most voted answers will be shown first">popular answers</a></div>

                </div>
                

                
                    <a name="25766"></a>
                    <div id="answer-container-25766" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-25766-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/25766/up/" rel="nofollow"> </a>
<div id="post-25766-score" class="post-score"
    title="current number of votes">
    1
</div>
<a id="post-25766-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/25766/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>Is there a reason why you use a window of 1 million frames? If you're deduplicating frames that are a result of multi SPAN sources you should be getting good to perfect results with windows a fraction that size - I'm using 100 myself quite often, and it almost never fails. Duplicates that editcap removes are appearing within a couple of milliseconds at most, often single digit microseconds - it makes no sense to waste performance on a huge window of 1 million frames.</p>
<p>I don't think RAM size and CPU are the problem, it's probably more the disk I/O and the searching in the huge list of MD5 hashes that takes the longest time. If I were you I'd do a test run with a window of 100 frames to see how fast it performs, maybe on a smaller trace at first.</p>
<p>Update: wait, what do you mean by "running exponentially"? Are you saying that you start with -D 1, then -D 2, -D 3, until -D 1000000? If so: seriously? why would you do that?</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/25766/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Oct '13, 15:28</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" alt="Jasper's gravatar image" />
    <p><a href="/users/145/jasper">Jasper ♦♦</a><br/>
    <span class="score" title="23806 reputation points"><span class="">23.8k</span></span><span title="5 badges"><span class="badge1">&#9679;</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">&#9679;</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">&#9679;</span><span class="badgecount">284</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Jasper has 263 accepted answers">18&#37;</span>
    </p>
</div>

    <div class='post-update-info post-update-info-edited'>
        <p style="line-height:12px;">
            <a href="/revisions/25766/">
                edited
                <strong>08 Oct '13, 15:30</strong>
            </a>
        </p>
        
    </div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-25766">
    
        <a name="25770"></a>
        <div class="comment" id="comment-25770">
            <div id="post-25770-score" class="comment-score"></div>
            <div class="comment-text"><p>I am comparing the removal behavior of editcap -D.</p>

<p>By "running exponentially" I mean -D 1, -D 2, -D 3, -D 5, -D 6, -D 10, -D 17, -D 31, -D 56, -D 100, -D 177, -D 316, -D 562, -D 1000, ..., -D 562341, -D 1000000.</p>

<p>With this when I chart the plot on a log scale I have discretionary points early in the beginning, and ramp up exponentially to have a mid point and two points near it (one to the left and one to the right) in addition to the major magnitudes. </p>

<p>I have run the test on 3 other files removed pkts are shown. 
93578 pkts, 55MB = default 153 (0.12%), max 3412 (3.65%)
578197 pkts, 340MB = default 2736 (0.47%), max 21036 (3.64%)
1393760 pkts, 948MB = default 6126 (0.44%), max 14329 (1.03%)
This file:
13751611 pkts, 9.59GB = default 61701 (0.45%), max 129128 (0.94%)</p>

<p>The resultant curves are not purely linear, but have steps/ramps. </p>

<p>Why would there be any differences between two magnitudinally equal gigantic window sizes?</p></div>
            <div class="comment-info" id="comment-25770-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 16:17)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
        <a name="25772"></a>
        <div class="comment" id="comment-25772">
            <div id="post-25772-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Why would there be any differences between two magnitudinally equal gigantic window sizes?</p>
</blockquote>

<p>Different frame sizes will take different times for the MD5 hash calculation.</p></div>
            <div class="comment-info" id="comment-25772-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 16:44)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="25773"></a>
        <div class="comment" id="comment-25773">
            <div id="post-25773-score" class="comment-score"></div>
            <div class="comment-text"><p>Sorry, I mean differences in packets removed.</p></div>
            <div class="comment-info" id="comment-25773-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 16:47)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
        <a name="25774"></a>
        <div class="comment" id="comment-25774">
            <div id="post-25774-score" class="comment-score"></div>
            <div class="comment-text"><p>What do you mean? I assume the capture files are different !?</p></div>
            <div class="comment-info" id="comment-25774-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 17:13)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="25776"></a>
        <div class="comment not_top_scorer" id="comment-25776">
            <div id="post-25776-score" class="comment-score"></div>
            <div class="comment-text"><p>I have ran -D 100000 and had 128,887 pkts removed and then -D 177827 and had 128,987 pkts removed. By extending the window size by 77,827 the 100 pkts were removed. I wouldn't suspect any packets would be removed at this point, but they are. Is there a way to get a feel for how long 177827 packets are in seconds in relation to my capture?</p></div>
            <div class="comment-info" id="comment-25776-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 17:41)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
        <a name="25777"></a>
        <div class="comment not_top_scorer" id="comment-25777">
            <div id="post-25777-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>Is there a way to get a feel for how long 177827 packets are in seconds in relation to my capture?</p>
</blockquote>

<p>Just look at the time stamps. Select one frame, set a time reference (CTRL-T), then scroll forward 177827 frames and check the delta in the time column.</p></div>
            <div class="comment-info" id="comment-25777-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 17:52)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="25779"></a>
        <div class="comment" id="comment-25779">
            <div id="post-25779-score" class="comment-score">1</div>
            <div class="comment-text"><p>editcap -D may remove additional frames that are very distant to each other but not duplicates (false positives). A common example are BPDU frames - if the Spanning Tree is stable (and it should be) ALL BPDU frames are bitwise identical, but 3 seconds apart. It is quite possible that with huge ranges like yours you'll detect them as duplicates at some point (3 seconds being an eternity in networks, but with your range you'll eventually find things like that).</p></div>
            <div class="comment-info" id="comment-25779-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 23:24)</span>
                <a class="comment-user userinfo" href="/users/145/jasper">Jasper ♦♦</a>
                
            </div>
        </div>
    
        <a name="25784"></a>
        <div class="comment not_top_scorer" id="comment-25784">
            <div id="post-25784-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>ALL BPDU frames are bitwise identical, but 3 seconds apart. It is quite possible that with huge ranges like yours you'll detect them as duplicates at some point</p>
</blockquote>

<p>good one! +1</p></div>
            <div class="comment-info" id="comment-25784-info">
                
                
                
                

                

                <span class="comment-age">(09 Oct '13, 01:46)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="25843"></a>
        <div class="comment not_top_scorer" id="comment-25843">
            <div id="post-25843-score" class="comment-score"></div>
            <div class="comment-text"><p>Is there a way to put the duplicate packets in their own file to inspect them?</p></div>
            <div class="comment-info" id="comment-25843-info">
                
                
                
                

                

                <span class="comment-age">(09 Oct '13, 10:23)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-25766" class="comment-tools">
    
        <span class="comments-showing">
            showing 5 of 9
        </span>
        <a href="#" class="show-all-comments-link">show 4 more comments</a>
    
    
</div>




<div class="clear"></div>
<div id="comment-25766-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                    <a name="25771"></a>
                    <div id="answer-container-25771" class="answer ">
                        <table style="width:100%;">
                            <tr>
                                <td style="width:30px;vertical-align:top">
                                    <div class="vote-buttons">
                                        

<a id="post-25771-upvote" title="I like this post (click again to cancel)"
    class="ajax-command post-vote up "
     href="/vote/25771/up/" rel="nofollow"> </a>
<div id="post-25771-score" class="post-score"
    title="current number of votes">
    0
</div>
<a id="post-25771-downvote" title="I dont like this post (click again to cancel)"
    class="ajax-command post-vote down"
     href="/vote/25771/down/" rel="nofollow"> </a>

                                        


    



                                    </div>
                                </td>
                                <td>
                                    <div class="item-right">
                                        <div class="answer-body">
                                            <p>From the <a href="http://www.wireshark.org/docs/man-pages/editcap.html">editcap man page</a></p>
<pre>NOTE: Specifying large &lt;dup time="" window=""&gt; values with large tracefiles can result in very long processing times for editcap.
</pre>

<p>I guess you hit that constraint ;-)</p>
<blockquote>
<p>I am running editcap -D from 1 to 1000000 exponentially. There are 13751611 packets in the file</p>
</blockquote>
<p>This will end up in 13751611 MD5 calculations <strong>and</strong> roughly 13751611 * 1000000 MD5 comparisons (minus a few at the beginning because there are less MD5 sums than the window size). The later (MD5 sum comparisons) will kill your execution time.</p>
<blockquote>
<p>Is there a way to get this to finish faster? </p>
</blockquote>
<p>Try to narrow down the window and then run editcap with the 'optimized' window size.</p>
<p>Here is how I would do it.</p>
<ul>
<li>Read the pcap file with a script (like Perl Net::Pcap or Python Scapy)</li>
<li>Create a MD5 sum of each packet (full bytes!)</li>
<li>Print: 'MD5 hash'; 'Frame number'</li>
<li>At the end of the pcap file: Sort the output (MD5 hashes)</li>
<li>Read the sorted output and try to find two consecutive identical (duplicate) MD5 hashes. If you find one: Subtract the frame numbers and store that as max window. Repeat this step until the end. If you find a larger max window, replace the old value with the new value.</li>
<li>At the end: Print the max window value</li>
</ul>
<p>Take the <strong>max window</strong> value of your script, add 15% (just to be safe ;-)) and use that value as an input for editcap -D. BTW: If your max window is 0 (you did not find any duplicate MD5 hashes), you can skip editcap, as there are no duplicates.<br>
</p>
<p>I <strong>guess</strong> that this will be faster, because there are a ton less comparisons to make, however I have no prove (yet) :-) <strong>However:</strong> Maybe the sort operation will be heavy as well (or heavy as hell). I'm running some test right now ;-)</p>
<p><strong>++ UPDATE ++</strong> </p>
<p>O.K. you can ignore the sort operation. I created 100.000 fake frames of 1500 bytes length, calculated the MD5 sum and then sorted the sums.</p>
<p><strong>Result:</strong> 100.000 Frames</p>
<p>Create (/dev/urandom) and calculate MD5 sum: <strong>6m37.485s</strong><br>
Sort the MD5 sums: real <strong>0m0.186s</strong></p>
<p>So, sorting is ways faster than creating the MD5 sums. Who had thought of that? ;-)</p>
<p>My test was done in a VM on a latop and it took ~400 seconds for 100.000 frames. So it will take ~137 times longer for your capture file, which is ~55.000 seconds. Although this is much faster than your time, it is still 15 hours (mostly MD5 calculation)!! However your server is probably faster than my laptop.</p>
<p><strong>Pros and Cons:</strong></p>
<p><strong>Pro:</strong> If you're lucky, there are no duplicate MD5 sums, so you're done after the first step. <br>
<strong>Con:</strong> If things went wrong, you'll find the max window to be 1000000 (max of editcap), and then you'll have to run editcap on top, which means you just lost the 15 hours needed for pre-processing. However, how likely is it to have duplicates within a range of 1000000 packets ?!? </p>
<p>I guess that in real world scenarios you will find the max windows between 100 and 1000 as <a href="/users/145/jasper">@Jasper</a> also mentioned. So, if you want the 'exact' result, you can use my pre-processing method to speed up things. Otherwise, just use a window of 1000+ and rely on the 'rule of thumb' ;-)</p>
<p>Regards<br>
Kurt</p>
                                        </div>
                                        <div class="answer-controls post-controls">
                                            
<span class="action-link"><a rel="nofollow" title="answer permanent link" class="ajax-command withprompt  copy" href="/answer_link/25771/">permanent link</a></span>
                                            

                                        </div>
                                        <div class="post-update-info-container">
                                            
<div class='post-update-info post-update-info-user'>
    <p style="line-height:12px;">
        answered
        <strong>08 Oct '13, 16:29</strong>
    </p>
    <img class="gravatar" width="32" height="32" src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" alt="Kurt%20Knochner's gravatar image" />
    <p><a href="/users/2593/kurt-knochner">Kurt Knochner ♦</a><br/>
    <span class="score" title="24767 reputation points"><span class="">24.8k</span></span><span title="10 badges"><span class="badge1">&#9679;</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">&#9679;</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">&#9679;</span><span class="badgecount">237</span></span><br />
    
    <span title="Rate of the user's accepted answers" class="accept_rate">accept rate:</span>
    <span title="Kurt Knochner has 344 accepted answers">15&#37;</span>
    </p>
</div>


                                        </div>
                                        




<div class="comments-container" id="comments-container-25771">
    
        <a name="25775"></a>
        <div class="comment" id="comment-25775">
            <div id="post-25775-score" class="comment-score"></div>
            <div class="comment-text"><p>If all duplicate packet numbers can be deduced this way, then can these numbers be passed to editcap as parameters and the resultant files could be created quicker?</p></div>
            <div class="comment-info" id="comment-25775-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 17:33)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
        <a name="25778"></a>
        <div class="comment" id="comment-25778">
            <div id="post-25778-score" class="comment-score"></div>
            <div class="comment-text"><p>well ... no, because you obviously have way to many packets to remove (you mention 128987 in one comment). You simply cannot give that many options (frame numbers) to editcap.</p>

<p>Anyway, currently I don't get what you are trying to do. </p>

<ul>
<li>
<p>Why do you see that many duplicate frames with such a large gap between them (177827 frames)?</p>
</li>
<li>
<p>What kind of network are we talking about (1G/s, 10G/s, 40G/s)? </p>
</li>
<li>
<p>How do you capture?<br>
</p>
</li>
<li>
<p>Why do you need to eliminate duplicate frames?</p>
</li>
<li>
<p>Why did you run editcap "exponentially"? Is this just for fun, or a real world problem?</p>
</li>
</ul></div>
            <div class="comment-info" id="comment-25778-info">
                
                
                
                

                

                <span class="comment-age">(08 Oct '13, 17:56)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
        <a name="25842"></a>
        <div class="comment" id="comment-25842">
            <div id="post-25842-score" class="comment-score"></div>
            <div class="comment-text"><p>I don't know why there are still duplicates with window size of 177827. </p>

<p>The network is a lot slower. See capinfos from the original file:
File type: Wireshark - pcapng
File encapsulation: Ethernet
File size: 10305318996 bytes
Data size: 9848966269 bytes
Capture duration:
Data byte rate: 30071.70 bytes/sec
Data bit rate: 240573.61 bits/sec
Average packet size: 716.20 bytes
Average packet rate: 41.99 packets/sec</p>

<p>This implies the window (177827) is on average 1 hour 10 minutes and 35 seconds wide.</p>

<p>The capture was on a mirror port of a switch. A router took all users and then sent it over our [slow] WAN link.</p>

<p>I am eliminated duplicates because a "pro" said to. </p>

<p>I am running exponentially to prove <a href="/users/145/jasper">@Jasper</a>, your, mine, and the man pages expressed feeling of the rules of thumb. It's real world only for the sake of proving the capabilities of editcap -D. It's fun because it's a simple test... just super long.</p>

<p>My problem is that editcap doesn't seem to allocate memory correctly when memory is available.</p></div>
            <div class="comment-info" id="comment-25842-info">
                
                
                
                

                

                <span class="comment-age">(09 Oct '13, 10:20)</span>
                <a class="comment-user userinfo" href="/users/5838/karl">karl</a>
                
            </div>
        </div>
    
        <a name="25845"></a>
        <div class="comment" id="comment-25845">
            <div id="post-25845-score" class="comment-score"></div>
            <div class="comment-text"><blockquote>
<p>I don't know why there are still duplicates with window size of 177827. </p>
</blockquote>

<p>because there are a lot of possible 'candidates' if you look back that far.</p>

<ul>
<li><strong>ARP requests</strong> for the same address are identical</li>
<li>Cisco <strong>CDP</strong> frames are identical</li>
<li>Spanning Tree <strong>BPDUs</strong> are identical</li>
<li>many other broadcast frames are identical</li>
</ul>

<p>So, if you just go back far enough, you will <strong>always</strong> find some duplicates! But they are duplicate by nature and not due to an error on the network.</p>

<blockquote>
<p>This implies the window (177827) is on average 1 hour 10 minutes and 35 seconds wide.</p>
</blockquote>

<p>It really, really does not make sense to search for duplicates in that time window. Where should the real duplicate frames come from? Did circulate in a dark area of the network, just to pop out an hour later? Nah...</p>

<blockquote>
<p>I am eliminated duplicates because a "pro" said to. </p>
</blockquote>

<p>Greetings to your "pro". </p>

<p>If I was a "pro", I would eliminate duplicate frames only if I had a problem during analysis with them and not as a precaution. It costs time, it might cause confusion (sounds familiar ;-)), etc.</p>

<blockquote>
<p>My problem is that <strong>editcap doesn't seem to allocate memory correctly</strong> when memory is available.</p>
</blockquote>

<p>How do you get to this conclusion? editcap 'allocates' the memory for the max amount of MD5 hashes as a static data structure and then only a <strong>few</strong> more things dynamically. Why does it not allocate more memory? It does not need it. See the code.</p>

<p><strong>My overall recommendation:</strong> Simply stop doing, what you are doing, as it does not give you any real benefit, <strong>unless</strong> you have a real problem during the analysis phase with <strong>real</strong> duplicate frames. In contrary, it leads to massive confusion as we have seen in this discussion about phantom duplicate frames ;-)) Nevertheless, I thank you for asking this question, as I had a reason to check the editcap code and now I understand how that stuff works ;-))</p></div>
            <div class="comment-info" id="comment-25845-info">
                
                
                
                

                

                <span class="comment-age">(09 Oct '13, 13:26)</span>
                <a class="comment-user userinfo" href="/users/2593/kurt-knochner">Kurt Knochner ♦</a>
                
            </div>
        </div>
    
</div>
<div id="comment-tools-25771" class="comment-tools">
    
    
</div>




<div class="clear"></div>
<div id="comment-25771-form-container" class="comment-form-container">
    
</div>
<div class="clear"></div>



                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div class="paginator-container-left">
                    
                </div>
            
        <form id="fmanswer" action="/questions/25765/answer/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='jfctMg5eWCvAVvz6cb5sHaZpbP7ZrS7q' />
            <div style="clear:both">
            </div>

            
                <div style="padding:10px 0 0 0;">
                    <div class="headNormal">
                        
                            Your answer
                        
                    </div>
                </div>
                

                <div id="description" class="" >
                    <div id="wmd-button-bar" class="wmd-panel"></div>
                    <textarea cols="40" id="editor" name="text" rows="10"></textarea>
                    <div class="preview-toggle">
                        <table width="100%">
                            <tr>
                                <td>
                                    <span id="pre-collapse" 
                                        title="Toggle the real time Markdown editor preview">
                                            toggle preview
                                    </span>
                                </td>
                                <td style="text-align: right;" id="editor-metrics"></td>
                                
                                <td style="text-align:right;">
                                    <input id="id_wiki" name="wiki" type="checkbox" /> 
                                    <span style="font-weight:normal;cursor:help" 
                                        title="if you choose community wiki option, the question and answer do not generate points and name of author will not be shown">
                                            <label for="id_wiki">community wiki:</label> 
                                    </span>
                                </td>
                                
                            </tr>

                        </table>
                    </div>
                    
                    <div id="previewer" class="wmd-preview"></div>
                </div>

                

                <p><span class="form-error"></span></p>
                <input type="button"
                    
                        value="Login/Signup to Post Your Answer" 
                    
                    class="submit" style="float:left" onclick="submitClicked(event, this.form)"/>
            
        </form>
    </div>
</div>


        </div>
        <div id="CARight">
            
<div class="boxC" id="subscription_box">
    <h3 class="subtitle">Follow this question</h3><strong>By Email:</strong><p>Once you sign in you will be able to subscribe for any updates here</p><strong>By RSS:</strong><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/25765/editcap-and-tshark-performance?type=rss" title="subscribe to answers"></a>
    Answers
</p><p><a class="feed-icon" style="background-image:url('/m/default/media/images/feed-icon-small.png');"
        href="/questions/25765/editcap-and-tshark-performance?type=rss&comments=yes" title="subscribe to comments and answers"></a>
    Answers and Comments
</p>

</div>


<div class="boxC" id="editor_side_bar">
    <p class="subtitle darkred">Markdown Basics</p>
    <ul class="list-item">
        <li>
            *italic* or _italic_
        </li>
        <li>
			**bold** or __bold__
        </li>
        <li>
            <b>link</b>:[text](http://url.com/ "title")

        </li>

        <li>
            <b>image</b>?![alt text](/path/img.jpg "title")

        </li>
        <li>
			numbered list:
            1.  Foo
            2.  Bar
        </li>
        <li>
			to add a line break simply add two spaces to where you would like the new line to be.
        </li>
        <li>
			basic HTML tags are also supported
        </li>
    </ul>
    <p class='info-box-follow-up-links'>
        <a href="/markdown_help/" target="_blank">learn more about Markdown </a>
    </p>
</div>



<div id="sidebar-upper" class="boxC">
    <div class="body">
        <h2>You have a trillion packets.</h2>
<h3>You need to see four of them.</h3>
<p><a href="http://www.riverbed.com/products-solutions/products/network-performance-management/">Riverbed Technology</a> lets you seamlessly move between packets and flows for comprehensive monitoring, analysis and troubleshooting.</p>
<p><a href="http://www.riverbed.com/us/products/cascade/wireshark_enhancements/"><img style="margin-left: 39px;" src="https://www.wireshark.org/image/logo_riverbed_150.png"></a></p>
<p>Riverbed is Wireshark's primary sponsor and provides our funding.</p>
     </div>
</div>




<div class="boxC">
    <p>
        Question tags:
    </p>
    <p class="tags" >
        
        <a href="/tags/performance/"
            class="tag-link-performance"
            title="see questions tagged'performance'using tags"
            rel="tag">performance</a> <span class="tag-number">&#215;55</span><br/>
        
    </p>
    <p>
        question asked: <strong title="Oct. 8, 2013, 2:50 p.m.">08 Oct '13, 14:50</strong>
    </p>
    <p> 
     	question was seen: <strong>2,667 times</strong>
    </p>
    <p> 
        last updated: <strong title="Oct. 9, 2013, 1:26 p.m.">09 Oct '13, 13:26</strong>
    </p>
</div>


<div id="sidebar-lower" class="boxC">
    <div class="body">
        <h2>Don't have Wireshark?</h2>
<p>What are you waiting for? It's free! Wireshark documentation and downloads can be found at the <a href="https://www.wireshark.org/"><strong>Wireshark web site</strong></a>.</p>
     </div>
</div>


<div class="boxC">
    <h3 class="subtitle">Related questions</h3>
    <div class="questions-related">

        
        <p>
            <a href="/questions/346/wireshark-performance-freezing-when-stopping-capture-closing-file">Wireshark performance - freezing when stopping capture / closing file</a>
        </p>
        
        <p>
            <a href="/questions/18467/simulate-low-bandwidth-or-high-latency">simulate low-bandwidth or high-latency</a>
        </p>
        
        <p>
            <a href="/questions/38443/wireshark-opening-vs-exporting-performance">Wireshark opening vs exporting performance</a>
        </p>
        
        <p>
            <a href="/questions/52515/slow-application-response-times">Slow application response times</a>
        </p>
        
        <p>
            <a href="/questions/2075/very-slow-gui-when-running-wireshark-remotely">Very slow GUI when running wireshark remotely</a>
        </p>
        
        <p>
            <a href="/questions/19133/tshark-memory-consumption-and-temporary-file-usage">tshark memory consumption and temporary file usage</a>
        </p>
        
        <p>
            <a href="/questions/39163/tshark-command-to-find-answer-field-in-dns-query-response-with-more-than-1-answer-rrs">tshark command to find answer field in dns query response with more than 1 answer RRs</a>
        </p>
        
        <p>
            <a href="/questions/53703/slow-performance-on-aveva-software">slow performance on aveva software</a>
        </p>
        
        <p>
            <a href="/questions/2500/queries-regarding-http-protocol">queries regarding http protocol</a>
        </p>
        
        <p>
            <a href="/questions/19135/improving-performance">Improving performance</a>
        </p>
        

    </div>
</div>



        </div>
        <div id="tail" style="clear:both;">
            
            
        </div>
    </div>
    <div class="spacer3"></div>
</div>

        
            <div id="ground">
                


<div>
    <div class="footerLinks" >
         <a href="/about/" >about</a> <span class="link-separator"> |</span> <a href="/faq/" >faq</a> <span class="link-separator"> |</span> <a href="/privacy/" >privacy</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" target="_blank">support</a> <span class="link-separator"> |</span> <a href="https://bugs.wireshark.org/" >contact</a> 
    </div>
  <p>
        p&#8203;o&#8203;w&#8203;e&#8203;r&#8203;e&#8203;d by &#79;&#8203;&#83;&#8203;&#81;&#8203;&#65;
  </p>
</div>
 <div id="licenseLogo">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
            <img src="/m/default/media/images/by-sa-88x31.png" title="Creative Commons: Attribution - Share Alike" alt="cc-by-sa" width="88" height="31" />
  </a>
 </div>


            </div>
        
        

        
            <script type="text/javascript">
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-605389-6']);
                _gaq.push(['_trackPageview']);

                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            </script>
        
        </div>

        <!-- Put all elements with fixed position here, IE6 fixed position fix: http://ryanfait.com/position-fixed-ie6/ -->
        <div class="notify" style="display:none">
            
                
                    
                          <p class="darkred">First time here? Check out the <a href="/faq/">FAQ</a>!</p>
                    
                
            
            <a id="close-notify" onclick="notify.close(true)">&#215;</a>
        </div>
    </body>
</html>
<!-- end template base_content.html -->
