+++
type = "question"
title = "vlan filter"
description = '''Hello guys. the scenario below was implemented in GNS3; 1)For all PCs; Firewall:off, NIC Mode: Generic Driver. 2)on PC3, wireshark has installed. 3)The L3-Switch is a Router 2691 with module NM-ESW16. Now my question is; why can&#x27;t to capture traffic to PC3 from Vlan 5 or Vlan 10, while I set the wir...'''
date = "2014-07-09T06:14:00Z"
lastmod = "2014-07-11T00:49:00Z"
weight = 34500
keywords = [ "filter", "vlan" ]
aliases = [ "/questions/34500" ]
osqa_answers = 3
osqa_accepted = false
+++

<div class="headNormal">

# [vlan filter](/questions/34500/vlan-filter)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34500-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34500-score" class="post-score" title="current number of votes">0</div><span id="post-34500-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello guys. the scenario below was implemented in GNS3; 1)For all PCs; Firewall:off, NIC Mode: Generic Driver. 2)on PC3, wireshark has installed. 3)The L3-Switch is a Router 2691 with module NM-ESW16. Now my question is; why can't to capture traffic to PC3 from Vlan 5 or Vlan 10, while I set the wireshark to filter "vlan 5 and vlan 10"?? Thanks. <img src="https://osqa-ask.wireshark.org/upfiles/problem_1.png" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-filter" rel="tag" title="see questions tagged &#39;filter&#39;">filter</span> <span class="post-tag tag-link-vlan" rel="tag" title="see questions tagged &#39;vlan&#39;">vlan</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>09 Jul '14, 06:14</strong></p><img src="https://secure.gravatar.com/avatar/db00b14e3649ef46f9c87cb77617ea12?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="M_Bazgir&#39;s gravatar image" /><p><span>M_Bazgir</span><br />
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="M_Bazgir has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>09 Jul '14, 06:15</strong> </span></p></div></div><div id="comments-container-34500" class="comments-container"><span id="34545"></span><div id="comment-34545" class="comment"><div id="post-34545-score" class="comment-score"></div><div class="comment-text"><p>Hi guys. My previous scenario couldn't capture the vlans traffic because of incorrect configuration on the L3-Switch . now I corrected it to the scenario below and I used "Kurt knochner" and "Quadraric" guidance, but I still can't capture only the traffic of vlan 5 and vlan 10 via "vlan 5 and vlan 10" or "vlan and (ether[14:2]&amp;0xfff=5 or ether[14:2]&amp;0xfff=10)" filters, but when capturing without any filter, I see all the traffic from those Vlans. and now, where's the mistake?? my configuration and the filter are incorrect?? or GNS3 couldn't emulate/simulate it?? Thanks. this is the new scenario: <img src="https://osqa-ask.wireshark.org/upfiles/problem_1_smaller.png" alt="alt text" /></p></div><div id="comment-34545-info" class="comment-info"><span class="comment-age">(10 Jul '14, 02:08)</span> <span class="comment-user userinfo">M_Bazgir</span></div></div><span id="34548"></span><div id="comment-34548" class="comment"><div id="post-34548-score" class="comment-score"></div><div class="comment-text"><p>@M_Bazfir,</p><p>Arguably your last post should have been a new question (certainly not an answer) as the environment has changed enough to make the original answers a bit hard to follow, but on the other hand context is the same. We'll see how it goes.</p></div><div id="comment-34548-info" class="comment-info"><span class="comment-age">(10 Jul '14, 02:35)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div></div><div id="comment-tools-34500" class="comment-tools"></div><div class="clear"></div><div id="comment-34500-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="34504"></span>

<div id="answer-container-34504" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34504-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34504-score" class="post-score" title="current number of votes">1</div><span id="post-34504-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Please use this capture filter in Wireshark:</p><blockquote><p>'vlan and (ether[14:2]&amp;0xfff=5 or ether[14:2]&amp;0xfff=10)'</p></blockquote><p>Or use tcpdump/dumpcap:</p><blockquote><p>tcpdump -ni eth0 'vlan and (ether[14:2]&amp;0xfff=5 or ether[14:2]&amp;0xfff=10)'<br />
dumpcap -ni eth0 -f 'vlan and (ether[14:2]&amp;0xfff=5 or ether[14:2]&amp;0xfff=10)'<br />
</p></blockquote><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Jul '14, 07:28</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></img></div></div><div id="comments-container-34504" class="comments-container"><span id="34506"></span><div id="comment-34506" class="comment"><div id="post-34506-score" class="comment-score"></div><div class="comment-text"><p>Dear Kurt Knochner I test your filter and then ping and telnet to PC3, but didn't see any change or result, now what's your opinion about this?? where's the mistake??</p></div><div id="comment-34506-info" class="comment-info"><span class="comment-age">(09 Jul '14, 08:04)</span> <span class="comment-user userinfo">M_Bazgir</span></div></div><span id="34511"></span><div id="comment-34511" class="comment"><div id="post-34511-score" class="comment-score"></div><div class="comment-text"><blockquote><p>where's the mistake??</p></blockquote><p>According to your screenshot PC3 is in VLAN15. How did you ensure that the port of PC3 sees traffic from VLAN5 and VLAN10 ( like port mirroring)?</p><p>If you did nothing to make that happen, it's absolutely clear why you can't see the other vlans, as the idea of a vlan is to separate traffic from each other ;-))</p><p>BTW: Are the switch ports for PC1 and PC2 trunk ports? If no, you won't see anything with a vlan capture filter, as there will be no vlan tags!</p></div><div id="comment-34511-info" class="comment-info"><span class="comment-age">(09 Jul '14, 08:17)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34547"></span><div id="comment-34547" class="comment"><div id="post-34547-score" class="comment-score"></div><div class="comment-text"><blockquote><p>but when <strong>capturing without any filter</strong>, I <strong>see all the traffic from those Vlans</strong>. and now, <strong>where's the mistake??</strong></p></blockquote><ul><li>Either the configuration of the trunk port is not O.K.</li><li>or the port mirroring config is not O.K.</li><li>or GNS3 removes vlan tags,</li><li>or there are not vlan tags</li><li>or the NIC driver of your Wireshark PC removes the vlan tags</li></ul><p>Hard to tell, without the real switch config. Can you post the whole switch config somewhere and post a link here?</p><p>Furthermore: As already mentioned, if the device in the middle works as a L3 device (a router) and <strong>not</strong> as a L2 device (a switch), although you mentioned the switch module NM-ESW16 in your original question, then you will <strong>not see any VLAN tags</strong>!</p></div><div id="comment-34547-info" class="comment-info"><span class="comment-age">(10 Jul '14, 02:29)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34560"></span><div id="comment-34560" class="comment"><div id="post-34560-score" class="comment-score"></div><div class="comment-text"><p>Dear Kurt Knochner you were right. NIC of PCs in wireshark can not detect Vlan Tagging. but there's a problem; after I connect the LoopBack adapter to the fa 1/7 on L2-Switch2 instead of PC3, I can capture only the traffic of vlans via "vlan and (ether[14:2]&amp;0xfff=5 or ether[14:2]&amp;0xfff=10)" but these traffic didn't contain ICMP traffic.!!!!! what's your thinking??</p></div><div id="comment-34560-info" class="comment-info"><span class="comment-age">(10 Jul '14, 06:35)</span> <span class="comment-user userinfo">M_Bazgir</span></div></div><span id="34561"></span><div id="comment-34561" class="comment"><div id="post-34561-score" class="comment-score"></div><div class="comment-text"><blockquote><p>but these traffic didn't contain ICMP traffic.!!!!!</p></blockquote><p>ICMP traffic from where to where?</p><p>Did you see other traffic, like TCP and/or UDP?</p><p>Can you please post the capture file you have taken with the vlan filter on <a href="https://appliance.cloudshark.org/upload/">https://appliance.cloudshark.org/upload/</a> and post the link here?</p></div><div id="comment-34561-info" class="comment-info"><span class="comment-age">(10 Jul '14, 06:39)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34564"></span><div id="comment-34564" class="comment not_top_scorer"><div id="post-34564-score" class="comment-score"></div><div class="comment-text"><p>ICMP from PC1&amp;PC2 to PC4. This is the link, I uploaded Configurations too. <a href="http://cld.persiangig.com/download/zpIXNNmjgm/Config%26Cap.zip/dl">http://cld.persiangig.com/download/zpIXNNmjgm/Config%26Cap.zip/dl</a> Regards.</p></div><div id="comment-34564-info" class="comment-info"><span class="comment-age">(10 Jul '14, 07:38)</span> <span class="comment-user userinfo">M_Bazgir</span></div></div><span id="34567"></span><div id="comment-34567" class="comment not_top_scorer"><div id="post-34567-score" class="comment-score"></div><div class="comment-text"><p>There are several problems with the router/switch configurations, as far as I can see. <strong>However</strong> I don't know the module NM-ESW16 good enough to give any good advice.</p><p>Let's start with one thing (L2-Switch left side):</p><ul><li>You configured a trunk port on FastEthernet1/8, but you did not specify any VLAN on that port. So, I wonder why the whole setup works that way. Maye the NM-ESW16 automatically adds all VLANs to a trunk port if nothing is specified. I <strong>doubt</strong> that, but I don't know for sure, as I said: I don't know that module good enough.</li></ul><p>Maybe you take the following config example and read some other docs about the cisco vlan configuration to fix your <strong>Cisco configuration</strong></p><p><a href="http://www.cisco.com/c/en/us/support/docs/interfaces-modules/network-modules/82156-ether-switch-nm-config.html">http://www.cisco.com/c/en/us/support/docs/interfaces-modules/network-modules/82156-ether-switch-nm-config.html</a></p><p>Furthermore, I have the feeling that your question shifts away from a Wireshark 'problem' (as there is none - the vlan filter I posted works, if the environment is set up properly) and moves towards several cisco/GNS3 configuration issues. As cisco/GNS3 questions are off-topic for this site, I suggest to ask further IOS/GNS3 configuration questions in the appropriate forums, as you will get much better answers there ;-) You are welcome to ask Wireshark related questions here, as soon as your setup works.</p></div><div id="comment-34567-info" class="comment-info"><span class="comment-age">(10 Jul '14, 10:27)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34591"></span><div id="comment-34591" class="comment not_top_scorer"><div id="post-34591-score" class="comment-score"></div><div class="comment-text"><p>Thank you very much, the link was so useful, and I could capture ICMP traffic too, but the vlans filters problem didn't solve. ;-) maybe I must do ii in real environment. again and again Thanks for your guidance. :)</p></div><div id="comment-34591-info" class="comment-info"><span class="comment-age">(11 Jul '14, 00:49)</span> <span class="comment-user userinfo">M_Bazgir</span></div></div></div><div id="comment-tools-34504" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-34504-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="34502"></span>

<div id="answer-container-34502" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34502-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34502-score" class="post-score" title="current number of votes">0</div><span id="post-34502-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Maybe the answers in this question can shed some light: <a href="http://ask.wireshark.org/questions/31953/unusual-behavior-with-stacked-vlan-tags-and-capture-filter">http://ask.wireshark.org/questions/31953/unusual-behavior-with-stacked-vlan-tags-and-capture-filter</a></p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Jul '14, 06:21</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span> </br></p></div></div><div id="comments-container-34502" class="comments-container"></div><div id="comment-tools-34502" class="comment-tools"></div><div class="clear"></div><div id="comment-34502-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="34533"></span>

<div id="answer-container-34533" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34533-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34533-score" class="post-score" title="current number of votes">0</div><span id="post-34533-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>As written, PC3 will see traffic from the other two subnets as sources toward it, but vlan information is not preserved across an L3 gateway and as tags they exist only on interfaces that act as layer 2 trunks for the vlan in question. The "vlan" filter is looking for tags specifically, but in your diagram you have three direct L3 links toward a router.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Jul '14, 22:03</strong></p><img src="https://secure.gravatar.com/avatar/f533c5f20f9c9afbf4b03de08a100e11?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Quadratic&#39;s gravatar image" /><p><span>Quadratic</span><br />
<span class="score" title="1885 reputation points"><span>1.9k</span></span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="28 badges"><span class="bronze">●</span><span class="badgecount">28</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Quadratic has 23 accepted answers">13%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>09 Jul '14, 22:05</strong> </span></p></div></div><div id="comments-container-34533" class="comments-container"></div><div id="comment-tools-34533" class="comment-tools"></div><div class="clear"></div><div id="comment-34533-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

