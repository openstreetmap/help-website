+++
type = "question"
title = "Why acknowledgments sent early than window size reached during TCP session?"
description = '''Good day. I sniffered just a regular ftp download and noticed that ACK from client are sent every 2KB received:  I checked receive window size from client (window size in ACK message)and it size is 65536  So far I know theory of TCP window size determine the amount of data that can be sent before AC...'''
date = "2015-05-27T05:22:00Z"
lastmod = "2015-05-27T06:04:00Z"
weight = 42695
keywords = [ "window", "tcp", "wireshark" ]
aliases = [ "/questions/42695" ]
osqa_answers = 0
osqa_accepted = true
+++

<div class="headNormal">

# [Why acknowledgments sent early than window size reached during TCP session?](/questions/42695/why-acknowledgments-sent-early-than-window-size-reached-during-tcp-session)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-42695-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Good day.</p><p>I sniffered just a regular ftp download and noticed that ACK from client are sent every 2KB received:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/sniff.jpg" alt="alt text" /></p><p>I checked receive window size from client (window size in ACK message)and it size is 65536</p><p><img src="https://osqa-ask.wireshark.org/upfiles/window_size.jpg" alt="alt text" /></p><p>So far I know theory of TCP window size determine the amount of data that can be sent before ACK but here I observe very different behavior. Can somebody make it clear - what rule used here to send ACK packets?</p></div><div id="question-tags" class="tags-container tags">window tcp wireshark</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 May '15, 05:22</strong></p><img src="https://secure.gravatar.com/avatar/4f86795c7a782fccae8a0b7bd270d1d8?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mongolio&#39;s gravatar image" /><p>mongolio<br />
<span class="score" title="21 reputation points">21</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="9 badges"><span class="bronze">●</span><span class="badgecount">9</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mongolio has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p>edited 27 May '15, 20:15</p></div></div><div id="comments-container-42695" class="comments-container"></div><div id="comment-tools-42695" class="comment-tools"></div><div class="clear"></div><div id="comment-42695-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="42697"></span>

<div id="answer-container-42697" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-42697-score" class="post-score" title="current number of votes">3</div></div></td><td><div class="item-right"><div class="answer-body"><p>The TCP window size is the amount of data <strong>can</strong> be sent before an ACK is <strong>required</strong>. It doesn't mean that the receiver has to wait that long before acknowledging.</p><p>The normal rule is to acknowledge every other packet, so you get an ACK after two packets. The reason is that it is better to ACK in a constant way to keep the flow going, because if you ACK only when the window size is reached you have to wait one full roundtrip time before you can continue to send. ACKs that come in while sending move the window forward and allow the sender to continue without every having to wait.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 May '15, 06:04</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p>Jasper ♦♦<br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></img></div></div><div id="comments-container-42697" class="comments-container"><span id="42702"></span><div id="comment-42702" class="comment"><div id="post-42702-score" class="comment-score"></div><div class="comment-text"><p>And what in case if one packet will be lost on the way from server to client? Server will stop receiving ACK, but will keep sending packets till window size reached and only after that will start retransmission of all segments he sent till previous ACK?</p></div><div id="comment-42702-info" class="comment-info"><span class="comment-age">(27 May '15, 07:37)</span> mongolio</div></div><span id="42704"></span><div id="comment-42704" class="comment"><div id="post-42704-score" class="comment-score">1</div><div class="comment-text"><p>if a packet is lost the receiver will continue to ack every second packet, but the ACK number will be the one just before the gap. Those ACKs are marked by Wireshark as "Duplicate ACK". They signal packet loss.</p><p>Depending on the TCP stack of the sender it will then trigger the retransmission sooner or later; one of the mechanisms is the "Fast Retransmission" which is performed after receiving two or three duplicate ACKs (which is why we call the trigger "triple duplicate ACK"). Alternatively you may see a Retransmission using SACK (Selective Acknowledgements), which pinpoint the missing segments by specifying the sequence number edges of the gap.</p><p>So no, modern TCP stacks don't keep sending until the Window is full; they'll try to recover from packet loss as early as possible to avoid long delays until the retransmission fills the gap.</p></div><div id="comment-42704-info" class="comment-info"><span class="comment-age">(27 May '15, 07:50)</span> Jasper ♦♦</div></div><span id="42708"></span><div id="comment-42708" class="comment not_top_scorer"><div id="post-42708-score" class="comment-score"></div><div class="comment-text"><p>Tnx for great clarifications! BTW one more question - so there is no any sense in having big window size with modern applications and TCP window scale option is rudiment?</p></div><div id="comment-42708-info" class="comment-info"><span class="comment-age">(27 May '15, 09:18)</span> mongolio</div></div><span id="42710"></span><div id="comment-42710" class="comment"><div id="post-42710-score" class="comment-score">2</div><div class="comment-text"><p>Window size is important, depending on bandwidth and round trip time. The higher the bandwidth and the higher the RTT the higher the window size must be. This has nothing to do with modern applications. In LAN networks small window sizes are sufficient; on WAN links you need large window sizes.</p></div><div id="comment-42710-info" class="comment-info"><span class="comment-age">(27 May '15, 12:46)</span> Jasper ♦♦</div></div><span id="42782"></span><div id="comment-42782" class="comment not_top_scorer"><div id="post-42782-score" class="comment-score"></div><div class="comment-text"><blockquote><blockquote><blockquote><p>So no, modern TCP stacks don't keep sending until the Window is full; they'll try to recover from packet loss as early as possible to avoid long delays until the retransmission fills the gap.</p></blockquote></blockquote></blockquote><p>Jasper, two more question here 1) is not window already full when sender receives first Duplicate ACK? As I understand if it received Duplicate ACK than RTT already passed from moment unacknowledged segment was send and during RTT sender must already transmit data amount equal to receive window size.</p><p>2) Am I understand correctly that with Fast Retransmission time required to resend lost segment can be only slightly better than with Adaptive retransmission timer, cos RTT will be passed anyway by the time of raction in both cases?</p></div><div id="comment-42782-info" class="comment-info"><span class="comment-age">(01 Jun '15, 01:38)</span> mongolio</div></div><span id="42786"></span><div id="comment-42786" class="comment"><div id="post-42786-score" class="comment-score">1</div><div class="comment-text"><p>1) no, only sometimes. A Duplicate ACK is sent when the receiver detects packet loss, meaning, when it receives a sequence number that is higher than expected. Window full happens occasionally when the advertised window size wasn't large enough to keep sending packets when that happened.</p><p>2) that depends on how good the timer is - reacting to two Duplicate ACKs is pretty consistent, and can only be beat by SACK edges. Timers are always prone to errors, e.g. retransmitting too soon (resulting in a "Spurious Retransmission") or retransmitting too late (resulting in a slow connection)</p></div><div id="comment-42786-info" class="comment-info"><span class="comment-age">(01 Jun '15, 03:00)</span> Jasper ♦♦</div></div><span id="42808"></span><div id="comment-42808" class="comment not_top_scorer"><div id="post-42808-score" class="comment-score"></div><div class="comment-text"><p>Jasper, thanks a lot for your patience and willing in helping me to get grasp of some basic principles of TCP!</p><p>1) Can you please point me where i am wrong in my understanding: Receive window size is an amount of data that a sender can transfer to a receiver during one RTT period (this comes from BDP formula). So when the sender receives Duplicate ACK signaling about packet lost, RTT from the moment the lost packet was sent has already passed, and if the sender use packet size equal to MSS during transmission than amount of data equal to a window size must already be in the sender buffer.</p><p>2) &gt; that depends on how good the timer is So far I have heard only about Adaptive TCP retransmission algorithm used to calculate out smooth time to wait until start retransmission of the segment where TCP Timeout=SRTT+4*Svar. Are there another algorithm used in modern TCP stack implementations?</p></div><div id="comment-42808-info" class="comment-info"><span class="comment-age">(01 Jun '15, 10:46)</span> mongolio</div></div><span id="42810"></span><div id="comment-42810" class="comment"><div id="post-42810-score" class="comment-score">1</div><div class="comment-text"><p>1) true, but only on paper. In reality, modern TCP stacks don't stop at the BDP window size; instead they keep increasing it for a while to allow more than what fits into an RTT period. Otherwise a single lost packet may slow everything down because of what you said.</p><p>2) yes, you still sometimes see a fixed 3 seconds delay on the evil odd packet, meaning, if you have a connection where the last packet is an odd number (meaning nothing follows it to trigger the ACK) you may run into this. It's not that common these days anymore though.</p></div><div id="comment-42810-info" class="comment-info"><span class="comment-age">(01 Jun '15, 10:58)</span> Jasper ♦♦</div></div><span id="42829"></span><div id="comment-42829" class="comment not_top_scorer"><div id="post-42829-score" class="comment-score"></div><div class="comment-text"><p>Many thanks for clarifications!</p></div><div id="comment-42829-info" class="comment-info"><span class="comment-age">(02 Jun '15, 08:51)</span> mongolio</div></div></div><div id="comment-tools-42697" class="comment-tools"><span class="comments-showing"> showing 5 of 9 </span> <a href="#" class="show-all-comments-link">show 4 more comments</a></div><div class="clear"></div><div id="comment-42697-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

