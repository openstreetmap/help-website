+++
type = "question"
title = "Live capture Using pipes"
description = '''How to setup Wireshark to capture Live packets thrown to Pipe. Currently Only once packet can be captured on Wireshark using Named Pipes. I want to setup like Whenever I through Packets to Pipe, it should be shown in queue in Wireshark. So that it feels like Live capturing from Pipes. -Ankit'''
date = "2015-09-07T23:42:00Z"
lastmod = "2015-09-15T22:14:00Z"
weight = 45693
keywords = [ "pipe", "pcapng", "pcap", "pcap_open_live", "wireshark" ]
aliases = [ "/questions/45693" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Live capture Using pipes](/questions/45693/live-capture-using-pipes)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-45693-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-45693-score" class="post-score" title="current number of votes">2</div><span id="post-45693-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>How to setup Wireshark to capture Live packets thrown to Pipe. Currently Only once packet can be captured on Wireshark using Named Pipes. I want to setup like Whenever I through Packets to Pipe, it should be shown in queue in Wireshark. So that it feels like Live capturing from Pipes.</p><p>-Ankit</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-pipe" rel="tag" title="see questions tagged &#39;pipe&#39;">pipe</span> <span class="post-tag tag-link-pcapng" rel="tag" title="see questions tagged &#39;pcapng&#39;">pcapng</span> <span class="post-tag tag-link-pcap" rel="tag" title="see questions tagged &#39;pcap&#39;">pcap</span> <span class="post-tag tag-link-pcap_open_live" rel="tag" title="see questions tagged &#39;pcap_open_live&#39;">pcap_open_live</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>07 Sep '15, 23:42</strong></p><img src="https://secure.gravatar.com/avatar/e172d561cbb66f3dbeb3ed34d6bbf694?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Ankit%20Patel&#39;s gravatar image" /><p><span>Ankit Patel</span><br />
<span class="score" title="36 reputation points">36</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Ankit Patel has no accepted answers">0%</span></p></div></div><div id="comments-container-45693" class="comments-container"><span id="45697"></span><div id="comment-45697" class="comment"><div id="post-45697-score" class="comment-score"></div><div class="comment-text"><p>sounds like named pipes are not what you want. Can you please add your definition of "pipe" and how you would like to start Wireshark (CLI example)?</p></div><div id="comment-45697-info" class="comment-info"><span class="comment-age">(08 Sep '15, 05:08)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45720"></span><div id="comment-45720" class="comment"><div id="post-45720-score" class="comment-score"></div><div class="comment-text"><p>On Manage Interface selection I am creating new pipe @ /tmp/myfifo and then start capture on that. Meanwhile throwing .pcap file onto that Pipe i.e. cat ip_packet.pcap &gt; /tmp/myfifo</p><p>Now Wireshark captures this file and shows onto GUI.</p><p>If I send another .pcap file onto that pipe then it won't show on GUI. I have to restart capture then only it displays received packet on pipe.</p><p>I have to create one application which throws packets and Wireshark captures packets and monitors continuously. Is this Possible?</p><p>-Ankit</p></div><div id="comment-45720-info" class="comment-info"><span class="comment-age">(08 Sep '15, 21:29)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div></div><div id="comment-tools-45693" class="comment-tools"></div><div class="clear"></div><div id="comment-45693-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="45722"></span>

<div id="answer-container-45722" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-45722-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-45722-score" class="post-score" title="current number of votes">0</div><span id="post-45722-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>If I send another .pcap file onto that pipe then it won't show on GUI.</p></blockquote><p>If Wireshark reads from a named pipe, it expects the same file structure as it would find in a pcap file, meaning pcap header, then captured frames. So, if you write the pcap file to the named pipe in the first step, it will work. When you cat another pcap file to the named pipe, it won't work as Wireshark does not expect to see a second pcap file header.</p><p>So, if you want to 'throw' several pcap files at Wireshark through a named pipe, your program needs to read the pcap files and 'throw' only the captured frames to the named pipe together with a valid pcap file header in the first step.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Sep '15, 22:25</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-45722" class="comments-container"><span id="45723"></span><div id="comment-45723" class="comment"><div id="post-45723-score" class="comment-score"></div><div class="comment-text"><p>So in Live Capture mode, if 1000 packets received from LAN then Wireshark creates 1000 times pcap file with modified Header?</p></div><div id="comment-45723-info" class="comment-info"><span class="comment-age">(08 Sep '15, 22:32)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45724"></span><div id="comment-45724" class="comment"><div id="post-45724-score" class="comment-score"></div><div class="comment-text"><p>No. If Wireshark captures from a network interface it does <em>not <strong>expect a pcap</strong> file structure</em>* as there won't be one. Instead it reads the frames from the network interface and stores it in memory and/or a temp file. As soon as you tell Wireshark to save the captured frames, it will write a pcap file with the appropriate file structure to store the captured frames.</p></div><div id="comment-45724-info" class="comment-info"><span class="comment-age">(08 Sep '15, 22:36)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45726"></span><div id="comment-45726" class="comment"><div id="post-45726-score" class="comment-score">1</div><div class="comment-text"><p>But How Wireshark shows live capture? Previously you mentioned that Wireshark expects pcap files to display onto GUI</p></div><div id="comment-45726-info" class="comment-info"><span class="comment-age">(08 Sep '15, 22:42)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45727"></span><div id="comment-45727" class="comment not_top_scorer"><div id="post-45727-score" class="comment-score"></div><div class="comment-text"><blockquote><p>But How Wireshark shows live capture?</p></blockquote><p>??? Please elaborate!</p><p>If Wireshark captures the frames, where would you see a problem to show them in the GUI?</p></div><div id="comment-45727-info" class="comment-info"><span class="comment-age">(08 Sep '15, 23:07)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45729"></span><div id="comment-45729" class="comment not_top_scorer"><div id="post-45729-score" class="comment-score"></div><div class="comment-text"><p>While capturing from eth0. Wireshark shows live packet capture.As it receives packet it displays it. I need to create same scenario using pipe. As it captures packet it should be appended in display in Wireshark.</p></div><div id="comment-45729-info" class="comment-info"><span class="comment-age">(08 Sep '15, 23:58)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45730"></span><div id="comment-45730" class="comment not_top_scorer"><div id="post-45730-score" class="comment-score"></div><div class="comment-text"><blockquote><p>As it captures packet it should be appended in display in Wireshark</p></blockquote><p>if you want to <strong>capture</strong> from a named pipe, run:</p><blockquote><p>wireshark -ni /tmp/pipe -k</p></blockquote><p>Then write a <strong>valid</strong> data structure to /tmp/pipe, meaning only frames as they would appear on eth0</p><p>if you want to <strong>read</strong> a capture file from a named pipe, run:</p><blockquote><p>wireshark -nr /tmp/pipe</p></blockquote><p>Then write a <strong>valid</strong> data structure to /tmp/pipe, meaning a valid pcap file.</p></div><div id="comment-45730-info" class="comment-info"><span class="comment-age">(09 Sep '15, 00:31)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45734"></span><div id="comment-45734" class="comment not_top_scorer"><div id="post-45734-score" class="comment-score"></div><div class="comment-text"><p>So here is the question,</p><p>I need to create one application which sends IP packets with some time interval. Wireshark should be able to capture IP packets and display it. Wireshark displays one packet as it received and poll for another packet as it receives another packet, it displays in second raw and then third and so on.</p><p>Now Wireshark only accepts pcap formats onto pipe I need to generate pcap of first IP packet and send it to created PIPE. After that I need to create another pcap file with two IP packets(One previous and one current) and send it to wireshark.</p><p>What I am facing is Wireshark reads first pcap file but then for second file, I need to restart the capture manually. Is it possible to set autorestart after receiving packets from pipe?</p></div><div id="comment-45734-info" class="comment-info"><span class="comment-age">(09 Sep '15, 02:44)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45737"></span><div id="comment-45737" class="comment not_top_scorer"><div id="post-45737-score" class="comment-score"></div><div class="comment-text"><p>Have you tried sending the libpcap global header first and then each packet independently with its own packet header (as seen in <a href="https://wiki.wireshark.org/Development/LibpcapFileFormat).">https://wiki.wireshark.org/Development/LibpcapFileFormat).</a> I do not understand why you claim that you would need to create new pcap files for each dumped packet (containing previous an new packets). To summarize: when creating the pipe, try sending once the global header and then send each packet with its own packet header. It should work fine.</p></div><div id="comment-45737-info" class="comment-info"><span class="comment-age">(09 Sep '15, 06:16)</span> <span class="comment-user userinfo">Pascal Quantin</span></div></div><span id="45745"></span><div id="comment-45745" class="comment not_top_scorer"><div id="post-45745-score" class="comment-score"></div><div class="comment-text"><p>Yes I tried to send Global header using Pipe. It shows error message like "No packets captured! As no data was captured, closing the temporary capture file!"</p><p>If I send file which includes Global header and 1 packet header followed by data then it works. But another packets it won't capture.</p><p>I think Wireshark close the pipe as soon as something has captured. Wireshark dosen't continuously polls for the next packet from the Pipe.</p></div><div id="comment-45745-info" class="comment-info"><span class="comment-age">(10 Sep '15, 01:27)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45772"></span><div id="comment-45772" class="comment not_top_scorer"><div id="post-45772-score" class="comment-score"></div><div class="comment-text"><p>can you please post some information about your code or the way you tried to write the pcap header to the pipe and <strong>how</strong> you started Wireshark (with -r or -i)!?!</p></div><div id="comment-45772-info" class="comment-info"><span class="comment-age">(10 Sep '15, 18:33)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45774"></span><div id="comment-45774" class="comment not_top_scorer"><div id="post-45774-score" class="comment-score"></div><div class="comment-text"><p>Using below command to start capturing from Pipe wireshark -ni /tmp/myfifo -k</p><p>Sending pcap header to the pipe using below command cat global_header.pcap &gt; /tmp/myfifo</p><p>Wireshark gives error on receiving Global Header file</p><p>If I send pcap file which contains Global Header + Packet Header + Packet data then it captures properly. cat packet_with_global_header.pcap &gt; /tmp/myfifo</p><p>But I want to send another packet without restarting wireshark capture i.e. cat another_packet.pcap &gt; /tmp/myfifo and wireshark should capture another packet and displays in the packet queue. but wireshark dosen't do anything. It requires start new capture.</p></div><div id="comment-45774-info" class="comment-info"><span class="comment-age">(10 Sep '15, 21:53)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45798"></span><div id="comment-45798" class="comment not_top_scorer"><div id="post-45798-score" class="comment-score"></div><div class="comment-text"><blockquote><p>But I want to send another packet without restarting wireshark capture i.e. cat another_packet.pcap</p></blockquote><p>O.K. again, as you might have missed the point. If you <strong>cat</strong> another pcap to the same named pipe, you are <strong>NOT</strong> just sending another packet, you are sending <strong>another pcap</strong> file, including headers, etc. This will not work!</p></div><div id="comment-45798-info" class="comment-info"><span class="comment-age">(11 Sep '15, 14:05)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="45822"></span><div id="comment-45822" class="comment"><div id="post-45822-score" class="comment-score">3</div><div class="comment-text"><p>Ankit,</p><p>for continuous run, your application must not use "cat" to send packets to the pipe (regardless whether the Global Header would be sent before the packet), it must act as a pipe server completely.</p><p>Wireshark does not close (or, better, does not stop reading) the pipe as soon as it receives something; it stops reading the pipe as soon as the sending side disconnects from the pipe, which is what happens when the "cat" finishes sending the file.</p><p>With each press of "start capture", Wireshark connects to the named pipe as its client and expects to receive the Global Header first of all and only once. Next, it processes all the packets (Packet Header followed by Packet data) as they come and appends them to the running capture, until:</p><p>a) the server disconnects from the pipe,<br />
b) you press the "stop capture" button - in this case, Wireshark disconnects from the pipe.</p><p>So for continuous run of the capture, your application must:<br />
1) create the pipe (or connect to existing one as server),<br />
2) wait (and trash eventual packets to be sent) until the pipe indicates that a client is connected (using some pipe-&gt;State function),<br />
3) send the Global Header once (using some pipe-&gt;Write function, NOT using cat)<br />
4) send packets (Packet Header followed by Packet data) using pipe-&gt;Write<br />
</p><p>Unless you expect all that to run forever, the application should check that a client is still connected before sending each packet. When a client disconnects (because you have stopped the capture), the application may either end or get back to step 2).</p><p>HTH, Pavel</p></div><div id="comment-45822-info" class="comment-info"><span class="comment-age">(13 Sep '15, 04:49)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="45844"></span><div id="comment-45844" class="comment not_top_scorer"><div id="post-45844-score" class="comment-score"></div><div class="comment-text"><p>Sindy,</p><p><strong>3) send the Global Header once (using some pipe-&gt;Write function, NOT using cat)</strong></p><p>Folllowed steps as suggested by you but as soon as I wrote Global Header onto that pipe using pipe write method, Wireshark stops capturing of packet and shows "No packets captured! As no data was captured, closing the temporary capture file"</p></div><div id="comment-45844-info" class="comment-info"><span class="comment-age">(15 Sep '15, 02:18)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div><span id="45858"></span><div id="comment-45858" class="comment not_top_scorer"><div id="post-45858-score" class="comment-score"></div><div class="comment-text"><p>If not done yet, I suggest you to have a look at <a href="https://wiki.wireshark.org/CaptureSetup/Pipes">https://wiki.wireshark.org/CaptureSetup/Pipes</a></p><p>Given what you describe, it gives the feeling that you are closing the pipe after writing the global header. But without knowing more about what you are really doing, it's hard to tell more.</p></div><div id="comment-45858-info" class="comment-info"><span class="comment-age">(15 Sep '15, 09:26)</span> <span class="comment-user userinfo">Pascal Quantin</span></div></div><span id="45860"></span><div id="comment-45860" class="comment"><div id="post-45860-score" class="comment-score">1</div><div class="comment-text"><p>Ankit,</p><p>not knowing the OS &amp; programming language you use but using my own (fresh and limited) experience with the subject, and after reading again what you wrote so far, I dare to follow Pascal's general suspicion to a more specific one - that you use pipe-&gt;Write function but terminate the application after sending the Global Header (and possibly the first packet). And when the time comes to forge the next packet, you run your application again. However, an inevitable consequence of termination of the application is its disconnection from the pipe, as the application's next run will be a new process with a new PID. Am I right?</p><p>If I am wrong and your application runs continuously but despite that Wireshark stops capturing after receiving the first packet, could you post the code (maybe leaving out the packet contents construction but definitely including the startup and shutdown of the application)?</p><p>Pascal,</p><p>the wiki page you've suggested is misleading in one significant point - if I get it right, as of now Wireshark does NOT accept pcap-ng through a pipe. I've crashed my mouth on that a few days ago (using last stable which is 1.12.7), as I was looking for other cause of the trouble until I've found somewhere else that still only pcap is accepted.</p><p>Also the example with cat of a pcap file into the pipe may be misleading for people (like me and possibly Ankit) who are not aware of the fact that Wireshark watches the state of the sending end of the pipe and stops capturing when the source application disconnects from or even deletes the pipe. I too have expected that the pipe exists independently of the sender application and that Wireshark would keep listening to the pipe until manual stop of the capture, regardless what happens on the sending end.</p><p>I don't feel qualified enough to edit that page, but if you do, could you make it more correct (pcap-ng) and more detailed (pipe tracking), please?</p><p>Merci P.</p></div><div id="comment-45860-info" class="comment-info"><span class="comment-age">(15 Sep '15, 13:30)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="45870"></span><div id="comment-45870" class="comment not_top_scorer"><div id="post-45870-score" class="comment-score"></div><div class="comment-text"><p>Sindy,</p><p>Yes you are correct. I am terminating my code and that was the reason of pipe disconnection. Now I am able to send continuously Packets using pipe.</p><p>Thanks..</p></div><div id="comment-45870-info" class="comment-info"><span class="comment-age">(15 Sep '15, 22:14)</span> <span class="comment-user userinfo">Ankit Patel</span></div></div></div><div id="comment-tools-45722" class="comment-tools"><span class="comments-showing"> showing 5 of 17 </span> <a href="#" class="show-all-comments-link">show 12 more comments</a></div><div class="clear"></div><div id="comment-45722-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

