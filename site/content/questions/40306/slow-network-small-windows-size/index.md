+++
type = "question"
title = "Slow network small windows size"
description = '''Hi, I am troubleshooting slowness for Citrix running over a site to site VPN. The site also has a considerable number of users browsing the web. I have run a packet capture on the firewall to capture all traffic and am trying to provide data as to prove where the slowness is. It&#x27;s not slow all the t...'''
date = "2015-03-05T14:21:00Z"
lastmod = "2015-03-12T09:42:00Z"
weight = 40306
keywords = [ "slow" ]
aliases = [ "/questions/40306" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Slow network small windows size](/questions/40306/slow-network-small-windows-size)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40306-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40306-score" class="post-score" title="current number of votes">1</div><span id="post-40306-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, I am troubleshooting slowness for Citrix running over a site to site VPN. The site also has a considerable number of users browsing the web. I have run a packet capture on the firewall to capture all traffic and am trying to provide data as to prove where the slowness is. It's not slow all the time. I have noticed that when I run a filter for (tcp.window_size&lt;1460)&amp;&amp;(tcp.flags.reset==0) I get back a lot of packets and a considerable number are around a windows size of 100. This is from multiple clients but what exactly does this mean or could someone tell me what I need to be looking at next to help the situation. Thanks I'm pretty new to Wireshark : )</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-slow" rel="tag" title="see questions tagged &#39;slow&#39;">slow</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>05 Mar '15, 14:21</strong></p><img src="https://secure.gravatar.com/avatar/68ce515bc08f1da09ed2200c8aca252c?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Costello&#39;s gravatar image" /><p><span>Costello</span><br />
<span class="score" title="30 reputation points">30</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Costello has no accepted answers">0%</span></p></div></div><div id="comments-container-40306" class="comments-container"></div><div id="comment-tools-40306" class="comment-tools"></div><div class="clear"></div><div id="comment-40306-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="40308"></span>

<div id="answer-container-40308" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40308-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40308-score" class="post-score" title="current number of votes">1</div><span id="post-40308-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Troubleshooting Citrix (or any remote desktop) traffic is probably among the most complicated analysis problems you can run into. That's because those protocols are highly asynchronous, other than traditional request/response protocols, so it's kinda hard to tell when something took too long when it shouldn't have. Especially since all those protocols are proprietary and can't be decoded with Wireshark (well, the Citrix-capapable commercial analyzers I've seen do not impress me with their decode abilities, either).</p><p>The window size is a good indicator if it gets pretty low - 100 byte (scaled) is not a lot. Rule of thumb is that there should always be at least two segments of Window Size, e.g. 2* 1460 bytes, so 100 bytes is very low. Often, Citrix is run on thin clients which are not strong enough to handle high resolution flash movies, so you'll see window sizes go down in those situations. Low window sizes often indicate weak hardware, so maybe you can compare results with stronger/fat client hardware.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>05 Mar '15, 15:09</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-40308" class="comments-container"><span id="40455"></span><div id="comment-40455" class="comment"><div id="post-40455-score" class="comment-score"></div><div class="comment-text"><p>Apologies on the points I'm not fully up to speed yet on the site. How many points can be awarded? can they be split among responders. Thanks.</p></div><div id="comment-40455-info" class="comment-info"><span class="comment-age">(11 Mar '15, 01:48)</span> <span class="comment-user userinfo">Costello</span></div></div><span id="40460"></span><div id="comment-40460" class="comment"><div id="post-40460-score" class="comment-score"></div><div class="comment-text"><p>Generally we don't bother with awarding points, rather just accept the best answer using the check mark icon and vote up other good answers with the thumbs up icon.</p></div><div id="comment-40460-info" class="comment-info"><span class="comment-age">(11 Mar '15, 02:28)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div></div><div id="comment-tools-40308" class="comment-tools"></div><div class="clear"></div><div id="comment-40308-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="40310"></span>

<div id="answer-container-40310" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40310-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40310-score" class="post-score" title="current number of votes">1</div><span id="post-40310-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>Hi, I am troubleshooting slowness for Citrix <strong>running over a site to site VPN</strong>. The site also has a <strong>considerable number of users browsing the web.</strong> I have run a packet capture on the firewall to capture all traffic and am trying to provide data as to prove where the slowness is. <strong>It's not slow all the time.</strong></p></blockquote><p>There are thre magic keywords/phrases:</p><ul><li>VPN tunnel for Citrix traffic</li><li>considerable number users browsing the web</li><li>It's not slow all the time</li></ul><p>I'll assume you are connecting through a VPN tunnel from a remote site to the central site and the central site is where the "considerable number" of users are browsing the web.</p><p>If that assumption is correct, please think about a bandwidth consumption and/or RTT problem.</p><p>What can you do:</p><ul><li>Try to look at the RTT graph for the Citrix connection(s) at different times during the day (TCP Stream Graph -&gt; Round Trip Time Graph). Do you see any correlation with the amount of user surf traffic?</li><li>Run somkeping and/or other tools to measure the RTT through the VPN tunnel throughout the day and compare that with link statistics of your internet router at the cnetral site.</li><li>Is the VPN tunnel TCP based (SSL VPN) or UDP/IP based (IPSEC)? SSL VPNs (TCP) can develop bad performance if the RTT is increasing and/or if the available bandwidth is decreasing.</li></ul><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>05 Mar '15, 16:23</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-40310" class="comments-container"><span id="40454"></span><div id="comment-40454" class="comment"><div id="post-40454-score" class="comment-score"></div><div class="comment-text"><p>Super responses thank you very much</p></div><div id="comment-40454-info" class="comment-info"><span class="comment-age">(11 Mar '15, 01:46)</span> <span class="comment-user userinfo">Costello</span></div></div><span id="40466"></span><div id="comment-40466" class="comment"><div id="post-40466-score" class="comment-score"></div><div class="comment-text"><p>You're welcome. Any results based on the RTT analysis?</p></div><div id="comment-40466-info" class="comment-info"><span class="comment-age">(11 Mar '15, 03:38)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="40508"></span><div id="comment-40508" class="comment"><div id="post-40508-score" class="comment-score"></div><div class="comment-text"><p>I have taken an RTT graph and although its not related to the Citrix issue it does relate to the sites that Citrix runs over. In addition to running Citrix these sites also download AV updates and send logs to a central server that sits on the same network as the Citrix servers (its a branch office head office type scenario). I have run wireshark on the AV server in head office and set a capture filter for just the remote sites IP. The RTT graph would seem to indicate a device is queuing traffic? <a href="https://drive.google.com/file/d/0B5Av_KyDN-WVVnlxRVVBWUhXNW8/view?usp=sharing">https://drive.google.com/file/d/0B5Av_KyDN-WVVnlxRVVBWUhXNW8/view?usp=sharing</a></p></div><div id="comment-40508-info" class="comment-info"><span class="comment-age">(12 Mar '15, 01:49)</span> <span class="comment-user userinfo">Costello</span></div></div><span id="40509"></span><div id="comment-40509" class="comment"><div id="post-40509-score" class="comment-score"></div><div class="comment-text"><blockquote><p>The RTT graph would seem to indicate a device is queuing traffic?</p></blockquote><p>well, that's hard to tell by looking at just a single RTT graph.</p></div><div id="comment-40509-info" class="comment-info"><span class="comment-age">(12 Mar '15, 02:11)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="40515"></span><div id="comment-40515" class="comment"><div id="post-40515-score" class="comment-score"></div><div class="comment-text"><p>Not only is it hard to tell from a single RTT graph, as Kurt said, but Wireshark does not implement the RTT graph correctly. See <a href="https://ask.wireshark.org/questions/38607/rtt-graph-showing-values-higher-than-tcpanalysisack_rtt">https://ask.wireshark.org/questions/38607/rtt-graph-showing-values-higher-than-tcpanalysisack_rtt</a> . The RTT graph values will not be correct if delayed ACK is in use. They should be correct if delayed ACK is not in use. To see correct round-trip times, use the I/O graph as mentioned at that link.</p></div><div id="comment-40515-info" class="comment-info"><span class="comment-age">(12 Mar '15, 09:42)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div></div><div id="comment-tools-40310" class="comment-tools"></div><div class="clear"></div><div id="comment-40310-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

