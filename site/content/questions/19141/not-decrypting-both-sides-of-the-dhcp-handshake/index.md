+++
type = "question"
title = "Not decrypting both sides of the DHCP handshake"
description = '''Hello. I have AirPcap/Wireshark running on windows (both xp-32bit and 7-64bit). I need to capture the DHCP handshake in order to get further with the support desk of two wireless AP vendors (how far down the rabbit hole am I? A long way :) I need to solve this as the WiFi module in the product we ar...'''
date = "2013-03-04T21:48:00Z"
lastmod = "2013-03-04T21:48:00Z"
weight = 19141
keywords = [ "dhcp", "802.11", "decryption" ]
aliases = [ "/questions/19141" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Not decrypting both sides of the DHCP handshake](/questions/19141/not-decrypting-both-sides-of-the-dhcp-handshake)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-19141-score" class="post-score" title="current number of votes">1</div><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>Hello.</p><p>I have AirPcap/Wireshark running on windows (both xp-32bit and 7-64bit).</p><p>I need to capture the DHCP handshake in order to get further with the support desk of two wireless AP vendors (how far down the rabbit hole am I? A long way :)</p><p>I need to solve this as the WiFi module in the product we are developing doesn't always complete the DHCP handshake with certain AP vendor's equipment, and their response is "show me one where it works".</p><p>I can successfully enter encryption information into wireshark and for the most part it seems to decrypt packets happily.</p><p>The problem I have is that while wireshark decodes the DHCP discover/request side of the handshake, it will not decode the DHCP offer/acknowledgement. I can see the wireless AP send the 802.11 ack frame, and I can see it send packets (which must be the offer/ack), but wireshark does not decode them.</p><p>I know the DHCP handshake is working since I get an IP address and can see on the AP that the IP address is allocated to my MAC address.</p><p>Wireshark also quite happily the decodes the ARP request <strong><em>and the reply</em></strong> without any problems. Which is the strange bit, why can it decode a packet received literally two packets later?</p><p>Why will it not decode the AP's DHCP responses?</p><p>I have tried to capture this for 4 different AP vendors that work, and in all cases I cannot get the full DHCP handshake.</p><p>I have also tried to do this at my lab bench and now also at home (where the "air" is rather more "quiet" :)</p><p>I have a capture file if that is of any use.</p><p>Sorry if this has been asked somewhere else, I have searched high and low, but cannot find anyone else mentioning this problem. Any help greatly appreciated.</p><p>Thanks in advance,</p><p>Bryan</p></div><div id="question-tags" class="tags-container tags">dhcp 802.11 decryption</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>04 Mar '13, 21:48</strong></p><img src="https://secure.gravatar.com/avatar/0178ce886f70c3371eebe6e7dd2cb3fd?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Bryan&#39;s gravatar image" /><p>Bryan<br />
<span class="score" title="26 reputation points">26</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Bryan has no accepted answers">0%</span></p></div></div><div id="comments-container-19141" class="comments-container"><span id="19144"></span><div id="comment-19144" class="comment"><div id="post-19144-score" class="comment-score"></div><div class="comment-text"><p>What version of Wireshark? Posting the capture file along with the key would help diagnosis, try <a href="http://cloudhark.org">Cloudshark</a>. Make sure the capture doesn't contain anything sensitive before uploading it.</p></div><div id="comment-19144-info" class="comment-info"><span class="comment-age">(05 Mar '13, 00:53)</span> grahamb ♦</div></div><span id="19159"></span><div id="comment-19159" class="comment"><div id="post-19159-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I need to capture the DHCP handshake in order to get further with the support desk of two wireless AP vendors</p></blockquote><p>are you having problems with DHCP request from clients that are being sent through the AP <strong>or</strong> with DHCP requests from the AP itself (to get an IP address for the AP)?</p><blockquote><p>I have a capture file if that is of any use.</p></blockquote><p>Yes, please post it somewhere. As @grahamb suggested, you can use cloudshark.org or any other file hosting service (google docs, dropbox, etc.)</p></div><div id="comment-19159-info" class="comment-info"><span class="comment-age">(05 Mar '13, 10:45)</span> Kurt Knochner ♦</div></div><span id="19260"></span><div id="comment-19260" class="comment"><div id="post-19260-score" class="comment-score"></div><div class="comment-text"><p>I am using version 1.8.5 of wireshark.</p><p>The problem is that wireshark decrypts and displays the DHCP discover/request from my device, but not the DHCP offer/ack from the AP. Yet, the ARP request and ARP reply following this are.</p><p>Capture file is here <a href="https://www.dropbox.com/s/bybifuz5f4xji3m/dhcp_not_decrpyted.pcapng">https://www.dropbox.com/s/bybifuz5f4xji3m/dhcp_not_decrpyted.pcapng</a></p><p>Decryption info: wpa-psk:8b224ebd5981625fc831aece0d622df1b69997e7f06c2c25a8c54e6dd8a54763</p><p>Salient packet numbers are:</p><p>EAPOL (249) DHCP discover (265) DHCP offer (guess 328) DHCP ack (guess 377) ARP req/rsp: 378-381</p><p>Thanks again, and sorry for my tardy follow up.</p><p>Bryan</p></div><div id="comment-19260-info" class="comment-info"><span class="comment-age">(06 Mar '13, 20:25)</span> Bryan</div></div><span id="19261"></span><div id="comment-19261" class="comment"><div id="post-19261-score" class="comment-score"></div><div class="comment-text"><p>PS. I've just tried the development version and 1.8.6. No change.</p></div><div id="comment-19261-info" class="comment-info"><span class="comment-age">(06 Mar '13, 21:09)</span> Bryan</div></div><span id="19349"></span><div id="comment-19349" class="comment"><div id="post-19349-score" class="comment-score"></div><div class="comment-text"><p>Bump. Sorry but I've just fallen off page one. Did anyone check my capture file? TIA Bryan</p></div><div id="comment-19349-info" class="comment-info"><span class="comment-age">(11 Mar '13, 01:29)</span> Bryan</div></div><span id="21558"></span><div id="comment-21558" class="comment not_top_scorer"><div id="post-21558-score" class="comment-score"></div><div class="comment-text"><p>Hi Bryan,</p><p>I have the same problem. I can see the dhcp discover and the dhcp request. Also I can see some packets from wired side that I Think is the replys but it not readable. I run WS 1.10.RC2 because of 802.11 decryption problems in 1.8.x</p><p>Regs Paul</p></div><div id="comment-21558-info" class="comment-info"><span class="comment-age">(29 May '13, 06:15)</span> Paul_Holmgren</div></div><span id="21559"></span><div id="comment-21559" class="comment not_top_scorer"><div id="post-21559-score" class="comment-score"></div><div class="comment-text"><p>WS <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=8446">Bug 8446</a></p></div><div id="comment-21559-info" class="comment-info"><span class="comment-age">(29 May '13, 06:16)</span> Paul_Holmgren</div></div></div><div id="comment-tools-19141" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-19141-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

