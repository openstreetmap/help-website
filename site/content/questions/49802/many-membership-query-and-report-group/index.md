+++
type = "question"
title = "Many Membership Query and Report Group"
description = '''Hello there, I have 2 questions, which are surely linked: I can&#x27;t find the answer why my Cisco SF300 Switch, which is the Multicast querier as per its low IP, is sending many Membership Query packets on the network, like almost 10 per second, to the destination 239.255.255.250. All my clients comput...'''
date = "2016-02-03T20:32:00Z"
lastmod = "2016-02-06T02:35:00Z"
weight = 49802
keywords = [ "igmpv2", "multicast" ]
aliases = [ "/questions/49802" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Many Membership Query and Report Group](/questions/49802/many-membership-query-and-report-group)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-49802-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-49802-score" class="post-score" title="current number of votes">0</div><span id="post-49802-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello there, I have 2 questions, which are surely linked: I can't find the answer why my Cisco SF300 Switch, which is the Multicast querier as per its low IP, is sending many Membership Query packets on the network, like almost 10 per second, to the destination 239.255.255.250. All my clients computers are getting those of course. I would understand if it was only one packet every 120 seconds or so, but no, it's 5 to 10 packets every seconds. Any idea why?</p><p>The second question regards one and only one computer device (10.16.120.15) on the LAN (out of 7 total computers), sends a Membership report group to 239.255.255.250, once or twice every second. Why so many Membership report group packets are beeing sent?</p><p>I should add to this that no Multicast server is active on the network, no computer client has a VLC or anything opened and nobody is trying to get the multicast traffic. Only we configured Multicast V4 and Snooping on ALL (100%) of our 3 switches for a future possible need for it. The switches have been recently rebooted, the configurations are in place, the firmware of the switch is the lastest. Wireshark is the lastest 2.0.1, and Windows 8.1 updated and activated is on the computers.</p><p>Any clue would be much appreciated. Y.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-igmpv2" rel="tag" title="see questions tagged &#39;igmpv2&#39;">igmpv2</span> <span class="post-tag tag-link-multicast" rel="tag" title="see questions tagged &#39;multicast&#39;">multicast</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>03 Feb '16, 20:32</strong></p><img src="https://secure.gravatar.com/avatar/0d34cdc32519fc3c7ebcbbfa3aa5873a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="thewol&#39;s gravatar image" /><p><span>thewol</span><br />
<span class="score" title="21 reputation points">21</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="thewol has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>03 Feb '16, 20:33</strong> </span></p></div></div><div id="comments-container-49802" class="comments-container"><span id="49805"></span><div id="comment-49805" class="comment"><div id="post-49805-score" class="comment-score"></div><div class="comment-text"><p>Can you share the capture (filtered down to IGMP only, i.e. first apply a display filter <code>igmp</code>, then use <code>File -&gt; Export Specified Packets -&gt; All packets / Displayed</code>)?</p></div><div id="comment-49805-info" class="comment-info"><span class="comment-age">(03 Feb '16, 22:02)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="49877"></span><div id="comment-49877" class="comment"><div id="post-49877-score" class="comment-score"></div><div class="comment-text"><p>The capture for the first question is here: <a href="http://pandasoftware.free.fr/membershipquery.pcapng">http://pandasoftware.free.fr/membershipquery.pcapng</a> A capture for the second might not come as it seems to be gone after I deactivated Multicast and activated it back on the querier switch. Thank you for any advice!</p></div><div id="comment-49877-info" class="comment-info"><span class="comment-age">(04 Feb '16, 19:58)</span> <span class="comment-user userinfo">thewol</span></div></div><span id="49878"></span><div id="comment-49878" class="comment"><div id="post-49878-score" class="comment-score"></div><div class="comment-text"><p>So, the old 'turn it off and back on again' solved this?</p></div><div id="comment-49878-info" class="comment-info"><span class="comment-age">(04 Feb '16, 22:17)</span> <span class="comment-user userinfo">Jaap ♦</span></div></div><span id="49883"></span><div id="comment-49883" class="comment"><div id="post-49883-score" class="comment-score"></div><div class="comment-text"><p><span></span><span>@thewol</span>, you have provided just a single packet, so it ain't that easy to find the time relationship between packets, the source MACs of the individual packets, whether there are general queries mixed between the group queries... maybe you could post another one with all igmp packets which came, say, during three minutes?</p><p>So starting from what <em>can</em> be seen: as the Query indicates maximum response time of 1 second, I cannot see anything strange about such packets to be sent multiple times per second - this is a precaution against lost or missed query frames.</p><p>Now why the querying switch chooses a response time of one second is a designer (or configuration) choice. If the switch wants to track the status of eventual multicast recipients "in real time", 1 second is quite fine. I guess you wouldn't be happy to wait for the picture from a TV channel for two minutes after you've ordered it. If all three switches send their queries twice per second and don't filter other switches' queries out, you've got 6 queries per second.</p><p>So the "only" unexplained point remains what made the switch keep sending a query for a particular group (which is what I've hoped to see from the capture).</p><p>A logical scenario for me would be that the switch periodically sends general queries (for Group 0, so a member of any group can answer), and for each group for which it receives a response to the general query, it starts tracking the state of that group using group queries. So I would expect that at some point in the past, the PC has responded to the general query with the address of the group whose address you can see in the group queries.</p><p>I wouldn't be surprised if you'd find out that some application using multicast was not running at the PC at the time you've looked at it but was running there before, and when closed, it hasn't "tidied up" properly so the network stack continued to respond the IGMP queries.</p><p>There are white points in this theory (has the PC's network stack stopped responding because there was a gap in the queries as you've restarted the switch? Do <em>all</em> the three switches query the same group so restart of just one of them does not stop the group queries to be sent?).</p><p>So I would disable the IGMP on all three switches at the same time for five minutes, then re-enable it and capture again, and I would deem the theory confirmed if I would find only see general queries in the capture.</p></div><div id="comment-49883-info" class="comment-info"><span class="comment-age">(05 Feb '16, 00:06)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="49889"></span><div id="comment-49889" class="comment"><div id="post-49889-score" class="comment-score"></div><div class="comment-text"><p>Dear all, Thank you for your first help. Here is a new capture file into which we can see the two behaviors I was requesting help for:</p><p><a href="http://pandasoftware.free.fr/igmpv2thewol.pcapng">http://pandasoftware.free.fr/igmpv2thewol.pcapng</a></p><p>The old 'turn it off and back on did not solve it! This capture has been taken after your suggestion of turning off Multicast on all 3 switches for 5 or more minutes, and turning it back on on the switches.</p></div><div id="comment-49889-info" class="comment-info"><span class="comment-age">(05 Feb '16, 01:34)</span> <span class="comment-user userinfo">thewol</span></div></div><span id="49890"></span><div id="comment-49890" class="comment not_top_scorer"><div id="post-49890-score" class="comment-score"></div><div class="comment-text"><p>I should have been more specific when describing the capture conditions. To solve the chicken or egg problem, we need to have a capture which starts while the multicast is still off on all switches, so that we could see the beginning of the storm as you enable multicast on the first switch. If this is true for the capture you've just taken, then all my theory is wrong and I give up.</p><p>And I agree that 20 targeted queries per second look strange if all of them query the same group, come from the same source MAC address, and have a 1 s response timeout. But still it may be a designer's choice.</p></div><div id="comment-49890-info" class="comment-info"><span class="comment-age">(05 Feb '16, 02:41)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="49920"></span><div id="comment-49920" class="comment not_top_scorer"><div id="post-49920-score" class="comment-score"></div><div class="comment-text"><p>Thank you for your help and ideas. Here is a new capture file into which we can see the two behaviors I was requesting help for, this time ask requested I activated Multicast while capturing, switch 205, 204, and then 203, that should be the querier by its low IP number:</p><p><a href="http://pandasoftware.free.fr/igmpv2thewol2.pcapng">http://pandasoftware.free.fr/igmpv2thewol2.pcapng</a></p><p>THank you in advance for any good ideas on why so many packets are send, while no listener nor multicast sender is opened nowhere on the network.</p></div><div id="comment-49920-info" class="comment-info"><span class="comment-age">(06 Feb '16, 01:25)</span> <span class="comment-user userinfo">thewol</span></div></div><span id="49921"></span><div id="comment-49921" class="comment not_top_scorer"><div id="post-49921-score" class="comment-score"></div><div class="comment-text"><blockquote><p>ideas on why so many packets are sent</p></blockquote><p>Wireshark shows you <em>what</em> happens; to find out <em>why</em> it happens, you need to look at the applications responsible for sending the packets. So maybe there is some timer in the Cisco which controls the frequency of sending the group queries, and maybe there is not. Refer to Cisco documentation.</p><p>Because you haven't provided any network diagram, I can only assume that you capture at a machine connected to switch .203.</p><p>During the time when the switch .205 is the only one with IGMP on, the other switches let the IGMP packets go through but do not react on them. As soon as you switch on IGMP on .204, it stops forwarding IGMP from .205, and the same happens when you switch on IGMP on .203.</p><p>It seems, however, that it is a bit more complex:</p><ul><li><p>the two general queries from .205 indicate response time 10 seconds, which implies that it should send another 10 seconds after the last one at latest, but the capture doesn't show this. The question here is whether the ICMP support in the .204 has not already been getting up while the .205 was sending its third general query so the .204 already haven't let it go through.</p></li><li><p>the group membership report doesn't seem to come as a response to the queries as the time between the last captured query and the report is not fixed</p></li></ul><p>So I would say: switch off IGMP on all switches, leave it as it is for five minutes. Then start capturing, after two minutes switch on IGMP on .205, after another minute on .204, after another minute on .203. This should tell you whether the membership reports are sent spontaneously or as responses to queries, and whether the filtering of other switches' IGMP queries depends on whether IGMP is on on a given switch.</p><p>Another test would be to start from IGMP off on all switches plus disconnection of the machine which sends the group membership reports, and after 5 minutes in that state, starting the IGMP on switches one by one, one minute between switches, and two minutes after you activate it on the last switch, connect the machine back and continue capturing for one more minute.</p><p>This will only tell you whether the group queries are triggered by the membership reports or not; it will not tell you why the group queries are sent so frequently, as explained above.</p></div><div id="comment-49921-info" class="comment-info"><span class="comment-age">(06 Feb '16, 02:35)</span> <span class="comment-user userinfo">sindy</span></div></div></div><div id="comment-tools-49802" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-49802-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

