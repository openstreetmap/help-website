+++
type = "question"
title = "Problem using proto_tree_free()"
description = '''I get a linker error when I try to free a subtree using the proto_tree_free() function in my dissector plugin: error LNK2019: unresolved external symbol _proto_tree_free referenced in function _func However I&#x27;m able to call other functions declared in epan/proto.h such as proto_item_add_subtree(). W...'''
date = "2012-08-14T02:40:00Z"
lastmod = "2012-09-07T14:35:00Z"
weight = 13602
keywords = [ "lnk2019", "error" ]
aliases = [ "/questions/13602" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [Problem using proto\_tree\_free()](/questions/13602/problem-using-proto_tree_free)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-13602-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-13602-score" class="post-score" title="current number of votes">0</div><span id="post-13602-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I get a linker error when I try to free a subtree using the proto_tree_free() function in my dissector plugin:</p><p>error LNK2019: unresolved external symbol _proto_tree_free referenced in function _func</p><p>However I'm able to call other functions declared in epan/proto.h such as proto_item_add_subtree(). Why the linker error?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-lnk2019" rel="tag" title="see questions tagged &#39;lnk2019&#39;">lnk2019</span> <span class="post-tag tag-link-error" rel="tag" title="see questions tagged &#39;error&#39;">error</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>14 Aug '12, 02:40</strong></p><img src="https://secure.gravatar.com/avatar/46196bc495ce51058590c4e4ae334d22?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SidR&#39;s gravatar image" /><p><span>SidR</span><br />
<span class="score" title="245 reputation points">245</span><span title="12 badges"><span class="badge1">●</span><span class="badgecount">12</span></span><span title="17 badges"><span class="silver">●</span><span class="badgecount">17</span></span><span title="22 badges"><span class="bronze">●</span><span class="badgecount">22</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SidR has 3 accepted answers">30%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>14 Aug '12, 02:41</strong> </span></p></div></div><div id="comments-container-13602" class="comments-container"><span id="13616"></span><div id="comment-13616" class="comment"><div id="post-13616-score" class="comment-score"></div><div class="comment-text"><p>Why are you trying to free a protocol tree from within a <em>dissector</em>?</p></div><div id="comment-13616-info" class="comment-info"><span class="comment-age">(14 Aug '12, 09:56)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="13669"></span><div id="comment-13669" class="comment"><div id="post-13669-score" class="comment-score"></div><div class="comment-text"><p>My plugin postdissector dissects certain proprietary suboption fields found under TCP options, they used to be displayed as "Unknown". Currently I'm just hiding the associated text node by changing it to a hidden node, but I wanted to know if it was possible to remove the redundant text node instead, just in case.</p></div><div id="comment-13669-info" class="comment-info"><span class="comment-age">(15 Aug '12, 21:25)</span> <span class="comment-user userinfo">SidR</span></div></div><span id="13993"></span><div id="comment-13993" class="comment"><div id="post-13993-score" class="comment-score"></div><div class="comment-text"><p>So which to which TCP option have you added your proprietary suboptions? Presumably that option has a mechanism to support proprietary suboptions, in which case the Wireshark dissector for that option should be enhanced to allow third-party dissectors to plug into it.</p></div><div id="comment-13993-info" class="comment-info"><span class="comment-age">(02 Sep '12, 14:36)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="14080"></span><div id="comment-14080" class="comment"><div id="post-14080-score" class="comment-score"></div><div class="comment-text"><p>I sorry if I'm misunderstanding your comment. I'm not adding anything to an existing TCP suboption, instead I'm adding a TCP suboption which was previously unidentified(and hence displayed as "Unknown").</p></div><div id="comment-14080-info" class="comment-info"><span class="comment-age">(06 Sep '12, 04:04)</span> <span class="comment-user userinfo">SidR</span></div></div><span id="14097"></span><div id="comment-14097" class="comment"><div id="post-14097-score" class="comment-score"></div><div class="comment-text"><p>A "suboption" is part of an option, otherwise it wouldn't be a "suboption", it'd just be an "option".</p><p>So either you're adding a TCP <em>option</em>, not a TCP <em>suboption</em>, as per RFC 793, or there's an existing TCP option that has suboptions, to which you're adding a new suboption.</p><p>If it's an option, did you use the <a href="http://tools.ietf.org/html/rfc4727">RFC 4727</a> mechanism for them, or did you do them in some other fashion?</p><p>If it's a suboption, what's the TCP option to which you're adding it?</p></div><div id="comment-14097-info" class="comment-info"><span class="comment-age">(06 Sep '12, 14:31)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="14102"></span><div id="comment-14102" class="comment not_top_scorer"><div id="post-14102-score" class="comment-score"></div><div class="comment-text"><p>My apologies! Thanks for the clarification. I'm adding a TCP <em>option</em>, not a suboption. I'm not adding any suboptions to an existing option either. I'm sorry for the confusion.</p><p>Also, I haven't used any of the options reserved for experimentation according to RFC 4727.</p></div><div id="comment-14102-info" class="comment-info"><span class="comment-age">(06 Sep '12, 21:03)</span> <span class="comment-user userinfo">SidR</span></div></div><span id="14131"></span><div id="comment-14131" class="comment not_top_scorer"><div id="post-14131-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Also, I haven't used any of the options reserved for experimentation according to RFC 4727.</p></blockquote><p>OK, then presumably this is only used for TCP sessions between machines running software that you control (and that you can update if the IETF assigns the option number to some other option).</p><blockquote><p>I'm adding a TCP <em>option</em>, not a suboption.</p></blockquote><p>Then the best fix might be to have a mechanism by which a dissector can be registered for a particular TCP option number; that could handle both your case and the "reserved for experimentation" case. File a bug for this at <a href="http://bugs.wireshark.org">bugs.wireshark.org</a>.</p></div><div id="comment-14131-info" class="comment-info"><span class="comment-age">(07 Sep '12, 14:35)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div></div><div id="comment-tools-13602" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-13602-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="13606"></span>

<div id="answer-container-13606" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-13606-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-13606-score" class="post-score" title="current number of votes">3</div><span id="post-13606-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="SidR has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>On Windows, functions have to be exported from the libwireshark dll so that plugins can use them. The export definitions are listed in epan\libwireshark.def and proto_tree_free isn't in there.</p><p>Modify the file as required, rebuild libwireshark and you should be good to go.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>14 Aug '12, 03:56</strong></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="grahamb has 274 accepted answers">22%</span></p></div></div><div id="comments-container-13606" class="comments-container"><span id="13607"></span><div id="comment-13607" class="comment"><div id="post-13607-score" class="comment-score"></div><div class="comment-text"><p>Thank you. Adding the function to libwireshark.def did the trick.</p></div><div id="comment-13607-info" class="comment-info"><span class="comment-age">(14 Aug '12, 04:02)</span> <span class="comment-user userinfo">SidR</span></div></div><span id="13609"></span><div id="comment-13609" class="comment"><div id="post-13609-score" class="comment-score"></div><div class="comment-text"><p>I've added the function to libwireshark.def and committed to Wireshark trunk in r44485.</p></div><div id="comment-13609-info" class="comment-info"><span class="comment-age">(14 Aug '12, 04:25)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="13634"></span><div id="comment-13634" class="comment"><div id="post-13634-score" class="comment-score"></div><div class="comment-text"><p>It's my understanding that the export definitions listed in <code>libwireshark.def</code> now apply to all OS's, and not just to Windows.</p></div><div id="comment-13634-info" class="comment-info"><span class="comment-age">(14 Aug '12, 13:40)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div></div><div id="comment-tools-13606" class="comment-tools"></div><div class="clear"></div><div id="comment-13606-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

