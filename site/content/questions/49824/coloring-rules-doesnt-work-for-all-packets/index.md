+++
type = "question"
title = "Coloring rules doesn&#x27;t work for all packets"
description = '''Hi, I have some problems with custom dissectors and coloring rules. I &#x27;m using the latest version of Wireshark (tried on both x86 and x64 machines). I have some dissectors for proprietary protocols (and, until now, they have worked well). In this case I have a transport protocol named XNL which cont...'''
date = "2016-02-04T07:16:00Z"
lastmod = "2016-02-04T13:46:00Z"
weight = 49824
keywords = [ "color-rules", "coloring", "dissector" ]
aliases = [ "/questions/49824" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Coloring rules doesn't work for all packets](/questions/49824/coloring-rules-doesnt-work-for-all-packets)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-49824-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>I have some problems with custom dissectors and coloring rules. I 'm using the latest version of Wireshark (tried on both x86 and x64 machines).</p><p>I have some dissectors for proprietary protocols (and, until now, they have worked well). In this case I have a transport protocol named XNL which contains (in its payload) another protocol XCMP. The problem is that not all the (same protocol) packets are colored, some are treated as TCP packets.</p><p>In the image I highlighted one packet who should be marked (and colored green) as XCMP. The "strange" thing is that it seems to be recognized as XNL and colored as TCP.</p><p><img src="https://osqa-ask.wireshark.org/upfiles/ColoringRules.png" alt="alt text" /></p><p>The image below show an XCMP packet right recognized and colored..</p><p><img src="https://osqa-ask.wireshark.org/upfiles/ColoringRulesOK.png" alt="alt text" /></p><p>Any idea on what could be the cause?</p><p><strong>[EDIT]</strong></p><p>Here two XCMP packets: one correctly recognized (on the left) and one not (on the right):</p><p><img src="https://osqa-ask.wireshark.org/upfiles/ColoringRulesDiff.png" alt="alt text" /></p><p>Thanks in advance.</p></div><div id="question-tags" class="tags-container tags">color-rules coloring dissector</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>04 Feb '16, 07:16</strong></p><img src="https://secure.gravatar.com/avatar/1a539e71d23e84540bdcffc4bbdeeb68?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Barzo&#39;s gravatar image" /><p>Barzo<br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Barzo has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p>edited 04 Feb '16, 08:40</p></div></div><div id="comments-container-49824" class="comments-container"><span id="49825"></span><div id="comment-49825" class="comment"><div id="post-49825-score" class="comment-score"></div><div class="comment-text"><p>Have you checked the "Frame" section of the decode for the coloring rule information? You can see what rule matched and then check the rule itself (or the order, as rules are applied top-down, match first) - maybe you need to reorder your rules?</p></div><div id="comment-49825-info" class="comment-info"><span class="comment-age">(04 Feb '16, 07:18)</span> Jasper ♦♦</div></div><span id="49827"></span><div id="comment-49827" class="comment"><div id="post-49827-score" class="comment-score"></div><div class="comment-text"><p>Hi @Jasper, thanks for the reply. Yes, I have checked the Frame section and, in fact, for XCMP packet (not right colored) I see: Coloring Rule Name: TCP. In my rules, XCMP and XNL are at the top of the list. Have I a way to "debug" the dissectors/rules?</p></div><div id="comment-49827-info" class="comment-info"><span class="comment-age">(04 Feb '16, 08:22)</span> Barzo</div></div><span id="49830"></span><div id="comment-49830" class="comment"><div id="post-49830-score" class="comment-score"></div><div class="comment-text"><p>Okay, that would indicate that the not correcly colored packets are not matched by the rules you created. Do the exact <strong>same</strong> expressions work correctly as display filters? Or are they not giving correct results either?</p><p>If they work -&gt; open a bug at <a href="https://bugs.wireshark.org">https://bugs.wireshark.org</a> (check first if there is a bug for this already pls)</p><p>If they do not work -&gt; try to modify your filter until it does</p></div><div id="comment-49830-info" class="comment-info"><span class="comment-age">(04 Feb '16, 08:27)</span> Jasper ♦♦</div></div><span id="49831"></span><div id="comment-49831" class="comment"><div id="post-49831-score" class="comment-score"></div><div class="comment-text"><p>I updated my question with another screen. Tell me if I wrong...Since the filter simply say: "Color the XCMP pkt in Blue", here seems to be a dissector that does not match, right?</p></div><div id="comment-49831-info" class="comment-info"><span class="comment-age">(04 Feb '16, 08:44)</span> Barzo</div></div><span id="49837"></span><div id="comment-49837" class="comment"><div id="post-49837-score" class="comment-score"></div><div class="comment-text"><p>Looks to me like your dissector is not being called in the "Failing" screen shot.</p></div><div id="comment-49837-info" class="comment-info"><span class="comment-age">(04 Feb '16, 10:12)</span> Anders ♦</div></div><span id="49841"></span><div id="comment-49841" class="comment not_top_scorer"><div id="post-49841-score" class="comment-score"></div><div class="comment-text"><p>Hi @Anders, I'm not the dissectors creator (they are created by a third party company), I only use them. Just for curiosity, do I have a way to verify this? What could be the cause? (I'm not an expert in dissector development). PS. I try to install an older version (1.9.1) and it seems to work: most of the packets are decoded (except some one).</p></div><div id="comment-49841-info" class="comment-info"><span class="comment-age">(04 Feb '16, 10:25)</span> Barzo</div></div><span id="49864"></span><div id="comment-49864" class="comment not_top_scorer"><div id="post-49864-score" class="comment-score"></div><div class="comment-text"><p>Sorry I did not look closely enough. I think the reason is that it's tagged as a retransmission and dissection stops at the tcp layer.</p></div><div id="comment-49864-info" class="comment-info"><span class="comment-age">(04 Feb '16, 12:52)</span> Anders ♦</div></div></div><div id="comment-tools-49824" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-49824-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="49869"></span>

<div id="answer-container-49869" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-49869-score" class="post-score" title="current number of votes">2</div></div></td><td><div class="item-right"><div class="answer-body"><p>In both of the failing screenshots you'll note that the packet is marked as a TCP Retransmission (in the Info column). By default (IIRC) Wireshark will not call subdissectors (such as, in your case, the Motorola XNL dissector) on "error" packets such as retransmissions (since many upper-layer protocols get confused when they see the same data more than once). When the subdissector is not called the traffic will only be decoded up to the TCP layer so Wireshark won't recognize the traffic as belonging to the subdissector/higher-level protocol.</p><p>If you want to change that behavior you'd need to turn off the "Do not call subdissectors for error packets" TCP preference.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>04 Feb '16, 13:46</strong></p><img src="https://secure.gravatar.com/avatar/e0564001bb7deb960d5d9d9c1e0ba074?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="JeffMorriss&#39;s gravatar image" /><p>JeffMorriss ♦<br />
<span class="score" title="6219 reputation points"><span>6.2k</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="72 badges"><span class="bronze">●</span><span class="badgecount">72</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="JeffMorriss has 103 accepted answers">27%</span></p></img></div></div><div id="comments-container-49869" class="comments-container"><span id="49884"></span><div id="comment-49884" class="comment"><div id="post-49884-score" class="comment-score"></div><div class="comment-text"><p>Hi @JeffMorriss, I had already tried to disable that option (I also tried to uncheck "Analyze TCP sequence number" but the behavior does not change. Also these packets are marked as "suspected retransmission" but I don't understand why...they are not retransmissions because one is a "request" (192.168.10.2 -&gt; 192.168.10.1) and one is a "reply" (192.168.10.1 -&gt; 192.168.10.2).</p></div><div id="comment-49884-info" class="comment-info"><span class="comment-age">(05 Feb '16, 00:20)</span> Barzo</div></div><span id="49885"></span><div id="comment-49885" class="comment"><div id="post-49885-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Also these packets are marked as "suspected retransmission" but I don't understand why...</p></blockquote><p>At this point screenshots stop being enough and publishing a pcap file showing the issue is necessary, because debugging weird issues by screenshots is next to impossible. So please make the capture available at google drive, onedrive, dropbox... for everyone (no requirement for password at that particular service) or cloudshark, and then someone may look why Wireshark interprets the packets as retransmissions.</p></div><div id="comment-49885-info" class="comment-info"><span class="comment-age">(05 Feb '16, 00:58)</span> sindy</div></div><span id="49895"></span><div id="comment-49895" class="comment"><div id="post-49895-score" class="comment-score"></div><div class="comment-text"><p>A the very least a screenshot with those options disabled <em>might</em> be helpful (or it might not).</p></div><div id="comment-49895-info" class="comment-info"><span class="comment-age">(05 Feb '16, 06:32)</span> JeffMorriss ♦</div></div><span id="50087"></span><div id="comment-50087" class="comment"><div id="post-50087-score" class="comment-score"></div><div class="comment-text"><p>Hi @sindy and @JeffMorriss you are right, here you can find a capture pcap: <a href="https://drive.google.com/file/d/0B7QZixdvKHVOVC16cmdlWkdheXc/view?usp=sharing">https://drive.google.com/file/d/0B7QZixdvKHVOVC16cmdlWkdheXc/view?usp=sharing</a></p></div><div id="comment-50087-info" class="comment-info"><span class="comment-age">(11 Feb '16, 01:16)</span> Barzo</div></div><span id="50094"></span><div id="comment-50094" class="comment"><div id="post-50094-score" class="comment-score"></div><div class="comment-text"><p>Hm...</p><p>first, the capture is a different one than that from which you've taken your screenshots (frames 16 and 22 are totally different), so the two sources of information cannot be put together.</p><p>Second, as we do not have the private dissectors, we cannot see their behaviour on retransmissions and "overhead" (i.e. carrying no payload) packets.</p><p>Third, I haven't found any packet analyzed literally as <code>suspected retransmission</code>, only <code>retransmission</code> in the packet list and <code>(suspected) retransmission</code> in the tcp analysis -&gt; expert info. So if this is your case as well, it is because the Wireshark's embedded tcp analyzer assumes by all criteria that it is a retransmission but can never be 100 % sure. I would assume that this has been emphasized in the expert info in order to make users realize that they have to look themselves.</p><p>So can you please identify several pairs of frame numbers <em>in the capture posted above</em>, which the Wireshark version you currently use considers to be a "first transmission" and its related "retransmission", and then open that same capture using the Wireshark version you know to be working properly and check whether it handles these pairs of frames the same way (first transmission/retransmission) or as two first transmissions?</p><p>At the moment I suspect that this is the root difference between the "old" and "new" behaviour, of which the rest is a consequence.</p></div><div id="comment-50094-info" class="comment-info"><span class="comment-age">(11 Feb '16, 03:16)</span> sindy</div></div></div><div id="comment-tools-49869" class="comment-tools"></div><div class="clear"></div><div id="comment-49869-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

