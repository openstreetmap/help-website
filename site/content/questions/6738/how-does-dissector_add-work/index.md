+++
type = "question"
title = "How does dissector_add work?"
description = '''Hi, I&#x27;m a newbie trying to write a dissector for the first time. I&#x27;ve noticed the function dissector_add() gets called to associate a particular identifier with a dissector handle. If I call dissector_add() twice for the same handle does it &quot;and&quot; these two identifiers or &quot;or&quot; them?  What do I do if ...'''
date = "2011-10-05T12:47:00Z"
lastmod = "2011-10-05T13:05:00Z"
weight = 6738
keywords = [ "development", "dissector_table", "dissector" ]
aliases = [ "/questions/6738" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [How does dissector\_add work?](/questions/6738/how-does-dissector_add-work)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-6738-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, I'm a newbie trying to write a dissector for the first time. I've noticed the function <code>dissector_add()</code> gets called to associate a particular identifier with a dissector handle.</p><p>If I call dissector_add() twice for the same handle does it "and" these two identifiers or "or" them?</p><p>What do I do if I want my dissector to match a combination of "and"s and "or"s, like an expression like this might indicate?: "((host 1.2.3.4 and port 111) or (host 5.6.7.8 and port 222))"</p></div><div id="question-tags" class="tags-container tags">development dissector_table dissector</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>05 Oct '11, 12:47</strong></p><img src="https://secure.gravatar.com/avatar/851676df3c7a09999c0522099f40d6e1?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="JVo&#39;s gravatar image" /><p>JVo<br />
<span class="score" title="16 reputation points">16</span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="JVo has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 05 Oct '11, 16:40</p><img src="https://secure.gravatar.com/avatar/fe1cf996b30e896dc95ca3cd47ac7406?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="multipleinterfaces&#39;s gravatar image" /><p>multipleinte...<br />
<span class="score" title="1321 reputation points"><span>1.3k</span></span><span title="15 badges"><span class="badge1">●</span><span class="badgecount">15</span></span><span title="23 badges"><span class="silver">●</span><span class="badgecount">23</span></span><span title="40 badges"><span class="bronze">●</span><span class="badgecount">40</span></span></p></div></div><div id="comments-container-6738" class="comments-container"></div><div id="comment-tools-6738" class="comment-tools"></div><div class="clear"></div><div id="comment-6738-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="6739"></span>

<div id="answer-container-6739" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-6739-score" class="post-score" title="current number of votes">3</div></div></td><td><div class="item-right"><div class="answer-body"><p><code>dissector_add</code> is really just a <code>#define</code>d alias for <code>dissector_add_uint</code>, so if you are using <code>dissector_add</code> you should change it to <code>dissector_add_uint</code>. That said, when you call <code>dissector_add_uint("foo", BAR_PORT, bar_handle);</code>, it adds the dissector referenced by <code>bar_handle</code> to the dissector table referenced by <code>foo</code> for the <code>uint</code> value <code>BAR_PORT</code>.</p><p>To answer your question, it would be more like a logical <code>or</code> operation. Consider adding a dissector to the <code>udp.port</code> table twice using <code>1337</code> and <code>31337</code> as your ports --when the UDP dissector looks into its table for traffic on either of those ports, your dissector would be called. Note that hueristic dissectors work a little differently. <code>dissector_add_uint</code> is declared in <code>epan/packet.h</code>, so you should read some of the comments there about how the functions work and are intended to be used.</p><p><strong>Edit</strong>: Regarding your comments, 1337 and 31337 were example ports; in your example, these would be 111 and 222.</p><p>Regarding the IP address, there are no dissector tables tied to particular IP addresses. Network protocols are generic and typically understood by more than one machine, and maintaining large lists of IPs would become cumbersome (and practically infeasable) over time. In stead, you can limit the packets you see with a display filter so that only hosts 1.2.3.4 and 5.6.7.8 are shown (<code>ip.addr == 1.2.3.4 || ip.addr == 5.6.7.8</code>).</p><p>You can find more information in the <a href="http://www.wireshark.org/docs/wsdg_html_chunked/">Wireshark Developer's Guide</a>. Comments in the various source files (<code>.c</code>) typically concern implementation details that are subject to change or specific workarounds. Usually, you should hope to find the information you need in the header files, as these expose the interface as it is intended (and are usually easier to follow).</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>05 Oct '11, 13:05</strong></p><img src="https://secure.gravatar.com/avatar/fe1cf996b30e896dc95ca3cd47ac7406?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="multipleinterfaces&#39;s gravatar image" /><p>multipleinte...<br />
<span class="score" title="1321 reputation points"><span>1.3k</span></span><span title="15 badges"><span class="badge1">●</span><span class="badgecount">15</span></span><span title="23 badges"><span class="silver">●</span><span class="badgecount">23</span></span><span title="40 badges"><span class="bronze">●</span><span class="badgecount">40</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="multipleinterfaces has 9 accepted answers">12%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 05 Oct '11, 14:12</p></div></div><div id="comments-container-6739" class="comments-container"><span id="6740"></span><div id="comment-6740" class="comment"><div id="post-6740-score" class="comment-score"></div><div class="comment-text"><p>Thanks so much for the quick response.</p><p>So, are "1337" and "31337" just example port numbers? In my example that would be "111" and "222", right?</p><p>Sorry for my confusion but how would I handle the host IP addresses as well, like in my example? "((host 1.2.3.4 and port 111) or (host 5.6.7.8 and port 222))"</p><p>Because I don't want to match tcp port 111 on every IP address, just that one. How do I deal with a "logical and" expression?</p></div><div id="comment-6740-info" class="comment-info"><span class="comment-age">(05 Oct '11, 13:38)</span> JVo</div></div><span id="6741"></span><div id="comment-6741" class="comment"><div id="post-6741-score" class="comment-score"></div><div class="comment-text"><p>Sorry for my very little understanding of this - I'm just not sure where to go to learn about dissector tables. There don't seem to be many detailed comments in packet.h. Is my best bet to try to read the code itself in packet.c?</p><p>Thanks again!</p></div><div id="comment-6741-info" class="comment-info"><span class="comment-age">(05 Oct '11, 13:39)</span> JVo</div></div><span id="6742"></span><div id="comment-6742" class="comment"><div id="post-6742-score" class="comment-score"></div><div class="comment-text"><p>I've updated my answer with some more information. The comments in the header files are usually the ones to go by, though they can be daunting at first. Make sure you understand the relevant portions of the Developer's Guide and have read <code>doc/README.developer</code>. You can also find information on the wiki: http://wiki.wireshark.org/</p></div><div id="comment-6742-info" class="comment-info"><span class="comment-age">(05 Oct '11, 14:14)</span> multipleinte...</div></div><span id="6745"></span><div id="comment-6745" class="comment"><div id="post-6745-score" class="comment-score"></div><div class="comment-text"><p>Thanks for the update.</p><p>Regarding the IP addresses: I suppose generally the port number for our protocol should be unique to messages of this protocol.</p><p>If, in the off chance, another message arrives with the same port number (from a different IP), I'm not sure what I'll do. Preventing it from being displayed by using the display filter isn't really what I'd want. I still want to display all messages, whether or not they are one of my protocol messages. Any other thoughts? I may just have to make the assumption that any message with this port number is of this protocol.</p></div><div id="comment-6745-info" class="comment-info"><span class="comment-age">(05 Oct '11, 16:14)</span> JVo</div></div><span id="6746"></span><div id="comment-6746" class="comment"><div id="post-6746-score" class="comment-score"></div><div class="comment-text"><p>Do you know if it's possible to tie a dissector to a particular ethernet capture device such as eth0, eth1, etc?</p></div><div id="comment-6746-info" class="comment-info"><span class="comment-age">(05 Oct '11, 16:16)</span> JVo</div></div><span id="6747"></span><div id="comment-6747" class="comment not_top_scorer"><div id="post-6747-score" class="comment-score"></div><div class="comment-text"><p>I suppose there isn't a way in the dissect_foo() method to say "nevermind, this isn't a foo after all", is there? :o) (Sorry for the 20 questions)</p></div><div id="comment-6747-info" class="comment-info"><span class="comment-age">(05 Oct '11, 16:19)</span> JVo</div></div><span id="6748"></span><div id="comment-6748" class="comment not_top_scorer"><div id="post-6748-score" class="comment-score"></div><div class="comment-text"><p>You cannot tie your dissector to a specific capture interface (other than by only capturing on that interface) since this information is not provided to dissectors. Regarding your other questions, what you are looking for is a "hueristic dissector". You should look at <code>doc/README.heuristic</code> for information about how to convert your current dissector into a hueristic dissector and what changes you may need to make otherwise. If you go this route, also make sure that your transport protocol's <code>try_heuristic_dissectors_first</code> preference is enabled.</p></div><div id="comment-6748-info" class="comment-info"><span class="comment-age">(05 Oct '11, 16:30)</span> multipleinte...</div></div><span id="6749"></span><div id="comment-6749" class="comment not_top_scorer"><div id="post-6749-score" class="comment-score"></div><div class="comment-text"><p>I'll take a look at README.heuristic. Thanks!</p></div><div id="comment-6749-info" class="comment-info"><span class="comment-age">(05 Oct '11, 16:52)</span> JVo</div></div><span id="6790"></span><div id="comment-6790" class="comment not_top_scorer"><div id="post-6790-score" class="comment-score"></div><div class="comment-text"><p>Wireshark dissectors works in a similar way as the protocol stack does if your protocol runs on top of TCP/UDP the handoff would be to something listening to that port. (dissector registered in tcp and udp uint dissector tables in the case of Wireshark) When capturing you can use capture filters to only capture packets to from IP addresses and ports the interface yo capture on will be the ETH "selector". If your protocol has a magic number or a unique signature you can make it an heuristic dissector.</p></div><div id="comment-6790-info" class="comment-info"><span class="comment-age">(07 Oct '11, 10:14)</span> Anders ♦</div></div><span id="6791"></span><div id="comment-6791" class="comment not_top_scorer"><div id="post-6791-score" class="comment-score"></div><div class="comment-text"><p>The heuristic dissector idea looks promising in that I can check the IP addresses, and return FALSE if they don't match. However, can I use a heuristic dissector in combination with tcp_dissect_pdus()? I have 2 methods: tcp_dissect_foo() and tcp_dissect_foo_message(). tcp_dissect_foo() calls tcp_dissect_pdus(), which sets tcp_dissect_foo_message() to be called once the full message is received. If I make this a heuristic dissector and check my IPs in tcp_dissect_foo_message(), returning false if they don't match, will wireshark do the right thing and pass the message on to other dissectors?</p></div><div id="comment-6791-info" class="comment-info"><span class="comment-age">(07 Oct '11, 10:51)</span> JVo</div></div><span id="6793"></span><div id="comment-6793" class="comment not_top_scorer"><div id="post-6793-score" class="comment-score"></div><div class="comment-text"><p>Oh wait. Now that I think about it, I can check the IPs from tcp_dissect_foo() and return false if they don't match. If they do match, I could call tcp_dissect_pdus(). On the other hand, what if I wanted to check bytes in the message to verify that it was a "foo"? It seems like I would want to check those bytes in the full message, not in some random packet of the message. Thus, wouldn't I want to check them in tcp_dissect_foo_message() and return FALSE from there?</p></div><div id="comment-6793-info" class="comment-info"><span class="comment-age">(07 Oct '11, 11:21)</span> JVo</div></div><span id="6794"></span><div id="comment-6794" class="comment not_top_scorer"><div id="post-6794-score" class="comment-score"></div><div class="comment-text"><p>tcp_dissect_pdus() expects packets of a particular protocol, as it has to be able to figure out how big each packet is, and how that's done is protocol-dependent (for example, one protocol might have a 2-byte big-endian length field at the beginning of the packet whose value that includes the length of the length field, another might have a 4-byte little-endian length field 2 bytes into the packet whose value does <em>not</em> include the length of the length field). This makes it difficult to support having tcp_dissect_pdus() call heuristic dissectors, and it does not support that.</p></div><div id="comment-6794-info" class="comment-info"><span class="comment-age">(07 Oct '11, 13:25)</span> Guy Harris ♦♦</div></div></div><div id="comment-tools-6739" class="comment-tools"><span class="comments-showing"> showing 5 of 12 </span> <a href="#" class="show-all-comments-link">show 7 more comments</a></div><div class="clear"></div><div id="comment-6739-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

