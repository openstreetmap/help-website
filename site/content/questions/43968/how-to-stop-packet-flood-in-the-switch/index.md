+++
type = "question"
title = "How to stop packet flood in the switch?"
description = '''Hi there! I&#x27;m with a trouble that goes beyond my network knowledge. I&#x27;m posting here looking for some help of network experts. We have some network hangs since 2 weeks ago. Nothing changed in the configuration. First I suspected the router to be dead/overcharged since it was the source of freezes an...'''
date = "2015-07-08T09:11:00Z"
lastmod = "2015-07-17T13:28:00Z"
weight = 43968
keywords = [ "flood", "switch", "dos" ]
aliases = [ "/questions/43968" ]
osqa_answers = 2
osqa_accepted = true
+++

<div class="headNormal">

# [How to stop packet flood in the switch?](/questions/43968/how-to-stop-packet-flood-in-the-switch)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-43968-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-43968-score" class="post-score" title="current number of votes">0</div><span id="post-43968-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi there!</p><p>I'm with a trouble that goes beyond my network knowledge. I'm posting here looking for some help of network experts. We have some network hangs since 2 weeks ago. Nothing changed in the configuration. First I suspected the router to be dead/overcharged since it was the source of freezes and rebooting it was solving the problem. But I changed 2 times of router, from a Cisco Linksys E4200 with stock firmware to an Asus RT-AC87U with DD-WRT build 26635 (still in beta, so could not be stable) then a Netgear with stock firmware. All presented the same trouble. The router gets unresponsive to ping and naturally the network connection is dead. I then discovered that just unplugging/replugging the network cable was sufficient to come back to working state.</p><p>The router is plugged to a dlink DGS-1210-52 switch (named A) linked to another DGS-1210-24 switch (named B) by an optical fiber. All clients are connected to one of those switches, with also some wireless access points. I mirrored the switch port in which the router is connected to analyze the traffic. During the freezes I saw TCP Packet retransmissions like this:</p><pre><code>0.000000 109.234.160.36 -&gt; 172.20.30.12 IMAP Response: * OK Still here
0.000003 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000005 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000007 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000116 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000119 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000241 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000243 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here
0.000363 109.234.160.36 -&gt; 172.20.30.12 IMAP [TCP Retransmission] Response: * OK Still here</code></pre><p>And this, until I unplug/replug the cable or during many minutes. Analyzing this packet I got the information that 109.234.160.36 is our externalized mail server and 172.20.30.12 is the IP of a colleague. Her PC was sleeping (so unreachable) at the moment of the flood. I was thinking of a bad behaviour of our mail client (Windows Live Mail 2009). Then the network froze again:</p><pre><code>0.000000 179.60.192.2 -&gt; 172.20.30.60 TCP https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000002 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000005 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000007 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000139 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000141 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000144 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832
0.000146 179.60.192.2 -&gt; 172.20.30.60 TCP [TCP Retransmission] https &gt; 46812 [FIN, ACK] Seq=0 Ack=0 Win=57 Len=0 TSV=1771622880 TSER=10028832</code></pre><p>This time, nothing to do with the mails, it's a wireless notebook (172.20.30.60) having troubles to receive data from Facebook (179.60.192.2). The notebook lost the connection to the AP at the moment of the flood. Again, unplugging/replugging the cable between the router and the switch stopped the retransmission packets to flood the network. Unplugging/replugging the cable between the router and the the WAN modem did no effect (packets stopped while unplugged but restarted when plugged again).</p><p>Then I got another colleague having TCP retransmissions from the mail server (I have no info about if the computer was sleeping at the moment):</p><pre><code>0.000000 109.234.160.36 -&gt; 172.20.30.26 IMAP Response: * OK Still here
0.000003 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here
0.000005 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here
0.000007 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here
0.000112 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here
0.000114 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here
0.000228 109.234.160.36 -&gt; 172.20.30.26 IMAP [TCP Retransmission] Response: * OK Still here</code></pre><p>Then I had the same flood from a SIP connection (don't know if this is not a malicious try):</p><pre><code>0.000000 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000004 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000116 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000120 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000124 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000127 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000238 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000241 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]
0.000363 62.75.145.240 -&gt; 172.20.30.129 SIP Request: OPTIONS sip:[email protected]</code></pre><p>x is our external IP and there is NAT configured to let 172.20.30.129 make/receive SIP calls. But 172.20.30.129 was off at this moment and we wasn't expecting a call. Then, very strange, I got this:</p><pre><code>0.000000  172.20.30.7 -&gt; 172.20.30.11 TCP rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000004  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000007  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000009  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000012  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000014  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000017  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79
0.000020  172.20.30.7 -&gt; 172.20.30.11 TCP [TCP Retransmission] rtip &gt; 4580 [PSH, ACK] Seq=0 Ack=0 Win=8192 Len=79</code></pre><p>172.20.30.7 is a IP temperature monitor and 172.20.30.11 is the PC collecting its data. For the first time the problem is LAN to LAN. And, interesting fact, both equipments are plugged to switch B, so if I'm correct, I should not see those packets at the router port at the switch A. This time I had to completely reboot both switches to stop the flood. And this morning I got another one:</p><pre><code>0.000000 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000004 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000006 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000009 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000011 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000013 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000016 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000018 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1</code></pre><p>Another LAN to LAN, 172.20.30.11 is a PC and 172.20.30.18 is a network printer (Canon 1022). And this time it's not a TCP retransmission but a SNMP request. I tried to play with all the switch options: Storm control, Spanning Tree (STP), Power saving setup, IEEE802.3az, Flow control, DLink safeguard engine. Nothing worked. Googled a lot, found also that could be damaged cables, replaced the cable to the router. Well, I'm kinda desperate and rely on your help to stop having to reboot the network 3x a day and being able to focus in other tasks!</p><p>Thanks very much if you read until here and even more if you have a clue of what's going on in my network. I can provide more details as needed. Help really appreciated!</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-flood" rel="tag" title="see questions tagged &#39;flood&#39;">flood</span> <span class="post-tag tag-link-switch" rel="tag" title="see questions tagged &#39;switch&#39;">switch</span> <span class="post-tag tag-link-dos" rel="tag" title="see questions tagged &#39;dos&#39;">dos</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>08 Jul '15, 09:11</strong></p><img src="https://secure.gravatar.com/avatar/553a78839c1d10fc37b4e21b1099c4e1?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="vitoriodelage&#39;s gravatar image" /><p><span>vitoriodelage</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="vitoriodelage has no accepted answers">0%</span></p></div></div><div id="comments-container-43968" class="comments-container"><span id="43971"></span><div id="comment-43971" class="comment"><div id="post-43971-score" class="comment-score"></div><div class="comment-text"><p>I have the following remarks.</p><p>Is the the IP Id identical at every packet of a case and is it different of zero?</p><p>Could you provide a quick drawing where we can see all of your switches and the gateway of this subnet and the cables between this devices?</p><p>Have you checked interface counters at the switches on every uplink?</p></div><div id="comment-43971-info" class="comment-info"><span class="comment-age">(08 Jul '15, 09:38)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="43982"></span><div id="comment-43982" class="comment"><div id="post-43982-score" class="comment-score"></div><div class="comment-text"><p>First of all, thank you for your interest in my case :)</p><p>1) What do you mean by "IP id"? How can I see it? Sorry, I'm newbie to network analysis and just doing my first steps with ethereal (Wireshark doesn't work on the Powerbook G4 that I got to do the job);</p><p>2) The schema is simple WAN &lt;- Ethernet -&gt; (WAN IP) Router (172.20.30.10/16 Gbit full duplex) &lt;- Ethernet -&gt; (172.20.30.205/16) Switch A &lt;- Ethernet -&gt; Gbit media converter &lt;- optical fiber -&gt; Gbit media converter &lt;- Ethernet -&gt; (172.20.30.203/16) Switch B</p><p>Both switches have many devices connected on them (computers, printers, wireless access points). The setup is not new and the setup did not change at the moment the network started hanging (about 15 days ago). Have a mix of Gbit, 100 and 10Mbit devices.</p><p>3) Switch counters are OK and show no transmission errors or collisions. Apart from the ethereal snif, nothing abnornal is revealed by the switches or router GUI interfaces. That's why I'm becoming crazy! :)</p></div><div id="comment-43982-info" class="comment-info"><span class="comment-age">(08 Jul '15, 13:09)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div></div><div id="comment-tools-43968" class="comment-tools"></div><div class="clear"></div><div id="comment-43968-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="43997"></span>

<div id="answer-container-43997" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-43997-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-43997-score" class="post-score" title="current number of votes">1</div><span id="post-43997-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="vitoriodelage has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I think of course you got a loop, too.</p><p>The interesting thing seems to be, that the issue only occurs if the destination mac address has been deleted from the cam table ( internal switch table to decide the switching path). It obviously does not occur with normal broadcasts or multicasts. Strange, what is the difference in your config? (enabled broadcast control mechanisms)</p><p>So maybe the problem could be reproduced if you add a wrong static arp entry for a ip of your subnet on a test device and then try to ping it with just one ping.</p><p>But the question will still be the same: where does the loop occur in your straight l2 design?</p><p>Maybe it is a device which connected is two more than one switch.</p><p>Maybe your WLAN is spanning a loop.</p><p>Maybe it is a switch issue.</p><p>Maybe you have changed something (firmware, unimport stuff) several weeks ago.</p><p>But indeed if you can't answer these things fast. Then the most safety and fastes way to find the issue is the solution which Kurt told you.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Jul '15, 23:16</strong></p><img src="https://secure.gravatar.com/avatar/3b24b339fc62fb46dced6a443d3202ea?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Christian_R&#39;s gravatar image" /><p><span>Christian_R</span><br />
<span class="score" title="1830 reputation points"><span>1.8k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="25 badges"><span class="bronze">●</span><span class="badgecount">25</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Christian_R has 25 accepted answers">16%</span></p></div></div><div id="comments-container-43997" class="comments-container"><span id="44002"></span><div id="comment-44002" class="comment"><div id="post-44002-score" class="comment-score"></div><div class="comment-text"><p>"So maybe the problem could be reproduced if you add a wrong static arp entry for a ip of your subnet on a test device and then try to ping it with just one ping." -&gt; I would like to try this, but it's maybe too late for it (since I rebooted the faulty modem). Where to enter the wrong address? At a computer or switch? On the switch I can only find MAC to port association, no MAC to IP. I choose the IP of an existing device or a free IP in the subnet? Sorry about the questions, I'm newbie to network at such a technical level.</p></div><div id="comment-44002-info" class="comment-info"><span class="comment-age">(09 Jul '15, 03:11)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44004"></span><div id="comment-44004" class="comment"><div id="post-44004-score" class="comment-score"></div><div class="comment-text"><p>I meant you could create a static arp entry for an unused mac address and better an unused IPAddress which belongs to your subnet. You could create this entry on random host in this subnet.</p><p>For example the Syntax for the arp entry on Windows OS on Linux could be a little bit different.</p><p>arp -s 172.20.30.249 00-aa-00-62-c6-08</p><p>And then try to ping this address from that host for example with the following command on win: ping -n 1 172.20.30.249</p><p><strong>Beware! If it will cause a looping transport the issue could only be stopped by unplugging cables or switchoff one switch!!!</strong></p><p>And look what happens.... Then tell me.</p><p>Could you explain how the router has done the Loop? Could it be that you have always a Loop but the broadcast storm are filtered ou by storm control?</p><p>Maybe you could show us the anonymised Switch config.</p><p><strong>You should really look if one or more device/devices is/are connected to more than one switch port. Do you have such devices?</strong></p></div><div id="comment-44004-info" class="comment-info"><span class="comment-age">(09 Jul '15, 03:32)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44032"></span><div id="comment-44032" class="comment"><div id="post-44032-score" class="comment-score"></div><div class="comment-text"><p>Thanks for the details, I will try this today and let you know.</p><p>I have a physical server with 4 ethernet cards. But each card is used by a different virtual server. It's not configured with both cards on the same OS, and not showing itself guilty during the loops.</p></div><div id="comment-44032-info" class="comment-info"><span class="comment-age">(09 Jul '15, 23:57)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44040"></span><div id="comment-44040" class="comment"><div id="post-44040-score" class="comment-score"></div><div class="comment-text"><p>Tested the false arp entry: The ping ended normally after 10 sec with a timeout as expected. No troubles in the network, no flood triggered.</p><p>About the switch config, I will see how I can extract it.</p></div><div id="comment-44040-info" class="comment-info"><span class="comment-age">(10 Jul '15, 02:45)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44041"></span><div id="comment-44041" class="comment"><div id="post-44041-score" class="comment-score"></div><div class="comment-text"><p>ok than we will see.</p></div><div id="comment-44041-info" class="comment-info"><span class="comment-age">(10 Jul '15, 03:03)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44043"></span><div id="comment-44043" class="comment not_top_scorer"><div id="post-44043-score" class="comment-score"></div><div class="comment-text"><p>I have the impression that the flood is happening in a combination of many equipments, not only one. Yesterday morning, as in comment of Kurt Knochner answer, I found the old modem/router flooding the packets in the network (packets that have nothing to do with it, as their are LAN device to LAN device packets).</p><p>Yesterday evening on another flood (same case of SNMP request 172.20.30.11 to 172.20.30.18):</p><ol><li>unplugged the old modem/router -&gt; flood continued -&gt; replugged</li><li>unplugged main router -&gt; flood continued -&gt; replugged</li><li>unplugged switch B -&gt; flood continued</li><li>unplugged main router again -&gt; flood stopped</li></ol><p>It seems clear that it comes from a combination of many devices. I would like to know what is causing the devices to flood the network with those packets. I don't know very well how the network stack works, but there is a mechanism with arp tables or something that when gets overflowed result in things like this, no? I should check those tables to find an abnormal activity.</p><p>I'm still blind and I still don't know what is triggering all this mess! The idea of Christian_R of pinging an inexistent MAC address unfortunately didn't triggered the loop. Any idea on how to trigger the problem? This would help understanding how to solve it…</p><p>As always, kind and warm thanks to all people envolved, your help is really appreciated!</p></div><div id="comment-44043-info" class="comment-info"><span class="comment-age">(10 Jul '15, 03:14)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44044"></span><div id="comment-44044" class="comment not_top_scorer"><div id="post-44044-score" class="comment-score"></div><div class="comment-text"><p>I think the same as Kurt does. We do not have a lot of info. So as you are telling you have a sporadic issue. So you should watch the events and collect the and compare the info and maybe you are able to isolate the root cause. To find the root cause of a sporadic problem is mostly hard work.</p></div><div id="comment-44044-info" class="comment-info"><span class="comment-age">(10 Jul '15, 03:29)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44047"></span><div id="comment-44047" class="comment not_top_scorer"><div id="post-44047-score" class="comment-score"></div><div class="comment-text"><p>Yes, it is! I would like to be able to provide more data, that's why I'm here, to have a good methodology on how to analyze the problem. It's sporadic and the symptoms are not always exactly the same (It's not unplugging the same equipment that ends the flood).</p><p>I don't have the expertise to look deeply the transaction than sniffing the network. I guess it would be interesting to see the memory status of switches and routers at the moment of the bug.</p></div><div id="comment-44047-info" class="comment-info"><span class="comment-age">(10 Jul '15, 04:52)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44177"></span><div id="comment-44177" class="comment not_top_scorer"><div id="post-44177-score" class="comment-score"></div><div class="comment-text"><p><span>@Christian_R</span>: My apologies for the delay, I had other problems to solve and it was an extended holiday here in France. Please don't consider my silence as if I left over. And many thanks again for your help.</p><p>I managed to upload the configuration of both switches at <a href="http://acadmed.o2switch.net/tmp/dlink/">http://acadmed.o2switch.net/tmp/dlink/</a> My apologies for the ergonomy, the screen capture was the best I could get to show you the config.</p><p>For the updates, it flooded again friday morning. Flood was coming from switch B. I realized that it firmware was not up to date and flashed it with the last version (2.01.001 -&gt; 2.03.001). Friday evening it flooded again. As I started to take the screen captures of the config in switch B, I saw that the Loopback detection was disabled and activated it.</p><p>Since this action I got no more floods. Today (first working day after friday) everything was OK. Making all the screen captures I also changed another feature in switch A, the DoS detection was turned off. And tried to turn on the loopback detection in switch A failed. It complains that it's incompatible with STP. What is strange is that switch B (older but same brand/model) accepts it.</p><p>Well, by the moment the network is working again (After so much pain, I'm prudent to say it's over), so I thank you one more time for your tips. And if you see anything on the config that could be improved, please let me know.</p><p>Cheers!</p></div><div id="comment-44177-info" class="comment-info"><span class="comment-age">(15 Jul '15, 08:55)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44179"></span><div id="comment-44179" class="comment not_top_scorer"><div id="post-44179-score" class="comment-score"></div><div class="comment-text"><p>ok that are a lot pics. I will have a deeper look at them in two hours or so. But why do I see at Port 47 on Switch A such a lot of failures? Is there a half duplex device connected? And what is connected at Port 13?</p></div><div id="comment-44179-info" class="comment-info"><span class="comment-age">(15 Jul '15, 09:35)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44190"></span><div id="comment-44190" class="comment not_top_scorer"><div id="post-44190-score" class="comment-score"></div><div class="comment-text"><p>So I checked the screenshots. The first thing that I can say that both switches are different HW Revision and Firmware Rev.</p><p>Switch A: It can be seen that there is an active port mirroring configured between Port 8 and 45.</p><p>Port 13: Sometimes comes up with 10 MBit/s HDX and sometimes with 1GBit/s FDX</p><p>At Port 47 and 24 failure could be seen.</p><p>Switch B: Port 1and Port 24 I would check at least.</p><p>At both Switches I would suggest you really should check at the port setting tab the actual operational mode of the interface against your expected value.</p><p>I think a Port with 100 MBit/s HDX is not very common. And a Port with HDX is worthful to be investigated if HDX is really the correct mode.</p></div><div id="comment-44190-info" class="comment-info"><span class="comment-age">(15 Jul '15, 14:19)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44194"></span><div id="comment-44194" class="comment not_top_scorer"><div id="post-44194-score" class="comment-score"></div><div class="comment-text"><p>Maybe this could help you. Disconnect the Port 46 at Switch A and tell/show us the stp status of switch A. There is a very small chance that this leads us to problem source. But keep your procceses in mind to do this.</p></div><div id="comment-44194-info" class="comment-info"><span class="comment-age">(15 Jul '15, 22:21)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44197"></span><div id="comment-44197" class="comment not_top_scorer"><div id="post-44197-score" class="comment-score"></div><div class="comment-text"><p>Thank you for you time!</p><p>At switch A: The mirror at port 8 is for monitoring purpose. The port 45 is the main switch. I did the monitoring at the router cable because it was my first lead.</p><p>Port 13 is a copier, it switches between 10 and 1Gbit because of power saving mode. This used to be fixed disabling the power saving at the switch. I removed this setting when testing the config for the loop issue. Now that loops seems to be gone, I'll disable power saving for it again.</p><p>Port 24 is an old Synel SY-751 badging system. Although there are few errors reported, its working fine.</p><p>Port 47 is the backup modem that was provoking one of the loops. Is one of the first ADSL Modems, an Alcatel Speed Touch. It's used to have a lot of packet errors since long time, without major troubles. It gives connection.</p><p>Port 46 is the link between both switches. Why are you incriminating it? Did you mean port 47? I can't find anything wrong about it from port monitoring nor from the system log.</p><p>Switch B Port 24 is the link with switch A.</p><p>Port 1 is a standard PC from a colleague. Connectivity is OK. The 10/1Gbit dance comes from PC power saving.</p><p>Port 20 that have 100 HDX is the modem for temperature/humidity capture. This one was incriminated in some of the loops. I will try to fix it at 100 FDX or 10FDX.</p><p>Thank you for your fresh eye. Making the report here I'm getting some details I've overlooked alone.</p></div><div id="comment-44197-info" class="comment-info"><span class="comment-age">(16 Jul '15, 02:43)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44199"></span><div id="comment-44199" class="comment not_top_scorer"><div id="post-44199-score" class="comment-score"></div><div class="comment-text"><pre><code> Port 46 is the link between both switches. Why are you incriminating it? Did you mean port 47? I can&#39;t find anything wrong about it from port monitoring nor from the system log. </code></pre><p>I meant Port 46, if you unplug it the connection betwen the switches should be lost. If not or you got a new Root port then you know why you have a loop. it is judt a test.</p><p>At port 47 normally there should not be failures. As I remind me it is configured as FDX.</p></div><div id="comment-44199-info" class="comment-info"><span class="comment-age">(16 Jul '15, 03:20)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44203"></span><div id="comment-44203" class="comment not_top_scorer"><div id="post-44203-score" class="comment-score"></div><div class="comment-text"><p>Yes, if I disconnect port 46 the connection with switch B is lost. It's the only path to the other switch.</p><p>I can force the port 47 to 10Mbit FDX but it still makes some errors: RX InOctets 521160 InUcastPkts 1345 InNUcastPkts 32 InDiscards 0 InErrors 40 FCSErrors 37 FrameTooLongs 0 InternalMacReceiveErrors 0</p><p>TX OutOctets 368765 OutUcastPkts 1409 OutNUcastPkts 1314 OutErrors 0 LateCollisions 0 ExcessiveCollisions 0 InternalMacTransmitErrors 0</p></div><div id="comment-44203-info" class="comment-info"><span class="comment-age">(16 Jul '15, 05:25)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44221"></span><div id="comment-44221" class="comment not_top_scorer"><div id="post-44221-score" class="comment-score"></div><div class="comment-text"><pre><code>I can force the port 47 to 10Mbit FDX but it still makes some errors: RX InOctets 521160 InUcastPkts 1345 InNUcastPkts 32 InDiscards 0 InErrors 40 FCSErrors 37 FrameTooLongs 0 InternalMacReceiveErrors 0</code></pre><p>I don´t know if this device could be forced to 10MBit/s FDX. If a dvice can talk only HDX, than it is so. On the other hand it happens sometimes that the autoneg mechanism fails and then one device sends FDX and the other HDX that is the worst case scenario for a link, because it is an undefined mode.</p><hr /><p>I have seen that Flow control is enabled at one Switch and at the other it is disabled. Check out what is correct for your environment.</p><p>I do normally start with disbaled Flow Control. But this need not be correct for your environment.</p><hr /><p>What is connected at Port Switch A Port 48? Could you post a screenshot of the dynamic forwarding table for all ports of Switch A?</p><hr /><p>I do not know why your switch loops? Maybe you have the whole time a loop but it prevented by the options you enabled at the switches like: Storm Control and Loopback detection.</p><p>Maybe you can perform a little dangerous test.</p><p><strong>But again keep your procceses in mind before you do this. If it is forbidden then stop just now!</strong> Maybe the loop can provoked by disabling Storm control and disabling Loopback detection. If than a broadcast stormm appears it can only be stopped by discabling one device after another.</p></div><div id="comment-44221-info" class="comment-info"><span class="comment-age">(16 Jul '15, 12:55)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="44242"></span><div id="comment-44242" class="comment not_top_scorer"><div id="post-44242-score" class="comment-score"></div><div class="comment-text"><p>For the modem/router, I will plan to change it for a newer model and stop the RX errors.</p><p>About Flow control, I activated this option to see if it stabilize my problem. It did not and it's now disabled again (in both switches) because literature on it shows mitigate advices, especially if you want to do QoS.</p><p>The port 48 is connected to an internal server with some virtual machines on it (shared ethernet card). What did you see of suspect on this?</p><p>Here is the dynamic forwarding table of switch A:</p><pre><code>&gt;      ID    Port    MAC Address     VID     Type
&gt;       1    42      00-08-5D-86-99-58   1   Dynamic     
&gt;       2    46      00-0C-76-4C-37-3F   1   Dynamic     
&gt;       3    48      00-10-18-6C-4A-24   1   Dynamic     
&gt;       4    25      00-11-32-1B-FA-77   1   Dynamic     
&gt;       5    46      00-11-43-B6-75-B8   1   Dynamic     
&gt;       6    46      00-12-3F-55-D3-5B   1   Dynamic     
&gt;       7    44      00-13-72-73-F9-B5   1   Dynamic     
&gt;       8    13      00-1E-8F-30-10-1F   1   Dynamic     
&gt;       9    40      00-1E-8F-4C-59-9A   1   Dynamic     
&gt;       10   46      00-1F-3A-4C-3A-34   1   Dynamic     
&gt;       11   24      00-20-4A-54-4C-F0   1   Dynamic     
&gt;       12   47      00-90-D0-32-9F-F3   1   Dynamic     
&gt;       13   48      08-00-27-08-3B-CE   1   Dynamic     
&gt;       14   45      08-00-27-AB-8E-79   1   Dynamic     
&gt;       15   48      08-00-27-BB-F0-59   1   Dynamic     
&gt;       16   44      08-00-27-E8-7D-3E   1   Dynamic     
&gt;       17   14      08-00-37-C1-F4-47   1   Dynamic     
&gt;       18   32      08-62-66-8E-8F-92   1   Dynamic     
&gt;       19   46      14-8F-C6-5A-4D-07   1   Dynamic     
&gt;       20   46      14-D6-4D-06-C7-0C   1   Dynamic     
&gt;       21   46      14-D6-4D-06-C7-24   1   Dynamic     
&gt;       22   29      3C-07-54-38-80-53   1   Dynamic     
&gt;       23   45      A4-BA-DB-3E-1C-4F   1   Dynamic     
&gt;       24   15      A4-BA-DB-3E-1C-51   1   Dynamic     
&gt;       25   46      AC-9E-17-96-67-02   1   Dynamic     
&gt;       26   29      B4-18-D1-D7-F0-A1   1   Dynamic     
&gt;       27   29      C0-C1-C0-95-1A-72   1   Dynamic     
&gt;       28   1       C4-34-6B-53-4C-AD   1   Dynamic     
&gt;       29   46      C8-1F-66-1D-0A-61   1   Dynamic     
&gt;       30   11      D4-BE-D9-C7-0F-B6   1   Dynamic     
&gt;       31   9       D4-BE-D9-C7-10-44   1   Dynamic     
&gt;       32   45      EC-22-80-6A-A5-F4   1   Dynamic     
&gt;       33   45      F0-79-59-D4-88-18   1   Dynamic</code></pre><p>Looking deep at the devices attached I found a dead temperature/humidity modem (power LED is on, but network card's LED is off from modem side and from switch side). Maybe this device was short circuiting the network while dying (it's off, now). I don't have related problems anymore since Wednesday.</p><p>About your test, I had a flood while both Storm Control and Loopback detection were effective. And it's not only the fact of switching off those features that provokes a flood. I still don't know how to provoke the error. For all the test I did/related, I switched one option than wait until the next flood (aleatory but under 24h, normally). It got solved after I switch on the Loopback detection on switch B, Friday evening. But it relates everything OK:</p><pre><code>&gt;     Port  Loopdetect Detection State  Loop Status
&gt;     1     Enabled     Normal
&gt;     2     Enabled     Normal
&gt;     3     Enabled     Normal
&gt;     4     Enabled     Normal
&gt;     5     Enabled     Normal
&gt;     6     Enabled     Normal
&gt;     7     Enabled     Normal
&gt;     8     Enabled     Normal
&gt;     9     Enabled     Normal
&gt;     10    Enabled     Normal
&gt;     11    Enabled     Normal
&gt;     12    Enabled     Normal
&gt;     13    Enabled     Normal
&gt;     14    Enabled     Normal
&gt;     15    Enabled     Normal
&gt;     16    Enabled     Normal
&gt;     17    Enabled     Normal
&gt;     18    Enabled     Normal
&gt;     19    Enabled     Normal
&gt;     20    Enabled     Normal
&gt;     21    Enabled     Normal
&gt;     22    Enabled     Normal
&gt;     23    Enabled     Normal
&gt;     24    Enabled     Normal</code></pre><p>Well, I think we will never be able to know what went wrong with the network. I have now lots of other tasks waiting for my attention and I don't want to take more of your precious time.</p><p>A sincerely big thank you about your help and tips. Even if we didn't get the root, your stranger eye and the exchange gave us a lot of details that I would have overlook alone. Thanks!</p></div><div id="comment-44242-info" class="comment-info"><span class="comment-age">(17 Jul '15, 07:17)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44269"></span><div id="comment-44269" class="comment not_top_scorer"><div id="post-44269-score" class="comment-score"></div><div class="comment-text"><p>Indeed Port 48 was not well aimed, I thought saw something in the logfile But I have seen in your logfiles that once the root bridge has changed. Maybe because Switch B has rebooted, than it is ok.</p><p>But such events could be a sign for a looping problem.</p><p>You are welcome, if you need a helping hand again.</p></div><div id="comment-44269-info" class="comment-info"><span class="comment-age">(17 Jul '15, 13:28)</span> <span class="comment-user userinfo">Christian_R</span></div></div></div><div id="comment-tools-43997" class="comment-tools"><span class="comments-showing"> showing 5 of 18 </span> <a href="#" class="show-all-comments-link">show 13 more comments</a></div><div class="clear"></div><div id="comment-43997-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="43991"></span>

<div id="answer-container-43991" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-43991-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-43991-score" class="post-score" title="current number of votes">1</div><span id="post-43991-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>It's allways the same frame with just a small time delta, so this is most certainly a loop somewhere in your switch infrastructure. Could be a direct loop (switch A -&gt; switch B -&gt; switch A), or a loop through any device connected to both switches.</p><p>If the problem occurs, disconnect one cable after the other until the problem stops. The last cable you unplugged is the one (somehow) involved in the loop.</p><blockquote><p>And this, until I unplug/replug the cable or during many minutes.</p></blockquote><p>O.K. looks like a good candidate to start with ;-)</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Jul '15, 15:45</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-43991" class="comments-container"><span id="44001"></span><div id="comment-44001" class="comment"><div id="post-44001-score" class="comment-score"></div><div class="comment-text"><p>Thank you indeed for your insights! I feel less alone face to this problem. Well, today I think I made a big step forward in troubleshooting this. Got a packet loop as usual:</p><pre><code>0.000000 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000004 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000006 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000009 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000012 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000015 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1
0.000017 172.20.30.11 -&gt; 172.20.30.18 SNMP GET 1.3.6.1.2.1.25.3.2.1.5.1 1.3.6.1.2.1.25.3.5.1.1.1 1.3.6.1.2.1.25.3.5.1.2.1</code></pre><p>The same of yesterday, computer 172.20.30.11 making an SNMP request to the printer 172.20.30.18. Following Kurt's idea, I unplugged cables from:</p><ol><li>172.20.30.11 computer -&gt; Flood continues</li><li>172.20.30.18 printer -&gt; Flood continues, so from here I can guess it's not a problem on devices but a loop inside the network</li><li>On switch A, unplugged the connection to switch B -&gt; Flood continues monitored on switch A</li><li>Plugged the monitoring in switch B -&gt; Flood is also there on every port</li><li>Unplugged the link to switch A -&gt; Flood stops in switch B.</li><li>Replugged the link -&gt; Flood continues. From there I can deduce the problem comes from a device in switch A.</li><li>Unplugged the main router 172.20.30.10 from switch A -&gt; Flood continues.</li><li>Got an old backup ADSL modem/router up since many years plugged to the switch A (172.20.30.198). So discreet that I forgot about it. Unplugged -&gt; Flood stopped!</li></ol><p>I'm ashamed that the cause is so trivial, I was too much concentrated on effectively used material and forgot about it. Reset the ADSL modem/router to free it's ARP table that was probably saturated since the time. Hope that's all.</p><p>During this investigation I studied about Storm Control and Spanning Tree Protocol. Those technologies didn't solve the problem, but I think they somehow modified it. I can't be sure, but from my analysis the problem moved from WAN to LAN circuit to LAN to LAN. Is it merely coincidence or activating those options in the switch changed something?</p></div><div id="comment-44001-info" class="comment-info"><span class="comment-age">(09 Jul '15, 03:08)</span> <span class="comment-user userinfo">vitoriodelage</span></div></div><span id="44034"></span><div id="comment-44034" class="comment"><div id="post-44034-score" class="comment-score"></div><div class="comment-text"><p>Spanning Tree and Storm Control are not perfect solutions and they don't work in all cases. I can only speculate what really happend on your switches, as there is not enough information available.</p></div><div id="comment-44034-info" class="comment-info"><span class="comment-age">(10 Jul '15, 00:23)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-43991" class="comment-tools"></div><div class="clear"></div><div id="comment-43991-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

