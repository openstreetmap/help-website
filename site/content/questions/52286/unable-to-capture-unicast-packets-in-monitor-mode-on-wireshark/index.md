+++
type = "question"
title = "Unable to capture unicast packets in monitor mode on wireshark"
description = '''I have two RPi-3&#x27;s and a desktop linux system. I have the two RPi-3&#x27;s creating ping and iperf3 traffic between each other over wifi. I have the desktop linux system running wireshark in monitor mode, and have not been able to capture any data packets. Things I have done/tried include:  I am currentl...'''
date = "2016-05-06T14:23:00Z"
lastmod = "2016-05-10T06:49:00Z"
weight = 52286
keywords = [ "wlan", "802.11", "monitor-mode", "wireshark" ]
aliases = [ "/questions/52286" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Unable to capture unicast packets in monitor mode on wireshark](/questions/52286/unable-to-capture-unicast-packets-in-monitor-mode-on-wireshark)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-52286-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-52286-score" class="post-score" title="current number of votes">0</div><span id="post-52286-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>I have two RPi-3's and a desktop linux system. I have the two RPi-3's creating ping and iperf3 traffic between each other over wifi. I have the desktop linux system running wireshark in monitor mode, and have not been able to capture any data packets. Things I have done/tried include:</p><ul><li>I am currently running wireshark with ubuntu 14.04 lts using an ASUS PCE-N10 (pci-e) network card</li><li>I am running wireshark Version 1.10.6 (v1.10.6 from master-1.10)</li><li>I have tried 6 different wifi cards (5 usb, 1 pci-e)</li><li>I am capturing 802.11n (no 5G ac)</li><li>I have set wireshark 802.11 encryption keys, and enabled encryption</li><li>I have enabled monitor mode multiple ways (wireshark capture options, airmon-ng, iwconfig, ...)</li><li>I have tried various settings for 802.11 protocol "Ignore Protection bit" and "Assume packets have FCS"</li><li>I have set the channel to match the wifi router (iwconfig or airmon-ng)</li><li>I see lot of broadcast packets</li><li>List item</li></ul><p><code> eth0      Link encap:Ethernet  HWaddr f0:4d:a2:f6:15:82           inet addr:10.10.3.16  Bcast:10.10.3.255  Mask:255.255.255.0           inet6 addr: fe80::f24d:a2ff:fef6:1582/64 Scope:Link           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1           RX packets:1583160 errors:0 dropped:80 overruns:0 frame:0           TX packets:3340647 errors:0 dropped:0 overruns:0 carrier:0           collisions:0 txqueuelen:1000            RX bytes:213443629 (213.4 MB)  TX bytes:4339356507 (4.3 GB)</code></p><code></code><p>lo Link encap:Local Loopback<br />
inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:810841 errors:0 dropped:0 overruns:0 frame:0 TX packets:810841 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:4257012230 (4.2 GB) TX bytes:4257012230 (4.2 GB)</p><p>mon0 Link encap:UNSPEC HWaddr F0-79-59-EB-24-78-3A-30-00-00-00-00-00-00-00-00<br />
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:32865 errors:0 dropped:22794 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:7563887 (7.5 MB) TX bytes:0 (0.0 B)</p></code><p><code>wlan5     Link encap:UNSPEC  HWaddr F0-79-59-EB-24-78-00-00-00-00-00-00-00-00-00-00           BROADCAST MULTICAST  MTU:1500  Metric:1           RX packets:329980 errors:0 dropped:164334 overruns:0 frame:0           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0           collisions:0 txqueuelen:1000            RX bytes:76222872 (76.2 MB)  TX bytes:0 (0.0 B</code><br />
</p><p>Does anyone have any suggestion on what I could be doing wrong</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-wlan" rel="tag" title="see questions tagged &#39;wlan&#39;">wlan</span> <span class="post-tag tag-link-802.11" rel="tag" title="see questions tagged &#39;802.11&#39;">802.11</span> <span class="post-tag tag-link-monitor-mode" rel="tag" title="see questions tagged &#39;monitor-mode&#39;">monitor-mode</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>06 May '16, 14:23</strong></p><img src="https://secure.gravatar.com/avatar/796d353373746c193c6e5c1ca1655320?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mw-ed&#39;s gravatar image" /><p><span>mw-ed</span><br />
<span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mw-ed has one accepted answer">100%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>09 May '16, 11:42</strong> </span></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span></br></p></div></div><div id="comments-container-52286" class="comments-container"><span id="52288"></span><div id="comment-52288" class="comment"><div id="post-52288-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>have not been able to capture any data packets</p></blockquote><p>I.e., you are not seeing any 802.11 packets with a "Type and subtype" field of "Data" or "QoS Data" or some other "Data" type?</p><p>If you <em>are</em> seeing them, please indicate what you mean by "have not been able to capture any data packets" - do you mean that nothing gets dissected past the 802.11 layer?</p></div><div id="comment-52288-info" class="comment-info"><span class="comment-age">(06 May '16, 15:06)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="52292"></span><div id="comment-52292" class="comment"><div id="post-52292-score" class="comment-score"></div><div class="comment-text"><p>I have seen some broadcast packets, but no "Type and subtype" field of "Data" or "QoS Data" packets</p></div><div id="comment-52292-info" class="comment-info"><span class="comment-age">(06 May '16, 15:36)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52293"></span><div id="comment-52293" class="comment"><div id="post-52293-score" class="comment-score">1</div><div class="comment-text"><p>Just to be sure, does the above mean that you cannot see any 802.11 frames whose <code>wlan.da</code> field would differ from <code>ff:ff:ff:ff:ff:ff</code> (applying a display filter <code>!(wlan.da == ff:ff:ff:ff:ff:ff)</code> will show you whether any such frame remains in the packet list pane) or that such frames are there but you cannot decrypt their contents?</p><p>If there are really no frames but those with broadcast destination address, and if you are sure that the RPi-3s don't use 802.11ac mode, it may be a linux regression, as <span>@Bob Jones</span> pointed out in his comment from 30 Apr, 05:48 to <a href="https://ask.wireshark.org/questions/52027/capturing-traffic-from-wireless-cctv/52107">this answer</a>.</p><p>In general, it doesn't matter how many different WLAN adaptors you have but how many different chipsets they are built on, as any number of adaptors based on the same chipset will behave the same - at least in linux where adaptor manufacturer's specific modifications of generic drivers for a chipset are really rare.</p></div><div id="comment-52293-info" class="comment-info"><span class="comment-age">(06 May '16, 23:03)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="52297"></span><div id="comment-52297" class="comment not_top_scorer"><div id="post-52297-score" class="comment-score"></div><div class="comment-text"><p>Can you share a trace of what you are seeing? Otherwise we are just guessing at what you might or might not observe.</p></div><div id="comment-52297-info" class="comment-info"><span class="comment-age">(07 May '16, 10:36)</span> <span class="comment-user userinfo">Bob Jones</span></div></div><span id="52344"></span><div id="comment-52344" class="comment not_top_scorer"><div id="post-52344-score" class="comment-score"></div><div class="comment-text"><p>I am currently using ASUS PCE-N10 (pci-e) which is a rtl8192ce chipset (as are most). Other adapters also include and rtl8192cu and Atheros ath9k chipsets. I have also tried running it on a RPi3, but the RPi3 does not seem to support monitor mode.</p></div><div id="comment-52344-info" class="comment-info"><span class="comment-age">(09 May '16, 05:20)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52345"></span><div id="comment-52345" class="comment not_top_scorer"><div id="post-52345-score" class="comment-score"></div><div class="comment-text"><p><img src="https://osqa-ask.wireshark.org/upfiles/wireshark_rE5AV0k.png" alt="alt text" /></p></div><div id="comment-52345-info" class="comment-info"><span class="comment-age">(09 May '16, 05:53)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52354"></span><div id="comment-52354" class="comment not_top_scorer"><div id="post-52354-score" class="comment-score"></div><div class="comment-text"><p>So what is the value of the "Type and subtype" field in the "LLC" frames?</p></div><div id="comment-52354-info" class="comment-info"><span class="comment-age">(09 May '16, 11:23)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="52356"></span><div id="comment-52356" class="comment not_top_scorer"><div id="post-52356-score" class="comment-score"></div><div class="comment-text"><p>Unfortunately, screen shots do not provide enough details to provide analysis. It is best to post a PCAP file with the capture in question to Cloudshark, Google drive, etc. and share it so others can download the file.</p><p>With that said, did you try the other suggestions made above:</p><ol><li><p>Configure the WLAN (if possible) to 802.11a/b/g so that the higher coding schemes are not used. I suspect the WiFi chipsets do not support the higher modulation schemes offered in an 802.11ac networks.</p></li><li><p>Apply the following filter to ensure no Data and/or QoS-Data packets are being captured: wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12) If you apply the filter and see nothing, then you know that no Data and/or QoS-Data frames are not captured.</p></li></ol></div><div id="comment-52356-info" class="comment-info"><span class="comment-age">(09 May '16, 11:27)</span> <span class="comment-user userinfo">Amato_C</span></div></div><span id="52357"></span><div id="comment-52357" class="comment not_top_scorer"><div id="post-52357-score" class="comment-score"></div><div class="comment-text"><p>"Type and subtype" field in the "LLC" frames?</p><pre><code>Type/Subtype: Data (0x20)</code></pre></div><div id="comment-52357-info" class="comment-info"><span class="comment-age">(09 May '16, 11:29)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52360"></span><div id="comment-52360" class="comment not_top_scorer"><div id="post-52360-score" class="comment-score"></div><div class="comment-text"><p>OK, so you <em>are</em> seeing 802.11 packets with a "Type and subtype" field of "Data" or "QoS Data" or some other "Data" type.</p><p>I.e., you <em>are</em> capturing data packets; that's what those LLC packets are.</p><p>What you don't appear to be capturing are <em>unicast</em> packets.</p></div><div id="comment-52360-info" class="comment-info"><span class="comment-age">(09 May '16, 11:41)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="52361"></span><div id="comment-52361" class="comment"><div id="post-52361-score" class="comment-score">1</div><div class="comment-text"><p>So you are seeing data frames now? What happens when you apply this filter in Wireshark:</p><p>wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12)</p><p>Do you see any frames?</p></div><div id="comment-52361-info" class="comment-info"><span class="comment-age">(09 May '16, 11:42)</span> <span class="comment-user userinfo">Amato_C</span></div></div><span id="52362"></span><div id="comment-52362" class="comment not_top_scorer"><div id="post-52362-score" class="comment-score"></div><div class="comment-text"><p>Amato_C,</p><p>I set the router to support B/G only (no n and it does not support ac). I ran wireshark capture, with the display filter wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12)</p><p>The result was a bunch of LLC packets and a few SNA,STP, CLNP. I also received a a few IPv4 packet with warnings ("Bogus IP Header" and "Malformed Packet")</p></div><div id="comment-52362-info" class="comment-info"><span class="comment-age">(09 May '16, 11:53)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52363"></span><div id="comment-52363" class="comment not_top_scorer"><div id="post-52363-score" class="comment-score"></div><div class="comment-text"><p>Guy Harris,</p><p>Yes you are correct, and I guess the unicast packets are what I am looking for, and thanks for changing the topic line.</p></div><div id="comment-52363-info" class="comment-info"><span class="comment-age">(09 May '16, 11:56)</span> <span class="comment-user userinfo">mw-ed</span></div></div><span id="52376"></span><div id="comment-52376" class="comment"><div id="post-52376-score" class="comment-score">1</div><div class="comment-text"><p>Looks like monitor mode is supported on the adapter but not promiscuous mode. I don't have that chipset, but several others that behave this way. Broadcast/multicast is usually sent at lower rates/modulation coding schemes so they tend to be easier to get. However, ACKs, RTS, and CTS tend to be sent at lower rates too and we don't see any of those, and they are typically unicast. I rule out modulation then (though you might still have issues collecting at higher rates) and assign root cause to no promiscuous mode support while in monitor mode.</p><p>Suggest to change hardware and/or kernel.</p></div><div id="comment-52376-info" class="comment-info"><span class="comment-age">(09 May '16, 18:24)</span> <span class="comment-user userinfo">Bob Jones</span></div></div><span id="52390"></span><div id="comment-52390" class="comment not_top_scorer"><div id="post-52390-score" class="comment-score"></div><div class="comment-text"><p>Bob Jones,</p><p>Thanks, I went back and tried the TP-LINK TL-WN722N (Atheros ath9k chipset) and I seem to be up and running now.</p><p>Thank you for everyone's help.</p></div><div id="comment-52390-info" class="comment-info"><span class="comment-age">(10 May '16, 06:40)</span> <span class="comment-user userinfo">mw-ed</span></div></div></div><div id="comment-tools-52286" class="comment-tools"><span class="comments-showing"> showing 5 of 15 </span> <a href="#" class="show-all-comments-link">show 10 more comments</a></div><div class="clear"></div><div id="comment-52286-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="52392"></span>

<div id="answer-container-52392" class="answer accepted-answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-52392-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-52392-score" class="post-score" title="current number of votes">0</div><span id="post-52392-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="mw-ed has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>The key points for me to capture unicast packets from other systems seem to be:</p><ul><li>the rtl8192 chipset does not seem to capture unicast packets on ubuntu 14.04 LTS</li><li>both monitor and pomiscuous mode must be set</li><li>the wlan card must be set to monitor the appropriate frequency (i.e. iwconfig wlan0 channel 11)</li></ul><p>Further, to decode the packets:</p><ul><li>Edit-&gt;Preferences-&gt;Protocols-&gt;IEEE 802.11-&gt;</li><li>"Enable Decryption" must be set</li><li>"Decryption Keys" must be set</li><li>Not sure if Ignore Protection bit needs to be set (I have it set)</li><li>the EAPOL packets must have been captured for the device connection some time in the wireshark session</li></ul></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>10 May '16, 06:49</strong></p><img src="https://secure.gravatar.com/avatar/796d353373746c193c6e5c1ca1655320?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mw-ed&#39;s gravatar image" /><p><span>mw-ed</span><br />
<span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mw-ed has one accepted answer">100%</span> </br></br></p></img></div></div><div id="comments-container-52392" class="comments-container"></div><div id="comment-tools-52392" class="comment-tools"></div><div class="clear"></div><div id="comment-52392-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

