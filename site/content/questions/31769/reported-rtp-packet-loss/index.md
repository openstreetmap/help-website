+++
type = "question"
title = "Reported RTP Packet Loss"
description = '''I was working on an issue where a commercial packet level RTP stream analyzer tool was reporting very high packet loss (on the order of +50%) for one RTP stream (the other stream reported without loss) on some calls but users were not reporting call quality issues. From the beginning we believed the...'''
date = "2014-04-13T11:44:00Z"
lastmod = "2014-04-15T21:47:00Z"
weight = 31769
keywords = [ "sbc", "packetloss", "rtp", "voip", "dsp" ]
aliases = [ "/questions/31769" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Reported RTP Packet Loss](/questions/31769/reported-rtp-packet-loss)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-31769-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-31769-score" class="post-score" title="current number of votes">0</div><span id="post-31769-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I was working on an issue where a commercial packet level RTP stream analyzer tool was reporting very high packet loss (on the order of +50%) for one RTP stream (the other stream reported without loss) on some calls but users were not reporting call quality issues. From the beginning we believed the issue was related to false reporting by the tool and not actual loss of packets. We used Wireshark to analyze a packet capture in an attempt at locating the issue and we found the RTP tools in Wireshark reported the same loss.</p><p>In the end, the reported loss was confirmed false and no packet loss was actually occurring. The root cause was the VoIP platform "shifting" the RTP media stream to a DSP resource during DTMF use.</p><ul><li>SIP would establish bi-directional RTP streams between a Phone and a SBC for an outbound call</li><li>User would signal DTMF from the Phone for call routing</li><li>The Phone-&gt;SBC stream would shift away from the SBC over to a DSP resource (out-of-band DTMF because we use G.729)</li><li>After a period of time without DTMF signaling, the stream would shift back to the SBC to release the DSP resource</li></ul><p>During this shifted period of time:</p><ul><li>The SSRC would stay the same</li><li>The sequence numbers would continue to increment from the point at which the stream shifted to the DSP resource</li><li>The end point IP address would obviously change from that of the SBC to that of the DSP resource</li></ul><p>This caused both our tool and Wireshark to report a new/discrete steam for the Phone-&gt;DSP during the shifted period. If/when the stream shifted back to the original Phone-&gt;SBC path:</p><ul><li>The SSRC would remain the same</li><li>The sequence numbers would continue to increment from the point at which the stream shifted away from the DSP resource</li><li>The end station IP address would return being that of the SBC</li></ul><p>This resulted in this steam matching up with the original stream but the sequence number being significantly higher from when the steam organically shifted to the DSP resource. This gap in sequence numbers is reported by both tools as lost packets.</p><p>My questions are...</p><ul><li>Has anyone seem this behavior and/or have any documentation this RTP stream behavior that you would provide for additional research?</li><li>Is there any current or planned functionality in Wireshark to detect and identify this event/behavior then correctly correlate the streams for accurate reporting?</li></ul><p>Any assistance with this issue is greatly appreciated. Please feel free to respond with questions if any additional information is needed.</p><p>Thanks!</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Tree_Example.png" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-sbc" rel="tag" title="see questions tagged &#39;sbc&#39;">sbc</span> <span class="post-tag tag-link-packetloss" rel="tag" title="see questions tagged &#39;packetloss&#39;">packetloss</span> <span class="post-tag tag-link-rtp" rel="tag" title="see questions tagged &#39;rtp&#39;">rtp</span> <span class="post-tag tag-link-voip" rel="tag" title="see questions tagged &#39;voip&#39;">voip</span> <span class="post-tag tag-link-dsp" rel="tag" title="see questions tagged &#39;dsp&#39;">dsp</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>13 Apr '14, 11:44</strong></p><img src="https://secure.gravatar.com/avatar/7c1ef29980c9705460c40387ee1dc52b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="oma1981&#39;s gravatar image" /><p><span>oma1981</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="oma1981 has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>15 Apr '14, 17:35</strong> </span></p></div></div><div id="comments-container-31769" class="comments-container"><span id="31770"></span><div id="comment-31770" class="comment"><div id="post-31770-score" class="comment-score"></div><div class="comment-text"><p>How is the RTP stream "shifted"? Is there a SIP re-INVITE or UPDATE with a new SDP offer/answer to shift the stream to the DSP resource? Or is it instead done with proprietary signaling or some other protocol between the SBC and DSP resource?</p><p>Can you post an example pcap file of this happening, like on cloudshark.org or somewhere publicly accessible?</p></div><div id="comment-31770-info" class="comment-info"><span class="comment-age">(13 Apr '14, 13:14)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="31851"></span><div id="comment-31851" class="comment"><div id="post-31851-score" class="comment-score"></div><div class="comment-text"><p><span>@Oma</span>: did you get my comment? (I've noticed the emailing system for this site isn't consistent, so just making sure...)</p></div><div id="comment-31851-info" class="comment-info"><span class="comment-age">(15 Apr '14, 14:09)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="31859"></span><div id="comment-31859" class="comment"><div id="post-31859-score" class="comment-score"></div><div class="comment-text"><p>Sorry for the slow response. I am unfortunately not able to post a packet capture due to privacy and security reasons. About the best I can do at this moment is a sanitized call tree. This capture was taken from the perspective of the SBC. Near the bottom it can be seen when the Remote DSP starts providing RTP DTMF but the capture did not witness any signaling to the SBC for establishing the RTP stream with the Remote DSP.</p><p>Thoughts?</p></div><div id="comment-31859-info" class="comment-info"><span class="comment-age">(15 Apr '14, 17:36)</span> <span class="comment-user userinfo">oma1981</span></div></div><span id="31863"></span><div id="comment-31863" class="comment"><div id="post-31863-score" class="comment-score"></div><div class="comment-text"><p>You asked:</p><pre><code>Thoughts?</code></pre><p>Yes: that this will be hard to diagnose without an example capture file. :)</p><p>The above call ladder diagram doesn't show any signaling between the SBC and even the <em>phone</em>, let alone with the branch or remote DSP resources. You said above that the capture is taken from the perpsective of the SBC - doesn't the SBC signal SIP to the phone?</p><p>Was your original problem of incorrect RTP reporting also from captures taken on the SBC, or was it from somewhere else?</p><p>All I see in the above call flow is the initial INVITE transaction at the start, and what I assume are in-dialog re-INVITEs after that, but only between the Session Manager and the SBC. So I assume the Session Manager is the one controlling the media shifting, by sending a re-INVITE without SDP, getting SBC's 200 OK with an SDP offer, and changing the SDP info in the ACKs it sends back to the SBC to move the media. Right?</p><p>Also, in this call flow it looks like the SSRCs are changing, and the DTMF events are going from the DSP to the SBC... both of which you said were not the case in your original question. (I think?)</p></div><div id="comment-31863-info" class="comment-info"><span class="comment-age">(15 Apr '14, 21:30)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="31865"></span><div id="comment-31865" class="comment"><div id="post-31865-score" class="comment-score"></div><div class="comment-text"><p>BTW, the reason I'm asking these things is because Wireshark doesn't really know what RTP streams are associated with what call except by seeing the appropriate signaling (i.e., SIP or H.323 or whatever) in the capture. In fact it doesn't even usually know they're RTP packets at all, instead of just random UDP packets, without seeing that signaling. In the call flow above, anything that's labeled "RTP" is only labeled that because Wireshark has seen SIP/SDP that tells it the address:ports of those RTP streams, I believe.</p><p>So if the streams you were talking about in your original question aren't on that call flow, Wireshark doesn't know about them.</p></div><div id="comment-31865-info" class="comment-info"><span class="comment-age">(15 Apr '14, 21:47)</span> <span class="comment-user userinfo">Hadriel</span></div></div></div><div id="comment-tools-31769" class="comment-tools"></div><div class="clear"></div><div id="comment-31769-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

