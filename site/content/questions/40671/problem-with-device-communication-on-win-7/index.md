+++
type = "question"
title = "Problem with device communication on win 7"
description = '''I&#x27;ve been using an application for sending/receiving data to multiple devices which are configured in persistent route through network. It&#x27;s been working fine on Windows XP . I had switch to Win7 and found the application not able to send the data to devices any more from the PC ,but still it can re...'''
date = "2015-03-18T12:42:00Z"
lastmod = "2015-07-28T09:19:00Z"
weight = 40671
keywords = [ "win", "7" ]
aliases = [ "/questions/40671" ]
osqa_answers = 3
osqa_accepted = false
+++

<div class="headNormal">

# [Problem with device communication on win 7](/questions/40671/problem-with-device-communication-on-win-7)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40671-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40671-score" class="post-score" title="current number of votes">0</div><span id="post-40671-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I've been using an application for sending/receiving data to multiple devices which are configured in persistent route through network. It's been working fine on Windows XP . I had switch to Win7 and found the application not able to send the data to devices any more from the PC ,but still it can receive the data.</p><p>I have tried changing configuration for NIC to allow jumbo packets, Disabled the firewall and anti virus but still I am not able to send the data.</p><p>When I install wire-shark on win 7 PC to capture data for analysis,surprisingly my application able to send the data to devices with out any issues but if I stops wire-shark and again run the application it is not able to send the data.</p><p>can any body tell me what modifications wire-shark is doing to PC to allow the data to transfer?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-win" rel="tag" title="see questions tagged &#39;win&#39;">win</span> <span class="post-tag tag-link-7" rel="tag" title="see questions tagged &#39;7&#39;">7</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>18 Mar '15, 12:42</strong></p><img src="https://secure.gravatar.com/avatar/1b3b58b0547169d9b2d6e36cc6ce6c91?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="lav&#39;s gravatar image" /><p><span>lav</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="lav has no accepted answers">0%</span></p></div></div><div id="comments-container-40671" class="comments-container"></div><div id="comment-tools-40671" class="comment-tools"></div><div class="clear"></div><div id="comment-40671-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="40679"></span>

<div id="answer-container-40679" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40679-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40679-score" class="post-score" title="current number of votes">1</div><span id="post-40679-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>If you select the option Wireshark installs WinPcap, a driver to support capturing packets.</p><p>Update the NIC driver and reset TCP/IP using:</p><p><code>&gt; netsh winsock reset catalog</code></p><p><code>&gt; netsh int ip reset reset.txt</code></p><p>Restart the pc.</p><p>It will solve your problem but also remove any entries written by your security software. If you have the time, do a fresh install of Win 7 without any 3rd party software and install them one by one until you find the software that is causing the issue.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>19 Mar '15, 01:42</strong></p><img src="https://secure.gravatar.com/avatar/721b9692d2a30fc3b386b7fae9a44220?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Roland&#39;s gravatar image" /><p><span>Roland</span><br />
<span class="score" title="764 reputation points">764</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="15 badges"><span class="bronze">●</span><span class="badgecount">15</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Roland has 9 accepted answers">13%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>19 Mar '15, 01:43</strong> </span></p></div></div><div id="comments-container-40679" class="comments-container"><span id="40692"></span><div id="comment-40692" class="comment"><div id="post-40692-score" class="comment-score"></div><div class="comment-text"><p>Hi Roland, Thanks for your reply I will try this and let you know the status. But still I am not clear why it is working when Wireshark is running?Do you have any information on that.</p></div><div id="comment-40692-info" class="comment-info"><span class="comment-age">(19 Mar '15, 11:09)</span> <span class="comment-user userinfo">lav</span></div></div><span id="40765"></span><div id="comment-40765" class="comment"><div id="post-40765-score" class="comment-score"></div><div class="comment-text"><p>Did you try my suggestions? When winpcap is installed it bypasses the os protocol stack. Search for winpcap internals if you want to find out more.</p></div><div id="comment-40765-info" class="comment-info"><span class="comment-age">(22 Mar '15, 05:41)</span> <span class="comment-user userinfo">Roland</span></div></div><span id="41102"></span><div id="comment-41102" class="comment"><div id="post-41102-score" class="comment-score"></div><div class="comment-text"><p>Roland,I tried your sugesstions but still no luck.</p></div><div id="comment-41102-info" class="comment-info"><span class="comment-age">(01 Apr '15, 10:03)</span> <span class="comment-user userinfo">lav</span></div></div><span id="41460"></span><div id="comment-41460" class="comment"><div id="post-41460-score" class="comment-score"></div><div class="comment-text"><p>Then the way forward is to do a fresh install of Windows without any 3rd party software.</p></div><div id="comment-41460-info" class="comment-info"><span class="comment-age">(15 Apr '15, 07:11)</span> <span class="comment-user userinfo">Roland</span></div></div><span id="41461"></span><div id="comment-41461" class="comment"><div id="post-41461-score" class="comment-score"></div><div class="comment-text"><p><span>@Roland</span>,</p><p>You stated that "When winpcap is installed it bypasses the os protocol stack", but WinPCap is a filter driver that "taps" data traversing the OS stack, it should not interfere with that data, or the processing of it by other elements of the stack. If it did, then lots of applications would fail to work when it's installed, which isn't the case.</p><p>In this case the application did <strong>NOT</strong> work on Win 7 until the OP installed Wireshark and started a capture. This implies some config issue for the host\application\client that was overcome when making a capture, I still think promiscuous mode is the most likely suspect.</p></div><div id="comment-41461-info" class="comment-info"><span class="comment-age">(15 Apr '15, 07:24)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="41463"></span><div id="comment-41463" class="comment not_top_scorer"><div id="post-41463-score" class="comment-score"></div><div class="comment-text"><p><span>@grahamb</span>,</p><p>My statement is based on <a href="https://www.winpcap.org/docs/docs_412/html/group__NPF.html">this</a> link. Maybe I misinterpreted the diagram. lav can confirm if he used promiscous mode, but from what I understood he didn't and the problem is the sending of packets from the host, not towards it. I believe it is a host issue and the prettiest solution is to do a clean install of Windows.</p></div><div id="comment-41463-info" class="comment-info"><span class="comment-age">(15 Apr '15, 10:34)</span> <span class="comment-user userinfo">Roland</span></div></div><span id="41466"></span><div id="comment-41466" class="comment not_top_scorer"><div id="post-41466-score" class="comment-score"></div><div class="comment-text"><p>The diagram in the link shows how a WinPCap application communicates with the NPF driver to receive (and send) data through the NIC. All other applications using the NIC are (hopefully) unaffected by the NPF driver.</p><p>Promiscuous mode is on by default (in Wireshark), and there have been other questions where running a capture caused an app to work that in the end were determined to be down to promiscuous mode enabling the receipt of packets that would normally have been dropped.</p><p>Until <span>@lav</span> reports back on whether turning promiscuous mode off affects anything, we won't know. Posting the capture made while the application is running would also be handy.</p></div><div id="comment-41466-info" class="comment-info"><span class="comment-age">(15 Apr '15, 14:48)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="41467"></span><div id="comment-41467" class="comment not_top_scorer"><div id="post-41467-score" class="comment-score"></div><div class="comment-text"><p>Thanks for explaining the diagram.</p></div><div id="comment-41467-info" class="comment-info"><span class="comment-age">(15 Apr '15, 14:59)</span> <span class="comment-user userinfo">Roland</span></div></div><span id="42815"></span><div id="comment-42815" class="comment not_top_scorer"><div id="post-42815-score" class="comment-score"></div><div class="comment-text"><p><span>@Roland</span> I tried fresh installation of win 7 with out any third party software's and disabled all the security features but still i have same problem</p></div><div id="comment-42815-info" class="comment-info"><span class="comment-age">(01 Jun '15, 12:42)</span> <span class="comment-user userinfo">lav</span></div></div><span id="42816"></span><div id="comment-42816" class="comment not_top_scorer"><div id="post-42816-score" class="comment-score"></div><div class="comment-text"><p><span>@grahamb</span> as you said if I turn off promiscuous mode my application is not working .I tried to enable promiscuous mode for my 85279LM NIC as said in the following URL <a href="http://www.intel.com/support/network/sb/cs-005897.htm">http://www.intel.com/support/network/sb/cs-005897.htm</a> but still my application is not working</p></div><div id="comment-42816-info" class="comment-info"><span class="comment-age">(01 Jun '15, 12:49)</span> <span class="comment-user userinfo">lav</span></div></div></div><div id="comment-tools-40679" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-40679-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="40694"></span>

<div id="answer-container-40694" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40694-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40694-score" class="post-score" title="current number of votes">0</div><span id="post-40694-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>You say things change "when Wireshark is running". Do you mean making a capture or just viewing a capture? If when making a capture then possibly it might be because the capture interface is set to promiscuous mode.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>19 Mar '15, 13:51</strong></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="grahamb has 274 accepted answers">22%</span></p></div></div><div id="comments-container-40694" class="comments-container"><span id="40762"></span><div id="comment-40762" class="comment"><div id="post-40762-score" class="comment-score"></div><div class="comment-text"><p>Hi Graham,I mean when I am making a capture with wireshark my application also able to send data to devices.</p><p>I didn't get your point why capturing in promiscuous mode will allow my application to transfer data fine on Win 7.</p></div><div id="comment-40762-info" class="comment-info"><span class="comment-age">(21 Mar '15, 18:18)</span> <span class="comment-user userinfo">lav</span></div></div><span id="40786"></span><div id="comment-40786" class="comment"><div id="post-40786-score" class="comment-score">1</div><div class="comment-text"><p>Apart from enabling WinPCap to transfer data frames to a user application (such as Wireshark) the other thing that changes is that the interface you are capturing on is (usually) set to promiscuous mode. That's enabled by the checkbox "Use promiscuous mode on all interfaces" on the Capture Options dialog and by the "Capture packets in promiscuous mode" checkbox on each individual Edit Interfaces settings dialog.</p><p><a href="http://en.wikipedia.org/wiki/Promiscuous_mode">Promiscuous mode</a> means that all packets passing by the interface are captured, not just those "addressed" to the interface (either uni- or multi-cast).</p><p>Try turning off promiscuous mode when capturing and see if your application then works correctly.</p></div><div id="comment-40786-info" class="comment-info"><span class="comment-age">(23 Mar '15, 11:38)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="41548"></span><div id="comment-41548" class="comment"><div id="post-41548-score" class="comment-score"></div><div class="comment-text"><p>I will try promiscuous mode turn off to check whether my application still communicate good or not.</p></div><div id="comment-41548-info" class="comment-info"><span class="comment-age">(17 Apr '15, 12:11)</span> <span class="comment-user userinfo">lav</span></div></div><span id="43279"></span><div id="comment-43279" class="comment"><div id="post-43279-score" class="comment-score"></div><div class="comment-text"><p>Hi Graham,</p><p>Promiscuous mode is what makes my application works fine.Is there any work around to make it work with out using wire shark in promiscuous mode</p></div><div id="comment-43279-info" class="comment-info"><span class="comment-age">(17 Jun '15, 12:45)</span> <span class="comment-user userinfo">lav</span></div></div><span id="43287"></span><div id="comment-43287" class="comment"><div id="post-43287-score" class="comment-score"></div><div class="comment-text"><p>Posting a link to a capture file will give us the actual info, so I'm just guessing here. Some more details on what protocol you are using would be helpful.</p><p>It seems odd that you can't "send" without promiscuous mode being on, normally promiscuous mode affects reception, what do you mean by "send"? Maybe your application expects a response from the "send" to confirm it was sent and the response isn't being received because it's addressed to some other host and only by enabling promiscuous mode does it allow your PC to receive it.</p></div><div id="comment-43287-info" class="comment-info"><span class="comment-age">(17 Jun '15, 15:05)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="43336"></span><div id="comment-43336" class="comment not_top_scorer"><div id="post-43336-score" class="comment-score"></div><div class="comment-text"><p><span></span><span>@grahamb</span> can you give me your mail id to send the capture files.I am not comfortable to post it public</p></div><div id="comment-43336-info" class="comment-info"><span class="comment-age">(18 Jun '15, 10:09)</span> <span class="comment-user userinfo">lav</span></div></div><span id="43338"></span><div id="comment-43338" class="comment not_top_scorer"><div id="post-43338-score" class="comment-score"></div><div class="comment-text"><p>You can see my email address in Wireshark -&gt; Help -&gt; About -&gt; Authors, usually 1 click of the scroll bar down.</p></div><div id="comment-43338-info" class="comment-info"><span class="comment-age">(18 Jun '15, 12:07)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="43588"></span><div id="comment-43588" class="comment not_top_scorer"><div id="post-43588-score" class="comment-score"></div><div class="comment-text"><p><span>@grahamb</span> I had sent capture files to your mail.Please have a look at them</p></div><div id="comment-43588-info" class="comment-info"><span class="comment-age">(26 Jun '15, 05:05)</span> <span class="comment-user userinfo">lav</span></div></div><span id="43855"></span><div id="comment-43855" class="comment not_top_scorer"><div id="post-43855-score" class="comment-score"></div><div class="comment-text"><p>Hi Graham,do you have a chance to look in to log files I sent</p></div><div id="comment-43855-info" class="comment-info"><span class="comment-age">(03 Jul '15, 18:31)</span> <span class="comment-user userinfo">lav</span></div></div><span id="43858"></span><div id="comment-43858" class="comment not_top_scorer"><div id="post-43858-score" class="comment-score"></div><div class="comment-text"><p>Been a bit busy with SharkFest, but hopefully this weekend.</p></div><div id="comment-43858-info" class="comment-info"><span class="comment-age">(03 Jul '15, 20:22)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="43889"></span><div id="comment-43889" class="comment not_top_scorer"><div id="post-43889-score" class="comment-score"></div><div class="comment-text"><p>okay Thanks Graham</p></div><div id="comment-43889-info" class="comment-info"><span class="comment-age">(06 Jul '15, 06:40)</span> <span class="comment-user userinfo">lav</span></div></div><span id="44567"></span><div id="comment-44567" class="comment not_top_scorer"><div id="post-44567-score" class="comment-score"></div><div class="comment-text"><p>Investigation of the captures provided privately by <span>@lav</span> showed that the ftp data transfers were causing ICMP "Fragmentation Needed" responses due to the IP "Don't Fragment" flag being set, but the ICMP responses were addressed to MAC address 00:00:00:00:00:02.</p><p>This wasn't the MAC address of the originator of the too-big packets,so with promisc mode off, the ICMP message was discarded and the sender continued with the "Don't Fragment" flag set and failed to get any response.</p><p>With promisc mode on, the ICMP message was received and the ftp data retransmitted with the "Don't Fragment" flag cleared.</p></div><div id="comment-44567-info" class="comment-info"><span class="comment-age">(28 Jul '15, 09:19)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div></div><div id="comment-tools-40694" class="comment-tools"><span class="comments-showing"> showing 5 of 12 </span> <a href="#" class="show-all-comments-link">show 7 more comments</a></div><div class="clear"></div><div id="comment-40694-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="43291"></span>

<div id="answer-container-43291" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-43291-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-43291-score" class="post-score" title="current number of votes">0</div><span id="post-43291-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Typically, when an application "works" when Wireshark is running, the issue is related to the use of IP multicast by the application.</p><p>IP multicast has mechanisms to enable certain IP multicast packets to be accepted by the NIC and processed by the OS. If these mechanisms aren't working for some reason, then setting the NIC to promiscuous (as Wireshark does) allows all packets to be accepted by the NIC to be available for processing by the OS.</p><p>A web search for "windows xp 7 multicast" shows some hits which may be relevant.</p><p>A web search as to how IP multicast works may also be helpful.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Jun '15, 17:31</strong></p><img src="https://secure.gravatar.com/avatar/bfb20acfe44690473b10c7963b5d4a18?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Bill%20Meier&#39;s gravatar image" /><p><span>Bill Meier ♦♦</span><br />
<span class="score" title="3180 reputation points"><span>3.2k</span></span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="50 badges"><span class="bronze">●</span><span class="badgecount">50</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Bill Meier has 31 accepted answers">17%</span></p></div></div><div id="comments-container-43291" class="comments-container"></div><div id="comment-tools-43291" class="comment-tools"></div><div class="clear"></div><div id="comment-43291-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

