+++
type = "question"
title = "Graph of wlan datarate incorrect"
description = '''I have another problem that I don&#x27;t understand, I have filtered to radiotap.vht.datarate.0 and wlan.fc.type_subtype == 0x28 but the graph don&#x27;t show a higher datarate (180-200 Mbit/s) as the two N devices with maximum of 150 Mbit/s:  I have another question, what is the difference between radiotap.v...'''
date = "2017-02-17T00:12:00Z"
lastmod = "2017-02-18T06:23:00Z"
weight = 59492
keywords = [ "radiotap", "wlan", "datarate", "graph" ]
aliases = [ "/questions/59492" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Graph of wlan datarate incorrect](/questions/59492/graph-of-wlan-datarate-incorrect)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-59492-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I have another problem that I don't understand, I have filtered to radiotap.vht.datarate.0 and wlan.fc.type_subtype == 0x28 but the graph don't show a higher datarate (180-200 Mbit/s) as the two N devices with maximum of 150 Mbit/s:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Screenshot_from_2017-02-17_09-04-37_Gj2KqJp.png" width="640" /></p><p>I have another question, what is the difference between radiotap.vht.datarate.0/radiotap.vht.datarate.1/radiotap.vht.datarate.2/radiotap.vht.datarate.3/radiotap.vht.datarate.4?</p></div><div id="question-tags" class="tags-container tags">radiotap wlan datarate graph</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>17 Feb '17, 00:12</strong></p><img src="https://secure.gravatar.com/avatar/a2f4985698458696d92a0f17460c70a5?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Hyrrican&#39;s gravatar image" /><p>Hyrrican<br />
<span class="score" title="6 reputation points">6</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Hyrrican has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p>converted 18 Feb '17, 02:05</p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p>grahamb ♦<br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-59492" class="comments-container"><span id="59525"></span><div id="comment-59525" class="comment"><div id="post-59525-score" class="comment-score"></div><div class="comment-text"><p>Converted from <a href="https://ask.wireshark.org/questions/59283/data-rate-mcs-not-shown">this</a> other question.</p></div><div id="comment-59525-info" class="comment-info"><span class="comment-age">(18 Feb '17, 02:06)</span> grahamb ♦</div></div></div><div id="comment-tools-59492" class="comment-tools"></div><div class="clear"></div><div id="comment-59492-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="59527"></span>

<div id="answer-container-59527" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-59527-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><blockquote><p>radiotap.vht.datarate.0/radiotap.vht.datarate.1/radiotap.vht.datarate.2/radiotap.vht.datarate.3/radiotap.vht.datarate.4?</p></blockquote></blockquote><p>If you look at the <a href="http://www.radiotap.org/fields/VHT.html">radiotap header VHT</a> definitions, they define a number of fields for up to four users:</p><pre><code>The four mcs_nss fields encode MCS and NSS for up to four users</code></pre><p>Defined are number of spatial streams, MCS index, and coding(BCC or LDPC). Based on this, I believe these fields represent MU-MIMO capabilities. Since these specific ones do not appear to be part of the defined radiotap fields, I suspect they are derived quantities from items that are present, such as MCS Index, bandwidth, guard interval, etc., which would en masse define the datarate, per the <a href="http://mcsindex.com/">MCS Index table</a>.</p><p>Since an AP could send data to up to four clients at the same time with MU_MIMO, and the clients could be all different with different capabilities, RF environment, etc., it seems reasonable that they could all have a different Tx rate assigned per the algorithm radios use to Tx data.</p><p>Another reference is <a href="http://www.balticnetworks.com/docs/802.11AC%20Intro%20with%20RouterOS.pdf">here</a>.</p><p>Note that your analysis can be a little bit tricky in that 802.11ac clients can send frames at max datarate, or something less, all the way down to plain-old 802.11a rates. If you are analyzing all the traffic, be careful when just looking at specific datarate fields in the header for VHT, HT, etc., because if the datarate falls for whatever reason (distance, sudden rf environment change, etc) you might miss it. This is why the</p><pre><code>wlan_radio.data_rate</code></pre><p>field could be of significant value - with luck it captures all the datarates into one field in which case you could then analyze just this one field.<br />
</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>18 Feb '17, 05:23</strong></p><img src="https://secure.gravatar.com/avatar/0a47ef51dd9c9996d194a4983295f5a4?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Bob%20Jones&#39;s gravatar image" /><p>Bob Jones<br />
<span class="score" title="1014 reputation points"><span>1.0k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="15 badges"><span class="bronze">●</span><span class="badgecount">15</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Bob Jones has 19 accepted answers">21%</span> </br></p></div></div><div id="comments-container-59527" class="comments-container"><span id="59528"></span><div id="comment-59528" class="comment"><div id="post-59528-score" class="comment-score"></div><div class="comment-text"><p>@Bob Jones = This answer was already provided here:</p><p><a href="https://ask.wireshark.org/questions/59283/data-rate-mcs-not-shown">https://ask.wireshark.org/questions/59283/data-rate-mcs-not-shown</a></p><p>The original question was already answered, but the user (@Hyrrican) requested assistance on another topic - namely how to graph WLAN data rates. It was decided (and rightly so) to create a new topic regarding the question about plotting WLAN data rates.</p><p>Now with all that said, below is the response (and hopefully the answer to the question) about plotting WLAN data rates in Wireshark.</p></div><div id="comment-59528-info" class="comment-info"><span class="comment-age">(18 Feb '17, 06:11)</span> Amato_C</div></div><span id="59531"></span><div id="comment-59531" class="comment"><div id="post-59531-score" class="comment-score"></div><div class="comment-text"><p>@Amato,</p><blockquote><blockquote><p>@Bob Jones = This answer was already provided here:</p></blockquote></blockquote><p>Is this it?</p><blockquote><blockquote><p>Neither provide a very descriptive explanation. But looking at the Git hub repository, it "appears" that the difference is the number of spatial streams supported by the device??</p></blockquote></blockquote><p>datarate.0 = 1SS</p><p>datarate.1 = 2SS</p><p>An answer, yes, but note that my view is different. Are we allowed to have different viewpoints?<br />
</p><p>I can show with a trace that when my radio Tx frames with one or two SS that the radiotap.vht.datarate.0 field gets populated either way (as does the wlan_radio.data_rate field).</p></div><div id="comment-59531-info" class="comment-info"><span class="comment-age">(18 Feb '17, 06:28)</span> Bob Jones</div></div><span id="59532"></span><div id="comment-59532" class="comment"><div id="post-59532-score" class="comment-score"></div><div class="comment-text"><p>@Bob Jones - I apologize if my response was confrontational. I was trying to explain the sequence of events that lead to this new post based on a previous post.</p><p>And of course people can have different view points! :)</p></div><div id="comment-59532-info" class="comment-info"><span class="comment-age">(18 Feb '17, 06:41)</span> Amato_C</div></div><span id="59533"></span><div id="comment-59533" class="comment"><div id="post-59533-score" class="comment-score"></div><div class="comment-text"><p>@Bob Jones - I think your explanation about the different VHT datarate.x variables makes better sense than my assumption.</p><p>Having diffetent datarates for different MU-MIMO users would make better sense.</p><p>Thanks</p></div><div id="comment-59533-info" class="comment-info"><span class="comment-age">(18 Feb '17, 07:32)</span> Amato_C</div></div></div><div id="comment-tools-59527" class="comment-tools"></div><div class="clear"></div><div id="comment-59527-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="59530"></span>

<div id="answer-container-59530" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-59530-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>You need to enter values for the 3 fields: Display Filter, Y-Axis, and Y-Field.</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Capture_Ze83ACz.JPG" alt="alt text" /></p><p>In the display filter, you enter the filter expression you would like to use. For example, I entered the IP address of the WiFi Client (ip.addr==192.168.0.101). The graph will only display information pertaining to the Client with IP address 192.168.0.101</p><p>The Y-axis must be selected as Max, Min or Average. Then the Y-field would be wlan_radio.data_rate</p><p>Your graph would look like something like this:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Capture2.JPG" alt="alt text" /></p><p>Again, this is not the optimal solution since Wireshark only graphs based on time (sec) as opposed to frame numbers.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>18 Feb '17, 06:23</strong></p><img src="https://secure.gravatar.com/avatar/d9cf592a79eafbc3b2a8b3f38cf38362?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Amato_C&#39;s gravatar image" /><p>Amato_C<br />
<span class="score" title="1098 reputation points"><span>1.1k</span></span><span title="14 badges"><span class="badge1">●</span><span class="badgecount">14</span></span><span title="20 badges"><span class="silver">●</span><span class="badgecount">20</span></span><span title="32 badges"><span class="bronze">●</span><span class="badgecount">32</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Amato_C has 15 accepted answers">14%</span> </br></p></img></div></div><div id="comments-container-59530" class="comments-container"><span id="59545"></span><div id="comment-59545" class="comment"><div id="post-59545-score" class="comment-score"></div><div class="comment-text"><p>Ok, now I understand how to filter min, max, avg, sorry.</p><p>@Amato but can you explain me why in my case, screenshot above, the red line (ac-device) 200 Mbit/s is lesser as the green and violet line (n-device) with maximum 150 Mbit/s? The most of the time the QoS/data packets of the ac-device are at 180-200 Mbit/s. Or is my filtering completely wrong, but I think if it's filtered so, I can see faster the collapse of the datarate.</p></div><div id="comment-59545-info" class="comment-info"><span class="comment-age">(19 Feb '17, 23:52)</span> Hyrrican</div></div><span id="59554"></span><div id="comment-59554" class="comment"><div id="post-59554-score" class="comment-score"></div><div class="comment-text"><p>@Hyrrican = try using the following Display filters in the I/O graph:</p><p>(wlan.ta == d8:c4:6a:53:bd:b9)&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>Explanation:</p><ol><li><p>wlan.ta = this is the transmit address, it should be the MAC address of your client</p></li><li><p>The remaining part of the filters ensures that only Data and QoS-Data frames are displayed while removing Null Data frames and QoS-Null-Data frames also.</p></li></ol><p>The filter should be used for each WiFi client that requires analysis. For example:</p><p>Filter 1 = (wlan.ta == aa:aa:aa:aa:aa:aa)&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>Filter 2 = Filter 1 = (wlan.ta == bb:bb:bb:bb:bb:bb)&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>Filter 3 = Filter 1 = (wlan.ta == cc:cc:cc:cc:cc:cc)&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>Unfortunately, the WiFi capture you posted is encrypted and the passphrase was not provided. So I was unable to use the IP address within the filter.</p><p>If you are using a wireless mesh solution, then the filter would have to be amended to include the Source and Transmit address:</p><p>Filter 1 = ((wlan.ta == aa:aa:aa:aa:aa:aa)||(wlan.sa == aa:aa:aa:aa:aa:aa))&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>After applying the following filter:</p><p>(wlan.ta == d8:c4:6a:53:bd:b9)&amp;&amp;(wlan.fc.type eq 2 and !(wlan.fc.subtype eq 4 or wlan.fc.subtype eq 12))</p><p>I observe a majority of the traffic is around 200Mbps with a spike of 360Mbps. There are some dips in throughput to 6Mbps which could be explained with EAPOL re-keying. However, there is a major dip in traffic at 136 seconds in which the client is only sending data at 6Mbps because only multicast traffic is being transmitted. Without decrypting the traffic, it is hard to say what upper-layer protocol is being used. Regardless, there is about 10-13 seconds where 6Mbps data rate is being used due to multicast traffic.</p></div><div id="comment-59554-info" class="comment-info"><span class="comment-age">(20 Feb '17, 05:56)</span> Amato_C</div></div><span id="59560"></span><div id="comment-59560" class="comment"><div id="post-59560-score" class="comment-score"></div><div class="comment-text"><p>Hi Amato, thanks for explanation, I will test it. Is it also possible to filter to wlan.bssid instead of wlan.ta and wlan.sa?</p></div><div id="comment-59560-info" class="comment-info"><span class="comment-age">(20 Feb '17, 08:20)</span> Hyrrican</div></div><span id="59568"></span><div id="comment-59568" class="comment"><div id="post-59568-score" class="comment-score">1</div><div class="comment-text"><p>What are you trying to analyze?</p><p>Are you trying to analyze the transmit data rates of your AP or client? Then it is not recommended to use wlan.bssid since both WiFi Access Points and WiFi clients populate that field with the same value when the client is connected to that BSSID.<br />
</p><p>If you are interested in viewing data rates only from your client, then the wlan.ta = &lt;client-mac-address&gt;</p><p>If you are interested in viewing data rates only from your AP, then the wlan.ta = &lt;ap-mac-address-for-ssid&gt;</p><p>Are you trying to analyze bi-directional traffic? Then use wlan.bssid to view all traffic to/from that BSSID. But you have to consider that some traffic will be from the client and some from the AP. This could not be used to determine the data rate of a particular device (either AP or client).</p><p>My recommendation: DO NOT use wlan.bssid = it will lead to confusion. Use the wlan.ta and the correct MAC address.</p></div><div id="comment-59568-info" class="comment-info"><span class="comment-age">(20 Feb '17, 13:40)</span> Amato_C</div></div></div><div id="comment-tools-59530" class="comment-tools"></div><div class="clear"></div><div id="comment-59530-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

