+++
type = "question"
title = "Duplicate ACK Causing Client Slowdown?"
description = '''I&#x27;m working on troubleshooting a slow application. I took a few packet captures from the client workstation and I&#x27;m seeing some odd behavior with duplicate ACKs that I can&#x27;t seem to explain. You can see in the screenshot below that the server (172.) is occasionally sending a duplicate ack to the cli...'''
date = "2014-07-08T13:58:00Z"
lastmod = "2014-07-09T13:08:00Z"
weight = 34478
keywords = [ "ack", "duplicate", "slow", "tcp" ]
aliases = [ "/questions/34478" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [Duplicate ACK Causing Client Slowdown?](/questions/34478/duplicate-ack-causing-client-slowdown)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34478-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34478-score" class="post-score" title="current number of votes">0</div><span id="post-34478-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I'm working on troubleshooting a slow application. I took a few packet captures from the client workstation and I'm seeing some odd behavior with duplicate ACKs that I can't seem to explain. You can see in the screenshot below that the server (172.) is occasionally sending a duplicate ack to the client (10.). After the duplicate ack the client seems to hang for a random amount of time before moving on to the next HTTP request. Usually always more then a second but I have seen some as high as 20 seconds.</p><p>I'm a bit new to analyzing sequence and acknowledgement numbers so feel free to correct me here. But I think the reason for the duplicate ack being sent is because the server is not receiving the ack from the client in frame 90. I'm just not sure why this would cause the client to grind to a halt.</p><p><a href="https://www.dropbox.com/s/8r3ljgks44hkia9/tcp.dup.ack_anon.pcapng">Packet Capture Download</a> - Truncated to 79 bytes.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-ack" rel="tag" title="see questions tagged &#39;ack&#39;">ack</span> <span class="post-tag tag-link-duplicate" rel="tag" title="see questions tagged &#39;duplicate&#39;">duplicate</span> <span class="post-tag tag-link-slow" rel="tag" title="see questions tagged &#39;slow&#39;">slow</span> <span class="post-tag tag-link-tcp" rel="tag" title="see questions tagged &#39;tcp&#39;">tcp</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>08 Jul '14, 13:58</strong></p><img src="https://secure.gravatar.com/avatar/aad57de6572d4f83d1bf870ef9f31e3d?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Strebzilla&#39;s gravatar image" /><p><span>Strebzilla</span><br />
<span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Strebzilla has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>09 Jul '14, 09:01</strong> </span></p></div></div><div id="comments-container-34478" class="comments-container"><span id="34486"></span><div id="comment-34486" class="comment"><div id="post-34486-score" class="comment-score">2</div><div class="comment-text"><p>Hi,</p><p>it's a bit hard to do <strong>packet</strong> analysis based on screenshots, so can you please post a capture file somewhere (google drive, dropbox, cloudshark.org) and post the link here? If you have privacy concerns, you can anonymize the capture file with <a href="http://tracewrangler.com/">Tracewrangler</a>, which is developed by our member <span>@Jasper</span>.</p><p>BTW: Why are you hiding <strong>private</strong> addresses in your screenshot (10.x.x.x and 172.x.x.x)?? O.K. the 172.x.x.x <strong>could</strong> be public addresses....</p><p>Regards<br />
Kurt</p></div><div id="comment-34486-info" class="comment-info"><span class="comment-age">(08 Jul '14, 18:05)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34487"></span><div id="comment-34487" class="comment"><div id="post-34487-score" class="comment-score"></div><div class="comment-text"><p>Thanks for the tip. I see your point about the private addresses. It's nothing super secret but people get a bit freaked about privacy here. I'll update this post asap.</p></div><div id="comment-34487-info" class="comment-info"><span class="comment-age">(08 Jul '14, 18:10)</span> <span class="comment-user userinfo">Strebzilla</span></div></div><span id="34508"></span><div id="comment-34508" class="comment"><div id="post-34508-score" class="comment-score"></div><div class="comment-text"><p>I'm sorry to tell you, but you removed too data much from the payload. I can't even identify any HTTP requests. With that capture file it's even harder to do analysis than with the screenshot your removed ;-))</p></div><div id="comment-34508-info" class="comment-info"><span class="comment-age">(09 Jul '14, 08:05)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34513"></span><div id="comment-34513" class="comment"><div id="post-34513-score" class="comment-score"></div><div class="comment-text"><p>Sorry. This is clearly my first crack at soliciting help from the community so bear with me while I get it right. I cleaned out everything after layer 4 because I didn't think it was necessary since the duplicate ack seemed to be causing the slowdown and not http. I really can't make too much of the payload public so is there a reasonable place I can truncate the capture and still make it useful?</p></div><div id="comment-34513-info" class="comment-info"><span class="comment-age">(09 Jul '14, 08:20)</span> <span class="comment-user userinfo">Strebzilla</span></div></div><span id="34514"></span><div id="comment-34514" class="comment"><div id="post-34514-score" class="comment-score"></div><div class="comment-text"><blockquote><p>so bear with me while I get it right.</p></blockquote><p>Don't be afraid, this is a friendly site with patient members ;-)</p><blockquote><p>I really can't make too much of the payload public</p></blockquote><p>I understand that.</p><blockquote><p>so is there a reasonable place I can truncate the capture and still make it useful?</p></blockquote><p>That's the tricky part. We would need more information than you want to disclose, to get an idea where the problem might be. Can you try to keep at least 15-20 bytes of the TCP payload, which would contain the HTTP method and some bytes of the URL. I'm not sure if that is sufficient to do any analysis, but we can start with that.</p></div><div id="comment-34514-info" class="comment-info"><span class="comment-age">(09 Jul '14, 08:24)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34515"></span><div id="comment-34515" class="comment not_top_scorer"><div id="post-34515-score" class="comment-score"></div><div class="comment-text"><p>Your patience is much appreciated :-)</p><p>79 Bytes seems to be a good sweet spot to get a unique URI.</p></div><div id="comment-34515-info" class="comment-info"><span class="comment-age">(09 Jul '14, 09:02)</span> <span class="comment-user userinfo">Strebzilla</span></div></div><span id="34516"></span><div id="comment-34516" class="comment not_top_scorer"><div id="post-34516-score" class="comment-score"></div><div class="comment-text"><p>O.K. I think we can work with the latest capture file. Where do you think there could be a problem? Please post the frame number and your assumption.</p><p>BTW: What kind of application is this? Is it an interactive application that needs to wait for input from the user, or something that should do things automatically as fast as possible?</p></div><div id="comment-34516-info" class="comment-info"><span class="comment-age">(09 Jul '14, 09:25)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="34518"></span><div id="comment-34518" class="comment not_top_scorer"><div id="post-34518-score" class="comment-score"></div><div class="comment-text"><p>The suspected problem occurs multiple times in the capture but tcp stream index 2 has the most extreme example. Packet 96 is a duplicate to the ack in frame 89. The next packet, number 97, doesn't get sent for 20.895 seconds. I suspect this is what's causing trouble for users. You can see more examples at packets 191, 253, 564, etc.</p><p>This seems to be occurring in all of the tcp streams with delays ranging from 1-20 seconds. I realize that you could see this kind of delay while waiting for user input but the fact this always happens after the duplicate ack strikes me as odd.</p><p>It's an interactive web application. Users pull up records, make updates, create new records, etc.</p></div><div id="comment-34518-info" class="comment-info"><span class="comment-age">(09 Jul '14, 10:28)</span> <span class="comment-user userinfo">Strebzilla</span></div></div></div><div id="comment-tools-34478" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-34478-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="34520"></span>

<div id="answer-container-34520" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-34520-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-34520-score" class="post-score" title="current number of votes">1</div><span id="post-34520-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="Strebzilla has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I don't think the DUP-ACK is the problem, because there are other delays in stream #2 that are not accompanied by a DUP-ACK.</p><p>Frame #1455: There is a 37 second delay for the next GET.<br />
Frame #2305: There is a 34 second delay for the next POST.<br />
Frame #2672: There is a 11 second delay for the next GET.<br />
</p><p>There is no explanation in the capture file for that delay, maybe waiting for the next user action.</p><p>That's the reason why I was asking for the type of the application (interactive versus 'automatic'), as it does <strong>not</strong> only happen after a DUP-ACK.</p><blockquote><p>It's an interactive web application. Users pull up records, make updates, create new records, etc.</p></blockquote><p>O.K. then we would need a much more detailed problem description.</p><ul><li>What exactly is slow?</li><li>When (timestamp in the capture file) did the user report the problem?</li><li>etc.</li></ul><p>If you don't have that information, you should repeat the tests and collect (at least) the following information:</p><ul><li>when does the problem occur - time on the capturing device - to the second!</li><li>which action was initiated in the web app (click on which link)</li><li>what was the expected result</li><li>what was the observed result</li><li>how much data should have been transmitted (estimation)</li><li>what exactly is the 'problem'</li><li>whatever else helps to nail down the problem</li></ul><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Jul '14, 10:48</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>09 Jul '14, 10:55</strong> </span></p></div></div><div id="comments-container-34520" class="comments-container"><span id="34523"></span><div id="comment-34523" class="comment"><div id="post-34523-score" class="comment-score"></div><div class="comment-text"><p>A lot of that information I don't have. I've been working with our application team on this issue so I'd need to get that from them. My suspicion is that this has something to do with the application itself or the back end database. I just wanted to make sure those duplicate acks weren't something noteworthy which you have just confirmed.</p><p>Thanks so much for looking into this to me and for helping me get a usable packet capture to you.</p></div><div id="comment-34523-info" class="comment-info"><span class="comment-age">(09 Jul '14, 12:34)</span> <span class="comment-user userinfo">Strebzilla</span></div></div><span id="34525"></span><div id="comment-34525" class="comment"><div id="post-34525-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I just wanted to make sure those duplicate acks weren't something noteworthy which you have just confirmed.</p></blockquote><p>actually I did not want to 'confirm' that. What I wanted to say: There is not enough information about the problem to figure out what's going wrong. It could be related to the DUP-ACK (although I don't believe that), it could the something totally different. So, the best thing you can do, is to collect the information I listed above and then come back for further analysis.</p><blockquote><p>Thanks so much for looking into this to me</p></blockquote><p>You're welcome!</p></div><div id="comment-34525-info" class="comment-info"><span class="comment-age">(09 Jul '14, 13:08)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-34520" class="comment-tools"></div><div class="clear"></div><div id="comment-34520-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

