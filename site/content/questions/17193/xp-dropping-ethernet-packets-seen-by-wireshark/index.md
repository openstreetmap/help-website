+++
type = "question"
title = "XP dropping Ethernet packets seen by Wireshark"
description = '''I have some hardware connected by Ethernet to an XP system via a USB adaptor. The hardware is sending a UDP broadcast packet to the XP every 3 seconds. Wireshark running on the XP system sees these packets: Frame 1 (342 bytes on wire, 342 bytes captured) Ethernet II, Src: 40:5f:c2:b9:21:d1 (40:5f:c2...'''
date = "2012-12-23T06:22:00Z"
lastmod = "2012-12-25T14:52:00Z"
weight = 17193
keywords = [ "ethernet", "xp", "udp", "dropped" ]
aliases = [ "/questions/17193" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [XP dropping Ethernet packets seen by Wireshark](/questions/17193/xp-dropping-ethernet-packets-seen-by-wireshark)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-17193-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I have some hardware connected by Ethernet to an XP system via a USB adaptor. The hardware is sending a UDP broadcast packet to the XP every 3 seconds. Wireshark running on the XP system sees these packets:</p><p>Frame 1 (342 bytes on wire, 342 bytes captured)</p><p>Ethernet II, Src: 40:5f:c2:b9:21:d1 (40:5f:c2:b9:21:d1), Dst: Broadcast (ff:ff:ff:ff:ff:ff)</p><p>Internet Protocol, Src: 0.0.0.0 (0.0.0.0), Dst: 0.0.0.0 (0.0.0.0)</p><p>User Datagram Protocol, Src Port: bootpc (68), Dst Port: bootps (67)</p><p>No activity at all is seen in the Ethernet connection status: no packets are received.</p><p>The Windows firewall is disabled.</p><p>An AVG firewall is set to pass these packets and is not showing any being blocked (if I disable the permission to pass the packets, I then see them being blocked).</p><p>Any suggestions as to what is dropping these packets and how to let them through to my program?</p></div><div id="question-tags" class="tags-container tags">ethernet xp udp dropped</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>23 Dec '12, 06:22</strong></p><img src="https://secure.gravatar.com/avatar/ef7626f540002d6403180aa20be73c9f?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Peter%20Robertson&#39;s gravatar image" /><p>Peter Robertson<br />
<span class="score" title="15 reputation points">15</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Peter Robertson has no accepted answers">0%</span></p></div></div><div id="comments-container-17193" class="comments-container"></div><div id="comment-tools-17193" class="comment-tools"></div><div class="clear"></div><div id="comment-17193-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="17240"></span>

<div id="answer-container-17240" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-17240-score" class="post-score" title="current number of votes">2</div></div></td><td><div class="item-right"><div class="answer-body"><p>Other people seem to have the same problem and it looks like <strong>TI did it intentionally</strong>.</p><blockquote><p><code>http://e2e.ti.com/support/dsp/davinci_digital_media_processors/f/99/t/57903.aspx</code><br />
</p></blockquote><p><strong>Cite TI Employee:</strong> "Regarding the BOOTP packet. The DM648 BOOTP format is TI specific and will not work with standard BOOTP server. You will have to use a custom server which accepts all 0 as IP address."</p><p><strong>Cite TI Employee:</strong> "There is no detailed documentation on how to write the server. You can use PCAP library (<a href="http://en.wikipedia.org/wiki/Pcap)">http://en.wikipedia.org/wiki/Pcap)</a> to achieve these functionalities (capture and send the packet). I have used RAW sockets to send/receive the packets."</p><p>So, they also recommend (win)pcap :-)</p><blockquote><p><code>http://www.ti.com/lit/ug/spruec6g/spruec6g.pdf</code><br />
</p></blockquote><p><strong>Cite:</strong> The Ethernet-ready announcement frame is made in the form of a BOOTP request so it can use a standard format. No response is processed for this message <strong>and it is constructed in such a way that most if not all BOOTP and DHCP servers discard it.</strong></p><p>Aha !</p><blockquote><p><code>http://e2e.ti.com/support/dsp/c6000_multi-core_dsps/f/439/t/67820.aspx</code><br />
</p></blockquote><p>So, WinPcap sounds like a possible solution. However, I'm not sure if you will be able to establish a complete communication that way (delivering a firmware image to the DSP). I'm sure you will figure out.</p><p>The other option would be to use Windows 7 as BOOTP server, as you said raw sockets do work there, even with the destination ip address of 0.0.0.0. <strong>HOWEVER</strong> I would not rely too much on that 'feature' as that is probably not intentional and Microsoft may change that behavior without notification.</p><p><strong>One last idea:</strong> You could try to enable <a href="http://support.microsoft.com/kb/315236">IP Forwarding on Windows XP</a>. Maybe the packet then gets far enough into the IP stack to intercept it with raw sockets.</p><p>Good luck!</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>25 Dec '12, 14:52</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p>edited 26 Dec '12, 06:46</p></div></div><div id="comments-container-17240" class="comments-container"><span id="17242"></span><div id="comment-17242" class="comment"><div id="post-17242-score" class="comment-score"></div><div class="comment-text"><p>Following your suggestion, I have managed to get this working using WinPcap to detect the BOOTP packets and then switching to sockets for the actual two-way communication once the MAC address of the DSP has been determined.</p><p>It looks like another 'feature' that TI hasn't bothered to think through properly.</p><p>Thanks for your work on this.</p></div><div id="comment-17242-info" class="comment-info"><span class="comment-age">(25 Dec '12, 23:19)</span> Peter Robertson</div></div><span id="17243"></span><div id="comment-17243" class="comment"><div id="post-17243-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Following your suggestion, I have managed to get this working using WinPcap</p></blockquote><p>Good to hear !</p><blockquote><p>It looks like another 'feature' that TI hasn't bothered to think through properly.</p></blockquote><p>:-)</p><p><strong>Hint:</strong> If a supplied answer resolves your question can you please "accept" it by clicking the checkmark icon next to it. This highlights good answers for the benefit of subsequent users with the same or similar questions.</p></div><div id="comment-17243-info" class="comment-info"><span class="comment-age">(26 Dec '12, 00:04)</span> Kurt Knochner ♦</div></div></div><div id="comment-tools-17240" class="comment-tools"></div><div class="clear"></div><div id="comment-17240-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="17196"></span>

<div id="answer-container-17196" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-17196-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>I recommend to uninstall AVG. Not having any message in the log, does not mean that AVG works flawlessly ;-)</p><p>BTW: What you do see, if you connect your 'hardware' to the on board ethernet port of your WinXP instead of using a USB adapter?</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>23 Dec '12, 07:22</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p>edited 23 Dec '12, 07:22</p></div></div><div id="comments-container-17196" class="comments-container"><span id="17197"></span><div id="comment-17197" class="comment"><div id="post-17197-score" class="comment-score"></div><div class="comment-text"><p>AVG is not the problem; I get identical behaviour on another system without AVG installed. Connecting the hardware direcly to XP also changes nothing. In both cases, Wireshark continues to see the packets but the status shows nothing received.</p><p>It is fairly clear that something in XP itself is discarding the packets.</p><p>The program I need to run manages to connect to port 67, so it's not as if something else is listening there.</p></div><div id="comment-17197-info" class="comment-info"><span class="comment-age">(23 Dec '12, 07:39)</span> Peter Robertson</div></div><span id="17201"></span><div id="comment-17201" class="comment"><div id="post-17201-score" class="comment-score"></div><div class="comment-text"><p>O.K. the packet you have shown, looks <strong>almost</strong> like DHCP, <strong>however</strong> the destination IP is not 255.255.255.255 (broadcast address).</p><p>Do you have any software on WinXP that can handle that special packet?</p><p>As the packet is sent to 0.0.0.0 and not 255.255.255.255, your WinXP IP stack may simply ignore (drop/discard) it, as it's neither a packet sent to the broadcast address nor to one of it's configured IP addresses.</p><p>What is the output of the following command, after you have seen some packets in Wireshark? Run the command before and after.</p><blockquote><p><code>netstat -s -p ip</code><br />
</p></blockquote><p>Do you see any changes for these parameters.</p><pre><code>  Packets Received                   
  Received Address Errors
  Datagrams Forwarded                
  Unknown Protocols Received         
  Received Packets Discarded         
  Received Packets Delivered         </code></pre></div><div id="comment-17201-info" class="comment-info"><span class="comment-age">(23 Dec '12, 13:04)</span> Kurt Knochner ♦</div></div><span id="17209"></span><div id="comment-17209" class="comment"><div id="post-17209-score" class="comment-score"></div><div class="comment-text"><p>My understanding is that the MAC addr FF:FF:FF:FF:FF:FF indicates a broadcast. The packet is actually a BOOTP packet.</p><p>Received address errors appears to be counting the BOOTP packets that are being dropped.</p></div><div id="comment-17209-info" class="comment-info"><span class="comment-age">(23 Dec '12, 15:08)</span> Peter Robertson</div></div><span id="17210"></span><div id="comment-17210" class="comment"><div id="post-17210-score" class="comment-score"></div><div class="comment-text"><p>one other thing - I can read these packets without difficulty under W7.</p></div><div id="comment-17210-info" class="comment-info"><span class="comment-age">(23 Dec '12, 15:15)</span> Peter Robertson</div></div><span id="17223"></span><div id="comment-17223" class="comment"><div id="post-17223-score" class="comment-score"></div><div class="comment-text"><blockquote><p>My understanding is that the MAC addr FF:FF:FF:FF:FF:FF indicates a broadcast.</p></blockquote><p>That's just the ethernet broadcast and that's the reason why you see the packet in Wireshark. If you want the IP stack to handle the packet, you need to use either an IP broadcast address or one of the configured IP addresses of the Win XP machine.</p><blockquote><p>The packet is actually a BOOTP packet.</p></blockquote><p>well, it <strong>looks</strong> like BOOTP. However, RFC 951 defines how the packet should look like.</p><pre><code>3. Packet Format

   In the IP header of a bootrequest, the client fills in its own IP
   source address if known, otherwise zero.  When the server address is
   unknown, the IP destination address will be the &#39;broadcast address&#39;
   255.255.255.255.  This address means &#39;broadcast on the local cable,
   (I don&#39;t know my net number)&#39; [4].</code></pre><p>So, the packet you have shown is not a real BOOTP packet.</p><blockquote><p>Received address errors appears to be counting the BOOTP packets that are being dropped.</p></blockquote><p>well, there you have it. As I suspected, the IP stack of Win XP just drops those packets.</p><blockquote><p>one other thing - I can read these packets without difficulty under W7.</p></blockquote><p>another IP stack might handle those packets differently.</p><p>Conclusion: I don't think there is anything you can do, unless you have the option to change the behavior of Win XP (unlikely) or your 'hardware device'.</p></div><div id="comment-17223-info" class="comment-info"><span class="comment-age">(24 Dec '12, 01:24)</span> Kurt Knochner ♦</div></div><span id="17224"></span><div id="comment-17224" class="comment not_top_scorer"><div id="post-17224-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your comments. The device is a DSP from Texas Instruments and they have explicitly chosen those values and have been steadfastly silent about how they expect anyone to read them. AFAIK it's not possible to change what is sent.</p></div><div id="comment-17224-info" class="comment-info"><span class="comment-age">(24 Dec '12, 01:24)</span> Peter Robertson</div></div><span id="17225"></span><div id="comment-17225" class="comment not_top_scorer"><div id="post-17225-score" class="comment-score"></div><div class="comment-text"><p>well, then you are out of luck on Win XP.</p><p>One possible solution could be the use raw sockets in your application.</p><blockquote><p><code>http://msdn.microsoft.com/en-us/library/windows/desktop/ms740548%28v=vs.85%29.aspx</code><br />
</p></blockquote><p><strong>However</strong> there are some limitations with raw sockets, and I leave it to you to check if it's possible to receive those kind of packets with a raw socket.</p><p>An alternative would be the use WinPcap within your application to intercept those packets (just like Wireshark does). See the programming guide of WinPcap</p><blockquote><p><code>http://www.winpcap.org</code></p></blockquote></div><div id="comment-17225-info" class="comment-info"><span class="comment-age">(24 Dec '12, 01:31)</span> Kurt Knochner ♦</div></div><span id="17226"></span><div id="comment-17226" class="comment not_top_scorer"><div id="post-17226-score" class="comment-score"></div><div class="comment-text"><p>Once again screwed by TI! My application DOES use raw sockets. That's how I know it works under W7.</p><p>I'll look at WinPcap.</p></div><div id="comment-17226-info" class="comment-info"><span class="comment-age">(24 Dec '12, 01:43)</span> Peter Robertson</div></div><span id="17228"></span><div id="comment-17228" class="comment not_top_scorer"><div id="post-17228-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Once again screwed by TI!</p></blockquote><p>:-(. The packet is for sure not RFC compliant. You could ask TI for sample code to handle <strong>those</strong> packets on Win XP.</p><blockquote><p>My application DOES use raw sockets. That's how I know it works under W7.</p></blockquote><p>Then you're out of luck on Win XP. I suggest to ask the same question on <a href="http://stackoverflow.com">stackoverflow.com</a>. Maybe there is a way to make it work on XP.</p><p><strong>Hint:</strong> If a supplied answer resolves your question can you please "accept" it by clicking the checkmark icon next to it. This highlights good answers for the benefit of subsequent users with the same or similar questions.</p></div><div id="comment-17228-info" class="comment-info"><span class="comment-age">(24 Dec '12, 02:34)</span> Kurt Knochner ♦</div></div><span id="17230"></span><div id="comment-17230" class="comment not_top_scorer"><div id="post-17230-score" class="comment-score"></div><div class="comment-text"><p>"You could ask TI for sample code to handle those packets on Win XP." Why do you think I said they have been steadfastly silent?</p></div><div id="comment-17230-info" class="comment-info"><span class="comment-age">(24 Dec '12, 03:00)</span> Peter Robertson</div></div><span id="17231"></span><div id="comment-17231" class="comment not_top_scorer"><div id="post-17231-score" class="comment-score"></div><div class="comment-text"><p>Please don't blame those who want to help you ;-)</p></div><div id="comment-17231-info" class="comment-info"><span class="comment-age">(24 Dec '12, 03:02)</span> Kurt Knochner ♦</div></div></div><div id="comment-tools-17196" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-17196-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

