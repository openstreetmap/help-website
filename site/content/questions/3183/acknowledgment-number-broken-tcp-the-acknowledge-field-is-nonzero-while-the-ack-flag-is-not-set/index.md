+++
type = "question"
title = "Acknowledgment number: Broken TCP. The acknowledge field is nonzero while the ACK flag is not set"
description = '''What does this message mean? Acknowledgment number: Broken TCP. The acknowledge field is nonzero while the ACK flag is not set I see the client attempt to send this after the TCP connection has been torn down by FIN/ACK, ACK+FIN/ACK, ACK. Our firewall blocks the RST packet sent (with the above &quot;brok...'''
date = "2011-03-28T13:55:00Z"
lastmod = "2011-05-19T05:25:00Z"
weight = 3183
keywords = [ "reset", "tcp" ]
aliases = [ "/questions/3183" ]
osqa_answers = 3
osqa_accepted = true
+++

<div class="headNormal">

# [Acknowledgment number: Broken TCP. The acknowledge field is nonzero while the ACK flag is not set](/questions/3183/acknowledgment-number-broken-tcp-the-acknowledge-field-is-nonzero-while-the-ack-flag-is-not-set)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-3183-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>What does this message mean?</p><p>Acknowledgment number: Broken TCP. The acknowledge field is nonzero while the ACK flag is not set</p><p>I see the client attempt to send this after the TCP connection has been torn down by FIN/ACK, ACK+FIN/ACK, ACK. Our firewall blocks the RST packet sent (with the above "broken tcp" message) because at that point the session has already been removed from the firewall because of the four-way FIN teardown.</p></div><div id="question-tags" class="tags-container tags">reset tcp</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>28 Mar '11, 13:55</strong></p><img src="https://secure.gravatar.com/avatar/39cd80ed85e55962a47b03253968662c?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="networkguy09&#39;s gravatar image" /><p>networkguy09<br />
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="networkguy09 has no accepted answers">0%</span></p></div></div><div id="comments-container-3183" class="comments-container"></div><div id="comment-tools-3183" class="comment-tools"></div><div class="clear"></div><div id="comment-3183-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="3185"></span>

<div id="answer-container-3185" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-3185-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Basically the message says that whenever a TCP packet does not have the ACK flag set, the acknowledge field must be zero and this packet does not comply to that rule.</p><p>The reason that you see this message is that the other side has closed it's session (on the Firewall, Loadbalancer or end system) before the last packet comes in, resulting in the RST packet. However, the generation of the RST packet is not valid as the ACK flag is not set and the acknowledge field is non-zero.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>28 Mar '11, 15:55</strong></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p>SYN-bit ♦♦<br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SYN-bit has 174 accepted answers">20%</span></p></div></div><div id="comments-container-3185" class="comments-container"><span id="3203"></span><div id="comment-3203" class="comment"><div id="post-3203-score" class="comment-score"></div><div class="comment-text"><p>What do you mean by "resulting in the RST packet?" I don't understand why the client would send a RST packet after it just finished the session by FIN/ACK, ACK+FIN/ACK, ACK (first FIN/ACK being sent by the server in every case). I expect to not see the RST packet at all and if I understand correctly, the RST packet is a non factor as the session is already terminated.</p><p>My problem is the clients report getting "kicked out" of a particular application (which runs over telnet). In every case of the kick out, I see the FIN/ACK, ACK+FIN/ACK, ACK, then the client sends a RST. In troubleshooting we bypassed our ASA firewall for the network in question and found the clients no longer have the issue. I don't understand how the firewall could be causing the issue when we see in the captures the server sends a FIN/ACK to teardown the session. Any suggestions of what to look for in the capture/firewall? Thanks!</p></div><div id="comment-3203-info" class="comment-info"><span class="comment-age">(29 Mar '11, 11:54)</span> networkguy09</div></div><span id="3204"></span><div id="comment-3204" class="comment"><div id="post-3204-score" class="comment-score"></div><div class="comment-text"><p>(converted your 'answer' to a 'comment' as that's the way this Q&amp;A site works best, see the FAQ for details)</p><p>My answer was geared to the original question of what the "Acknowledgment number: Broken TCP. The acknowledge field is nonzero while the ACK flag is not set" message meant.</p></div><div id="comment-3204-info" class="comment-info"><span class="comment-age">(29 Mar '11, 12:05)</span> SYN-bit ♦♦</div></div><span id="3205"></span><div id="comment-3205" class="comment"><div id="post-3205-score" class="comment-score">1</div><div class="comment-text"><p>As far as your "users being kicked off" problem, firewalls have session timeouts so that their session tables don't fill up on sessions that somehow did not terminate. The side effect is that long lived sessions like "Telnet", "SSH", "RDP" and the like will be terminated by the firewall if they are idle for a longer time than the configured timeout on the firewall for that particular service/port/application. This is especially a problem if a custom port is being used.</p><p>Check your traces for idle time before the session termination, also check the idle time for your protocol on the firewall.</p></div><div id="comment-3205-info" class="comment-info"><span class="comment-age">(29 Mar '11, 12:06)</span> SYN-bit ♦♦</div></div><span id="3211"></span><div id="comment-3211" class="comment"><div id="post-3211-score" class="comment-score"></div><div class="comment-text"><p>There is virtually no idle time in the captures for this. They both are sending telnet data and ACK each, then the server sends data along with FIN/PSH/ACK and the session is torn down as mentioned. As for the timeout on the firewall, it is set to 1 hour for established connections. The user reports getting kicked out at random times (could be 2 minutes, 5 minutes, 10 minutes, 2 hours, 4 hours, etc.) The server admin has configured tcp keepalives to send to the clients every 5 minutes and I always see the keepalives sent and ACK'd from captures taken on the server NIC.</p></div><div id="comment-3211-info" class="comment-info"><span class="comment-age">(29 Mar '11, 13:23)</span> networkguy09</div></div><span id="3212"></span><div id="comment-3212" class="comment"><div id="post-3212-score" class="comment-score"></div><div class="comment-text"><p>Sorry for messing up the earlier post and for asking more than one question in the thread. I suppose I could have mentioned the underlying issue originally. Thanks for all the help because I am stumped!</p></div><div id="comment-3212-info" class="comment-info"><span class="comment-age">(29 Mar '11, 13:25)</span> networkguy09</div></div><span id="3213"></span><div id="comment-3213" class="comment not_top_scorer"><div id="post-3213-score" class="comment-score"></div><div class="comment-text"><p>Hmmm... if the server behaves badly when traffic goes through the firewall, but it behaves properly when the firewall is not in the path, I would make traces on both the client and server in both situations. You then need to compare them meticulously...</p><p>If you'd need help with that, feel free to contact me (see my profle for contact details)</p></div><div id="comment-3213-info" class="comment-info"><span class="comment-age">(29 Mar '11, 14:29)</span> SYN-bit ♦♦</div></div><span id="3227"></span><div id="comment-3227" class="comment not_top_scorer"><div id="post-3227-score" class="comment-score"></div><div class="comment-text"><p>Idle timeout is different from the absolute connection timeout...but it doesn't sound like you're hitting either timeout. The ASA has a pretty good builtin debugging system and I'm 99% sure that the log can reveal the firewall's reasoning for terminating the connection. If you have a specific rule/conduit/ACL/etc for allowing the telnet traffic you can enable the log feature for that rule also. Also, don't forget about good ol' Cisco bugs - those can be VERY difficult to troubleshoot.</p></div><div id="comment-3227-info" class="comment-info"><span class="comment-age">(30 Mar '11, 05:14)</span> GeonJay</div></div></div><div id="comment-tools-3185" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-3185-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="3229"></span>

<div id="answer-container-3229" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-3229-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Which side of the firewall did you trace at? Between the client and the firewall or between the firewall and the server? If the server is sending the FIN and you traced between the server and the firewall then it is the server that is causing the client to be kicked out. Everything after the FIN is almost moot, right?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>30 Mar '11, 07:56</strong></p><img src="https://secure.gravatar.com/avatar/96f54c80d7829218b63d145864a91eab?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="motdc&#39;s gravatar image" /><p>motdc<br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="motdc has no accepted answers">0%</span></p></div></div><div id="comments-container-3229" class="comments-container"><span id="3230"></span><div id="comment-3230" class="comment"><div id="post-3230-score" class="comment-score"></div><div class="comment-text"><p>We did two traces one directly on the server, the other on the firewall looking before it passes through (so between the client and firewall). The firewall capture you see the RST, but on the server side you do not because after the FIN four way teardown the firewall has removed that session from its table and the RST is dropped at the firewall. The server always sends the first FIN and this is when the users report getting "kicked out" We still don't understand how taking the firewall out of the mix seems to resolve the issue.</p></div><div id="comment-3230-info" class="comment-info"><span class="comment-age">(30 Mar '11, 09:42)</span> networkguy09</div></div><span id="3231"></span><div id="comment-3231" class="comment"><div id="post-3231-score" class="comment-score"></div><div class="comment-text"><p>Got it. Is there any other traffic or other connctions that are out of band so to speeak? So say you are tracing just one port only and something on a seperate connection is causing the problem?</p></div><div id="comment-3231-info" class="comment-info"><span class="comment-age">(30 Mar '11, 10:05)</span> motdc</div></div><span id="3234"></span><div id="comment-3234" class="comment"><div id="post-3234-score" class="comment-score"></div><div class="comment-text"><p>Not sure what your asking. The server for this application only runs this one application, but the client has multiple applications which access other servers via the same firewall, wireless, and wired path ways without issue. Only this one application the users report getting kicked out of.</p></div><div id="comment-3234-info" class="comment-info"><span class="comment-age">(30 Mar '11, 11:57)</span> networkguy09</div></div></div><div id="comment-tools-3229" class="comment-tools"></div><div class="clear"></div><div id="comment-3229-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="4136"></span>

<div id="answer-container-4136" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-4136-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>I ran into this problem with an ASA firewall, windows server 2000, and a VPN connection which wouldn't establish connection. When running traces I got the same error. I uninstalled the VPN software and re-installed it, including re-importing the certificate, and the problem resolved.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>19 May '11, 05:25</strong></p><img src="https://secure.gravatar.com/avatar/1f3966b6e9de3a63326e2d3fd51c8c04?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="John_Modlin&#39;s gravatar image" /><p>John_Modlin<br />
<span class="score" title="120 reputation points">120</span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="John_Modlin has no accepted answers">0%</span></p></div></div><div id="comments-container-4136" class="comments-container"></div><div id="comment-tools-4136" class="comment-tools"></div><div class="clear"></div><div id="comment-4136-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

