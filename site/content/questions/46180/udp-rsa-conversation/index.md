+++
type = "question"
title = "udp rsa conversation"
description = '''hi all, I have a capture of trying to connect to a RSA Server. I see the first UDP packet from client to RSA Server and I see a packet coming from the RSA Server back. Than i see 4 packets (each sent 5 seconds after the previous one) and each being 550 bytes. I came accross : http://www.cisco.com/c/...'''
date = "2015-09-25T12:42:00Z"
lastmod = "2015-09-26T15:35:00Z"
weight = 46180
keywords = [ "conversations", "udp" ]
aliases = [ "/questions/46180" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [udp rsa conversation](/questions/46180/udp-rsa-conversation)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-46180-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>hi all,</p><p>I have a capture of trying to connect to a RSA Server. I see the first UDP packet from client to RSA Server and I see a packet coming from the RSA Server back. Than i see 4 packets (each sent 5 seconds after the previous one) and each being 550 bytes. I came accross :</p><p><a href="http://www.cisco.com/c/en/us/support/docs/security-vpn/secureid-sdi/116304-technote-rsa-00.html#anc6">http://www.cisco.com/c/en/us/support/docs/security-vpn/secureid-sdi/116304-technote-rsa-00.html#anc6</a></p><p><strong><em>*<em>"A typical SDI exchange involves four packets, each of which is 550 bytes, but that might change with the RSA server version</em>"</em></strong>*</p><p>The capture was taken at the client. Since this is UDP i cannot tell what happened to this 4 packets. My question - if I capture the traffic on both sides , should I be able to find the same 4 UDP packets in the capture from the RSA Server ? I found some information (older posts , not sure if it's still valid) that some Firewalls were not processing UPD packets &gt; 512 bytes ? Is this still true?</p><p>BR</p><p>Adam</p></div><div id="question-tags" class="tags-container tags">conversations udp</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>25 Sep '15, 12:42</strong></p><img src="https://secure.gravatar.com/avatar/2b3f26f3a24449776af62dd8cca7715a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="adasko&#39;s gravatar image" /><p>adasko<br />
<span class="score" title="86 reputation points">86</span><span title="34 badges"><span class="badge1">●</span><span class="badgecount">34</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="42 badges"><span class="bronze">●</span><span class="badgecount">42</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="adasko has no accepted answers">0%</span></p></div></div><div id="comments-container-46180" class="comments-container"></div><div id="comment-tools-46180" class="comment-tools"></div><div class="clear"></div><div id="comment-46180-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="46188"></span>

<div id="answer-container-46188" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-46188-score" class="post-score" title="current number of votes">2</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>My question - if I capture the traffic on both sides , should I be able to find the same 4 UDP packets in the capture from the RSA Server ?</p></blockquote><p>Yes</p><blockquote><p>that some Firewalls were not processing UPD packets &gt; 512 bytes ? Is this still true?</p></blockquote><p>No, only 'ancient' firewall will block anything based on size. Of course you can configure some firewalls to block frames based on size, but that's rather silly.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>26 Sep '15, 15:35</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-46188" class="comments-container"><span id="46200"></span><div id="comment-46200" class="comment"><div id="post-46200-score" class="comment-score"></div><div class="comment-text"><p>Thank you Kurt for answering my questions.</p><p>How would I "look" for the packets on the RSA Server ? Since this is a UDP conversation not SEQ numbers are used. Would I have to filter for the socket pair combination (what if NAT is in play ? ) would be the only option be to search after the size of the packets?</p><p>what about a TCP conversation ? I know that Wireshark is using the ISN as relative zero. will I be able to track packets based on the real sequence number (after I disable relative sequence numbers in protocol preferences ?) on the opposite host ?</p><p>Thank you in advance. Best Regards</p><p>Adam</p></div><div id="comment-46200-info" class="comment-info"><span class="comment-age">(27 Sep '15, 14:27)</span> adasko</div></div><span id="46206"></span><div id="comment-46206" class="comment"><div id="post-46206-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>Would I have to filter for the socket pair combination</p></blockquote><p>Yes.</p><blockquote><p>(what if NAT is in play ?</p></blockquote><p>Then it gets more complicated. You could look at the IP ID, some NAT devices don't touch that field. The timestamp should also help to narrow down things. Further than that, there are not much options left to compare frames, except the payload of the frames.</p><blockquote><p>will I be able to track packets based on the real sequence number</p></blockquote><p>Yes, but some security devices (firewall) change the SEQ as well, so that's not a reliable criteria.</p><p>Regards<br />
Kurt</p></div><div id="comment-46206-info" class="comment-info"><span class="comment-age">(27 Sep '15, 23:42)</span> Kurt Knochner ♦</div></div><span id="46212"></span><div id="comment-46212" class="comment not_top_scorer"><div id="post-46212-score" class="comment-score"></div><div class="comment-text"><p>Thank you, very informative! So basically, for both UDP and TCP it's better to compare the payload of the frame,correct ? Also what I would like to ask,is it possible for a packet/frame to be changed in size due to passing via a intermediary device say Firewall etc? What I mean, when we configure span on a virtual VMware switch and define the bytes to be reported to say 64 bytes I will end up with frames recorded in wireshark not bigger as 64 bytes.</p><p>Thank you and best regards Adam</p></div><div id="comment-46212-info" class="comment-info"><span class="comment-age">(28 Sep '15, 02:21)</span> adasko</div></div><span id="46223"></span><div id="comment-46223" class="comment"><div id="post-46223-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>Also what I would like to ask,is it possible for a packet/frame to be changed in size due to passing via a intermediary device say Firewall etc?</p></blockquote><p>Yes and no ;-) YES, it is possible, if the intermediary device has a bug and thus changes things it should not change. And NO, this should not happen.</p><blockquote><p>What I mean, when we configure span on a virtual VMware switch and define the bytes to be reported to say 64 bytes I will end up with frames recorded in wireshark not bigger as 64 bytes.</p></blockquote><p>I'm not sure what that actually means ("and define the bytes to be reported to say 64 bytes"), but it sounds like you limited the number of bytes that were captured/recorded. If so, it would be the same as the '-s' option of tcpdump/Wireshark. It means, you only captured the first 64 Bytes of every frame, even if the frame was larger!</p></div><div id="comment-46223-info" class="comment-info"><span class="comment-age">(28 Sep '15, 10:04)</span> Kurt Knochner ♦</div></div><span id="46226"></span><div id="comment-46226" class="comment not_top_scorer"><div id="post-46226-score" class="comment-score"></div><div class="comment-text"><p>I see. You wrote about the IP identification field, that I could use it. I was assuming that this field is used for fragmentation and reasamble only. Why would a NAT device change it? I mean, I understand that depending on the NAT option used it will change the IP or IP &amp; port number, but it will modify the packet or will the device performing NAT actually create a new packet to send it out? Did you mean that this can trigger the IP ID field to be changed? You also mentioned that some security devices like Firewalls may change the sequence number. I'm just wondering, if it does change it, can the conversation still be considered reliable? I mean let's host A is at seq nbr 101 and is sending 1500 bytes to host B. If a say Firewall in between will modify the seq to 111 how can both keep track on what was sent and what was acknowledged ?</p><p>Best Regards Adam</p></div><div id="comment-46226-info" class="comment-info"><span class="comment-age">(28 Sep '15, 12:39)</span> adasko</div></div><span id="46229"></span><div id="comment-46229" class="comment"><div id="post-46229-score" class="comment-score">1</div><div class="comment-text"><p>@adasko: You are right with the need of the IP ID. But in fact nearly every device is setting this field, if needed or not. You can read some facts about the IP ID here: <a href="http://crnetpackets.com/2015/08/29/a-short-story-about-the-ip-id-field/">http://crnetpackets.com/2015/08/29/a-short-story-about-the-ip-id-field/</a></p></div><div id="comment-46229-info" class="comment-info"><span class="comment-age">(28 Sep '15, 13:20)</span> Christian_R</div></div><span id="46233"></span><div id="comment-46233" class="comment"><div id="post-46233-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>will the device performing NAT actually create a new packet to send it out?</p></blockquote><p>well, how would you define "create a new packet". A router allways "creates" a new packet, by copying the contents of the old frame and by creating a new one, just with different MAC addresses, so ...</p><blockquote><p>Did you mean that this can trigger the IP ID field to be changed?</p></blockquote><p>yes, but not because of the "new" packet, because the IP ID gets changed on purpose (IP ID randomization) to prevent passive OS fingerprinting or similar reasons.</p><blockquote><p>Firewalls may change the sequence number. I'm just wondering, if it does change it, can the conversation still be considered reliable?</p></blockquote><p>If that device does it in the right way, yes ;-)</p><blockquote><p>I mean let's host A is at seq nbr 101 and is sending 1500 bytes to host B.</p></blockquote><p>A (SEQ: 1000 + 500) ---&gt; Firewall (SEQ: 9000 +500) ---&gt; B (SEQ: 9000 + xx)</p><p>B only sees what the Firewall sent, it's like a "TCP proxy".</p></div><div id="comment-46233-info" class="comment-info"><span class="comment-age">(28 Sep '15, 13:58)</span> Kurt Knochner ♦</div></div><span id="46251"></span><div id="comment-46251" class="comment not_top_scorer"><div id="post-46251-score" class="comment-score"></div><div class="comment-text"><p>Please excuse for the late replay – I had to do some reading and take time to sum it up in my head. Could you please just confirm with YES / NO (or please add additional comments to correct myself) the following:</p><p>a)The IP ID field was originally meant (still is) for fragmentation and reassembly purposes.<br />
</p><p>b)When a router will have to process the data to a network with lower MTU it will perform fragmentation. So, if the original packet has the IP ID set to 0x61ca after fragmentation ALL packets that originated from the original packet will have the same value inside the Identification field (to identify fragments of the original packet).</p><p>c)Each packet must have a unique IP ID for the given conversation.</p><p>d)If I would connect two hosts via a crossover cable (no device in-between) the IP ID value for each single packet sent from A to B would be identical in both trace files.</p><p>e)If there is any device between A and B that will change the IP ID value, I cannot really use this field on the receiving end to find packets sent from A.</p><p>f)The IP ID randomization as Kurt mentioned is for security reasons to prevent for example passive OS fingerprinting.</p><p>g)I took a look on a trace file (captured few of them) , narrowed down to onestream / conversation and I can see that each time the “first” IP ID value is always different but some sites mentioned that normally the value increments by 1 for each packet. In my example I have a trace file of a connection between 2 MS hosts and in fact I can see that the IP ID value for host A is incrementing by 1 for each packet BUT the fifth packet is incremented by 1841 … I tried to google this but without luck. Could this be perhaps also a “way” of this randomization, I mean that there is no really a clear pattern on how this IP ID filed is incremented.</p><p>[EDIT] Found this "Newer operating systems, such as the recent Linux kernel, OpenBSD, and Windows Vista, randomize the IP ID, but older operating systems and hardware (such as printers) typically do not."</p><p>So the IP ID is generated by the host but if older did not use randomization does that mean that each packet was ALWAYS incremented by 1 o?</p><p>h)Also when devices performing NAT, Firewalls do change the IP ID they do it not because of a bug or miss behavior , it’s done by them for security reasons (IP ID randomization to prevent passive OS spoofing).</p><p>I really appreciate your time and expertise. I learn something new with each and every post!</p><p>Best Regards</p><p>Adam</p></div><div id="comment-46251-info" class="comment-info"><span class="comment-age">(29 Sep '15, 06:31)</span> adasko</div></div><span id="46264"></span><div id="comment-46264" class="comment not_top_scorer"><div id="post-46264-score" class="comment-score"></div><div class="comment-text"><p>a.) - e.): yes (more or less)<br />
f.) Is this a question or a statement?<br />
g.) + EDIT: correct<br />
h.) yes</p></div><div id="comment-46264-info" class="comment-info"><span class="comment-age">(29 Sep '15, 11:31)</span> Kurt Knochner ♦</div></div><span id="46265"></span><div id="comment-46265" class="comment not_top_scorer"><div id="post-46265-score" class="comment-score"></div><div class="comment-text"><p>@adasko for g) it could be that you different concurrent sessions between this hoast. Remember that the IP ID must be unique for non atomic datagrams for the 3 tupels of (IP SRC, IP DST and L4 protocol Type). But a lot of stacks do not care in there generation of IP ID if the datagram is atomic or not.</p><p>So even a IP ID of 0x0 would be correct for a atomic datagramm.</p><p>o Atomic datagrams: (DF==1)&amp;&amp;(MF==0)&amp;&amp;(frag_offset==0)</p></div><div id="comment-46265-info" class="comment-info"><span class="comment-age">(29 Sep '15, 11:54)</span> Christian_R</div></div></div><div id="comment-tools-46188" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-46188-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

