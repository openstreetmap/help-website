+++
type = "question"
title = "&quot;Smaller tshark&quot; for specific protocol"
description = '''Hi all, as we know, wireshark is a big open source project with contributions from many developers. It is able to decode many, many protocols and this number is increasing day by day. But actually in some specific tasks, we just need to use to decode very few protocol, for example in my case, i use ...'''
date = "2013-10-31T01:02:00Z"
lastmod = "2013-10-31T18:45:00Z"
weight = 26563
keywords = [ "camel" ]
aliases = [ "/questions/26563" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# ["Smaller tshark" for specific protocol](/questions/26563/smaller-tshark-for-specific-protocol)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26563-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26563-score" class="post-score" title="current number of votes">0</div><span id="post-26563-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi all, as we know, wireshark is a big open source project with contributions from many developers. It is able to decode many, many protocols and this number is increasing day by day. But actually in some specific tasks, we just need to use to decode very few protocol, for example in my case, i use CAMEL only. I'm using a big wireshark to build, to run for a very small objective. So, I wonder: is there any way to take the advantage of wireshark to build a new project which is smaller, and just focus on specific protocol. All I need is running tshark to decode CAMEL, no need to have GUI, no need to dissect other protocols, no more, no less. In other words, wireshark might be considered as giant Goliath while in some specific cases, young David is more useful. I think it is possible but I don't know how to start because of my poor experience. If you have any suggestion, please tell me your idea. As usual, your comment always help me a lot. Thanks.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-camel" rel="tag" title="see questions tagged &#39;camel&#39;">camel</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>31 Oct '13, 01:02</strong></p><img src="https://secure.gravatar.com/avatar/824a7342f59ff90e6040505b38626416?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="hoangsonk49&#39;s gravatar image" /><p><span>hoangsonk49</span><br />
<span class="score" title="81 reputation points">81</span><span title="28 badges"><span class="badge1">●</span><span class="badgecount">28</span></span><span title="29 badges"><span class="silver">●</span><span class="badgecount">29</span></span><span title="33 badges"><span class="bronze">●</span><span class="badgecount">33</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="hoangsonk49 has 2 accepted answers">28%</span></p></div></div><div id="comments-container-26563" class="comments-container"></div><div id="comment-tools-26563" class="comment-tools"></div><div class="clear"></div><div id="comment-26563-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="26572"></span>

<div id="answer-container-26572" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26572-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26572-score" class="post-score" title="current number of votes">0</div><span id="post-26572-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="hoangsonk49 has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I guess this question is based on my recommendation in a comment of the following question:</p><blockquote><p><a href="http://ask.wireshark.org/questions/25794/tshark-generate-core-dump">http://ask.wireshark.org/questions/25794/tshark-generate-core-dump</a><br />
</p></blockquote><p><strong>Cite:</strong> <code>Maybe you can just use parts of the dissector engine to build your own real time monitoring system for the protocol you want to monitor.</code></p><p><strong>However:</strong> Just removing other dissectors will not necessarily solve your main problem (<a href="http://ask.wireshark.org/questions/25984/what-does-processing-speed-of-dissectors-depend-on">tshark lagging behind dumpcap</a>), as you won't change the architecture of the dissection engine and you won't change the way how dumpcap and tshark interact.</p><p>You can already today disable the dissectors you don't need. That will improve dissection speed a bit, but probably not enough to solve your problem.</p><blockquote><p>Analyze -&gt; Enabled Protocols</p></blockquote><p><strong>But</strong>, even if you disable some dissectors and/or you don't compile them into tshark/Wireshark, the original problems remain:</p><ul><li>tshark/Wireshark was not built with real-time and long-term <strong>monitoring</strong> in mind.</li></ul><p>Thus, you will hit</p><ul><li>the memory problem (sooner or later) even if you remove most of the dissectors.</li><li>and you will hit the problem with tshark lagging behind dumpcap, as that's a structural problem due to the way how dumpcap and tshark interact.</li></ul><p>What I originally meant in that comment: Take the code of the CAMEL dissector and try to build your own monitoring tool, just for that protocol, based on some <a href="https://www.google.com/?q=libpcap+programming+tutorial">libpcap programming tutorials</a>, meaning: build your own little CAMEL 'dissector' with the help of the CAMEL dissector code, but <strong>without</strong> the Wireshark dissection engine.</p><p>Please take a look at the <a href="http://www.tcpdump.org/#source">code of tcpdump</a>. It has also dissection capabilities for certain protocols, while it works differently than Wireshark. That might be a good starting point for your own monitoring tool.</p><p><strong>UPDATE</strong><br />
Just to make this clear: Writing your own CAMEL dissector, based on the Wireshark dissector and tcpdump code, sounds easy, but <strong>it is not</strong> that easy!! You'll have to implement some other protocols as well before you get to your CAMEL data. But I guess you already knew this ;-)</p><p>BTW: It would be nice if you could close some of your other questions by either accepting one of the answers or by answering the question yourself and then choose that as the correct answer, if you have a better solution than what was suggested by others.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>31 Oct '13, 03:25</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>31 Oct '13, 06:38</strong> </span></p></div></div><div id="comments-container-26572" class="comments-container"><span id="26589"></span><div id="comment-26589" class="comment"><div id="post-26589-score" class="comment-score"></div><div class="comment-text"><p>Agreed. You can already take the GUI out by doing ./configure --without-gtk2 --without-gtk3 and anyway that just saves you the compile time (it won't affect tshark at all).</p><p>Taking out dissectors (which you could do by careful removal in the Makefiles and maybe some minor code changes) probably also won't help the speed unless you happen to take out some heuristic dissectors which are looking at your CAMEL packets before they reach the CAMEL dissector.</p><p>Removing dissectors will reduce the memory footprint but the amount of code you'll save will be negligible compared to tshark's dynamic memory allocation. tshark will be <em>slightly</em> faster to load the first time you run it if you strip out all that code but it won't affect run-time speed (again, unless you find some heuristic dissectors in your way).</p></div><div id="comment-26589-info" class="comment-info"><span class="comment-age">(31 Oct '13, 06:18)</span> <span class="comment-user userinfo">JeffMorriss ♦</span></div></div><span id="26605"></span><div id="comment-26605" class="comment"><div id="post-26605-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Please take a look at the code of tcpdump</p></blockquote><p>Thanks, that is what I want to do. I 'll check the code of tcpdump to have a basic understanding of how to start.</p><blockquote><p>the memory problem (sooner or later) even if you remove most of the dissectors</p></blockquote><p>Yes, I know this problem is really serious. Maybe I cannot solve it but as I see in my system, it spends about 14% of 8 GB RAM after 1 week and so, I can restart tshark twice a month. Although my service must be stopped in 1 second and some packets could be lost, but it could be acceptable by doing this at 3 or 4AM when there are only 10-14 calls/second.</p><blockquote><p>and you will hit the problem with tshark lagging behind dumpcap, as that's a structural problem due to the way how dumpcap and tshark interact</p></blockquote><p>and</p><blockquote><p>it won't affect run-time speed</p></blockquote><p>I'm doing some experiments related to this problem to find a workaround. I will answer in my <a href="http://ask.wireshark.org/questions/25794/tshark-generate-core-dump">other question</a> after I finish</p><blockquote><p>BTW: It would be nice if you could close some of your other questions by either accepting one of the answers or by answering the question yourself and then choose that as the correct answer, if you have a better solution than what was suggested by others</p></blockquote><p>Actually, for some suggestions and ideas provided by this community, I need to analyze and verify if it is possible to work well with my system. It is more practical than talking in theory :-) .Also, I'm doing some experiments that i think it is a good way at least for my case but it has not been finished. So, some of my questions which are related to practical problem are still pending.</p></div><div id="comment-26605-info" class="comment-info"><span class="comment-age">(31 Oct '13, 18:45)</span> <span class="comment-user userinfo">hoangsonk49</span></div></div></div><div id="comment-tools-26572" class="comment-tools"></div><div class="clear"></div><div id="comment-26572-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

