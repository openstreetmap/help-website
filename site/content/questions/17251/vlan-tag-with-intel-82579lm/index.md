+++
type = "question"
title = "VLAN tag with Intel 82579LM"
description = '''Hello, I would like to see VLAN tags in Wireshark when using SPAN on switch. switch is configured properly to send output packets with their tags.  OS is Windows t Pro x64, Laptop is Thinkpad X230. when I am edit registry &quot;MonitorMode=1&quot;/&quot;MonitorModeEnabled=1&quot;, I see that Wireshark not show tagged p...'''
date = "2012-12-27T00:31:00Z"
lastmod = "2013-01-01T03:13:00Z"
weight = 17251
keywords = [ "tag", "monitoring", "intel", "82579lm" ]
aliases = [ "/questions/17251" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [VLAN tag with Intel 82579LM](/questions/17251/vlan-tag-with-intel-82579lm)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17251-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17251-score" class="post-score" title="current number of votes">0</div><span id="post-17251-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello,</p><p>I would like to see VLAN tags in Wireshark when using SPAN on switch. switch is configured properly to send output packets with their tags. OS is Windows t Pro x64, Laptop is Thinkpad X230.</p><p>when I am edit registry "MonitorMode=1"/"MonitorModeEnabled=1", I see that Wireshark not show tagged packet at all. untagged packets displayed properly without any issue.</p><p>if I remove "MonitorMode"/"MonitorModeEnabled", than all packets is displayed but without tagged information.</p><p>any idea what is the problem?</p><p>Thanks!</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-tag" rel="tag" title="see questions tagged &#39;tag&#39;">tag</span> <span class="post-tag tag-link-monitoring" rel="tag" title="see questions tagged &#39;monitoring&#39;">monitoring</span> <span class="post-tag tag-link-intel" rel="tag" title="see questions tagged &#39;intel&#39;">intel</span> <span class="post-tag tag-link-82579lm" rel="tag" title="see questions tagged &#39;82579lm&#39;">82579lm</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 Dec '12, 00:31</strong></p><img src="https://secure.gravatar.com/avatar/011ec39e8834cab313d1d9c0d6028117?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="leonm12&#39;s gravatar image" /><p><span>leonm12</span><br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="leonm12 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>27 Dec '12, 04:04</strong> </span></p><img src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jaap&#39;s gravatar image" /><p><span>Jaap ♦</span><br />
<span class="score" title="11680 reputation points"><span>11.7k</span></span><span title="16 badges"><span class="silver">●</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">●</span><span class="badgecount">101</span></span></p></div></div><div id="comments-container-17251" class="comments-container"><span id="17368"></span><div id="comment-17368" class="comment"><div id="post-17368-score" class="comment-score"></div><div class="comment-text"><p>not possible do to. any more ideas?</p></div><div id="comment-17368-info" class="comment-info"><span class="comment-age">(31 Dec '12, 23:44)</span> <span class="comment-user userinfo">leonm12</span></div></div></div><div id="comment-tools-17251" class="comment-tools"></div><div class="clear"></div><div id="comment-17251-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="17252"></span>

<div id="answer-container-17252" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17252-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17252-score" class="post-score" title="current number of votes">0</div><span id="post-17252-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Somehow the network card / card driver manages to filter them out before they are send up the stack to where WinPcap can pick them up. I'm not familiar with the this combination so can't really tell what to set, other then use Google some more, or maybe this <a href="http://www.intel.com/support/network/sb/CS-005897.htm">Intel page</a>.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 Dec '12, 00:53</strong></p><img src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jaap&#39;s gravatar image" /><p><span>Jaap ♦</span><br />
<span class="score" title="11680 reputation points"><span>11.7k</span></span><span title="16 badges"><span class="silver">●</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">●</span><span class="badgecount">101</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jaap has 155 accepted answers">14%</span></p></div></div><div id="comments-container-17252" class="comments-container"><span id="17255"></span><div id="comment-17255" class="comment"><div id="post-17255-score" class="comment-score"></div><div class="comment-text"><p>what Intel says now work for this card and wireshark..</p></div><div id="comment-17255-info" class="comment-info"><span class="comment-age">(27 Dec '12, 01:01)</span> <span class="comment-user userinfo">leonm12</span></div></div></div><div id="comment-tools-17252" class="comment-tools"></div><div class="clear"></div><div id="comment-17252-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="17258"></span>

<div id="answer-container-17258" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17258-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17258-score" class="post-score" title="current number of votes">0</div><span id="post-17258-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>if I remove "MonitorMode"/"MonitorModeEnabled", than all packets is displayed but without tagged information.</p></blockquote><p>See my answer (and possible solutions therein) to the following question:</p><blockquote><p><code>http://ask.wireshark.org/questions/15524/vlan-tagging-intel-82579lm-and-wireshark-183</code><br />
</p></blockquote><p>If that does not help: Boot your PC with <a href="http://www.backtrack-linux.org/">BackTrack Linux</a> (no installation needed) and capture there with Wireshark and/or tcpdump (cli: <code>tcpdump -ni eth0 vlan</code>). If you don't see the tags on Linux, then most certainly your switch removes them.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 Dec '12, 01:25</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>27 Dec '12, 02:16</strong> </span></p></div></div><div id="comments-container-17258" class="comments-container"><span id="17328"></span><div id="comment-17328" class="comment"><div id="post-17328-score" class="comment-score"></div><div class="comment-text"><p>when you BT it still not capture vlan tags. when applying this tcpdump filter there is no packet captured.</p><p>I have tested the Cisco switch (connect it's SPAN to other network device) and I can see it replicate the vlan tag correctly.</p><p>what else can cause it? is it about build in NIC?</p><p>Thanks</p></div><div id="comment-17328-info" class="comment-info"><span class="comment-age">(31 Dec '12, 01:27)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17331"></span><div id="comment-17331" class="comment"><div id="post-17331-score" class="comment-score"></div><div class="comment-text"><p>According to information from Intel, the driver for the card does not strip VLAN tags by default on Linux.</p><blockquote><p><code>http://www.intel.com/support/network/sb/cs-005897.htm</code><br />
</p></blockquote><p>Cite: To not strip VLAN tags: By default, the driver, in promiscuous mode, does not strip VLAN tags.</p><p><strong>HOWEVER</strong> I'm not sure what driver they are referring to. Maybe that's a proprietary driver from Intel. On the other side, I don't believe that any open source linux ethernet driver will ever strip VLAN tags <strong>by default</strong>.</p><p><strong>Conclusion:</strong> If you <strong>really</strong> see the VLAN tags of <strong>the same</strong> SPAN port on another system, but you don't see it on the mentioned Laptop (neither with Windows nor with Linux), there must be something wrong with the network card (<a href="http://dot1x.blogspot.de/2010/03/sniffing-dot1q-tags-with-wireshark.html">other people report success, even on Windows 7</a>).</p><p>BTW: Do you use that adapter in a docking station? I don't think that will change anything, just want to check...</p></div><div id="comment-17331-info" class="comment-info"><span class="comment-age">(31 Dec '12, 01:41)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17332"></span><div id="comment-17332" class="comment"><div id="post-17332-score" class="comment-score"></div><div class="comment-text"><p>I used the build in adapter, not docking station</p></div><div id="comment-17332-info" class="comment-info"><span class="comment-age">(31 Dec '12, 01:48)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17335"></span><div id="comment-17335" class="comment"><div id="post-17335-score" class="comment-score"></div><div class="comment-text"><p>O.K. I have no real idea then.</p><p>Can you post the output of the following commands (while running BackTrack Linux).</p><ul><li><code>dmesg | egrep -i '(intel|eth)'</code></li><li><code>lspci | grep -i intel</code><br />
</li><li><code>ifconfig eth0</code><br />
</li><li><code>eththool eth0</code></li></ul><p>BTW: If you run BackTrack, do you seen anything, if you omit the <strong>vlan</strong> filter for tcpdump?</p><blockquote><p><code>tcpdump -ni eth0</code></p></blockquote></div><div id="comment-17335-info" class="comment-info"><span class="comment-age">(31 Dec '12, 02:00)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17345"></span><div id="comment-17345" class="comment"><div id="post-17345-score" class="comment-score"></div><div class="comment-text"><p>yes, I can see the packet that way. how can I upload the files here?</p></div><div id="comment-17345-info" class="comment-info"><span class="comment-age">(31 Dec '12, 05:43)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17347"></span><div id="comment-17347" class="comment not_top_scorer"><div id="post-17347-score" class="comment-score"></div><div class="comment-text"><blockquote><p>how can I upload the files here?</p></blockquote><p>you can't on this site. You can however upload it to google docs, your own web server, <a href="http://cloudshark.org">cloudshark.org</a> or any one click file hoster. Beware of the privacy issues in doing so!!</p><p>Anyway, if you see the packets now I would really like to see those packets as I suspect there a no VLAN tags.</p></div><div id="comment-17347-info" class="comment-info"><span class="comment-age">(31 Dec '12, 05:57)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17348"></span><div id="comment-17348" class="comment not_top_scorer"><div id="post-17348-score" class="comment-score"></div><div class="comment-text"><p>I have captured to file and I can see vlan tags!!. but when using "tcpdump -ni eth0 vlan" there is no screen output.. why? and what can be the problem in Windows OS?</p><p>Thanks</p></div><div id="comment-17348-info" class="comment-info"><span class="comment-age">(31 Dec '12, 06:53)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17349"></span><div id="comment-17349" class="comment not_top_scorer"><div id="post-17349-score" class="comment-score"></div><div class="comment-text"><p>no idea. Can you please post the capture file?</p></div><div id="comment-17349-info" class="comment-info"><span class="comment-age">(31 Dec '12, 07:03)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17354"></span><div id="comment-17354" class="comment not_top_scorer"><div id="post-17354-score" class="comment-score"></div><div class="comment-text"><p><a href="https://docs.google.com/folder/d/0BxlhpZm7yF0GQWgxcGRfTVNDd2s/edit">https://docs.google.com/folder/d/0BxlhpZm7yF0GQWgxcGRfTVNDd2s/edit</a></p></div><div id="comment-17354-info" class="comment-info"><span class="comment-age">(31 Dec '12, 08:15)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17355"></span><div id="comment-17355" class="comment not_top_scorer"><div id="post-17355-score" class="comment-score"></div><div class="comment-text"><p>So, there are indeed VLAN tags. And now I run out of ideas, as you already did what is possible on Windows 7. Usually those two registry entries do work on Win7.</p><p>One last question: Is there any software on your Win7 installation that interferes with the network (IDS, Endpoint Protection, VPN, and the like)? I have not heard yet that such software will interfere with VLAN tags, but you never know.</p><p>Also, what I don't understand is why you don't see any packets on BackTrack with the capture filter <strong>vlan</strong>. That <strong>should</strong> show vlan tagged packets !??!</p></div><div id="comment-17355-info" class="comment-info"><span class="comment-age">(31 Dec '12, 08:33)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17356"></span><div id="comment-17356" class="comment not_top_scorer"><div id="post-17356-score" class="comment-score"></div><div class="comment-text"><p>I will try to load windows in safe mode with networking and check. I also trying now various drivers</p><p>I will update</p></div><div id="comment-17356-info" class="comment-info"><span class="comment-age">(31 Dec '12, 08:41)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17367"></span><div id="comment-17367" class="comment not_top_scorer"><div id="post-17367-score" class="comment-score"></div><div class="comment-text"><p>not possible do to. any more ideas?</p></div><div id="comment-17367-info" class="comment-info"><span class="comment-age">(31 Dec '12, 23:44)</span> <span class="comment-user userinfo">leonm12</span></div></div><span id="17371"></span><div id="comment-17371" class="comment not_top_scorer"><div id="post-17371-score" class="comment-score"></div><div class="comment-text"><p>You could try <a href="http://www.microsoft.com/en-us/download/details.aspx?id=4865">Microsoft Network Monitor</a>.</p></div><div id="comment-17371-info" class="comment-info"><span class="comment-age">(01 Jan '13, 03:13)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-17258" class="comment-tools"><span class="comments-showing"> showing 5 of 13 </span> <a href="#" class="show-all-comments-link">show 8 more comments</a></div><div class="clear"></div><div id="comment-17258-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

