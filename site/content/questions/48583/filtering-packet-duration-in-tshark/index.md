+++
type = "question"
title = "Filtering Packet Duration in Tshark."
description = '''I need to filter out either option A or option A below of a pcap file: A. The connection speed of a transmission (aka mbps), the number of bits for that packet transmission, and the starting time of the transmission; may need to be of a specific protocol  B. The duration (or life) of the packet tran...'''
date = "2015-12-16T12:49:00Z"
lastmod = "2016-05-08T07:48:00Z"
weight = 48583
keywords = [ "duration", "filter", "tshark", "packet", "batch" ]
aliases = [ "/questions/48583" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Filtering Packet Duration in Tshark.](/questions/48583/filtering-packet-duration-in-tshark)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-48583-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-48583-score" class="post-score" title="current number of votes">0</div><span id="post-48583-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I need to filter out either option A or option A below of a pcap file:</p><p>A. The connection speed of a transmission (aka mbps), the number of bits for that packet transmission, and the starting time of the transmission; may need to be of a specific protocol<br />
B. The duration (or life) of the packet transmission, and the starting time of the packet transmission.</p><p>Here is the code I currently have, which exports only the packet start time of ip transmissions:<br />
<code> "C:\Program Files\Wireshark\tshark.exe” -r "%~1" -P -Y "ip" -o "uat:user_dlts:\"User 8 (DLT=155)\",\"pxt\",\"0\",\"\",\"0\",\"\"" -o "gui.column.format:\"Time\", \"%t\"" &gt; "%~1.txt”</code><br />
Notes:</p><ol><li>The "%~1" allows me to drag and drop the *.pcap file onto a batch file</li><li>The "uat:..." converts the data so that it is readable due to the nature of the pcap file (otherwise the filter returns a blank output file for me). Most likely won't apply to how you use Wireshark/Tshark</li><li>the "gui.format" exports the time of the transmission</li><li>What we need to add is either A. or B. as listed above.</li><li>I know I can use <code>-o "gui.column.format:\"Length\", \"%L\""</code> to retrieve the length, but the more important part is the duration information.</li></ol><p>The problem I am having is that I am not finding anything that allows me to export the specific information listed in either A. or B. Any help would be appreciated.</p><p>PS: I do know that "ip.len" can be used to find instances of specific lengths, but I want to find the lengths of specific instances (aka certain protocols or simply a transmission occurrence).</p><p>Need a response as soon as possible, if possible.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-duration" rel="tag" title="see questions tagged &#39;duration&#39;">duration</span> <span class="post-tag tag-link-filter" rel="tag" title="see questions tagged &#39;filter&#39;">filter</span> <span class="post-tag tag-link-tshark" rel="tag" title="see questions tagged &#39;tshark&#39;">tshark</span> <span class="post-tag tag-link-packet" rel="tag" title="see questions tagged &#39;packet&#39;">packet</span> <span class="post-tag tag-link-batch" rel="tag" title="see questions tagged &#39;batch&#39;">batch</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>16 Dec '15, 12:49</strong></p><img src="https://secure.gravatar.com/avatar/3a4bc2ba5c09d24f214dc472eb5b7993?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Midimistro&#39;s gravatar image" /><p><span>Midimistro</span><br />
<span class="score" title="11 reputation points">11</span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="10 badges"><span class="bronze">●</span><span class="badgecount">10</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Midimistro has one accepted answer">50%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>16 Dec '15, 13:01</strong> </span></p></div></div><div id="comments-container-48583" class="comments-container"></div><div id="comment-tools-48583" class="comment-tools"></div><div class="clear"></div><div id="comment-48583-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="48584"></span>

<div id="answer-container-48584" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-48584-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-48584-score" class="post-score" title="current number of votes">0</div><span id="post-48584-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>If I get you right, you need to calculate an average transmission speed, calculated as (sum of lengths of all packets meeting the display filter) / (timestamp of the last packet - timestamp of the first packet). One way, which allows you to use your favourite scripting language, would be to let tshark display tuples (<code>frame.time_relative</code>,<code>frame.len</code>) and pipe its output to a post-process script which would calculate the result; another, "all Wireshark" way, would be to use a <a href="https://wiki.wireshark.org/Lua/Taps">Lua listener</a> to do the same thing. The point is that a display filter can work with real and forged fields of individual frames, but forged fields providing summary or delta values from several frames exist only in some dissectors (e.g., request-to-response time in SMB or SMB2). So one way or another, you need to summarize the time elapsed and bytes transferred "manually", i.e. on top of the normal dissector operation.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>16 Dec '15, 13:31</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span> </br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>16 Dec '15, 13:37</strong> </span></p></div></div><div id="comments-container-48584" class="comments-container"><span id="48585"></span><div id="comment-48585" class="comment"><div id="post-48585-score" class="comment-score"></div><div class="comment-text"><p>Not really. I need to print out the life of the packet for that instance (aka how long the packet was present in the network) to a text file. If programmed right, I can do this by using the the length (aka # of bytes, converted to bits using MATLAB) multiplied by the connection speed (in say Mbps), and calculating the life in MATLAB. What I can't seem to find is the information regarding the connection speed. The other possible way would be if Wireshark provides the duration, or life of the packet straight up. Either method will do, but as stated, I'm looking for packet life, not gaps between each packet.</p><p>Alternatively, do you know what "DLT" means in the encapsulation preferences? That might help solve this problem if it is the download rate... If not, I need the speed.</p></div><div id="comment-48585-info" class="comment-info"><span class="comment-age">(16 Dec '15, 13:43)</span> <span class="comment-user userinfo">Midimistro</span></div></div><span id="48586"></span><div id="comment-48586" class="comment"><div id="post-48586-score" class="comment-score"></div><div class="comment-text"><p>In that case, you've bumped the wall. While the pcapng format specification foresees interface speed as a parameter (of an interface, not of each single frame captured at that interface), WinPcap does not fetch that information from the OS and store it to the file, and even if it would be present in the file, Wireshark does not make it accessible as a forged field associated to a frame anyway.</p><p>In generic case it is not a big information loss because what you would get would be nothing more and nothing less than the bit rate of the interface on which you took the capture, but the packet may have passed through slower connections, so what would be the value of the information about its duration on the last (nearest to the capture point) link out of the whole path? On the contrary, if you know that the sending side is sending as fast as the media to which it is directly connected permits, the difference of timestamps of two subsequent packets gives you a hint about the transmission speed of the slowest link in the path (provided that no other traffic shares the bandwidth of that link of course).</p><p>So should that approach suit you, you could use <code>frame.len, frame.time_delta_displayed</code> to feed your Matlab.</p></div><div id="comment-48586-info" class="comment-info"><span class="comment-age">(16 Dec '15, 14:07)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="48598"></span><div id="comment-48598" class="comment"><div id="post-48598-score" class="comment-score"></div><div class="comment-text"><p>An afterthought - I take some things for obvious while they may not be for someone else. Already at early times of tcpdump, all network interface cards (NICs) had their local buffers or direct access to the common RAM, so the process of packet reception was their autonomous business and the CPU (or operating system, or kernel, however you prefer to think about it) has received a single signal "a packet has been received" when the autonomous reception process has been completed. I.e. the CPU was not involved in handling every single bit of the packet. On the other hand, the NIC hardware had got no notion of real time because for normal deployment there was no need to indicate the duration of the packet (or the time when the first and last bit have been received). Even the shortest timeouts of request/response protocol timeouts start several orders of magnitude above the bit duration because most routers and even switches in the network work on a store-and-forward basis, so each packet must first be completely received before being sent further.</p><p>Therefore, on a common NIC, the capturing software has no primary source of information about packet duration which it could pass on. Even worse, it even has no information about the moment of packet arrival, so it asks the kernel for current time at the moment it picks up the packet from the driver. This means that there is a difference between the moment of physical arrival of the packet and the contents of the timestamp and that it varies depending on the hardware and software architecture and the machine load.</p></div><div id="comment-48598-info" class="comment-info"><span class="comment-age">(17 Dec '15, 01:28)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="52299"></span><div id="comment-52299" class="comment"><div id="post-52299-score" class="comment-score"></div><div class="comment-text"><p>I found this thread looking for frame duration. I guess Midimistro is looking for 802.11 durations (at least I am). In 802.11 different frames have different bit rates and some frames change bit rate mid frame making calculating the duration cumbersome. Fortunately someone has written the code and epan/dissectors/packet-ieee80211-radio.c provides hf_wlan_radio_duration.</p><p>My question is: How do I access this information?</p></div><div id="comment-52299-info" class="comment-info"><span class="comment-age">(07 May '16, 15:12)</span> <span class="comment-user userinfo">petri</span></div></div><span id="52303"></span><div id="comment-52303" class="comment"><div id="post-52303-score" class="comment-score"></div><div class="comment-text"><p>I've converted your post from an Answer to the original Question (which it was not) to a comment to an existing Answer, but I believe it should have been a separate Question. Please consider converting it that way yourself.</p><p>The answer to such Question would be:</p><p>Read <code>epan/dissectors/packet-ieee80211-radio.c</code> a little bit past the initial declarations, which yields the following piece of code:</p><p><code>...     {&amp;hf_wlan_radio_duration,      {"Duration", "wlan_radio.duration", FT_UINT32, BASE_DEC, NULL, 0,       "Total duration of the frame in microseconds, including any preamble or plcp header. "       "Calculated from the frame length, modulation and other phy data.", HFILL }}, ...</code></p><p>The second item there (<code>wlan_radio.duration</code>) could be called the <strong>full name of protocol field</strong> (the official name is probably different) which can be used in a display filter expression (like e.g. <code>-Y wlan_radio.duration &gt; 50</code>) as well as displayed in tshark output using <code>-T fields -e wlan_radio.duration</code>.</p><p>A temporary remark for others interested: to date, the key to use this protocol field is to run the bleeding edge version of Wireshark which you have to compile yourself or download from <a href="https://wireshark.org/download/automated/">the automated builds area</a>, because this feature of the ieee80211_radio is not yet part of the stable release (2.0.3 as of writing this).</p></div><div id="comment-52303-info" class="comment-info"><span class="comment-age">(08 May '16, 01:15)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="52309"></span><div id="comment-52309" class="comment not_top_scorer"><div id="post-52309-score" class="comment-score"></div><div class="comment-text"><p>Thanks sindy!</p><p>Yes, it was my first post around here and I am not yet familiar with the manners. Thanks for helping me out.</p><p>Yes, I had read the code to check how the duration was calculated (correctly!). I just couldn't access the field in the app. Now I know the reason is I am running older code. I hadn't checked the version history to learn this was a recent addition (to my surprise).</p></div><div id="comment-52309-info" class="comment-info"><span class="comment-age">(08 May '16, 07:48)</span> <span class="comment-user userinfo">petri</span></div></div></div><div id="comment-tools-48584" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-48584-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

