+++
type = "question"
title = "Unexplained NETBIOS traffic"
description = '''I&#x27;m currently seeing a lot of traffic coming from two of my machines at the office to various IP addresses in the European block, I&#x27;m from Canada so this is unusual. The info in Wireshark reports: &quot;Name query NBSTAT *&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt;00&amp;gt;&amp;lt...'''
date = "2011-03-15T06:11:00Z"
lastmod = "2011-03-16T06:01:00Z"
weight = 2824
keywords = [ "nbstat", "virus" ]
aliases = [ "/questions/2824" ]
osqa_answers = 2
osqa_accepted = true
+++

<div class="headNormal">

# [Unexplained NETBIOS traffic](/questions/2824/unexplained-netbios-traffic)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-2824-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-2824-score" class="post-score" title="current number of votes">0</div><span id="post-2824-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I'm currently seeing a lot of traffic coming from two of my machines at the office to various IP addresses in the European block, I'm from Canada so this is unusual. The info in Wireshark reports: "Name query NBSTAT *&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;&lt;00&gt;". Now normally I wouldn't panic about this however there is also a second relation to this that is the worrying part.</p><p>In the Windows 7 Resource Monitor these requests are coming from any users spawned process, firefox and process explorer are two common ones, plus the System Process, PID 4. Since the request is coming from both a user process AND the system process this is what I find things being worrying.</p><p>Can anyone explain this behaviour to me?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-nbstat" rel="tag" title="see questions tagged &#39;nbstat&#39;">nbstat</span> <span class="post-tag tag-link-virus" rel="tag" title="see questions tagged &#39;virus&#39;">virus</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>15 Mar '11, 06:11</strong></p><img src="https://secure.gravatar.com/avatar/a37c1e32633215d68a10f1767976f988?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Stuart&#39;s gravatar image" /><p><span>Stuart</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Stuart has no accepted answers">0%</span></p></div></div><div id="comments-container-2824" class="comments-container"></div><div id="comment-tools-2824" class="comment-tools"></div><div class="clear"></div><div id="comment-2824-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="2848"></span>

<div id="answer-container-2848" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-2848-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-2848-score" class="post-score" title="current number of votes">3</div><span id="post-2848-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="Stuart has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Those are packets used to ask a machine with a given IP address what it's NetBIOS name is. I think you're right to be suspicious; there's usually not much reason for a machine to ask for the NetBIOS name of random machines on the Internet, and, apparently, <a href="http://www.sans.org/security-resources/idfaq/port_137.php">there's a worm that looks for machines to infect, and it sends out NetBIOS NBSTAT packets</a>.</p><p>I'm not sure why they're being reported as coming from various random processes; if your machine is infected, it might be that a system DLL is infected, and programs using that DLL are calling infected routines that are sending out those packets. It might also be that the Resource Monitor is incorrectly reporting who's sending the packets.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>15 Mar '11, 16:38</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span></p></div></div><div id="comments-container-2848" class="comments-container"><span id="2852"></span><div id="comment-2852" class="comment"><div id="post-2852-score" class="comment-score">1</div><div class="comment-text"><p>Not all NBSTAT messages are send by worms looking for hosts to infect. We found the frames send by domain controllers freshly installed in an isolated networks. Another legitimate source could be a service monitoring network printers.</p><p>If the transaction ID in the NBSTAT message shows up as x1337 you are indeed in trouble: That would be the infamous nmap at work.</p></div><div id="comment-2852-info" class="comment-info"><span class="comment-age">(15 Mar '11, 17:12)</span> <span class="comment-user userinfo">packethunter</span></div></div><span id="2854"></span><div id="comment-2854" class="comment"><div id="post-2854-score" class="comment-score">2</div><div class="comment-text"><p>Yes, NetBIOS-over-TCP can go out over the Intertubes, because it runs atop IP. However, it's generally not sent out across the Atlantic Ocean; unless he's working for an international company with offices in Europe, and the machines in question have reasons to do, for example, SMB across the Atlantic to machines in Europe, those packets are a bit suspicious - I doubt any Windows domains set up in the office stretch across the ocean, or that machines in his office are monitoring printers in Europe, although I suppose it's not inconceivable.</p></div><div id="comment-2854-info" class="comment-info"><span class="comment-age">(15 Mar '11, 17:16)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="2855"></span><div id="comment-2855" class="comment"><div id="post-2855-score" class="comment-score">1</div><div class="comment-text"><p>If the destination addresses are not controlled by Stuart - even out in the Internet - he is in trouble.</p><p>I posted my answer under the assumption that source and destination belong to his network. Btw, I am aware of several Windows domains spanning the globe without proper definition of sites and a plethora of transatlantic NetBIOS.</p></div><div id="comment-2855-info" class="comment-info"><span class="comment-age">(15 Mar '11, 17:25)</span> <span class="comment-user userinfo">packethunter</span></div></div><span id="2870"></span><div id="comment-2870" class="comment"><div id="post-2870-score" class="comment-score"></div><div class="comment-text"><p>Guy has the right idea as these are packets headed from our work network in Canada to an unknown IP in Europe. The company I work for isn't a transatlantic company so there is no reason why my laptop should be contacting those IP addresses.</p><p>The other interesting thing that PacketHunter led me to look at was that the Transaction ID is running in increments of two. This is strange so at this stage I'm going to start looking for something either a) viral/wormy or b) rootkit like.</p><p>Thanks for the help.</p></div><div id="comment-2870-info" class="comment-info"><span class="comment-age">(16 Mar '11, 06:01)</span> <span class="comment-user userinfo">Stuart</span></div></div></div><div id="comment-tools-2848" class="comment-tools"></div><div class="clear"></div><div id="comment-2848-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="2851"></span>

<div id="answer-container-2851" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-2851-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-2851-score" class="post-score" title="current number of votes">0</div><span id="post-2851-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>The NBSTAT message is a message using the NetBIOS name services (nbns) running on UDP port 137. Typical nbns messages are host announcements "here I am, node WORKSTATION" or queries "who has the host name SERVER?"</p><p>In the nbns messages bytes 1-15 specify a hostname and byte 16 indicates a function. This is often a role like workstation or server, while more esoteric functions can also be found.</p><p>The NBSTAT message is an NBNS equivalent of "Introduce yourself". We found it as broadcast and unicast messages. Any computer supporting NBNS would answer with specific information like "I am node type B". Some NetBIOS implementations also add statistics about number good or bad frames send and received.</p><p>For a better diagnosis it would help to know, if NetBIOS name resolution is active on the systems sending the NBSTAT message.</p><hr /><p>If you do not expect European NBNS frames showing up in Canada you might want to check your router configuration:</p><p>If a Cisco router is acting as DHCP relay server (specified by the command "ip helper") the router will forward not only DHCP packets to the ip helper address, but also UDP ports 137, 138 and a few others.</p><p>Unix/Linux systems usually send an ICMP messages as reaction to these UDP messages, which can result in quite a waste of bandwidth. To stop the router from forwarding broadcast NBNS-packets to the DHCP server use the command "no ip forward-protocol udp 137".</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>15 Mar '11, 17:08</strong></p><img src="https://secure.gravatar.com/avatar/3b60e92020a427bb24332efc0b560943?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="packethunter&#39;s gravatar image" /><p><span>packethunter</span><br />
<span class="score" title="2137 reputation points"><span>2.1k</span></span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="48 badges"><span class="bronze">●</span><span class="badgecount">48</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="packethunter has 8 accepted answers">8%</span></p></div></div><div id="comments-container-2851" class="comments-container"><span id="2853"></span><div id="comment-2853" class="comment"><div id="post-2853-score" class="comment-score"></div><div class="comment-text"><p>Actually, those are coming <em>from</em> his machine in Canada <em>to</em> machines in Europe, not <em>from</em> Europe to Canada; it may be that his machine is sending them because it's infected.</p></div><div id="comment-2853-info" class="comment-info"><span class="comment-age">(15 Mar '11, 17:13)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div></div><div id="comment-tools-2851" class="comment-tools"></div><div class="clear"></div><div id="comment-2851-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

