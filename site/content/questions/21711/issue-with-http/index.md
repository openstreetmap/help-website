+++
type = "question"
title = "Issue with HTTP"
description = '''we are facing slowness issue with only one of our website . It is not opening any webpages.  When running Wireshark from client PC we see intial 3 way handshake is fine , but after that suddenly we are getting destination host unreachable and TCP-Out-of-order. 16 24.621544 192.168.1.10 10.150.0.40 T...'''
date = "2013-06-03T02:46:00Z"
lastmod = "2013-06-06T07:15:00Z"
weight = 21711
keywords = [ "http" ]
aliases = [ "/questions/21711" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Issue with HTTP](/questions/21711/issue-with-http)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-21711-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>we are facing slowness issue with only one of our website .</p><p>It is not opening any webpages.</p><p>When running Wireshark from client PC we see intial 3 way handshake is fine , but after that suddenly we are getting destination host unreachable and TCP-Out-of-order.</p><pre><code>16  24.621544   192.168.1.10    10.150.0.40 TCP 985 [TCP segment of a reassembled PDU]
17  24.621754   10.150.0.40 192.168.1.10    ICMP    81  Destination unreachable (Fragmentation needed)
18  24.621768   192.168.1.10    10.150.0.40 TCP 1457    [TCP Out-Of-Order] http &gt; 58765 [ACK] Seq=894 Ack=2394 Win=6773 Len=1366</code></pre></div><div id="question-tags" class="tags-container tags">http</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>03 Jun '13, 02:46</strong></p><img src="https://secure.gravatar.com/avatar/6615a61d69b703d89076bb0f18342bbf?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="m_1607&#39;s gravatar image" /><p>m_1607<br />
<span class="score" title="35 reputation points">35</span><span title="12 badges"><span class="badge1">●</span><span class="badgecount">12</span></span><span title="13 badges"><span class="silver">●</span><span class="badgecount">13</span></span><span title="16 badges"><span class="bronze">●</span><span class="badgecount">16</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="m_1607 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 03 Jun '13, 10:02</p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p>SYN-bit ♦♦<br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span></p></div></div><div id="comments-container-21711" class="comments-container"><span id="21713"></span><div id="comment-21713" class="comment"><div id="post-21713-score" class="comment-score"></div><div class="comment-text"><pre><code>17  24.621754 10.150.0.40   192.168.1.10 10 ICMP    81  Destination unreachable (Fragmentation needed)

18  24.621768  192.168.1.10 10  10.150.0.40      10 TCP 1457    [TCP Out-Of-Order] http &gt; 58765 [ACK] Seq=894 Ack=2394 Win=6773 Len=1366</code></pre></div><div id="comment-21713-info" class="comment-info"><span class="comment-age">(03 Jun '13, 04:19)</span> m_1607</div></div><span id="21737"></span><div id="comment-21737" class="comment"><div id="post-21737-score" class="comment-score"></div><div class="comment-text"><p>Could someone help me understand what does this error say.</p></div><div id="comment-21737-info" class="comment-info"><span class="comment-age">(04 Jun '13, 03:30)</span> m_1607</div></div></div><div id="comment-tools-21711" class="comment-tools"></div><div class="clear"></div><div id="comment-21711-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="21712"></span>

<div id="answer-container-21712" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-21712-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>The trace snippet indicates that PMTUD Path MTU discovery is occuring. The HTTP server tries to send a tcp payload of 1366 bytes and this obviously doesn't get through.</p><p>In the ICMP packet you will see the supported MTU size over the path. Normally, you should then see re-transmission occuring with a reduced ip.len and the web page should finally arrive at (be acknowleged by) the client. If this does not occur here, you could artificially reduce the MTU size at your (httpd) end to 1400 (which I suppose is what is being reported back).</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>03 Jun '13, 03:35</strong></p><img src="https://secure.gravatar.com/avatar/d6607c3aca20db751d019d8bbd2da893?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mrEEde2&#39;s gravatar image" /><p>mrEEde2<br />
<span class="score" title="336 reputation points">336</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="14 badges"><span class="bronze">●</span><span class="badgecount">14</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mrEEde2 has 5 accepted answers">20%</span></p></div></div><div id="comments-container-21712" class="comments-container"><span id="21738"></span><div id="comment-21738" class="comment"><div id="post-21738-score" class="comment-score"></div><div class="comment-text"><p>So You are saying we need to change MTU on HTTP server side firewall ?</p><p>makes me think why only one server affecetd by that.</p></div><div id="comment-21738-info" class="comment-info"><span class="comment-age">(04 Jun '13, 04:46)</span> m_1607</div></div><span id="21743"></span><div id="comment-21743" class="comment"><div id="post-21743-score" class="comment-score">1</div><div class="comment-text"><p>I assume that your firewall is not reducing the client's mss option in the syn packet when this server is the target. For your other servers it is probably adjusted. To prove this you need to capture the 3-way handshake to each server and compare the tcp options. Could you please upload your trace upto packet 18 to cloudshark? It is not clear to me why a tcp payload of 1366 bytes coud expand the ip packet to 1457 bytes...</p></div><div id="comment-21743-info" class="comment-info"><span class="comment-age">(04 Jun '13, 11:52)</span> mrEEde2</div></div><span id="21787"></span><div id="comment-21787" class="comment"><div id="post-21787-score" class="comment-score"></div><div class="comment-text"><pre><code>1   0.000000    00:00:00_00:00:00   00:00:00_00:00:00   Ethernet    188 Ethernet Unknown: Invalid length/type: 0x05ff (1535)
2   22.876067   10.150.0.40 192.168.1.10TCP 77  58765 &gt; http [SYN] Seq=0 Win=8192 Len=0 MSS=1460 WS=4 SACK_PERM=1
3   22.876086   192.168.1.10     10.150.0.40    TCP 103 http &gt; 58765 [SYN, ACK] Seq=0 Ack=1 Win=4380 Len=0 MSS=1460 WS=1 SACK_PERM=1
4   23.140692   10.150.0.40 192.168.1.10TCP 91  58765 &gt; http [ACK] Seq=1 Ack=1 Win=65700 Len=0
5   23.140788   10.150.0.40 192.168.1.10HTTP    630 GET /Pages/default.aspx HTTP/1.1 
6   23.140852   192.168.1.10    10.150.0.40 TCP 91  http &gt; 58765 [ACK] Seq=1 Ack=540 Win=4919 Len=0
7   23.145275   192.168.1.10     10.150.0.40    HTTP    385 HTTP/1.1 401 Unauthorized 
8   23.422818   10.150.0.40 192.168.1.10HTTP    708 GET /Pages/default.aspx HTTP/1.1 , NTLMSSP_NEGOTIATE
9   23.422862   192.168.1.10     10.150.0.40    TCP 91  http &gt; 58765 [ACK] Seq=295 Ack=1157 Win=5536 Len=0
10  23.425676   192.168.1.10      10.150.0.40   HTTP    690 HTTP/1.1 401 Unauthorized , NTLMSSP_CHALLENGE
11  23.697484   10.150.0.40 192.168.1.10HTTP    1328    GET /Pages/default.aspx HTTP/1.1 , NTLMSSP_AUTH, User: \mandar.kulkarni
12  23.697529   192.168.1.10    10.150.0.40 TCP 91  http &gt; 58765 [ACK] Seq=894 Ack=2394 Win=6773 Len=0
13  24.621214   192.168.1.10     10.150.0.40    TCP 1551    [TCP segment of a reassembled PDU]
17  24.621754   10.150.0.40 192.168.1.10ICMP    81  Destination unreachable (Fragmentation needed)
18  24.621768   192.168.1.10     10.150.0.40    TCP 1457    [TCP Out-Of-Order] http &gt; 58765 [ACK] Seq=894 Ack=2394 Win=6773 Len=1366
19  24.621772   192.168.1.10      10.150.0.40   TCP 185 [TCP Out-Of-Order] [TCP segment of a reassembled PDU]</code></pre></div><div id="comment-21787-info" class="comment-info"><span class="comment-age">(05 Jun '13, 22:32)</span> m_1607</div></div><span id="21791"></span><div id="comment-21791" class="comment"><div id="post-21791-score" class="comment-score"></div><div class="comment-text"><p>please help isolate issue</p></div><div id="comment-21791-info" class="comment-info"><span class="comment-age">(06 Jun '13, 03:14)</span> m_1607</div></div><span id="21793"></span><div id="comment-21793" class="comment"><div id="post-21793-score" class="comment-score"></div><div class="comment-text"><p>Just take a look at the dest. unreachable packet in frame 17, unfold the ICMP Header there you will find the needed MTU inside the ICMP message. Why the sender is sending too big packets is then on your side to find out. Check the MTU settings first</p></div><div id="comment-21793-info" class="comment-info"><span class="comment-age">(06 Jun '13, 04:02)</span> Landi</div></div><span id="21794"></span><div id="comment-21794" class="comment not_top_scorer"><div id="post-21794-score" class="comment-score"></div><div class="comment-text"><p>I Need to check MTU settings on client side firewall right ?</p><p>Internet Control Message Protocol Type: 3 (Destination unreachable) Code: 4 (Fragmentation needed) Checksum: 0x3b4f [correct] MTU of next hop: 1446</p><p>Flags: 0x02 (Don't Fragment) 0... .... = Reserved bit: Not set .1.. .... = Don't fragment: Set .1.. .... = Don't fragment: Set</p></div><div id="comment-21794-info" class="comment-info"><span class="comment-age">(06 Jun '13, 04:33)</span> m_1607</div></div><span id="21796"></span><div id="comment-21796" class="comment not_top_scorer"><div id="post-21796-score" class="comment-score"></div><div class="comment-text"><p>When there's a firewall in between maybe -&gt; "MTU of next hop: 1446" seen inside the ICMP packet tells you exactly what the MTU in this case is. The SYN from the client says MSS=1460 so MTU 1500 -&gt; doesn't match the 1446 MTU from the dest. unreachable message, so some device inbetween does improper MSS overwrite.</p><p>In any case 1551 Bytes in frame 13 is too big for either MTU -&gt; check why the size is that big and if it really is coming from 192.168.1.10 with that size originally</p></div><div id="comment-21796-info" class="comment-info"><span class="comment-age">(06 Jun '13, 05:30)</span> Landi</div></div><span id="21797"></span><div id="comment-21797" class="comment not_top_scorer"><div id="post-21797-score" class="comment-score"></div><div class="comment-text"><p>Thanks Landi for your help.</p><p>How can we check where does exactly this MTU issue is there, i mean how can we find IP of that device or location of device.</p></div><div id="comment-21797-info" class="comment-info"><span class="comment-age">(06 Jun '13, 06:04)</span> m_1607</div></div><span id="21798"></span><div id="comment-21798" class="comment not_top_scorer"><div id="post-21798-score" class="comment-score"></div><div class="comment-text"><p>Bad answer: Check the path and find the device altering MSS values in the SYN packets and/or adding bytes to the data packet. If you can get a tracefile from 192.168.1.10 I'd start there and compare SYN packet values and frame sizes. If you see badly advertised MSS values there start with routers/firewalls to see which device alters</p></div><div id="comment-21798-info" class="comment-info"><span class="comment-age">(06 Jun '13, 06:15)</span> Landi</div></div><span id="21805"></span><div id="comment-21805" class="comment not_top_scorer"><div id="post-21805-score" class="comment-score"></div><div class="comment-text"><p>The incoming SYN from the client still carries the original MSS 1460, which means no device has adjusted the MSS in flight, which should have been done if a VPN Tunnel is involved as per the discussion in <a href="http://ask.wireshark.org/questions/20633/tcp-mss-inconsistency-in-different-capture-points">http://ask.wireshark.org/questions/20633/tcp-mss-inconsistency-in-different-capture-points</a> It would help to see the original .pcap file...</p></div><div id="comment-21805-info" class="comment-info"><span class="comment-age">(06 Jun '13, 09:22)</span> mrEEde2</div></div></div><div id="comment-tools-21712" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-21712-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="21799"></span>

<div id="answer-container-21799" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-21799-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Interesting packets, however, it would be much easier to help you if you uploaded the pcap file somewhere (for example to www.cloudshark.org and assuming there is no sensitive data in the pcap file).</p><p>A few things that really stand out from the pasted wireshark output:</p><ol><li>You say the capture was made on the client, this can not be true as the delta time between SYN and SYN/ACK is 0,021ms while the delta between the SYN/ACK and the ACK is ~264ms. The trace must have been made on the server.</li><li>For 1366 TCP payload there is a 1457 byte packet, which results in 91 bytes of headers. 20 for IP, 20 for TCP (no IP or TCP options seem present as the MSS is 1460 in the initial SYN and SYN/ACK). What protocols are used before IP in your case that make up for the other 51 bytes?</li><li>Because of NTLM authentication there are a few round trips lost to authentication (between frame 7 and 8 and between frame 10 and 11).</li><li>The server response time is ~924ms (see delta between frame 12 and 13)</li><li>The delta between sending the first server response packet and the icmp unreachable packet is 0,540ms. The icmp unreachable packet is coming from the same IP as the client. This means it is not the client address but a NAT address for the client and a link between the natting device (10.150.0.40) and the client is using a lower MTU size (94 bytes smaller).</li></ol><p>After frame 19, a normal TCP transfer should occur.</p><p>In short:</p><ul><li>~260ms delay due to high RTT</li><li>~540ms delay due to high RTT and authentication</li><li>~920ms delay due to high server response time</li></ul><p>Apart from that, all seems normal at the TCP level, but I'm curious about the protocols used below the IP layer.</p><p>EDIT: As @mrEEde2 is pointing out, it would be best practice for a VPN device to alter the TCP MSS to prevent the extra step caused by the ICMP fragmentation needed.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>06 Jun '13, 07:15</strong></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p>SYN-bit ♦♦<br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SYN-bit has 174 accepted answers">20%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 06 Jun '13, 09:46</p></div></div><div id="comments-container-21799" class="comments-container"><span id="21800"></span><div id="comment-21800" class="comment"><div id="post-21800-score" class="comment-score"></div><div class="comment-text"><p>Oh, one more thing. If nagle is enabled on 192.168.1.10 and delayed acking is enabled on the client, you might be in more trouble as 192.168.1.10 seems to be splitting the full size frames into two parts due to the PMTUD. If it continues doing so, it will result is a very slow transfer as there will be a RTT delay + 100ms (or 200ms) delayed ack timer delay for each full size packet that the server sends.</p><p>Again, having a pcap file with the whole transfer would really help in telling what exactly is going on.</p></div><div id="comment-21800-info" class="comment-info"><span class="comment-age">(06 Jun '13, 07:26)</span> SYN-bit ♦♦</div></div><span id="21905"></span><div id="comment-21905" class="comment"><div id="post-21905-score" class="comment-score"></div><div class="comment-text"><p>One doubt when I do tracepath from router of one location to webserver i see different PMTU , whereas when I do same from router of 2nd location I see PMTU as different.</p><p>why is it like that ?</p></div><div id="comment-21905-info" class="comment-info"><span class="comment-age">(10 Jun '13, 21:58)</span> m_1607</div></div></div><div id="comment-tools-21799" class="comment-tools"></div><div class="clear"></div><div id="comment-21799-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

