+++
type = "question"
title = "RST Packets with zero window length"
description = '''Hi All, i have a tcpdump. in that there are many rst packets send from host .26 with win = 0. i want to know whether it points to some problem existing in the .26 server application like max process reached or problem in tcp receiver. My .199 server was not able to receive traffic from .26 I want to...'''
date = "2017-10-22T00:51:00Z"
lastmod = "2017-10-22T07:35:00Z"
weight = 64076
keywords = [ "rst", "length", "window", "zero", "in" ]
aliases = [ "/questions/64076" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [RST Packets with zero window length](/questions/64076/rst-packets-with-zero-window-length)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-64076-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-64076-score" class="post-score" title="current number of votes">0</div><span id="post-64076-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi All,</p><p>i have a tcpdump. in that there are many rst packets send from host .26 with win = 0. i want to know whether it points to some problem existing in the .26 server application like max process reached or problem in tcp receiver. My .199 server was not able to receive traffic from .26 I want to know was there any issue with .26 server.</p><p>This dump was captured in 10.5.207.199 server. We need to analyze traffic b/w 10.5.220.26 and 10.5.207.199. This was a past problem and i am digging to get the RCA for failures. Presently no problems encountered.</p><p>Issue is:</p><ol><li>requests getting failed from/to 10.5.207.199 server received from 10.5.220.26</li><li>very less number of requests received from 10.5.220.26.</li></ol><p>I can see RST packets sent from 10.5.220.26 server. There are two types of RST packets sent.</p><ol><li>One with valid window length value.</li><li>And other with zero window length value.</li></ol><p>I feel valid window length value RST packets are not a problem. But RST packets sent with zero window lenght points to problem in 10.5.220.26 application. Zero window length indicates max process reached or problem in tcp receiver. That is the machine is busy or cannot accept any more traffic from other host. This may lead to delays or connection problems.</p><p>I need confirmation that this thinking is right and there was problem in 10.5.220.26 server. Please confirm.</p><p>I can see source machine ip as 10.5.220.26 in the tcpdump sending RST messages.</p><p>The tcpdump file is <a href="https://www.cloudshark.org/captures/d706cd5c3906">available at Cloudhshark</a>.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-rst" rel="tag" title="see questions tagged &#39;rst&#39;">rst</span> <span class="post-tag tag-link-length" rel="tag" title="see questions tagged &#39;length&#39;">length</span> <span class="post-tag tag-link-window" rel="tag" title="see questions tagged &#39;window&#39;">window</span> <span class="post-tag tag-link-zero" rel="tag" title="see questions tagged &#39;zero&#39;">zero</span> <span class="post-tag tag-link-in" rel="tag" title="see questions tagged &#39;in&#39;">in</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>22 Oct '17, 00:51</strong></p><img src="https://secure.gravatar.com/avatar/0387c0e9069cbcbf89455ca9f8bd2f15?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="HARPREET&#39;s gravatar image" /><p><span>HARPREET</span><br />
<span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="HARPREET has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>22 Oct '17, 03:33</strong> </span></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span></p></div></div><div id="comments-container-64076" class="comments-container"></div><div id="comment-tools-64076" class="comment-tools"></div><div class="clear"></div><div id="comment-64076-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="64086"></span>

<div id="answer-container-64086" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-64086-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-64086-score" class="post-score" title="current number of votes">0</div><span id="post-64086-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>My conclusion would be that the RST packets with zero window length are <em>not</em> a symptom of overload of the .26 machine.</p><p>Use the following display filter:</p><p><code>tcp.flags.reset == 1 and tcp.window_size == 0 and ip.addr == 10.5.220.26 and tcp.seq &gt; 2</code></p><p>This will show you only RST packets which aren't the only ones belonging to their TCP session in the capture and where the client-&gt;server data of the session are present in the capture, so you have a chance to see what had happened in their respective sessions before the RST packets came.</p><p>Now find sessions where the <code>tcp.seq</code> in the RST packet is below 3000. These seem to be conversations where both the SOAP request and response have been captured and where only a single session over a given socket pair has been captured; where the <code>tcp.seq</code> in the RST packet is much higher, you'll see that the socket pair has been reused.</p><p>Now find the <code>tcp.stream</code> value for any of them (e.g., 85) and use this value to show the whole stream, using a display filter <code>tcp.stream == 85</code>.</p><p>You'll see an almost normal exchange - the client sets up the session and sends a SOAP request, and it sends a FIN after it receives an ACK for the last segment of the request, indicating that it is not going to send anything else using this session. What is strange is that the client (.26) sends the packet with FIN exactly 10 seconds after getting an ACK to the last segment of the request, and that the server (.199) doesn't start sending the response until it receives that FIN from the client.</p><p>After the server (.199) finishes sending its response, it sends its own FIN. Normally, the client should send an ACK to that FIN and the session would be completely closed. Instead, it sends a RST (with window size = 0, but that's not important because the server has already sent FIN so it is not going to send data any more). That may be a way to avoid the tcp wait state which normally follows peaceful closure of a TCP session to provide a guard period to avoid confusion of packets belonging to two distinct TCP sessions using the same socket pair.</p><p>If you filter using <code>tcp.stream == 73</code>, you'll see a slightly different picture (several SOAP requests and responses in a single TCP session) but still with the 10 seconds gap before the client sends its FIN and still with the client responding with RST to server's FIN.</p><p>Why I don't think that the RST with window size 0 indicates an overload of .26:</p><ul><li>because the .26 sends window size 0 after receiving FIN from the opposite end so it is actually irrelevant,</li><li>because the .26 is a client in the sessions so if it would be overloaded, it would stop opening new sessions at first place.</li></ul><p>On the other hand, I do admit that the capture contains also cases where, in an otherwise same pattern, the window size in client's RST is different from 0.</p><p>The 10 second gap before sending the FIN seems to be a guard period for eventual other requests to come from the application. What is strange is that although the last segment of the request bears a PSH flag, the server does not respond immediately but only after receiving the FIN flag. This is only the case for the last request in the session, so maybe it is related to the particular type of that request?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>22 Oct '17, 05:21</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span></p></div></div><div id="comments-container-64086" class="comments-container"><span id="64089"></span><div id="comment-64089" class="comment"><div id="post-64089-score" class="comment-score"></div><div class="comment-text"><p>so it seems everything is normal, there r tcp and http sessions formed. data is exchanged b/w 26 and 199 server. I have also raised this towards my application side that is some problem in 199 server application. as I saw some Oracle errors in this tcpdump. but I also got "possible syn flooding at Port 44006. check snmp counters." messages in my 199 server so was concerned that some client is creating problems. wht do you think is there any client which sends delayed ayk messages after receiving syn ayk messages from server 199?</p></div><div id="comment-64089-info" class="comment-info"><span class="comment-age">(22 Oct '17, 06:49)</span> <span class="comment-user userinfo">HARPREET</span></div></div><span id="64093"></span><div id="comment-64093" class="comment"><div id="post-64093-score" class="comment-score"></div><div class="comment-text"><p>Answering that additional question in detail might require some programming (using MATE or Lua) to add meta-fields to the sessions' packets, allowing to use display filtering to highlight unusual sessions. However, a display filter <code>tcp.analysis.reused_ports</code> is enough to highlight some cases.</p><p>Use display filter <code>tcp.port == 43239</code> to show one of them. The client sends a SYN packet (note that in this capture the very first one is lost), but the server responds with an ACK with totally unrelated <code>tcp.ack</code> number (look at absolute seq/ack numbering), most likely because it still considers the received SYN packet to be part of the previous session established from the same ephemeral port at client side. Consequently the client sends a RST because the received <code>tcp.ack</code> value is inacceptable for it.</p><p>I belive the root cause is the incompatibility between the client's idea that sending a RST in response to server's FIN will clear the TIME_WAIT state at server side and server's moving the session to TIME_WAIT state anyway. You can see that sooner or later the server does accept the next SYN from the same client port and answers it with a matching <code>tcp.ack</code>, making the client continue the session normally.</p><p>I'm not an expert on tcp session closure so I don't know which one of the two approaches to RST after second FIN is right. However, it seems that the rate of tcp sessions opening from .26 to .199 per unit of time is higher than the number of available ephemeral ports divided by the 120 seconds of (typical) TIME_WAIT duration.</p><ul><li>Reducing TIME_WAIT duration at server side may seem the most straightforward solution but it may be dangerous if some clients connect via lossy paths with large transmission delays.</li><li>Binding additional instances of the server application to several other ports than 44006 and letting the client distribute the load among them might be a better approach.</li><li>As for me, the best approach would be not to close the already established TCP sessions and reuse them for multiple request-response exchanges, but I don't know whether SOAP doesn't use the TCP session as a context linking together related requests.</li></ul></div><div id="comment-64093-info" class="comment-info"><span class="comment-age">(22 Oct '17, 07:35)</span> <span class="comment-user userinfo">sindy</span></div></div></div><div id="comment-tools-64086" class="comment-tools"></div><div class="clear"></div><div id="comment-64086-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

