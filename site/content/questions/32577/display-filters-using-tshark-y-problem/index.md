+++
type = "question"
title = "Display filters using (tshark -Y) problem"
description = '''Hello!   This command works correctly: &quot;C:&#92;Program Files&#92;Wireshark&#92;tshark.exe&quot; -Y &quot;gsm_sms.sms_text contains &quot;test&quot;&quot; -r &quot;F:&#92;Temp&#92;pcapfile&quot; -w &quot;F:&#92;Temp&#92;resultfile.pcap&quot;   This command doesn&#x27;t work (tshark: &quot;&#x27;&quot; was unexpected in this context.): &quot;C:&#92;Program Files&#92;Wireshark&#92;tshark.exe&quot; -Y &quot;gsm_sms.sms_t...'''
date = "2014-05-06T21:59:00Z"
lastmod = "2014-05-08T07:02:00Z"
weight = 32577
keywords = [ "filter", "-y", "tshark", "display" ]
aliases = [ "/questions/32577" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [Display filters using (tshark -Y) problem](/questions/32577/display-filters-using-tshark-y-problem)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-32577-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-32577-score" class="post-score" title="current number of votes">0</div><span id="post-32577-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello!</p><ol><li><p>This command works correctly:</p><p><code>"C:\Program Files\Wireshark\tshark.exe" -Y "gsm_sms.sms_text contains "test"" -r "F:\Temp\pcapfile" -w "F:\Temp\resultfile.pcap"</code></p></li><li><p>This command doesn't work (tshark: "'" was unexpected in this context.):</p><p><code>"C:\Program Files\Wireshark\tshark.exe" -Y "gsm_sms.sms_text contains "тест"" -r "F:\Temp\pcapfile" -w "F:\Temp\resultfile.pcap"</code></p></li></ol><p>There is just 1 difference: display filter contains field "test" (English text) or field "тест" (Russian text).</p><p>How can I fix it? Wireshark (not tshark) handles both display filters properly.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-filter" rel="tag" title="see questions tagged &#39;filter&#39;">filter</span> <span class="post-tag tag-link--y" rel="tag" title="see questions tagged &#39;-y&#39;">-y</span> <span class="post-tag tag-link-tshark" rel="tag" title="see questions tagged &#39;tshark&#39;">tshark</span> <span class="post-tag tag-link-display" rel="tag" title="see questions tagged &#39;display&#39;">display</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>06 May '14, 21:59</strong></p><img src="https://secure.gravatar.com/avatar/d7ebdfa64a88154cd163c7cc781e4315?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="factorial&#39;s gravatar image" /><p><span>factorial</span><br />
<span class="score" title="26 reputation points">26</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="factorial has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>07 May '14, 07:26</strong> </span></p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p><span>cmaynard ♦♦</span><br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span></p></div></div><div id="comments-container-32577" class="comments-container"></div><div id="comment-tools-32577" class="comment-tools"></div><div class="clear"></div><div id="comment-32577-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="32602"></span>

<div id="answer-container-32602" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-32602-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-32602-score" class="post-score" title="current number of votes">1</div><span id="post-32602-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="factorial has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I'm not sure if this will work or not, but you could try specifying the hex bytes instead of the text.</p><p>For example, instead of <code>-Y "gsm_sms.sms_text contains "test""</code>, you could write, <code>-Y "gsm_sms.sms_text contains 74:65:73:74"</code>.</p><p>I'm not sure if this is correct, but instead of <code>-Y "gsm_sms.sms_text contains "тест""</code> you could try <code>-Y "gsm_sms.sms_text contains d1:82:d0:b5:d1:81:d1:82"</code> ... at least those are the bytes that show up when I dump <code>тест</code> into a text file and run <code>hexdump</code> on it.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>07 May '14, 07:56</strong></p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p><span>cmaynard ♦♦</span><br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="cmaynard has 108 accepted answers">20%</span></p></div></div><div id="comments-container-32602" class="comments-container"><span id="32604"></span><div id="comment-32604" class="comment"><div id="post-32604-score" class="comment-score">1</div><div class="comment-text"><p>Looks like a Unicode issue, is it that the Russian text is a multibyte-character string and your cmd shell isn't handling that?</p></div><div id="comment-32604-info" class="comment-info"><span class="comment-age">(07 May '14, 08:22)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="32605"></span><div id="comment-32605" class="comment"><div id="post-32605-score" class="comment-score"></div><div class="comment-text"><p>I didn't know about this opportunity. What's the conception of conversion text to hex and vise versa? I'll try your advice tomorrow and report result.</p></div><div id="comment-32605-info" class="comment-info"><span class="comment-age">(07 May '14, 08:29)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32607"></span><div id="comment-32607" class="comment"><div id="post-32607-score" class="comment-score"></div><div class="comment-text"><p><em>What's the conception of conversion text to hex and vise versa?</em></p><p>Sorry, but I'm not sure I understand your question.</p></div><div id="comment-32607-info" class="comment-info"><span class="comment-age">(07 May '14, 08:33)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="32608"></span><div id="comment-32608" class="comment"><div id="post-32608-score" class="comment-score"></div><div class="comment-text"><p><em>Sorry, but I'm not sure I understand your question.</em> No, It's my guilt. English isn't native language for me. Sorry:) I'd like to know how did you obtain 74:65:73:74 from "test" and d1:82:d0:b5:d1:81:d1:82 from "тест"?</p><p><em>Looks like a Unicode issue, the Russian text is a multibyte-character string and your cmd shell isn't handling that.</em> I also thinked about it. But I couldn't find solutions in Internet. Do you have any advices?</p></div><div id="comment-32608-info" class="comment-info"><span class="comment-age">(07 May '14, 08:59)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32609"></span><div id="comment-32609" class="comment"><div id="post-32609-score" class="comment-score"></div><div class="comment-text"><p>"test" is the four ASCII characters with values 0x74, 0x65, 0x73, 0x74. Using the method described in the answer <span>@cmaynard</span> found the Russian text to be the bytes he describes.</p><p>A further complication is how the Russian text is encoded in the packet you are looking at. Do you know the encoding used?</p></div><div id="comment-32609-info" class="comment-info"><span class="comment-age">(07 May '14, 09:11)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="32611"></span><div id="comment-32611" class="comment not_top_scorer"><div id="post-32611-score" class="comment-score"></div><div class="comment-text"><p><em>Do you know the encoding used?</em> UCS-2. May be I can use format of command sort of tshark ... -Y "gsm_sms.sms_text contains ASCII="test"" or tshark ... -Y "gsm_sms.sms_text contains UCS-2="test""?</p></div><div id="comment-32611-info" class="comment-info"><span class="comment-age">(07 May '14, 10:02)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32616"></span><div id="comment-32616" class="comment not_top_scorer"><div id="post-32616-score" class="comment-score"></div><div class="comment-text"><p>if the data in the packet is in UCS-2, then you could determine the UCS-2 codepoints for your Russian characters and then use those as the set of bytes to search for.</p></div><div id="comment-32616-info" class="comment-info"><span class="comment-age">(07 May '14, 12:56)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="32629"></span><div id="comment-32629" class="comment not_top_scorer"><div id="post-32629-score" class="comment-score"></div><div class="comment-text"><p>I've checked tshark -Y "gsm_sms.sms_text contains 74:65:73:74" and -Y "gsm_sms.sms_text contains d1:82:d0:b5:d1:81:d1:82". It works properly. Now I understand how ascii code 74:65:73:74 was obtained. But I can't understand how "тест" was converted to d1:82:d0:b5:d1:81:d1:82. UCS2 is a format that used for coding sms-messages. And I suppose that Wireshark decodes it and saves field "gsm_sms.sms_text" in other code sheme, because in UCS2 "тест" is 442:435:441:442 and it dosn't work. Christopher, explain me, please, how d1:82:d0:b5:d1:81:d1:82 was obtained from "тест"?</p></div><div id="comment-32629-info" class="comment-info"><span class="comment-age">(07 May '14, 18:52)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32632"></span><div id="comment-32632" class="comment not_top_scorer"><div id="post-32632-score" class="comment-score"></div><div class="comment-text"><p>Answering my own question. d1:82:d0:b5:d1:81:d1:82 is obtained from "тест" with the aid UTF-8 for CP1251 coding scheme.</p></div><div id="comment-32632-info" class="comment-info"><span class="comment-age">(07 May '14, 20:58)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32633"></span><div id="comment-32633" class="comment not_top_scorer"><div id="post-32633-score" class="comment-score"></div><div class="comment-text"><p>Ok, there is operating (suitable) solution - to use an HEX-form of text-field in gsm_sms.sms_text-filter. It isn't comfortably, but anyway I'll be able to write convertor to use in script. Thanks to Christopher and Graham!</p></div><div id="comment-32633-info" class="comment-info"><span class="comment-age">(07 May '14, 21:08)</span> <span class="comment-user userinfo">factorial</span></div></div><span id="32641"></span><div id="comment-32641" class="comment not_top_scorer"><div id="post-32641-score" class="comment-score"></div><div class="comment-text"><p>Well, there might be an easier way, but I'm glad you've found at least 1 solution. Instead of searching for hex bytes though, maybe you could switch code pages first beforehand, perhaps via <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/chcp.mspx?mfr=true">chcp.com</a> or something like it? Could you post a small capture file to <a href="https://appliance.cloudshark.org/upload/">cloudshark</a>, one that contains the <code>тест</code> text? I'm curious if it'll work in my console, with codepage 437.</p></div><div id="comment-32641-info" class="comment-info"><span class="comment-age">(08 May '14, 07:02)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div></div><div id="comment-tools-32602" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-32602-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

