+++
type = "question"
title = "WIRETAP Reading file?"
description = '''Hi I am trying to find the packet filled file(which libpcap format packet finally dumped for wiretap) from where wiretap is taking and giving to wireshark but didint found, can you guys help me to find out but didnt find it,can you guys help me to get me out. I found the wtap_open_offline(where wire...'''
date = "2015-05-27T06:36:00Z"
lastmod = "2015-05-31T14:30:00Z"
weight = 42698
keywords = [ "wiretap", "feeding" ]
aliases = [ "/questions/42698" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [WIRETAP Reading file?](/questions/42698/wiretap-reading-file)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-42698-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi I am trying to find the packet filled file(which libpcap format packet finally dumped for wiretap) from where wiretap is taking and giving to wireshark but didint found, can you guys help me to find out but didnt find it,can you guys help me to get me out.</p><p>I found the wtap_open_offline(where wiretap is opening the file and doing some wiretap reading ops).But not able to find the file.</p><p>Thanks, Karun.</p></div><div id="question-tags" class="tags-container tags">wiretap feeding</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 May '15, 06:36</strong></p><img src="https://secure.gravatar.com/avatar/50c4b78862c6ca806916c3a71498cdf3?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="karun256&#39;s gravatar image" /><p>karun256<br />
<span class="score" title="6 reputation points">6</span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="karun256 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 27 May '15, 06:43</p></div></div><div id="comments-container-42698" class="comments-container"></div><div id="comment-tools-42698" class="comment-tools"></div><div class="clear"></div><div id="comment-42698-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="42707"></span>

<div id="answer-container-42707" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-42707-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>libpcap.c for libpcap files and pcapng.c for pcap-ng files</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 May '15, 08:33</strong></p><img src="https://secure.gravatar.com/avatar/2d3d425a7a829209431fb38d326b53af?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Anders&#39;s gravatar image" /><p>Anders ♦<br />
<span class="score" title="4578 reputation points"><span>4.6k</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="52 badges"><span class="bronze">●</span><span class="badgecount">52</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Anders has 56 accepted answers">17%</span></p></div></div><div id="comments-container-42707" class="comments-container"><span id="42715"></span><div id="comment-42715" class="comment"><div id="post-42715-score" class="comment-score"></div><div class="comment-text"><p>Thanks Anders,in text2pcap.c we are preparing the libpcap format(Global header,Record header,data,Record header,data ...) right? In that line 1854 we are opening a file in read mode,from where we are getting this file to read and from where this argc &amp; argv are coming(who is running this .c file with command line arguments).Actually i want to see that file by opening it.</p><p>Similarly in capinfos.c we are opening that file and preparing wtap structure by reading that file in function wtap_open_offline() in which first argument is file.I want to know where its taking that file</p><p>Actually i want to create packet to display on wireshark,so my plan is that i want to mimic my packet as it is like libpcap format and want to give to wiretap so that wiretap will display the packet in wireshark.So i want to see the packet that libpcap is preparing for wiretap.</p><p>Exactly i want to know where we are feeding this packet to wiretap.</p><pre><code>    Correct me if am wrong.</code></pre><p>Thanks, Karun.</p></div><div id="comment-42715-info" class="comment-info"><span class="comment-age">(27 May '15, 21:54)</span> karun256</div></div><span id="42717"></span><div id="comment-42717" class="comment"><div id="post-42717-score" class="comment-score"></div><div class="comment-text"><p>This might be better to discuss on the dev mailing list rather tha on a Q&amp;A site...</p><p>I think we need to understand what you are trying to do on a higer level to be able to asnswer your questions better.</p><blockquote><p>Actually i want to create packet to display on wireshark</p></blockquote><p>What do you mean by this? Fire up wireshark from within your application and feed it the data? Create a pcap(ng) file and read that into wireshark afterwards? Perhaps you could feed the data to wireshak trough a pipe or have tshark deissect it and present the text output? Create a packet from what? If you are processing a log file with mixed text and packet hexdata you could perhaps write code to have Wireshark read the file directly.</p></div><div id="comment-42717-info" class="comment-info"><span class="comment-age">(28 May '15, 00:56)</span> Anders ♦</div></div><span id="42720"></span><div id="comment-42720" class="comment"><div id="post-42720-score" class="comment-score"></div><div class="comment-text"><p>Exactly i want to create packet from my application and feed the data inorder to display in wireshark.I had taken development release 1.99.5 for windows 7. My intension is to prepare my packet and keep it in winpcap format and feed it to wiretap(rest will take care by wiretap right?).</p></div><div id="comment-42720-info" class="comment-info"><span class="comment-age">(28 May '15, 02:58)</span> karun256</div></div><span id="42721"></span><div id="comment-42721" class="comment"><div id="post-42721-score" class="comment-score"></div><div class="comment-text"><p>You should maybe look into extcap. That allows applications that aren't a "network interface" to send data to Wireshark.</p><p>Unfortunately extcap is very poorly documented at the moment. There should be a man page (extcap.html) for it in an installed copy of the dev release and an example application in source doc\extcap_example.py. There is als an older SharkFest presentation <a href="https://sharkfest.wireshark.org/sharkfest.13/presentations/NAP-11_Expanding-Wireshark-Beyond-Ethernet-and-Network-Interfaces_Kershaw-Ryan.pdf">here</a>.</p><p>If you need more info about extcap the best place to ask would be on the Wireshark developers mailing list.</p></div><div id="comment-42721-info" class="comment-info"><span class="comment-age">(28 May '15, 03:44)</span> grahamb ♦</div></div><span id="42725"></span><div id="comment-42725" class="comment"><div id="post-42725-score" class="comment-score"></div><div class="comment-text"><p>Thanks grahamb, can you share me the developers mailing list.Actually is it possible as i discussed in my previous mail,will it works? other than extcap.</p></div><div id="comment-42725-info" class="comment-info"><span class="comment-age">(28 May '15, 03:54)</span> karun256</div></div><span id="42727"></span><div id="comment-42727" class="comment not_top_scorer"><div id="post-42727-score" class="comment-score"></div><div class="comment-text"><p><a href="https://www.wireshark.org/lists/">https://www.wireshark.org/lists/</a></p><p>Wireshark can read from pipes, so it might be possible for your application to create a pipe that Wireshark can read from, but there are difficulties in the Wireshark UI for selecting the pipe. This is what extcap is designed to overcome.</p></div><div id="comment-42727-info" class="comment-info"><span class="comment-age">(28 May '15, 04:53)</span> grahamb ♦</div></div><span id="42729"></span><div id="comment-42729" class="comment not_top_scorer"><div id="post-42729-score" class="comment-score"></div><div class="comment-text"><blockquote><p>...feed it to wiretap(rest will take care by wiretap right?).</p></blockquote><p>No, Wireshark uses wiretap to read from files as I understand your idea you need to invoke Wireshark to read your packet somehow or at least invoke the dissection engine from your program which may not de so easy as it's not designed to work that way.</p></div><div id="comment-42729-info" class="comment-info"><span class="comment-age">(28 May '15, 05:04)</span> Anders ♦</div></div><span id="42771"></span><div id="comment-42771" class="comment not_top_scorer"><div id="post-42771-score" class="comment-score"></div><div class="comment-text"><p>Thanks Anders,Dumpcap.c is n/w traffic dump tool which will capture packets form real interface and keep it in some output file stream(ASCII hex form).text2pcap.c is the file which converts the ascii hex into winpcap(windows)/libpcap(Linux) format.wireshark uses wiretap to read the above prepared winpcap format file.correct me if my understanding is wrong.</p><p>wireshark&lt;---wiretap&lt;---libpcap/winpcap(text2pcap.c)&lt;---dumpcap.c&lt;---n/w intf.</p><pre><code>  Is my above understanding is right?</code></pre><p>Whats the functionality of capinfos.c and who is giving argv,argc to that file,as its using argc ,argv and preparing wtap structure.</p></div><div id="comment-42771-info" class="comment-info"><span class="comment-age">(31 May '15, 02:47)</span> karun256</div></div></div><div id="comment-tools-42707" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-42707-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="42777"></span>

<div id="answer-container-42777" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-42777-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>Dumpcap.c is n/w traffic dump tool which will capture packets form real interface and keep it in some output file stream(ASCII hex form).text2pcap.c is the file which converts the ascii hex into winpcap(windows)/libpcap(Linux) format.wireshark uses wiretap to read the above prepared winpcap format file.correct me if my understanding is wrong. wireshark&lt;---wiretap&lt;---libpcap/winpcap(text2pcap.c)&lt;---dumpcap.c&lt;---n/w intf.</p></blockquote><p>Your understanding is wrong.</p><p>Dumpcap uses libpcap to capture packets, meaning that the packets are read from the network interface by libpcap and handed to dumpcap,</p><p>Those packets are in <em>binary</em> form, not text form.</p><p>Dumpcap then writes the packets to a pcap or pcap-ng file, in <em>binary</em> format; it's all binary, so text2pcap is not involved <em>at all</em>. It writes them out using Wireshark's own code, not libpcap/WinPcap (which currently can't write pcap-ng files). That code is in pcapio.c</p><p>Wireshark (or TShark) then reads from the same file, using Wiretap.</p><p>So it's more like</p><p>Network interface ---&gt;dumpcap---&gt;pcapio.c---&gt;{the capture file}---&gt;wiretap---&gt;Wireshark</p><p>text2pcap is a <em>separate</em> program, which is used to turn ASCII hex dump files, which usually come from sources <em>other</em> than Wireshark, into pcap files. It is <em>not at all</em> involved in the packet capture process.</p><blockquote><p>Whats the functionality of capinfos.c</p></blockquote><p>It reads capture files and prints some summary data for it.</p><blockquote><p>who is giving argv,argc to that file</p></blockquote><p>The program that runs it, whether it's the command-line interpreter (shell, cmd.exe, whatever) or some other program. It's no different from any <em>other</em> C program in that regard; you <em>are</em> familiar with how UN*X and Windows command-line programs are written in C, right? If not, you're going to have difficulty understanding the code in Wireshark programs that processes argc and argv, so you should probably make sure you're familiar with that before doing any more work on this.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>31 May '15, 14:30</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p>Guy Harris ♦♦<br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span></p></div></div><div id="comments-container-42777" class="comments-container"><span id="42779"></span><div id="comment-42779" class="comment"><div id="post-42779-score" class="comment-score"></div><div class="comment-text"><p>Thanks Harris,you kept me in write path.Dumpcap then writes the packets to a pcap or pcap-ng file?. Where is this file? whats the name?</p><p>Network interface ---&gt;dumpcap---&gt;pcapio.c---&gt;{the capture file}---&gt;wiretap---&gt;Wireshark<br />
</p><p>In above scenario where i can find the capture file.</p><p>Once capture file is created capinfos.c reads it and print some summary data for it right? then its followed by wireshark reading that file using wiretap and make it display to end user right?</p><p>Once every thing is ready How &amp; where wiretap is using that file meaning that<br />
capture file---&gt;(?)---&gt;wiretap---&gt;(?)---&gt;wireshark. Where we are feeding the packet to wiretap and how wireshark is using the file(or something) to display that packet from wiretap.</p><p>Can you give me the clear idea(file names will be more appreciated with functionalities) about capture file to wiretap &amp; to wireshark(end user display).</p></div><div id="comment-42779-info" class="comment-info"><span class="comment-age">(31 May '15, 21:55)</span> karun256</div></div><span id="42780"></span><div id="comment-42780" class="comment"><div id="post-42780-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your patience answering.</p><p>Actually i want to create one packet(By some application) inorder to display in wireshark with out having any n/w device.can you suggest me best method to do that?.</p><p>My plan is like to prepare my packet in specified(winpcap) format by using functions of pcapio.c and prepare one capture file then wireshark reads that packet using wiretap to display is it ok?</p><p><strong><em>***I am working on windows platform</em></strong>**</p></div><div id="comment-42780-info" class="comment-info"><span class="comment-age">(31 May '15, 22:01)</span> karun256</div></div><span id="42783"></span><div id="comment-42783" class="comment"><div id="post-42783-score" class="comment-score"></div><div class="comment-text"><p>As I mentioned earlier, I think extcap is the solution for you. It allows non-network devices to pass data into Wireshark for dissection and display.</p></div><div id="comment-42783-info" class="comment-info"><span class="comment-age">(01 Jun '15, 01:54)</span> grahamb ♦</div></div><span id="42813"></span><div id="comment-42813" class="comment"><div id="post-42813-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Actually i want to create one packet(By some application) inorder to display in wireshark with out having any n/w device.can you suggest me best method to do that?</p></blockquote><p>Use <a href="http://www.winpcap.org">WinPcap</a>. Have your application call <code>pcap_open_dead()</code> with whatever link-layer header format you want (for example, Ethernet, or "raw IP" with no link-layer headers), and then use the resulting <code>pcap_t</code> to open an output file with <code>pcap_dump_open()</code>. Then have it construct the packet, with <em>all</em> the protocol layers - including the link-layer header you want, if there is one - and write it out with <code>pcap_dump()</code>, and then call <code>pcap_dump_close()</code>. When your application finishes, it will have written out the file. Open that file in Wireshark.</p><blockquote><p>My plan is like to prepare my packet in specified(winpcap) format by using functions of pcapio.c and prepare one capture file then wireshark reads that packet using wiretap to display is it ok?</p></blockquote><p>"WinPcap format" is pcap format; WinPcap will write out files in that format. libpcap/WinPcap was <em>designed</em> to be used as a library by applications; the pcapio.c code was written solely for use within Wireshark and really isn't designed for somebody else to use in their own program.</p></div><div id="comment-42813-info" class="comment-info"><span class="comment-age">(01 Jun '15, 12:13)</span> Guy Harris ♦♦</div></div><span id="42822"></span><div id="comment-42822" class="comment"><div id="post-42822-score" class="comment-score"></div><div class="comment-text"><p>Thanks Harris,I will try to follow your suggestion.I want to conform one thing,I had taken winpcap latest source code by going through the code from pcap_open_live i encountered probe function where i found PktReceive function(as mentioned below), in that copying actual data into buf from &amp;head-&gt;destin,Where we are filling this destin?. PUBLIC int PktReceive (BYTE <em>buf, int max) { WORD inOfs =</em> rxInOfsFp; WORD outOfs = *rxOutOfsFp;</p><pre><code>if (outOfs != inOfs)
{
  RX_ELEMENT _far *head = (RX_ELEMENT _far*)(protBase+outOfs);
  int size, len = max;

  if (CheckElement(head))
  {
    size = min (head-&gt;firstCount, sizeof(RX_ELEMENT));
    len  = min (size, max);
    _fmemcpy (buf, &amp;head-&gt;destin, len);
  }
  else
    size = -1;

  outOfs += sizeof (RX_ELEMENT);
  if (outOfs &gt; LAST_RX_BUF)
      outOfs = FIRST_RX_BUF;
  *rxOutOfsFp = outOfs;
  return (size);
}
return (0);</code></pre><p>}</p></div><div id="comment-42822-info" class="comment-info"><span class="comment-age">(02 Jun '15, 01:03)</span> karun256</div></div><span id="42833"></span><div id="comment-42833" class="comment not_top_scorer"><div id="post-42833-score" class="comment-score"></div><div class="comment-text"><p>That's a separate issue, and it's probably best to ask questions about WinPcap's internals on the <a href="https://www.winpcap.org/mailman/listinfo/winpcap-users">WinPcap mailing list</a>. I don't have time to go through the entire packet capture code path in WinPcap, and that's not relevant to what you're trying to do in any case.</p></div><div id="comment-42833-info" class="comment-info"><span class="comment-age">(02 Jun '15, 12:37)</span> Guy Harris ♦♦</div></div></div><div id="comment-tools-42777" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-42777-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

