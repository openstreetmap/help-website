+++
type = "question"
title = "V1.12.8 - Save payload .au file does not show problem as heard in Player of RTP Stream Analysis"
description = '''Wireshark version V1.12.8 I have captured a wireshark trace which showed a payload issue (garbled) as reflected in RTP Stream Analysis when played using the Player button. Good. Then I saved this RTP stream using &quot;Save Payload As ...&quot; button and named it as Bad.au (Format: .au extension and Channel:...'''
date = "2016-01-21T17:09:00Z"
lastmod = "2016-01-26T14:51:00Z"
weight = 49441
keywords = [ "rtp", "stream" ]
aliases = [ "/questions/49441" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [V1.12.8 - Save payload .au file does not show problem as heard in Player of RTP Stream Analysis](/questions/49441/v1128-save-payload-au-file-does-not-show-problem-as-heard-in-player-of-rtp-stream-analysis)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-49441-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-49441-score" class="post-score" title="current number of votes">0</div><span id="post-49441-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Wireshark version V1.12.8</p><p>I have captured a wireshark trace which showed a payload issue (garbled) as reflected in RTP Stream Analysis when played using the Player button. Good.</p><p>Then I saved this RTP stream using "Save Payload As ..." button and named it as Bad.au (Format: .au extension and Channel: forward).</p><p>Upon opening the Bad.au using windows media player the captured speech was played clearly without any issue i.e no garbling was heard from the saved audio file. Opening the audio using CoolEdit2000 also produce no issue with the saved wave file.</p><p>My question is: How come there is a difference with playing the RTP Stream Analysis and saving the RTP Payload stream as an audio file in wireshark?</p><p>Not sure whether anyone has experienced this issue as I had. Thanks for any feedback.</p><p>Note: Have upgraded to wireshark version to V2.0.1 but the discrepancy persists?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-rtp" rel="tag" title="see questions tagged &#39;rtp&#39;">rtp</span> <span class="post-tag tag-link-stream" rel="tag" title="see questions tagged &#39;stream&#39;">stream</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>21 Jan '16, 17:09</strong></p><img src="https://secure.gravatar.com/avatar/0e501a01af7880821ba4ecacee36a98c?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SunnyK&#39;s gravatar image" /><p><span>SunnyK</span><br />
<span class="score" title="16 reputation points">16</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SunnyK has no accepted answers">0%</span></p></div></div><div id="comments-container-49441" class="comments-container"></div><div id="comment-tools-49441" class="comment-tools"></div><div class="clear"></div><div id="comment-49441-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="49447"></span>

<div id="answer-container-49447" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-49447-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-49447-score" class="post-score" title="current number of votes">1</div><span id="post-49447-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="SunnyK has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>The reason is that while the RTP player imitates the behaviour of a real gateway device by simulating use of a de-jittering buffer, which is something all gateway devices have to use, the <code>Save Payload As...</code> doesn't do this.</p><p>So the difference you describe indicates that you wanted to use <code>Save Payload As...</code> to document some issue with garbled sound, assuming that the source of the RTP or of the audio contents itself was faulty, but that the real cause of the garbled sound is actually a network issue.</p><p>The travel time of any packet through the network from the source to the destination is not the same for all packets. These deviations of travel time of individual packets from the mean travel time of all packets in the same stream are called "jitter". Due to its existence, it would be a bad idea to start playing the contents of any received RTP packet immediately as it comes, because if it would take the next one longer to get to you, you'd have finished playing the contents of the first packet and have nothing to play until the next one would arrive, causing a garbled sound at the output. To prevent this, gateways intentionally do not start playing packets immediately after reception of the very first one, but first build a queue of several packets. The longer the queue, the better tolerance to delayed packets, but the worse the user experience, so different developers use different strategies and even adjust the queue sizes dynamically.</p><p>The queue size is also an issue. At multi-channel gateways,</p><ul><li><p>you cannot give an unlimited amount of memory to each channel,</p></li><li><p>the playback sample rate is usually common for all streams.</p></li></ul><p>So if the source of the packets uses a slightly faster sample rate than its recipient, the playback queue grows with time, and if its size is limited, you have to drop those incoming packets which come while there is no space in the queue (or better use some smoothing techniques, dropping individual samples rather than whole packets), resulting in audio quality deterioration.</p><p>So when you encounter a garbled sound issue, but <code>Save Payload As...</code> saves a clean sound and Wireshark statistics shows no lost packets in the stream (i.e. the RTP sequence numbers of the packets in the stream are monotonously rising by one), look at the times elapsed between packet arrivals. If they differ heavily (in fact, any jitter values of tens of milliseconds, i.e. comparable to the packetization time, need attention) already at the point of capture, it means that you have to have a look to the dejittering buffer parameters at the receiving gateway. If you cannot see any interesting jitter values (jitter lower than packetization time usually doesn't make any real life trouble), but Wireshark tells you that the sample rate differs from the expected one (which is 8000 Hz for most traditional audio codecs but it is not a law of physics), it may also be that the jitter buffer underruns (new packets arrive too slowly due to lower sampling rate at the sending side) or overruns (new packets arrive too fast).</p><p>In the RTP player, you can imitate the de-jittering buffer behaviour of a particular gateway, if you know that gateway's settings, by setting the size of dejittering buffer in the RTP player window. Or you can switch the dejittering buffer simulation off by setting <code>Playback Timing</code> to <code>Uninterrupted mode</code> (i.e. same behaviour like <code>Save Payload As...</code>) if you want to check "by ear" whether jitter or something else is the cause of the issue. You can also set <code>Playback Timing</code> to <code>Use RTP Timestamps</code> (roughly, playing the packets as they looked at the sender), which more or less can only reveal sender's issues with timestamping.</p><p>More sophisticated dejittering buffer strategies are not implemented in the RTP player (yet?).</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>22 Jan '16, 01:35</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>22 Jan '16, 14:17</strong> </span></p></div></div><div id="comments-container-49447" class="comments-container"><span id="49496"></span><div id="comment-49496" class="comment"><div id="post-49496-score" class="comment-score"></div><div class="comment-text"><p>Thanks sindy for the informative reply.</p><p>After posting my question online I have a discussion with the customer IT staff and eventually the problem was resolved. It was due to delay between sites which led to the garbled sound.</p><p>Your reply reinforces my understanding of jitter buffer and wireshark as a tool to demonstrate it.</p><p>Thanks again for your reply. Appreciate it. Have a nice day.</p><p>Sunny</p></div><div id="comment-49496-info" class="comment-info"><span class="comment-age">(24 Jan '16, 20:17)</span> <span class="comment-user userinfo">SunnyK</span></div></div><span id="49500"></span><div id="comment-49500" class="comment"><div id="post-49500-score" class="comment-score"></div><div class="comment-text"><p><span>@SunnyK</span>, thank you for upvoting my answer, but to mark an answer as useful, you (because nobody else can do it) have to use the checkmark icon instead of the "thumbs up" one. This makes the question appear as "answered usefully" in the question list. This is how this site works.</p></div><div id="comment-49500-info" class="comment-info"><span class="comment-age">(25 Jan '16, 01:24)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="49523"></span><div id="comment-49523" class="comment"><div id="post-49523-score" class="comment-score"></div><div class="comment-text"><p>Hi sindy,</p><p>I had selected the checkmark icon.</p><p>Regards,</p><p>Sunny</p></div><div id="comment-49523-info" class="comment-info"><span class="comment-age">(26 Jan '16, 14:51)</span> <span class="comment-user userinfo">SunnyK</span></div></div></div><div id="comment-tools-49447" class="comment-tools"></div><div class="clear"></div><div id="comment-49447-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

