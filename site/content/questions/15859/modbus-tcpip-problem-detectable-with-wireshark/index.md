+++
type = "question"
title = "Modbus TCP/IP Problem detectable with WireShark?"
description = '''Hello, Here is my problem. In an industrial automation environment we have one Modbus Master system and serveral Modbus slave&#x27;s (13 x PLC&#x27;s/PC devices). Modbus communication is working, but frequently (twice per hour) we lose the connection to one of the devices (everytime a different device). This ...'''
date = "2012-11-13T04:21:00Z"
lastmod = "2012-11-20T01:26:00Z"
weight = 15859
keywords = [ "modbus" ]
aliases = [ "/questions/15859" ]
osqa_answers = 4
osqa_accepted = false
+++

<div class="headNormal">

# [Modbus TCP/IP Problem detectable with WireShark?](/questions/15859/modbus-tcpip-problem-detectable-with-wireshark)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-15859-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-15859-score" class="post-score" title="current number of votes">0</div><span id="post-15859-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello,</p><p>Here is my problem. In an industrial automation environment we have one Modbus Master system and serveral Modbus slave's (13 x PLC's/PC devices). Modbus communication is working, but frequently (twice per hour) we lose the connection to one of the devices (everytime a different device). This takes a couple of seconds (10-20 sec) and then the communication starts again. We can see that the frequency of missing the connection is related to the number of slaves active on the network. When we have less slaves on the network it still happens but less frequent. In our Modbus Master system there is no good log available to see what is happening. I used Wireshark to capture the datatrafic between the master and the slaves. I've got a situation captured, but to be honest i really don't know what i am looking at in Wireshark. Hopefully someone can explain to me what the Wireshark log can tell me. Thanks,</p><p>Niels</p><p>Hereby a link to the file on cloudshark: Problem is between 141.81.0.10 and 141.81.0.46 on time: 03 min, 46 sec until 04 min, 06 sec Hopefully this will help to find my problem???? Thanks</p><p><a href="https://www.cloudshark.org/captures/76038eaa4a3b">Link to CloudShark</a></p><p>Screenshot of Configuration in Master System (Wonderware AcherstrA). The Modbus devices are Elau PLC controllers. Also we communicate with an Xray machine wich has a dedicated PC based controller. Thanks to everyone for cooperative thinking and helping.</p><p><img src="https://osqa-ask.wireshark.org/upfiles/modbus_config1.JPG" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-modbus" rel="tag" title="see questions tagged &#39;modbus&#39;">modbus</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>13 Nov '12, 04:21</strong></p><img src="https://secure.gravatar.com/avatar/c0806c378940c0bc8cb81e455bd885bc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Niels&#39;s gravatar image" /><p><span>Niels</span><br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Niels has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>15 Nov '12, 13:44</strong> </span></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span></p></div></div><div id="comments-container-15859" class="comments-container"><span id="15861"></span><div id="comment-15861" class="comment"><div id="post-15861-score" class="comment-score"></div><div class="comment-text"><p>Can you add your capture to <a href="https://www.cloudshark.org/">CloudShark</a> and post a link back to here? Only do this if the data isn't sensitive. This is required as we can't really diagnose an issue via a screen capture.</p></div><div id="comment-15861-info" class="comment-info"><span class="comment-age">(13 Nov '12, 04:45)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="15864"></span><div id="comment-15864" class="comment"><div id="post-15864-score" class="comment-score"></div><div class="comment-text"><p>Hello Grahamb,</p><p>Link is added. Would appriciate if you can have a look!</p><p>Niels</p></div><div id="comment-15864-info" class="comment-info"><span class="comment-age">(13 Nov '12, 06:36)</span> <span class="comment-user userinfo">Niels</span></div></div></div><div id="comment-tools-15859" class="comment-tools"></div><div class="clear"></div><div id="comment-15859-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

4 Answers:

</div>

</div>

<span id="15893"></span>

<div id="answer-container-15893" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-15893-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-15893-score" class="post-score" title="current number of votes">3</div><span id="post-15893-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p><span>@Bill Meier</span> might be on to something here.</p><p>In the first capture, if you filter by the rtu address (ip.addr == 141.81.0.46) and look at the frames preceding the connection close, i.e. 29986 onwards, you can see a sequence of Read Input Register requests.</p><p>Looking at the Modbus/TCP headers you can see the "Transaction Identifier" that allows the master to match up responses to queries and have multiple queries in flight. Standard Modbus doesn't have this as it's a strict request/response protocol, but the TCP variant does.</p><p>So the query in frame 29986 has TI's 28532-28534. The response (30004) has the responses to those TI's. The next query (30006) has TI's 28535 &amp; 6. The next response (30067) has the responses to those TI's. The next query (30069) has TI's 28537-28540. The next response (30107) only has TI's 28537 &amp; 8 so TI 28539 &amp; 40 are still outstanding (in flight). The master then sends a query (30109) with TI 28541 and then another query (30126) with TI 28542-28544. Note that the latter two are actually coil writes so I'm speculating that the master pushed the writes out immediately (as we all like output ops to happen quickly) so now we have TI's 25839-25844 all in-flight. The rtu responds (30149) with TI 25839 &amp; 40, so TI's 25841-44 are still in-flight. Now we have the near 10 second gap until the rtu sends the tcp keep-alive (36817) and very quickly after that the master closes the connection.</p><p>I think that the number of TI's in-flight (4) cause the master to not send any more queries until the rtu responds, and as this doesn't happen in 10 seconds or so (a master timeout?) the master recycles the connection. I would further speculate that if the master has a write request, it may exceed the "normal" number of in-flight requests.</p><p>You need to check the permitted number of in-flight requests for the rtu, and (if possible) configure the master to not exceed that. Out of interest can you name the master software and the rtu vendor?</p><p>I also note that the master is not coalescing reads, i.e. it's sending out "overlapping" read requests and thus it's not making the most efficient use of bandwidth, e.g. frame 29869 requests 70 registers from starting index 201 (201-270), and then the next query (29916) in TI 28528 requests 1 register from index 206. This new read is entirely contained in the previous query.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>14 Nov '12, 03:25</strong></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="grahamb has 274 accepted answers">22%</span></p></div></div><div id="comments-container-15893" class="comments-container"><span id="15894"></span><div id="comment-15894" class="comment"><div id="post-15894-score" class="comment-score"></div><div class="comment-text"><p>Hello Grahamb,</p><p>Very impressive!!!! I've looked at the settings and made a screenshot of the configuration i can make in our system (Wonderware ArchestrA).</p><p>The two settings you mentioned are there (see original edited problem)</p><p>What do you suggest I should do with those settings. (increase them to the max???).</p><p>Thanks for all your time and effort....</p><p>Niels</p></div><div id="comment-15894-info" class="comment-info"><span class="comment-age">(14 Nov '12, 03:58)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="15897"></span><div id="comment-15897" class="comment"><div id="post-15897-score" class="comment-score">1</div><div class="comment-text"><p>Competitors product, I couldn't possibly assist :-)</p><p>However as I have a Wireshark hat on at the moment not the day job, try reducing the number of outstanding messages. This means the rtu doesn't have to buffer as many responses. Increasing it just means that the master can send even more requests before giving up on the rtu, and the rtu has to buffer all those requests and responses.</p></div><div id="comment-15897-info" class="comment-info"><span class="comment-age">(14 Nov '12, 04:30)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="15906"></span><div id="comment-15906" class="comment"><div id="post-15906-score" class="comment-score">1</div><div class="comment-text"><p>Analyzing further (with a little help from perl):</p><ol><li>It appears that the "maximum outstanding messages" parameter is not always being observed (presuming I understand the parameter).</li></ol><p>For example: filter on 'ip.addr eq 141.81.0.66' and then look at frames 12481 and 12504. You will see that 5 'Read Input Registers' queries and 1 'Read Discrete Inputs' query are queued before there is a response.</p><p>There are a fair number of similar sequences in the capture.</p><p>In all but one of these cases there is no failure. (See below).</p><p>(Continued below)</p></div><div id="comment-15906-info" class="comment-info"><span class="comment-age">(14 Nov '12, 10:17)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="15907"></span><div id="comment-15907" class="comment"><div id="post-15907-score" class="comment-score"></div><div class="comment-text"><p>(Cont'd)</p><p>(Note: I've no experience with the Modbus protocol or the vendor software, so I'm just taking the parameter to mean what it sounds like).</p><ol><li>In the case that failed (as noted in Graham's answer, the queued messages were as follows: 4 "Read Input Registers" 2 "Write Multiple Coils"</li></ol><p>Another queueing case in the capture was similar but did not fail: 3 "Read Input Registers" 2 "Write Multiple Coils" 1 "Read Input Registers"</p><p>(Continued_</p></div><div id="comment-15907-info" class="comment-info"><span class="comment-age">(14 Nov '12, 10:26)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="15908"></span><div id="comment-15908" class="comment not_top_scorer"><div id="post-15908-score" class="comment-score"></div><div class="comment-text"><p>(Cont'd)</p><p>So: It smells to me like the vendor(s) may have some timing (and maybe other) issues with their software.</p><p>If reducing the "maximum ..." parameter reduces but does not completely do away with the issue, I certainly wouldn't be surprised.</p><p>IMHO, any timing issues need to be fixed not minimized. The phrase "communicate with an Xray machine" doesn't make me comfortable.</p><p>I suggest discussing the issue and this capture with the vendor(s) (if you haven't already).</p><p>As I said, I've no experience with the Modbus protocol or the vendors so all of the above is just my opinion !</p></div><div id="comment-15908-info" class="comment-info"><span class="comment-age">(14 Nov '12, 10:34)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="15910"></span><div id="comment-15910" class="comment not_top_scorer"><div id="post-15910-score" class="comment-score"></div><div class="comment-text"><p>P.S. adding columns for mbtcp.trans_id and modbus.func_code helps to see what's happening when looking at the capture.</p><p>This can be done by separately right-clicking each of the two fields in the details pane and doing 'Apply as column'</p></div><div id="comment-15910-info" class="comment-info"><span class="comment-age">(14 Nov '12, 10:41)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="15922"></span><div id="comment-15922" class="comment"><div id="post-15922-score" class="comment-score">1</div><div class="comment-text"><p><span>@Bill Meier</span></p><p>I don't think it's a timing problem, as the master correctly waits the configured 10 seconds for a response before recycling the connection.</p><p>The master does exceed the configured number of messages outstanding though, and depending on how the rtu reacts to that is the cause of the problem. In the area I looked at, the rtu just fails to respond, so what is it doing? At best it's just running normally but the comms stack is a little behind and will catch up eventually. At worst the rtu may be undergoing a reset which is not likely to have a good effect on the equipment it's controlling.</p><p>Hopefully reducing the limit on the number of outstanding messages means that the master will reduce the actual outstanding messages, even if it does exceed the limit a little and the rtu will cope better. Personally I'd set it to 1.</p><p>For Modbus/TCP the ability to have outstanding messages doesn't add much, as the system is still limited by the response rate of the rtu to those messages, and many rtu's don't have the buffer capacity to hold the outstanding requests.</p></div><div id="comment-15922-info" class="comment-info"><span class="comment-age">(15 Nov '12, 01:54)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="15924"></span><div id="comment-15924" class="comment not_top_scorer"><div id="post-15924-score" class="comment-score"></div><div class="comment-text"><p>Hello Everybody,</p><p>Just an update,</p><p>I've put the Maximum number of outstanding messages at this moment for all my 13 devices to 1!!!</p><p>So far so good. I am monitoring constantly the status of the Modbus communication (not via wireshark), but via my application software, and since this morning i did't have any communication problems.</p><p>I will let it run a couple of days like this and then will post another update.</p><p>And Once more, Thanks for all your time, thoughts and suggestions.</p><p>Niels</p></div><div id="comment-15924-info" class="comment-info"><span class="comment-age">(15 Nov '12, 02:12)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="15929"></span><div id="comment-15929" class="comment not_top_scorer"><div id="post-15929-score" class="comment-score"></div><div class="comment-text"><p><span>@grahamb</span></p><p>"I don't think it's a timing problem, as the master correctly waits the configured 10 seconds for a response before recycling the connection. ..."</p><p>Sounds reasonable ....</p></div><div id="comment-15929-info" class="comment-info"><span class="comment-age">(15 Nov '12, 06:59)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="16097"></span><div id="comment-16097" class="comment not_top_scorer"><div id="post-16097-score" class="comment-score"></div><div class="comment-text"><p>Update:</p><p>Problem Solved:</p><p>I have changed the maximum outstanding messages to 1. This is active now in the factory for several days and no communication error has occured since then!!!</p><p>Many thanks to Grahamb who solved the mystery....</p><p>Regards,</p><p>Niels</p></div><div id="comment-16097-info" class="comment-info"><span class="comment-age">(20 Nov '12, 00:08)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="16099"></span><div id="comment-16099" class="comment not_top_scorer"><div id="post-16099-score" class="comment-score"></div><div class="comment-text"><p>Glad to hear the issue has been resolved.</p><p>Can you accept the answer that solved your issue by clicking the checkmark icon next to the answer? This highlights the best answer for the benefit of other users.</p></div><div id="comment-16099-info" class="comment-info"><span class="comment-age">(20 Nov '12, 01:26)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div></div><div id="comment-tools-15893" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-15893-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="15867"></span>

<div id="answer-container-15867" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-15867-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-15867-score" class="post-score" title="current number of votes">1</div><span id="post-15867-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>When referring to frames of interest it's best to use frame numbers rather than times that can be affected by the time-zone of the viewer.</p><p>I filtered by the ip address of the target rtu (ip.addr == 148.81.0.46) and can see that at frame 36817 the rtu sent a tcp keep-alive 9 seconds after the last communication from the master (30207), and the master ACK'd that then almost immediately after closed the connection and opened it again. Again after the ACK from the master indicating the connection was open (37003) there is a 9 second delay before the rtu sends a TCP Keep-alive (43200) and the master sends back the ack (43201). Half a second later the master starts sending requests.</p><p>So what happened around this period of interruption? Clearing the display filter to see all packets shows that the master is quite happily exchanging packets with other Modbus/TCP rtu's, and plenty of other traffic, e.g.CIP, some SQL server and some TPKT. There doesn't seem to be any issue with the network, may be the master is just too busy?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Nov '12, 07:23</strong></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="grahamb has 274 accepted answers">22%</span></p></div></div><div id="comments-container-15867" class="comments-container"><span id="15871"></span><div id="comment-15871" class="comment"><div id="post-15871-score" class="comment-score"></div><div class="comment-text"><p>Thanks Grahamb,</p><p>I've captured yesterday another link down. This one have some red lines in the log of wireshark. Maybe this tells you more???</p><p>Link = <a href="https://www.cloudshark.org/captures/3bfef9452c76">https://www.cloudshark.org/captures/3bfef9452c76</a></p><p>Rtu device is now: 141.81.0.86 and something goes wrong between frame 1014 and frame 9975</p><p>Thanks in advance,</p><p>Regards Niels</p></div><div id="comment-15871-info" class="comment-info"><span class="comment-age">(13 Nov '12, 08:07)</span> <span class="comment-user userinfo">Niels</span></div></div></div><div id="comment-tools-15867" class="comment-tools"></div><div class="clear"></div><div id="comment-15867-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="15881"></span>

<div id="answer-container-15881" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-15881-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-15881-score" class="post-score" title="current number of votes">1</div><span id="post-15881-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I also spent a little time doing an analysis ... :)</p><p>As noted in the previous answers:</p><ol><li><p>The first capture shows the master seeming to hiccup (not sending any queries for a while), then closing the connection and then after a new connection is opened, still delaying before sending another query.</p></li><li><p>The second capture shows a connection closing after some retransmissions &amp; etc. The connection is eventually restarted after some messy stuff (including an attempted restart which fails).</p></li></ol><p>For the first capture I spent a little time looking at the traffic on the connection which failed after a hiccup. The one thing I noticed is that there was a long sequence of repeated "READ INPUT REGISTER" queries just before the hiccup. In fact, there were 24 successive queries and this is the largest number of successive of "READ INPUT REGISTER" queries on a connection in the whole capture. Is this meaningful ? I've no idea.</p><p>To see if there's any pattern related to the failures which can be seen in the captures, additional captures covering the time period of a failure would be needed.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Nov '12, 14:47</strong></p><img src="https://secure.gravatar.com/avatar/bfb20acfe44690473b10c7963b5d4a18?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Bill%20Meier&#39;s gravatar image" /><p><span>Bill Meier ♦♦</span><br />
<span class="score" title="3180 reputation points"><span>3.2k</span></span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="50 badges"><span class="bronze">●</span><span class="badgecount">50</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Bill Meier has 31 accepted answers">17%</span></p></div></div><div id="comments-container-15881" class="comments-container"></div><div id="comment-tools-15881" class="comment-tools"></div><div class="clear"></div><div id="comment-15881-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="15860"></span>

<div id="answer-container-15860" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-15860-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-15860-score" class="post-score" title="current number of votes">0</div><span id="post-15860-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>The screen shot is pretty hard to read, especially with these migraine-inducing color rules. As far as I can tell you have some inactivity in there, leading to TCP keep alives (all normal), and then a normal session teardown using FIN-ACK-FIN-ACK. Then a new connection is started (SYN). As far as I can tell from the screen shot there is no critical situation there - looks like inactivity between server and slave leading to a "we don't need this session anymore"-behaviour.</p><p>Try filtering for "tcp.analysis.flags" and see if there's something bad happening - if you find a connection that zero window messages, or has long delays (see the time column) or reset packets (filter for "tcp.flags.reset==1") you might be onto something, but it is often hard to tell with the Modbus stuff.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Nov '12, 04:42</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-15860" class="comments-container"><span id="15865"></span><div id="comment-15865" class="comment"><div id="post-15865-score" class="comment-score"></div><div class="comment-text"><p>Hello Jasper,</p><p>I've uploaded the file to cloudshark. Maybe you can have a look??</p><p>Thanks,</p><p>Niels</p></div><div id="comment-15865-info" class="comment-info"><span class="comment-age">(13 Nov '12, 06:40)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="15866"></span><div id="comment-15866" class="comment"><div id="post-15866-score" class="comment-score"></div><div class="comment-text"><p>Sure... but I'd need the link ;-)</p></div><div id="comment-15866-info" class="comment-info"><span class="comment-age">(13 Nov '12, 07:14)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="15870"></span><div id="comment-15870" class="comment"><div id="post-15870-score" class="comment-score"></div><div class="comment-text"><p>Jasper, Link is in my original posted message.</p></div><div id="comment-15870-info" class="comment-info"><span class="comment-age">(13 Nov '12, 07:32)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="15872"></span><div id="comment-15872" class="comment"><div id="post-15872-score" class="comment-score"></div><div class="comment-text"><p>Jasper,</p><p>this link (capture of link down yesterday) has a warning log with windows = 0 at frame 3676.</p><p><a href="https://www.cloudshark.org/captures/3bfef9452c76">https://www.cloudshark.org/captures/3bfef9452c76</a></p><p>hopefully this makes sense to you???</p><p>Thanks,</p><p>Niels</p></div><div id="comment-15872-info" class="comment-info"><span class="comment-age">(13 Nov '12, 08:13)</span> <span class="comment-user userinfo">Niels</span></div></div><span id="15874"></span><div id="comment-15874" class="comment"><div id="post-15874-score" class="comment-score"></div><div class="comment-text"><p>The Zero Window in frame 3676 is not a problem in itself, since it is a Reset packet, and these always have a window of 0.</p><p>In that trace we can see that the IP addresses 141.81.0.10 and 141.81.0.86 have a little trouble finishing their connection (Stream Index 1). There are a couple of retransmissions from 141.81.0.10 followed by a FIN which is again retransmitted, and finally the FIN from 141.81.0.86, after which no more packets should arrive, but 141.81.0.86 does send a packet in frame 3674. This leads to an "angry" RST from 141.81.0.10.</p></div><div id="comment-15874-info" class="comment-info"><span class="comment-age">(13 Nov '12, 08:54)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div></div><div id="comment-tools-15860" class="comment-tools"></div><div class="clear"></div><div id="comment-15860-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

