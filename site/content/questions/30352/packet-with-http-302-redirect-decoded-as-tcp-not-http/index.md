+++
type = "question"
title = "Packet with HTTP 302 Redirect decoded as TCP not HTTP"
description = '''Hi All, Having a weird issue: a packet with HTTP 302 Redirect is being decoded only as TCP with Info = [TCP segment of a reassembled PDU] (thus hinting at the fact it&#x27;s just one of a few packets carrying a large PDU) and not as HTTP despite it seems to contain the whole HTTP message. Here&#x27;s this pac...'''
date = "2014-03-03T10:48:00Z"
lastmod = "2014-03-03T14:28:00Z"
weight = 30352
keywords = [ "tcptrace" ]
aliases = [ "/questions/30352" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Packet with HTTP 302 Redirect decoded as TCP not HTTP](/questions/30352/packet-with-http-302-redirect-decoded-as-tcp-not-http)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-30352-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi All,</p><p>Having a weird issue: a packet with HTTP 302 Redirect is being decoded only as TCP with Info = [TCP segment of a reassembled PDU] (thus hinting at the fact it's just one of a few packets carrying a large PDU) and not as HTTP despite it seems to contain the whole HTTP message. Here's this packet:</p><pre><code>0A0D0D0A840000004D3C2B1A01000000FFFFFFFFFFFFFFFF03002B0033322D6269742057696E646F777320372053657276696365205061636B20312C206275696C6420373630310004002F0044756D7063617020312E31302E31202853564E205265762035303932362066726F6D202F7472756E6B2D312E313029000000000084000000010000008800000001000000FFFF0000020032005C4465766963655C4E50465F7B31383539424338342D303638392D344545342D394637462D3835443039334138463538427D000009000100060000000C002B0033322D6269742057696E646F777320372053657276696365205061636B20312C206275696C642037363031000000000088000000060000001C01000000000000B6F30400CFA841FFFC000000FC000000E41F13778F8FACF2C589043B0800450000EE00000000F706EC6FD43AF65B0A0002040050EC4EBDE3C4ECF68FFA3C5011FFFFC6720000485454502F312E312033303220466F756E640D0A4C6F636174696F6E3A2068747470733A2F2F686F7473706F742E696E6D61727361742E636F6D2F696E6465783F6F72696755726C3D687474702533412532462532467777772E6262632E636F2E756B2532460D0A436F6E74656E742D547970653A20746578742F68746D6C3B20636861727365743D69736F2D383835392D310D0A50726F78792D436F6E6E656374696F6E3A20636C6F73650D0A0D0A54686520646F63756D656E7420686173206D6F7665641C010000050000006C00000000000000B7F3040055E3000201001C00436F756E746572732070726F76696465642062792064756D7063617002000800B7F3040094E0720003000800B7F3040055E30002040008003001000000000000050008000000000000000000000000006C000000</code></pre><p>Is anything wrong with encoding in this packet by chance?</p><p>Many thanks in advance,</p><p>Dmitriy</p></div><div id="question-tags" class="tags-container tags">tcptrace</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>03 Mar '14, 10:48</strong></p><img src="https://secure.gravatar.com/avatar/4c43e04f0ef8eacb2a3173436cb432f0?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Dmitriy&#39;s gravatar image" /><p>Dmitriy<br />
<span class="score" title="21 reputation points">21</span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="7 badges"><span class="silver">●</span><span class="badgecount">7</span></span><span title="11 badges"><span class="bronze">●</span><span class="badgecount">11</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Dmitriy has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 03 Mar '14, 14:15</p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span></p></div></div><div id="comments-container-30352" class="comments-container"><span id="30355"></span><div id="comment-30355" class="comment"><div id="post-30355-score" class="comment-score"></div><div class="comment-text"><p>It's much easier to help you, if you post the frame as a pcap file (on cloudshark, google drive or dropbox), instead the hex representation ;-)</p></div><div id="comment-30355-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:16)</span> Kurt Knochner ♦</div></div><span id="30356"></span><div id="comment-30356" class="comment"><div id="post-30356-score" class="comment-score"></div><div class="comment-text"><p>Hi Kurt - indeed ) How about this?</p><p><a href="https://drive.google.com/file/d/0B31e47Ucqt4BUnRNUVFQUmdsdU0/edit?usp=sharing">https://drive.google.com/file/d/0B31e47Ucqt4BUnRNUVFQUmdsdU0/edit?usp=sharing</a></p><p>The packet in question is #10. Please note this is 100% raw trace - no filtering was used whatsoever to ensure no packets are missed; also this is the only interface at the end user PC used for this kind of traffic.</p><p>The redirection works fine btw.</p><p>Thanks in advance,</p><p>Dmitriy</p></div><div id="comment-30356-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:23)</span> Dmitriy</div></div></div><div id="comment-tools-30352" class="comment-tools"></div><div class="clear"></div><div id="comment-30352-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="30358"></span>

<div id="answer-container-30358" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-30358-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>If you disable the following option, it shows as HTTP 302.</p><blockquote><p>Edit -&gt; Preferences -&gt; TCP -&gt; Allow subdissector to reassemble TCP streams</p></blockquote><p>I'll have to check why that happens, if you are interested.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>03 Mar '14, 14:28</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-30358" class="comments-container"><span id="30359"></span><div id="comment-30359" class="comment"><div id="post-30359-score" class="comment-score"></div><div class="comment-text"><p>I definitely am as unsure what exactly in this packet misleads this Wireshark option so that it has to be disabled - thank you )</p><p>Thanks &amp; Regards,</p><p>D.</p></div><div id="comment-30359-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:44)</span> Dmitriy</div></div><span id="30360"></span><div id="comment-30360" class="comment"><div id="post-30360-score" class="comment-score"></div><div class="comment-text"><p>I don't know either. I'll check it tomorrow....</p></div><div id="comment-30360-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:45)</span> Kurt Knochner ♦</div></div><span id="30361"></span><div id="comment-30361" class="comment"><div id="post-30361-score" class="comment-score"></div><div class="comment-text"><p>Many thanks!</p></div><div id="comment-30361-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:51)</span> Dmitriy</div></div><span id="30362"></span><div id="comment-30362" class="comment"><div id="post-30362-score" class="comment-score"></div><div class="comment-text"><p>In the meantime, you can help yourself by disabling that option.</p></div><div id="comment-30362-info" class="comment-info"><span class="comment-age">(03 Mar '14, 14:53)</span> Kurt Knochner ♦</div></div><span id="30369"></span><div id="comment-30369" class="comment"><div id="post-30369-score" class="comment-score"></div><div class="comment-text"><p>I tried it straight away - works for me indeed.</p></div><div id="comment-30369-info" class="comment-info"><span class="comment-age">(03 Mar '14, 15:55)</span> Dmitriy</div></div><span id="30527"></span><div id="comment-30527" class="comment not_top_scorer"><div id="post-30527-score" class="comment-score"></div><div class="comment-text"><p>Hi Kurt - sorry to disturb: have you had a chance to look into the root cause why it's not being decoded with that option enabled? If so any clues? Just curious now.</p><p>Many thanks,</p><p>D.</p></div><div id="comment-30527-info" class="comment-info"><span class="comment-age">(07 Mar '14, 03:24)</span> Dmitriy</div></div><span id="30528"></span><div id="comment-30528" class="comment not_top_scorer"><div id="post-30528-score" class="comment-score"></div><div class="comment-text"><p>sorry, not time atm. Maybe next week.</p></div><div id="comment-30528-info" class="comment-info"><span class="comment-age">(07 Mar '14, 04:25)</span> Kurt Knochner ♦</div></div><span id="30530"></span><div id="comment-30530" class="comment not_top_scorer"><div id="post-30530-score" class="comment-score"></div><div class="comment-text"><p>I think the reassembly code is not working properly; it should not consider the TCP segment in frame 10 as part of a larger payload, so it should be displayed as HTTP decoded content. Somehow the HTTP dissector seemt to tell the TCP dissector that there be should more content to reassemble while there isn't. Looks like a case for <a href="http://bugs.wireshark.org">http://bugs.wireshark.org</a> to me ;-)</p></div><div id="comment-30530-info" class="comment-info"><span class="comment-age">(07 Mar '14, 05:00)</span> Jasper ♦♦</div></div><span id="30535"></span><div id="comment-30535" class="comment not_top_scorer"><div id="post-30535-score" class="comment-score"></div><div class="comment-text"><p>I believe there is a 0x0a and/or 0x0d missing at the end of the data, but I did not really check, as I mentioned: no time atm.</p></div><div id="comment-30535-info" class="comment-info"><span class="comment-age">(07 Mar '14, 05:56)</span> Kurt Knochner ♦</div></div><span id="30538"></span><div id="comment-30538" class="comment not_top_scorer"><div id="post-30538-score" class="comment-score"></div><div class="comment-text"><p>Hi Jasper, Hi Kurt,</p><p>Thanks for looking into it. I've just uploaded the screenshots with packets 10 and 162 in the same trace resp for comparison (both carry HTTP 302 in a single packet):</p><p><a href="https://drive.google.com/folderview?id=0B31e47Ucqt4BSEE5ci1HdlByQ00&amp;usp=sharing">https://drive.google.com/folderview?id=0B31e47Ucqt4BSEE5ci1HdlByQ00&amp;usp=sharing</a></p><p>Packet 162 is decoded correctly no matter if that option is ON or OFF; packet 10 however is only decoded when that option is OFF. Perhaps it'll help one of you or someone else notice the critical difference between them as the ones I see look fine; \r\n is there in both of them. I'll file a bug on it then in the meantime - hope that's OK.</p><p>Thanks &amp; Regards,</p><p>D.</p></div><div id="comment-30538-info" class="comment-info"><span class="comment-age">(07 Mar '14, 06:36)</span> Dmitriy</div></div><span id="30539"></span><div id="comment-30539" class="comment not_top_scorer"><div id="post-30539-score" class="comment-score"></div><div class="comment-text"><p>Packet 162 has the PSH flag set, which signals "this is the last packet of the payload".</p></div><div id="comment-30539-info" class="comment-info"><span class="comment-age">(07 Mar '14, 06:45)</span> Jasper ♦♦</div></div><span id="30540"></span><div id="comment-30540" class="comment not_top_scorer"><div id="post-30540-score" class="comment-score"></div><div class="comment-text"><p>Oops, hence packet #10 encoding issue then? Well spotted )<br />
</p><p>I just filed it before I saw your comment:</p><p><a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=9848">https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=9848</a></p></div><div id="comment-30540-info" class="comment-info"><span class="comment-age">(07 Mar '14, 06:52)</span> Dmitriy</div></div><span id="30541"></span><div id="comment-30541" class="comment not_top_scorer"><div id="post-30541-score" class="comment-score"></div><div class="comment-text"><p>No problem, Wireshark should still decode packet #10 correctly even though there is no PSH flag.</p></div><div id="comment-30541-info" class="comment-info"><span class="comment-age">(07 Mar '14, 06:53)</span> Jasper ♦♦</div></div><span id="30542"></span><div id="comment-30542" class="comment not_top_scorer"><div id="post-30542-score" class="comment-score"></div><div class="comment-text"><p>Ah so PSH isn't mandatory then... Please excuse my ignorance of such TCP basics but what's the right criteria to use when deciding whether to look for any more packets when reassembling? (either before or after the one in question)</p></div><div id="comment-30542-info" class="comment-info"><span class="comment-age">(07 Mar '14, 07:03)</span> Dmitriy</div></div><span id="30543"></span><div id="comment-30543" class="comment not_top_scorer"><div id="post-30543-score" class="comment-score"></div><div class="comment-text"><p>Packet reassembly is dictated by the protocol on top of TCP. So the HTTP dissector has to tell the TCP dissector "there will be xyz payload bytes", and then the TCP dissector gathers them together (as far as my understanding goes).</p><p>In case of packet #10 there is no reassembly required, but somehow the TCP dissector thinks there is. A push flag is a typical flag found in the last packet of a larger payload, signaling "process this right away". So there can't be more payload bytes after that and the TCP dissector decodes it.</p></div><div id="comment-30543-info" class="comment-info"><span class="comment-age">(07 Mar '14, 07:16)</span> Jasper ♦♦</div></div><span id="30546"></span><div id="comment-30546" class="comment not_top_scorer"><div id="post-30546-score" class="comment-score"></div><div class="comment-text"><p>Thank you - clear now. Just tried setting PSH - no difference, so PSH doesn't seem to be the criteria being used...</p></div><div id="comment-30546-info" class="comment-info"><span class="comment-age">(07 Mar '14, 07:47)</span> Dmitriy</div></div><span id="30547"></span><div id="comment-30547" class="comment not_top_scorer"><div id="post-30547-score" class="comment-score"></div><div class="comment-text"><p>As http is "line-based" I think the http dissector is looking for a blank line with <code>\r\n</code> to determine the end of the http PDU. The packet in frame 10 doesn't have such a terminator so the http dissector is waiting for more data to find the line terminator. As the tcp stream is subsequently closed it never sees that final terminator so can't reassemble the PDU's.</p><p>In fact, I think it won't be called again for that stream as there is no further data so it never gets a chance to complete the reassembly. For whatever reason the capture doesn't show the FIN from the server to close the stream off, I suspect the <code>\r\n</code> and the FIN have been lost somewhere.</p><p><strong>Update</strong> As @Jasper pointed out the FIN is in there with the data response.</p></div><div id="comment-30547-info" class="comment-info"><span class="comment-age">(07 Mar '14, 07:49)</span> grahamb ♦</div></div><span id="30549"></span><div id="comment-30549" class="comment not_top_scorer"><div id="post-30549-score" class="comment-score"></div><div class="comment-text"><p>The FIN is piggy-packed in frame #10 ;-)</p><p>If I disable Reassembly frame #10 shows this:</p><pre><code>Hypertext Transfer Protocol
    HTTP/1.1 302 Found\r\n
    Location: https://hotspot.inmarsat.com/index?origUrl=http%3A%2F%2Fwww.bbc.co.uk%2F\r\n
    Content-Type: text/html; charset=iso-8859-1\r\n
    Proxy-Connection: close\r\n
    \r\n
    [HTTP response 1/1]
    [Time since request: 0.803409000 seconds]
    [Request in frame: 7]</code></pre><p>Looks like there are two \r\n with the second on a blank line.</p></div><div id="comment-30549-info" class="comment-info"><span class="comment-age">(07 Mar '14, 07:55)</span> Jasper ♦♦</div></div><span id="30550"></span><div id="comment-30550" class="comment not_top_scorer"><div id="post-30550-score" class="comment-score"></div><div class="comment-text"><p>Oh yep, didn't look at the actual flags breakdown, I don't often see a data bearing packet with a FIN in my usual traffic.</p><p>Possibly a non-conforming server then forgetting to add the line terminator, although I can't be bothered to go and check the http RFC's to confirm that.</p></div><div id="comment-30550-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:00)</span> grahamb ♦</div></div><span id="30551"></span><div id="comment-30551" class="comment not_top_scorer"><div id="post-30551-score" class="comment-score"></div><div class="comment-text"><p>Same here, no fun looking thru RFCs for MUST, SHOULD, etc,. Let's have @Kurt do this, he's our resident PEP ("pinpoint the exact problem") specialist :-)))</p></div><div id="comment-30551-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:03)</span> Jasper ♦♦</div></div><span id="30552"></span><div id="comment-30552" class="comment not_top_scorer"><div id="post-30552-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Let's have @Kurt do this,</p></blockquote><p>??? :-))</p></div><div id="comment-30552-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:06)</span> Kurt Knochner ♦</div></div><span id="30553"></span><div id="comment-30553" class="comment not_top_scorer"><div id="post-30553-score" class="comment-score"></div><div class="comment-text"><ul><li>packet #162 has \r\n right after Location</li><li>packet #10 has \r\n further down, not right after Location</li></ul><p>Could that be why? Will try to move Location closer to \r\n now )</p></div><div id="comment-30553-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:07)</span> Dmitriy</div></div><span id="30554"></span><div id="comment-30554" class="comment not_top_scorer"><div id="post-30554-score" class="comment-score"></div><div class="comment-text"><p>That's the separator between the header and the body. Look at the values in the hex bytes pane, no line terminator.</p><p>It appears that disabling either HTTP header or body reassembly allows it to display, but that probably just makes the HTTP dissector work with whatever's in the segment and if it reaches the end of the tvb it says job done.</p></div><div id="comment-30554-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:09)</span> grahamb ♦</div></div><span id="30555"></span><div id="comment-30555" class="comment not_top_scorer"><div id="post-30555-score" class="comment-score"></div><div class="comment-text"><p>@Kurt: your answers are almost always going to extremes with lots of details and stuff... I'm too lazy for that kind of thing :-)))</p></div><div id="comment-30555-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:09)</span> Jasper ♦♦</div></div><span id="30556"></span><div id="comment-30556" class="comment not_top_scorer"><div id="post-30556-score" class="comment-score"></div><div class="comment-text"><p>@Jasper, you're busy. Not lazy :-)</p></div><div id="comment-30556-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:10)</span> grahamb ♦</div></div><span id="30557"></span><div id="comment-30557" class="comment not_top_scorer"><div id="post-30557-score" class="comment-score"></div><div class="comment-text"><p>@grahamb, true, working on TraceWrangler every free minute... Silly me offered a Sharkfest talk about new features, so I only have 3 month left to put cool stuff in to have something to show for... yikes :-)</p></div><div id="comment-30557-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:12)</span> Jasper ♦♦</div></div><span id="30558"></span><div id="comment-30558" class="comment not_top_scorer"><div id="post-30558-score" class="comment-score"></div><div class="comment-text"><p>@dmitriy: try and let us know if it changes anything. If it does, add the info to the bug as well please.</p></div><div id="comment-30558-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:13)</span> Jasper ♦♦</div></div><span id="30559"></span><div id="comment-30559" class="comment not_top_scorer"><div id="post-30559-score" class="comment-score"></div><div class="comment-text"><p>@Jasper:</p><p>Just tried moving Location to the position just above \r\n - didn't help:</p><p>Content-Type: text/html; charset=iso-8859-1\r\n</p><p>Proxy-Connection: close\r\n</p><p>Location: <a href="https://hotspot.inmarsat.com/index?origUrl=http%3A%2F%2Fwww.bbc.co.uk%2F\r\n">https://hotspot.inmarsat.com/index?origUrl=http%3A%2F%2Fwww.bbc.co.uk%2F\r\n</a></p><p>\r\n</p></div><div id="comment-30559-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:20)</span> Dmitriy</div></div><span id="30562"></span><div id="comment-30562" class="comment not_top_scorer"><div id="post-30562-score" class="comment-score"></div><div class="comment-text"><p>@Dmitriy,</p><p><strong>Edit:</strong></p><p>OK, so I read the RFC. The body isn't terminated with a blank line, either the body length should be indicated in some way e.g. Content-Length header, or by the server closing the connection.</p><p>In this case the server closes the connection, but I think that currently in Wireshark there are no means for the tcp dissector to indicate to the http dissector that there is no more data to come to allow the reassembly to terminate.</p></div><div id="comment-30562-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:33)</span> grahamb ♦</div></div><span id="30565"></span><div id="comment-30565" class="comment not_top_scorer"><div id="post-30565-score" class="comment-score"></div><div class="comment-text"><p>@Graham:</p><p>Ah that one... just tried moving \r\n just before the body to the end of it to keep the packet length same: no luck I'm afraid...</p><p>Location: <a href="https://hotspot.inmarsat.com/index?origUrl=http%3A%2F%2Fwww.bbc.co.uk%2F\r\n">https://hotspot.inmarsat.com/index?origUrl=http%3A%2F%2Fwww.bbc.co.uk%2F\r\n</a></p><p>Content-Type: text/html; charset=iso-8859-1\r\n</p><p>Proxy-Connection: close\r\n</p><p>The document has moved\r\n</p></div><div id="comment-30565-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:44)</span> Dmitriy</div></div><span id="30566"></span><div id="comment-30566" class="comment not_top_scorer"><div id="post-30566-score" class="comment-score"></div><div class="comment-text"><p>@Dmitriy, I've edited my comment after reading the RFC.</p></div><div id="comment-30566-info" class="comment-info"><span class="comment-age">(07 Mar '14, 08:47)</span> grahamb ♦</div></div><span id="30567"></span><div id="comment-30567" class="comment not_top_scorer"><div id="post-30567-score" class="comment-score"></div><div class="comment-text"><p>@Graham:</p><p>So if we remove the body completely thus making packet #10 similar to packet #162 it should work? Also what if the appropriate parsing logic is enhanced with checking for the FIN flag?</p></div><div id="comment-30567-info" class="comment-info"><span class="comment-age">(07 Mar '14, 09:23)</span> Dmitriy</div></div><span id="30569"></span><div id="comment-30569" class="comment not_top_scorer"><div id="post-30569-score" class="comment-score"></div><div class="comment-text"><p>@Dmitriy</p><p>Yep, removing the body should work.</p><p>The latter case is more difficult, as the http dissector doesn't know, or need to know about the FIN flag. A normal application, such as a browser will see the stream being closed and then use whatever body has been received, Wireshark isn't really like that as it doesn't "understand" the protocols, just how they should be formatted on their layer.</p></div><div id="comment-30569-info" class="comment-info"><span class="comment-age">(07 Mar '14, 09:56)</span> grahamb ♦</div></div><span id="30570"></span><div id="comment-30570" class="comment not_top_scorer"><div id="post-30570-score" class="comment-score"></div><div class="comment-text"><p>@Graham:</p><p>Removing the body alone isn't good enough: looks like Wireshark doesn't like something about Content-Type field (it parses the packet as HTTP after I removed that field completely)</p><blockquote><p>In this case the server closes the connection, but I think that currently in Wireshark there are no means for the tcp dissector to indicate to the http dissector that there is no more data to come to allow the reassembly to terminate.</p></blockquote><p>Based on this comment from earlier I thought it's TCP dissector that signals "that's it" to the http dissector? Is it the other way round then?</p><p>Update: can further confirm that removing the body isn't necessary: removing Content-Type field is enough (after which the body is not decoded as ASCII text of course).</p></div><div id="comment-30570-info" class="comment-info"><span class="comment-age">(07 Mar '14, 10:07)</span> Dmitriy</div></div><span id="30571"></span><div id="comment-30571" class="comment not_top_scorer"><div id="post-30571-score" class="comment-score"></div><div class="comment-text"><p>Each dissector for a layer, e.g. tcp, calls dissectors for layers above it when it has data for them. It doesn't call them when it has no data, so the http dissector isn't called again for the tcp stream 0 after the data in packet 10. There would need to be a mechanism on that last call in packet 10 to say this is it, no more. I don't think that exists at the moment.</p></div><div id="comment-30571-info" class="comment-info"><span class="comment-age">(07 Mar '14, 10:22)</span> grahamb ♦</div></div><span id="30573"></span><div id="comment-30573" class="comment not_top_scorer"><div id="post-30573-score" class="comment-score"></div><div class="comment-text"><p>I thought tcp dissector could do that (i.e. signal to http dissector "no more data for you" by looking at the FIN flag in this tcp stream... looks like it's impossible/complicated.</p><p>Meanwhile as per my update above removing Content-Type field alone is sufficient. Not sure why though: perhaps because it just makes the body invisible w/o actually removing it?</p></div><div id="comment-30573-info" class="comment-info"><span class="comment-age">(07 Mar '14, 10:28)</span> Dmitriy</div></div><span id="30583"></span><div id="comment-30583" class="comment not_top_scorer"><div id="post-30583-score" class="comment-score"></div><div class="comment-text"><p>Removing the body means the http dissector isn't waiting for more data.</p></div><div id="comment-30583-info" class="comment-info"><span class="comment-age">(07 Mar '14, 14:30)</span> grahamb ♦</div></div><span id="30593"></span><div id="comment-30593" class="comment not_top_scorer"><div id="post-30593-score" class="comment-score"></div><div class="comment-text"><blockquote><p>going to extremes with lots of details and stuff...</p></blockquote><p>@Jasper: extremes? Well, I guess that depends on the perspective ;-) what you see here is my regular mode of operation. It would look differently if I were to go into my own definition of 'extremes' ;-)) I like 'details and stuff' ...</p></div><div id="comment-30593-info" class="comment-info"><span class="comment-age">(07 Mar '14, 22:24)</span> Kurt Knochner ♦</div></div><span id="30597"></span><div id="comment-30597" class="comment not_top_scorer"><div id="post-30597-score" class="comment-score"></div><div class="comment-text"><p>@Kurt: it's extreme compared to my mode of operation. But I'm lazy ;-)</p></div><div id="comment-30597-info" class="comment-info"><span class="comment-age">(08 Mar '14, 03:11)</span> Jasper ♦♦</div></div><span id="30598"></span><div id="comment-30598" class="comment not_top_scorer"><div id="post-30598-score" class="comment-score"></div><div class="comment-text"><p>@Graham:</p><blockquote><p>Removing the body means the http dissector isn't waiting for more data.</p></blockquote><p>Interesting why the same doesn't apply to the header as well then: can, say, a URL in Location field not be as long as to exceed one packet? (at least when taken together with the rest of the packet contents)</p><p>Anyway... would be great to see it fixed one day as this TCP segment reassembly option is apparently ON by default for a reason. The fix would save others time we lost trying to understand what's going on since our browser was successfully executing that redirection despite receiving no HTTP 302 packets whatsoever as it seemed initially )</p></div><div id="comment-30598-info" class="comment-info"><span class="comment-age">(08 Mar '14, 04:43)</span> Dmitriy</div></div><span id="52300"></span><div id="comment-52300" class="comment not_top_scorer"><div id="post-52300-score" class="comment-score"></div><div class="comment-text"><p>Hi All,</p><p>The original problem reported in this thread is now resolved using FIN flag: <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=9848">https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=9848</a></p><p>I've just come across the same symptom in a different scenario where neither of the 2 successive TCP packets making up an HTTP POST request carry FIN flag - they both carry only PSH and ACK flags (packets ##4-5): <a href="https://drive.google.com/file/d/0B31e47Ucqt4BdmttaGRscjE3QkU/view?usp=sharing">https://drive.google.com/file/d/0B31e47Ucqt4BdmttaGRscjE3QkU/view?usp=sharing</a></p><p>HTTP 200 OK response (packets ##9-10) is likewise affected.</p><p>Wondering if anything can be done about these too by chance? Disabling TCP Reassembly every time is a bit of a nuisance.</p><p>Many thanks in anticipation.</p></div><div id="comment-52300-info" class="comment-info"><span class="comment-age">(07 May '16, 16:19)</span> Dmitriy</div></div><span id="52314"></span><div id="comment-52314" class="comment not_top_scorer"><div id="post-52314-score" class="comment-score"></div><div class="comment-text"><p>The symptom I see with that comment is that frame 4 is marked as TCP ("TCP segment of a reassembled PDU") and frame 5 is marked as HTTP (because it's the second of the two segments containing the HTTP POST request in question).</p><p>Disabling TCP reassembly causes frame 4 to be marked as HTTP but not to show the full POST request and frame 5 to be marked as TCP, because it's not the <em>first</em> part of an HTTP request.</p><p>The underlying problem is that, when reassembly is enabled, all but the final segment of a message that spans multiple segments aren't marked with the protocol being reassembled. Fixing that might be possible, but it'd require more work. (I.e., mark frame 4 as HTTP, with the Info column saying it's part of a reassembled PDU, and frame 5 as HTTP, with the Info column saying it's a POST request.)</p></div><div id="comment-52314-info" class="comment-info"><span class="comment-age">(08 May '16, 11:44)</span> Guy Harris ♦♦</div></div><span id="52321"></span><div id="comment-52321" class="comment not_top_scorer"><div id="post-52321-score" class="comment-score"></div><div class="comment-text"><p>Thank you: makes sense. Do I file a new enhancement request or reopening 9848 makes more sense assuming it's possible?</p></div><div id="comment-52321-info" class="comment-info"><span class="comment-age">(08 May '16, 14:47)</span> Dmitriy</div></div><span id="52322"></span><div id="comment-52322" class="comment not_top_scorer"><div id="post-52322-score" class="comment-score"></div><div class="comment-text"><p>This isn't really the same issue as 9848, this is a separate one. The current situation has been around for a long time and hasn't been discussed much if at all, but don't let that stop you raising an enhancement request.</p></div><div id="comment-52322-info" class="comment-info"><span class="comment-age">(08 May '16, 14:58)</span> grahamb ♦</div></div><span id="52328"></span><div id="comment-52328" class="comment not_top_scorer"><div id="post-52328-score" class="comment-score"></div><div class="comment-text"><p>Done: <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=12411">https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=12411</a></p></div><div id="comment-52328-info" class="comment-info"><span class="comment-age">(08 May '16, 15:58)</span> Dmitriy</div></div></div><div id="comment-tools-30358" class="comment-tools"><span class="comments-showing"> showing 5 of 45 </span> <a href="#" class="show-all-comments-link">show 40 more comments</a></div><div class="clear"></div><div id="comment-30358-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

