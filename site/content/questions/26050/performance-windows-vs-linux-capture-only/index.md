+++
type = "question"
title = "Performance Windows vs Linux capture only"
description = '''At work I&#x27;ve been trying to setup a machine with the sole purpose of capturing traffic for later analysis. Linux seemed like the best option since it required very little resources. I&#x27;ve tried tshark, dumpcap and tcpdump. With all 3 command line tools it displays packet drops as high as 20% (I&#x27;m ass...'''
date = "2013-10-16T03:49:00Z"
lastmod = "2013-10-18T03:41:00Z"
weight = 26050
keywords = [ "windows", "capture", "linux" ]
aliases = [ "/questions/26050" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Performance Windows vs Linux capture only](/questions/26050/performance-windows-vs-linux-capture-only)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26050-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26050-score" class="post-score" title="current number of votes">0</div><span id="post-26050-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>At work I've been trying to setup a machine with the sole purpose of capturing traffic for later analysis.</p><p>Linux seemed like the best option since it required very little resources. I've tried tshark, dumpcap and tcpdump. With all 3 command line tools it displays packet drops as high as 20% (I'm assuming because the hardware can't handle the amount of traffic). So I tried with Windows and the number of dropped packets was 0...</p><p>Can anyone relate? Could this be the difference in libpcap and winpcap?</p><p>Test traffic (troughput and such) was the same.</p><p>Software used: Linux; Debian 7; libpcap v1.3.0-1; tshark v1.8.2-5; tcpdump v4.3.0-1 Windows; Windows XP SP3; winpcap v4.1.3; wireshark v1.10.2</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-windows" rel="tag" title="see questions tagged &#39;windows&#39;">windows</span> <span class="post-tag tag-link-capture" rel="tag" title="see questions tagged &#39;capture&#39;">capture</span> <span class="post-tag tag-link-linux" rel="tag" title="see questions tagged &#39;linux&#39;">linux</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>16 Oct '13, 03:49</strong></p><img src="https://secure.gravatar.com/avatar/69164e9eb695ef57ebd060c969360e41?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="psmul&#39;s gravatar image" /><p><span>psmul</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="psmul has one accepted answer">50%</span></p></div></div><div id="comments-container-26050" class="comments-container"><span id="26054"></span><div id="comment-26054" class="comment"><div id="post-26054-score" class="comment-score">1</div><div class="comment-text"><p>How many packet/s?(or Mbs) It's possible Winpcap does not report packet loss accurately do you have any way of verifying 0 packet drops and no drops on the interface?</p></div><div id="comment-26054-info" class="comment-info"><span class="comment-age">(16 Oct '13, 04:17)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26056"></span><div id="comment-26056" class="comment not_top_scorer"><div id="post-26056-score" class="comment-score"></div><div class="comment-text"><p>I've tried to relate the packet drops to the number of "TCP segment not seen" (the 'these are normal during capture start' warnings in the expert window) and as suspected, Windows shows only 8 or 10 while linux capture files show more then 1000</p></div><div id="comment-26056-info" class="comment-info"><span class="comment-age">(16 Oct '13, 04:44)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26058"></span><div id="comment-26058" class="comment not_top_scorer"><div id="post-26058-score" class="comment-score"></div><div class="comment-text"><p>Try tshark with -B 2 and -s 2000 on Linux to see if it makes a difference.</p></div><div id="comment-26058-info" class="comment-info"><span class="comment-age">(16 Oct '13, 05:47)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26060"></span><div id="comment-26060" class="comment not_top_scorer"><div id="post-26060-score" class="comment-score"></div><div class="comment-text"><p>Doesnt that mean I will capture less data per packet (so I might lose relevant data?)</p><p>ps. i've tried the -B option from 2MB - 25MB but no difference</p></div><div id="comment-26060-info" class="comment-info"><span class="comment-age">(16 Oct '13, 05:59)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26062"></span><div id="comment-26062" class="comment not_top_scorer"><div id="post-26062-score" class="comment-score"></div><div class="comment-text"><p>Do you see any packet over 2000 bytes?</p></div><div id="comment-26062-info" class="comment-info"><span class="comment-age">(16 Oct '13, 06:26)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26063"></span><div id="comment-26063" class="comment not_top_scorer"><div id="post-26063-score" class="comment-score"></div><div class="comment-text"><p>So far so good. I'm now running a test that will last for 30+ minutes. In the mean time, what affect will this have when analysing? Will it (most likely) cut data short (which means I can't read out the data) but still be able to see protocol, ports etc?</p></div><div id="comment-26063-info" class="comment-info"><span class="comment-age">(16 Oct '13, 06:40)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26064"></span><div id="comment-26064" class="comment"><div id="post-26064-score" class="comment-score">1</div><div class="comment-text"><p>Presumably if MTU ~1500 you will not miss anything unless there is jumboframes. If I undestod/remember correctly there is a problem with libpcap reserving buffer space of 65535 if no snaplength is defined making inefficient use of the buffer(s). I'm not sure which versions of libpcap has this problem(if it is a problem).</p></div><div id="comment-26064-info" class="comment-info"><span class="comment-age">(16 Oct '13, 06:47)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26065"></span><div id="comment-26065" class="comment not_top_scorer"><div id="post-26065-score" class="comment-score"></div><div class="comment-text"><p>Tried a snaplenght of 30.000 and still dropped some frames, Btw, just compiled latest version of libpcap and tcpdump and still same problem. Anyway, I'll let you know in a minute</p></div><div id="comment-26065-info" class="comment-info"><span class="comment-age">(16 Oct '13, 06:55)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26068"></span><div id="comment-26068" class="comment not_top_scorer"><div id="post-26068-score" class="comment-score"></div><div class="comment-text"><p>Too bad. 4,041,089 packets captured, 73,422 packets dropped :S</p></div><div id="comment-26068-info" class="comment-info"><span class="comment-age">(16 Oct '13, 07:15)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26074"></span><div id="comment-26074" class="comment not_top_scorer"><div id="post-26074-score" class="comment-score"></div><div class="comment-text"><p>Are you using capture filters? What HW do you use on Linux.</p></div><div id="comment-26074-info" class="comment-info"><span class="comment-age">(16 Oct '13, 08:59)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26075"></span><div id="comment-26075" class="comment not_top_scorer"><div id="post-26075-score" class="comment-score"></div><div class="comment-text"><p>No capture filters, fujitsu siemens esprimo D9510 laptop (test only)</p></div><div id="comment-26075-info" class="comment-info"><span class="comment-age">(16 Oct '13, 11:53)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26076"></span><div id="comment-26076" class="comment not_top_scorer"><div id="post-26076-score" class="comment-score"></div><div class="comment-text"><p>Same hardware for Linux and Windows?</p></div><div id="comment-26076-info" class="comment-info"><span class="comment-age">(16 Oct '13, 12:11)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26077"></span><div id="comment-26077" class="comment"><div id="post-26077-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>Tried a snaplenght of 30.000 and still dropped some frames</p></blockquote><p>If you mean 3*10^4 (i.e., the . is a thousands separator), that snapshot length is much higher than you need.</p><p>If this is Ethernet, and there are no jumbo frames, try a snapshot length of 1514.</p><p>(The problem to which Anders is referring is that the memory-mapped capture mechanism uses fixed-length slots for packets, so the slot size has to be the maximum packet size if the entire packet is to be captured. libpcap originally used the snapshot length for this, but the default snapshot length used by Wireshark/TShark/dumpcap is 65535, chosen to be "large enough", which is larger than the actual maximum snapshot size. Newer versions of libpcap will, on Ethernet, try to determine a smaller size and, if they can determine a smaller size, will use it.)</p></div><div id="comment-26077-info" class="comment-info"><span class="comment-age">(16 Oct '13, 12:25)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26078"></span><div id="comment-26078" class="comment not_top_scorer"><div id="post-26078-score" class="comment-score"></div><div class="comment-text"><p><span>@Kurt</span>: yes <span>@Guy</span>: I don't think I get it. Why would this be a problem? Concerning testing it with actually 1514, I will have to try tomorrow. I'll keep you posted</p></div><div id="comment-26078-info" class="comment-info"><span class="comment-age">(16 Oct '13, 12:32)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26079"></span><div id="comment-26079" class="comment not_top_scorer"><div id="post-26079-score" class="comment-score"></div><div class="comment-text"><p>Just for the fun of things, do you guys ever capture traffic using command line only tools? And do you abort them manually (so you can actually see any dropped packets when it closes down).</p><p>For I didn't even notice these errors while testing because my command line (was supposed to) start on bootup. When troubleshooting my Linux configuration I noticed it actually dropped a lot of traffic. In other words, it would have gone undetected (except for the lost tcp segements in expert info) if it wasn't for manually start and kill the command line tools.</p></div><div id="comment-26079-info" class="comment-info"><span class="comment-age">(16 Oct '13, 12:40)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26080"></span><div id="comment-26080" class="comment"><div id="post-26080-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>Why would this be a problem?</p></blockquote><p>It would be a problem because the size of the memory-mapped buffer is limited (make it too big and the kernel will refuse to let you allocate a chunk of wired-down kernel memory that large), and the bigger the per-packet slots are the fewer slots there are for packets are the buffer.</p></div><div id="comment-26080-info" class="comment-info"><span class="comment-age">(16 Oct '13, 12:43)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26081"></span><div id="comment-26081" class="comment not_top_scorer"><div id="post-26081-score" class="comment-score">1</div><div class="comment-text"><p>If you are using the same HW for Linux and Windows do you run Linix in a VM or do you have dual boot? I guess running in a VM may impact performance.</p></div><div id="comment-26081-info" class="comment-info"><span class="comment-age">(16 Oct '13, 13:10)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26082"></span><div id="comment-26082" class="comment not_top_scorer"><div id="post-26082-score" class="comment-score"></div><div class="comment-text"><p>so, capturing with -s0 (65k) is a bad idea, as there are fewer slots for packets in the kernel buffer?</p></div><div id="comment-26082-info" class="comment-info"><span class="comment-age">(16 Oct '13, 13:35)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26085"></span><div id="comment-26085" class="comment"><div id="post-26085-score" class="comment-score">2</div><div class="comment-text"><blockquote><p>so, capturing with -s0 (65k) is a bad idea, as there are fewer slots for packets in the kernel buffer?</p></blockquote><p>When capturing with the TPACKET_V1 and TPACKET_V2 memory-mapped capture mechanisms (which are the only memory-mapped capture mechanisms supported by current libpcap - TPACKET_V3 isn't currently supported - and which are used by libpcap if available), the larger the maximum packet size libpcap uses, the fewer packet slots there are.</p><p>With newer versions of libpcap, even with -s0 (65K snapshot length) will attempt to pick a "better" maximum packet size, i.e. the smallest needed to ensure that no packets are cut short. If there's segmentation offloading (so that a "packet" delivered to the adapter could be bigger than the maximum Ethernet packet size), or if the adapter isn't an Ethernet adapter, libpcap will fall back on the snapshot length as the maximum packet size, otherwise it'll use the MTU + 14 bytes for the Ethernet header.</p><p>So -s0 may mean "fewer slots", but it may also mean "you get all the bytes of the packet". Manually choosing an "appropriate" snapshot length would work better, but that's link-layer header type dependent, and some such headers (e.g., radiotap headers) are variable-length, so it's tricky.</p></div><div id="comment-26085-info" class="comment-info"><span class="comment-age">(16 Oct '13, 14:00)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26092"></span><div id="comment-26092" class="comment not_top_scorer"><div id="post-26092-score" class="comment-score"></div><div class="comment-text"><p>Interesting. I've never thought about the relationship between capture size and buffer space, as I did not know about those internals of libpcap. Thanks for pointing me to that 'issue'.</p></div><div id="comment-26092-info" class="comment-info"><span class="comment-age">(16 Oct '13, 16:11)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26099"></span><div id="comment-26099" class="comment not_top_scorer"><div id="post-26099-score" class="comment-score"></div><div class="comment-text"><p><span>@Anders</span>: No, not running in a VM. I just reinstall now and then.</p></div><div id="comment-26099-info" class="comment-info"><span class="comment-age">(16 Oct '13, 22:31)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26100"></span><div id="comment-26100" class="comment not_top_scorer"><div id="post-26100-score" class="comment-score">1</div><div class="comment-text"><p><span>@psmul</span> I usually capture on the command line using dumpcap when it is a capture that runs for more than a few minutes, and abort the capture by CTRL-C.</p><p>Since I use the PCAPng capture file format I can see the dropped frame count per file, because PCAPng does keep the number of dropped frames that dumpcap would have displayed. The drop count may not be completely accurate because there are multiple opportunities for packets to be dropped before making it into the capture file, and not all of them are noticed by dumpcap.</p></div><div id="comment-26100-info" class="comment-info"><span class="comment-age">(16 Oct '13, 22:31)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="26103"></span><div id="comment-26103" class="comment not_top_scorer"><div id="post-26103-score" class="comment-score"></div><div class="comment-text"><p>Using Ubuntu and snaplength of 1514, 1.179.216 packets captures, 0 drops! Looking good. Just going to reinstalling Debian, be back in an hour with test results</p></div><div id="comment-26103-info" class="comment-info"><span class="comment-age">(17 Oct '13, 00:42)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26107"></span><div id="comment-26107" class="comment not_top_scorer"><div id="post-26107-score" class="comment-score"></div><div class="comment-text"><p>Debian, new compiled libpcap and tcpdump, 1.831.616 packets captured, 3806 drops. I'll try again with the default repository versions. You figure the problem could be in the os ... ?!</p></div><div id="comment-26107-info" class="comment-info"><span class="comment-age">(17 Oct '13, 02:09)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26109"></span><div id="comment-26109" class="comment not_top_scorer"><div id="post-26109-score" class="comment-score">1</div><div class="comment-text"><p>Can you please just boot your Laptop with <a href="http://www.kali.org/">Kali Linux</a>, instead of installing Debian? Then capture there with tcpdump and/or dumpcap. Do you get the same results? If yes: strange. If no: Debian problem.</p></div><div id="comment-26109-info" class="comment-info"><span class="comment-age">(17 Oct '13, 02:20)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26121"></span><div id="comment-26121" class="comment not_top_scorer"><div id="post-26121-score" class="comment-score"></div><div class="comment-text"><p>Just did, 1.257.325 packets captured, 277 packets dropped. I'd say that could be due to hardware and high throughput. All in all, not to bad. I'll try again on my raspberry (this time with the Arch version instead of Raspbian) see what it does this time.</p><p>Edit: Just ran it again, 1.781.782 packets captures, 0 drops.</p><p>Could this be driver issues? Any other plausible explanation?</p></div><div id="comment-26121-info" class="comment-info"><span class="comment-age">(17 Oct '13, 04:42)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26122"></span><div id="comment-26122" class="comment not_top_scorer"><div id="post-26122-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Just did,</p></blockquote><p>with Kali, Debian or Windows?</p></div><div id="comment-26122-info" class="comment-info"><span class="comment-age">(17 Oct '13, 04:44)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26123"></span><div id="comment-26123" class="comment not_top_scorer"><div id="post-26123-score" class="comment-score"></div><div class="comment-text"><p>Sorry, with Kali</p></div><div id="comment-26123-info" class="comment-info"><span class="comment-age">(17 Oct '13, 04:50)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26125"></span><div id="comment-26125" class="comment not_top_scorer"><div id="post-26125-score" class="comment-score"></div><div class="comment-text"><p>O.K. so you do have more drops with Debian than with Kali? If so, it might be related to difference in the libpcap version or the kernel (driver, etc.)</p></div><div id="comment-26125-info" class="comment-info"><span class="comment-age">(17 Oct '13, 05:40)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26126"></span><div id="comment-26126" class="comment not_top_scorer"><div id="post-26126-score" class="comment-score"></div><div class="comment-text"><p>Raspberry still not working correctly, but chances are high its the hardware that can't handle the load. Anyway I'm marking this as solved and will stick to capturing on other distro's</p><p>Thanks for the assistance.</p></div><div id="comment-26126-info" class="comment-info"><span class="comment-age">(17 Oct '13, 07:15)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26130"></span><div id="comment-26130" class="comment not_top_scorer"><div id="post-26130-score" class="comment-score">1</div><div class="comment-text"><p>If some one is interested a co-worker just submitted a pull request to libpcap implementing TPACKET_v3 support <a href="https://github.com/the-tcpdump-group/libpcap/pull/325">https://github.com/the-tcpdump-group/libpcap/pull/325</a></p></div><div id="comment-26130-info" class="comment-info"><span class="comment-age">(17 Oct '13, 07:23)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="26134"></span><div id="comment-26134" class="comment not_top_scorer"><div id="post-26134-score" class="comment-score"></div><div class="comment-text"><p><span>@Jasper</span>:</p><blockquote>Since I use the PCAPng capture file format I can see the dropped frame count per file, because PCAPng does keep the number of dropped frames that dumpcap would have displayed.</blockquote><p>How does this work? I know the command line drops packets (it shows me when I kill command line) but when opening in Wireshark it does not show in the statusbar.</p></div><div id="comment-26134-info" class="comment-info"><span class="comment-age">(17 Oct '13, 07:50)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26136"></span><div id="comment-26136" class="comment not_top_scorer"><div id="post-26136-score" class="comment-score">1</div><div class="comment-text"><p>That's because Wireshark records the dropped packets per interface (which makes sense). The drop count in the status bar is only updated right after dumpcap is stopped.</p><p>To see the interface statistics after opening a file, go to Statistics -&gt; Sumary and take a look at the interface table in the middle of the dialog window.</p></div><div id="comment-26136-info" class="comment-info"><span class="comment-age">(17 Oct '13, 08:08)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="26138"></span><div id="comment-26138" class="comment not_top_scorer"><div id="post-26138-score" class="comment-score"></div><div class="comment-text"><blockquote><p>used in the same test.</p></blockquote><p>well, it was <strong>not</strong> the <strong>same</strong> test. If you want to compare results, you need a packet generator that generates the same data every time you test. Then you capture 10 times (or more) with Linux and 10 times with windows. You need more than a few tests with <strong>identical</strong> test parameters, to filter out CPU usage peaks or IO peaks that might have an influence on the test result. Then compare the content of the capture files with what you expected to get from the packet generator.</p><p>With that test method you would get far better and more realistic results ;-)) I'm not saying that windows might not perform better on a certain platform, but without a proper test environment (see differences of Debian and Kali!) there is a good chance to learn the wrong things from an experiment ;-))</p></div><div id="comment-26138-info" class="comment-info"><span class="comment-age">(17 Oct '13, 09:30)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26139"></span><div id="comment-26139" class="comment not_top_scorer"><div id="post-26139-score" class="comment-score"></div><div class="comment-text"><p>Very true,</p><p>Just couldn't believe I'm part of only a select few who was bothered by this. I was hoping, that more network admins (and sorts) were using cli linux for packet capturing and already knew why this happened or had a solution for this problem.</p><p>It didn't occur to me to spend <strong>that</strong> much time testing since the problem between Windows and Linux seemed so obvious. The more I was testing, the more blurred the lines became :)</p><p>I'll have to wait to get back to work tomorrow, but I'm gonna give that pf_ring a try. Maybe the problem is instantly solved... In the mean time hoping someone could verify this idea/solution.</p></div><div id="comment-26139-info" class="comment-info"><span class="comment-age">(17 Oct '13, 11:14)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26140"></span><div id="comment-26140" class="comment not_top_scorer"><div id="post-26140-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Would be logical to leave/display it at the statusbar.</p></blockquote><p>It probably would be. Please file an enhancement request on <a href="http://bugs.wireshark.org">the Wireshark bugzilla</a>.</p></div><div id="comment-26140-info" class="comment-info"><span class="comment-age">(17 Oct '13, 11:41)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26141"></span><div id="comment-26141" class="comment not_top_scorer"><div id="post-26141-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Found this interesting article: <a href="http://luca.ntop.org/Ring.pdf">Improving Passive Packet Capture: Beyond Device Polling</a></p></blockquote><p>It might be interesting to see results with newer versions of {Windows,Linux,FreeBSD,WinPcap,libpcap}.</p></div><div id="comment-26141-info" class="comment-info"><span class="comment-age">(17 Oct '13, 11:43)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26144"></span><div id="comment-26144" class="comment not_top_scorer"><div id="post-26144-score" class="comment-score"></div><div class="comment-text"><p>Would there be any rationale why WinPcap should be faster than libpcap?</p></div><div id="comment-26144-info" class="comment-info"><span class="comment-age">(17 Oct '13, 12:42)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="26145"></span><div id="comment-26145" class="comment not_top_scorer"><div id="post-26145-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Would there be any rationale why WinPcap should be faster than libpcap?</p></blockquote><p>Given that a lot of the performance issues are with the OS and its packet capture mechanism, you can't say anything is faster than or slower than libpcap without specifying the platform on which you're running libpcap; there's no <em>generic</em> reason why WinPcap would be faster than libpcap on all platforms other than "none of the UN*Xes on which libpcap runs have a capture mechanism that works as well as NDIS+the WinPcap driver".</p><p>The performance would also depend on the OS version and the libpcap/WinPcap version.</p></div><div id="comment-26145-info" class="comment-info"><span class="comment-age">(17 Oct '13, 12:58)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="26148"></span><div id="comment-26148" class="comment not_top_scorer"><div id="post-26148-score" class="comment-score"></div><div class="comment-text"><blockquote><p>there's no generic reason why WinPcap would be faster than libpcap on all platforms</p></blockquote><p>I tend to agree with that, although I don't know the internals of WinPcap or libpcap good enough for my own (internal) final résumé.</p><p>I've found this:</p><blockquote><p><a href="http://www.winpcap.org/docs/docs_412/html/group__NPF.html">http://www.winpcap.org/docs/docs_412/html/group__NPF.html</a></p></blockquote><p>Cite: 'When the kernel-level traffic logging feature of NPF is enabled, the capture driver addresses the file system directly, hence the path covered by the packets is the one of the red dotted arrow: only two buffers and a single copy are necessary, the number of system call is drastically reduced, therefore the performance is considerably better.'</p><p>That sounds like a (possible) advantage. <strong>Is there anything similar in libpcap?</strong></p><p>The function <a href="http://www.winpcap.org/docs/docs_412/html/group__wpcapfunc.html#gaedef54159d918b22a7de8e75b8a3ef4d">pcap_live_dump()</a> is not used in dumpcap, so there is no way to use/test that right now. However, there is sample code for a tool called <a href="http://www.winpcap.org/docs/docs_412/html/group__wpcap__tut7.html">kdump</a> (at the end of the page).</p><p>Would be interesting to see the difference of pcap_dump() in dumpcap and pcap_live_dump() in kdump. And that compared to libpcap on the systems you mentioned.</p></div><div id="comment-26148-info" class="comment-info"><span class="comment-age">(17 Oct '13, 14:35)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-26050" class="comment-tools"><span class="comments-showing"> showing 5 of 40 </span> <a href="#" class="show-all-comments-link">show 35 more comments</a></div><div class="clear"></div><div id="comment-26050-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="26137"></span>

<div id="answer-container-26137" class="answer accepted-answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26137-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26137-score" class="post-score" title="current number of votes">0</div><span id="post-26137-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="psmul has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p><span><span>@Jasper</span></span>:</p><p>Thanks for clearing that up. Would be logical to leave/display it at the statusbar. Anyway, without going off topic.</p><p>Has anyone ever experimented with pf_ring before ... ? Found this interesting article: <a href="http://luca.ntop.org/Ring.pdf">Improving Passive Packet Capture: Beyond Device Polling</a><br />
</p><p>I was wondering if this could boost performance. It actually describes everything I experienced.</p><blockquote><p>The experience learnt from this experiment is:<br />
<strong>• Out of the box, Windows and winpcap [winpcap], the port of libpcap to Win32, perform much better than other popular Unix-like OS.<br />
• Linux, a very popular OS used for running network appliances, performs very poorly with respect to other OSs used in the same test. <strong></strong></strong></p><blockquote></blockquote><p></strong></strong></p></blockquote></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Oct '13, 09:03</strong></p><img src="https://secure.gravatar.com/avatar/69164e9eb695ef57ebd060c969360e41?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="psmul&#39;s gravatar image" /><p><span>psmul</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="psmul has one accepted answer">50%</span> </br></br></p></div></div><div id="comments-container-26137" class="comments-container"><span id="26156"></span><div id="comment-26156" class="comment"><div id="post-26156-score" class="comment-score"></div><div class="comment-text"><p>Tested PF_RING several times on Debian (in my own little test setup, so nothing fancy) and worked like a charm. All captures went 1.000.000 + packets captured and not a single dropped packet. I'd say this solves my problem.</p><p>For future reference: <a href="http://www.ntop.org/products/pf_ring/">PF_RING by ntop.org</a></p></div><div id="comment-26156-info" class="comment-info"><span class="comment-age">(17 Oct '13, 23:52)</span> <span class="comment-user userinfo">psmul</span></div></div><span id="26163"></span><div id="comment-26163" class="comment"><div id="post-26163-score" class="comment-score"></div><div class="comment-text"><p>If you have the time to try the patch for TPACKET_V3 to libpcap as well and perhaps measure CPU load for the two cases that would be helpful too.</p></div><div id="comment-26163-info" class="comment-info"><span class="comment-age">(18 Oct '13, 03:41)</span> <span class="comment-user userinfo">Anders ♦</span></div></div></div><div id="comment-tools-26137" class="comment-tools"></div><div class="clear"></div><div id="comment-26137-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="26127"></span>

<div id="answer-container-26127" class="answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26127-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26127-score" class="post-score" title="current number of votes">0</div><span id="post-26127-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Problems arose on Raspbian and Debian. After better results on Ubuntu and near perfect results in Kali, I figure that's the problem.</p><p>Thanks for all the assistance.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Oct '13, 07:16</strong></p><img src="https://secure.gravatar.com/avatar/69164e9eb695ef57ebd060c969360e41?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="psmul&#39;s gravatar image" /><p><span>psmul</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="psmul has one accepted answer">50%</span> </br></p></div></div><div id="comments-container-26127" class="comments-container"></div><div id="comment-tools-26127" class="comment-tools"></div><div class="clear"></div><div id="comment-26127-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

