+++
type = "question"
title = "server sets win to zero in its syn+ack packet and resets the connection right after the completion of the three-way handshake"
description = '''Hi There, I recently run into the following issue and I hope that someone can shed some light on it. Our monitoring server sends tens of HTTP requests to our Web server every minute to measure its performance. Occasionally, a couple of those requests fail to establish TCP connections. The captured p...'''
date = "2015-09-22T12:38:00Z"
lastmod = "2015-09-24T15:00:00Z"
weight = 46066
keywords = [ "rst", "syn+ack", "zero-window" ]
aliases = [ "/questions/46066" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [server sets win to zero in its syn+ack packet and resets the connection right after the completion of the three-way handshake](/questions/46066/server-sets-win-to-zero-in-its-synack-packet-and-resets-the-connection-right-after-the-completion-of-the-three-way-handshake)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-46066-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi There,</p><p>I recently run into the following issue and I hope that someone can shed some light on it.</p><p>Our monitoring server sends tens of HTTP requests to our Web server every minute to measure its performance. Occasionally, a couple of those requests fail to establish TCP connections. The captured packets show that the Web server sets win to zero in its syn+ack packet and resets the connection right after the completion of the three-way handshake.</p><p>I would love to know</p><p>1) What condition(s) would cause such an issue?</p><p>2) If the reason is that the kernel run out of some resource, is there a way to monitor its usage &amp; upper bound?</p><p>All comments are welcome. Many thanks in advance!</p><p>Below packets were captured on the client (the monitoring server)</p><p>15:00:56.810144000 [Cli ---&gt; Svr] SYN Seq=0 Win=8192 Len=0 MSS=1460 WS=256 SACK_PERM=1</p><p>15:00:56.874678000 [Svr ---&gt; Cli] SYN, ACK Seq=0 Ack=1 Win=0 Len=0 MSS=1380</p><p>15:00:56.874740000 [Cli ---&gt; Svr] ACK Seq=1 Ack=1 Win=64860 Len=0</p><p>15:00:56.939406000 [Svr ---&gt; Cli] RST Seq=1 Win=0 Len=0</p><p>The CPU utilization of the Web server stays below 50% all the time. According to "netstat -s", TCP CurrEstab never exceeds 80 and there are 0 ListenOverflows, 0 TCPBacklogDrop, 0 PruneCalled, 0 TCPMemoryPressures, and 0 TWRecycled.</p><p>The output of "sysctl -a |grep net" is as follows:</p><p>net.netfilter.nf_log.0 = NONE</p><p>net.netfilter.nf_log.1 = NONE</p><p>net.netfilter.nf_log.2 = NONE</p><p>net.netfilter.nf_log.3 = NONE</p><p>net.netfilter.nf_log.4 = NONE</p><p>net.netfilter.nf_log.5 = NONE</p><p>net.netfilter.nf_log.6 = NONE</p><p>net.netfilter.nf_log.7 = NONE</p><p>net.netfilter.nf_log.8 = NONE</p><p>net.netfilter.nf_log.9 = NONE</p><p>net.netfilter.nf_log.10 = NONE</p><p>net.netfilter.nf_log.11 = NONE</p><p>net.netfilter.nf_log.12 = NONE</p><p>net.core.somaxconn = 4096</p><p>net.core.xfrm_aevent_etime = 10</p><p>net.core.xfrm_aevent_rseqth = 2</p><p>net.core.xfrm_larval_drop = 1</p><p>net.core.xfrm_acq_expires = 30</p><p>net.core.wmem_max = 4194304</p><p>net.core.rmem_max = 4194304</p><p>net.core.wmem_default = 124928</p><p>net.core.rmem_default = 124928</p><p>net.core.dev_weight = 64</p><p>net.core.netdev_max_backlog = 1000</p><p>net.core.message_cost = 5</p><p>net.core.message_burst = 10</p><p>net.core.optmem_max = 20480</p><p>net.core.rps_sock_flow_entries = 0</p><p>net.core.busy_poll = 0</p><p>net.core.busy_read = 0</p><p>net.core.netdev_budget = 300</p><p>net.core.warnings = 1</p><p>net.ipv4.route.gc_thresh = 524288</p><p>net.ipv4.route.max_size = 8388608</p><p>net.ipv4.route.gc_min_interval = 0</p><p>net.ipv4.route.gc_min_interval_ms = 500</p><p>net.ipv4.route.gc_timeout = 300</p><p>net.ipv4.route.gc_interval = 60</p><p>net.ipv4.route.redirect_load = 20</p><p>net.ipv4.route.redirect_number = 9</p><p>net.ipv4.route.redirect_silence = 20480</p><p>net.ipv4.route.error_cost = 1000</p><p>net.ipv4.route.error_burst = 5000</p><p>net.ipv4.route.gc_elasticity = 8</p><p>net.ipv4.route.mtu_expires = 600</p><p>net.ipv4.route.min_pmtu = 552</p><p>net.ipv4.route.min_adv_mss = 256</p><p>net.ipv4.route.secret_interval = 600</p><p>net.ipv4.neigh.default.mcast_solicit = 3</p><p>net.ipv4.neigh.default.ucast_solicit = 3</p><p>net.ipv4.neigh.default.app_solicit = 0</p><p>net.ipv4.neigh.default.retrans_time = 99</p><p>net.ipv4.neigh.default.base_reachable_time = 30</p><p>net.ipv4.neigh.default.delay_first_probe_time = 5</p><p>net.ipv4.neigh.default.gc_stale_time = 60</p><p>net.ipv4.neigh.default.unres_qlen = 3</p><p>net.ipv4.neigh.default.proxy_qlen = 64</p><p>net.ipv4.neigh.default.anycast_delay = 99</p><p>net.ipv4.neigh.default.proxy_delay = 79</p><p>net.ipv4.neigh.default.locktime = 99</p><p>net.ipv4.neigh.default.retrans_time_ms = 1000</p><p>net.ipv4.neigh.default.base_reachable_time_ms = 30000</p><p>net.ipv4.neigh.default.gc_interval = 30</p><p>net.ipv4.neigh.default.gc_thresh1 = 128</p><p>net.ipv4.neigh.default.gc_thresh2 = 512</p><p>net.ipv4.neigh.default.gc_thresh3 = 1024</p><p>net.ipv4.neigh.lo.mcast_solicit = 3</p><p>net.ipv4.neigh.lo.ucast_solicit = 3</p><p>net.ipv4.neigh.lo.app_solicit = 0</p><p>net.ipv4.neigh.lo.retrans_time = 99</p><p>net.ipv4.neigh.lo.base_reachable_time = 30</p><p>net.ipv4.neigh.lo.delay_first_probe_time = 5</p><p>net.ipv4.neigh.lo.gc_stale_time = 60</p><p>net.ipv4.neigh.lo.unres_qlen = 3</p><p>net.ipv4.neigh.lo.proxy_qlen = 64</p><p>net.ipv4.neigh.lo.anycast_delay = 99</p><p>net.ipv4.neigh.lo.proxy_delay = 79</p><p>net.ipv4.neigh.lo.locktime = 99</p><p>net.ipv4.neigh.lo.retrans_time_ms = 1000</p><p>net.ipv4.neigh.lo.base_reachable_time_ms = 30000</p><p>net.ipv4.neigh.eth0.mcast_solicit = 3</p><p>net.ipv4.neigh.eth0.ucast_solicit = 3</p><p>net.ipv4.neigh.eth0.app_solicit = 0</p><p>net.ipv4.neigh.eth0.retrans_time = 99</p><p>net.ipv4.neigh.eth0.base_reachable_time = 30</p><p>net.ipv4.neigh.eth0.delay_first_probe_time = 5</p><p>net.ipv4.neigh.eth0.gc_stale_time = 60</p><p>net.ipv4.neigh.eth0.unres_qlen = 3</p><p>net.ipv4.neigh.eth0.proxy_qlen = 64</p><p>net.ipv4.neigh.eth0.anycast_delay = 99</p><p>net.ipv4.neigh.eth0.proxy_delay = 79</p><p>net.ipv4.neigh.eth0.locktime = 99</p><p>net.ipv4.neigh.eth0.retrans_time_ms = 1000</p><p>net.ipv4.neigh.eth0.base_reachable_time_ms = 30000</p><p>net.ipv4.tcp_timestamps = 1</p><p>net.ipv4.tcp_window_scaling = 1</p><p>net.ipv4.tcp_sack = 1</p><p>net.ipv4.tcp_retrans_collapse = 1</p><p>net.ipv4.ip_default_ttl = 64</p><p>net.ipv4.ip_no_pmtu_disc = 0</p><p>net.ipv4.ip_nonlocal_bind = 0</p><p>net.ipv4.tcp_syn_retries = 5</p><p>net.ipv4.tcp_synack_retries = 5</p><p>net.ipv4.tcp_max_orphans = 262144</p><p>net.ipv4.tcp_max_tw_buckets = 1440000</p><p>net.ipv4.ip_dynaddr = 0</p><p>net.ipv4.tcp_keepalive_time = 1800</p><p>net.ipv4.tcp_keepalive_probes = 9</p><p>net.ipv4.tcp_keepalive_intvl = 75</p><p>net.ipv4.tcp_retries1 = 3</p><p>net.ipv4.tcp_retries2 = 15</p><p>net.ipv4.tcp_fin_timeout = 15</p><p>net.ipv4.tcp_syncookies = 1</p><p>net.ipv4.tcp_tw_recycle = 0</p><p>net.ipv4.tcp_abort_on_overflow = 0</p><p>net.ipv4.tcp_stdurg = 0</p><p>net.ipv4.tcp_rfc1337 = 0</p><p>net.ipv4.tcp_max_syn_backlog = 4096</p><p>net.ipv4.ip_local_port_range = 16384 61000</p><p>net.ipv4.ip_local_reserved_ports =</p><p>net.ipv4.igmp_max_memberships = 20</p><p>net.ipv4.igmp_max_msf = 10</p><p>net.ipv4.inet_peer_threshold = 65664</p><p>net.ipv4.inet_peer_minttl = 120</p><p>net.ipv4.inet_peer_maxttl = 600</p><p>net.ipv4.inet_peer_gc_mintime = 10</p><p>net.ipv4.inet_peer_gc_maxtime = 120</p><p>net.ipv4.tcp_orphan_retries = 0</p><p>net.ipv4.tcp_fack = 1</p><p>net.ipv4.tcp_reordering = 3</p><p>net.ipv4.tcp_ecn = 2</p><p>net.ipv4.tcp_dsack = 1</p><p>net.ipv4.tcp_mem = 1141728 1522304 2283456</p><p>net.ipv4.tcp_wmem = 4096 16384 4194304</p><p>net.ipv4.tcp_rmem = 4096 87380 4194304</p><p>net.ipv4.tcp_app_win = 31</p><p>net.ipv4.tcp_adv_win_scale = 2</p><p>net.ipv4.tcp_tw_reuse = 1</p><p>net.ipv4.tcp_frto = 2</p><p>net.ipv4.tcp_frto_response = 0</p><p>net.ipv4.tcp_low_latency = 0</p><p>net.ipv4.tcp_no_metrics_save = 0</p><p>net.ipv4.tcp_moderate_rcvbuf = 1</p><p>net.ipv4.tcp_tso_win_divisor = 3</p><p>net.ipv4.tcp_congestion_control = cubic</p><p>net.ipv4.tcp_abc = 0</p><p>net.ipv4.tcp_mtu_probing = 0</p><p>net.ipv4.tcp_base_mss = 512</p><p>net.ipv4.tcp_workaround_signed_windows = 0</p><p>net.ipv4.tcp_challenge_ack_limit = 100</p><p>net.ipv4.tcp_limit_output_bytes = 131072</p><p>net.ipv4.tcp_dma_copybreak = 4096</p><p>net.ipv4.tcp_slow_start_after_idle = 1</p><p>net.ipv4.cipso_cache_enable = 1</p><p>net.ipv4.cipso_cache_bucket_size = 10</p><p>net.ipv4.cipso_rbm_optfmt = 0</p><p>net.ipv4.cipso_rbm_strictvalid = 1</p><p>net.ipv4.tcp_available_congestion_control = cubic reno</p><p>net.ipv4.tcp_allowed_congestion_control = cubic reno</p><p>net.ipv4.tcp_max_ssthresh = 0</p><p>net.ipv4.tcp_thin_linear_timeouts = 0</p><p>net.ipv4.tcp_thin_dupack = 0</p><p>net.ipv4.tcp_min_tso_segs = 2</p><p>net.ipv4.udp_mem = 1141728 1522304 2283456</p><p>net.ipv4.udp_rmem_min = 4096</p><p>net.ipv4.udp_wmem_min = 4096</p><p>net.ipv4.conf.all.forwarding = 0</p><p>net.ipv4.conf.all.mc_forwarding = 0</p><p>net.ipv4.conf.all.accept_redirects = 0</p><p>net.ipv4.conf.all.secure_redirects = 0</p><p>net.ipv4.conf.all.shared_media = 1</p><p>net.ipv4.conf.all.rp_filter = 0</p><p>net.ipv4.conf.all.send_redirects = 0</p><p>net.ipv4.conf.all.accept_source_route = 0</p><p>net.ipv4.conf.all.src_valid_mark = 0</p><p>net.ipv4.conf.all.proxy_arp = 0</p><p>net.ipv4.conf.all.medium_id = 0</p><p>net.ipv4.conf.all.bootp_relay = 0</p><p>net.ipv4.conf.all.log_martians = 0</p><p>net.ipv4.conf.all.tag = 0</p><p>net.ipv4.conf.all.arp_filter = 0</p><p>net.ipv4.conf.all.arp_announce = 0</p><p>net.ipv4.conf.all.arp_ignore = 0</p><p>net.ipv4.conf.all.arp_accept = 0</p><p>net.ipv4.conf.all.arp_notify = 0</p><p>net.ipv4.conf.all.proxy_arp_pvlan = 0</p><p>net.ipv4.conf.all.disable_xfrm = 0</p><p>net.ipv4.conf.all.disable_policy = 0</p><p>net.ipv4.conf.all.force_igmp_version = 0</p><p>net.ipv4.conf.all.promote_secondaries = 0</p><p>net.ipv4.conf.all.accept_local = 0</p><p>net.ipv4.conf.all.route_localnet = 0</p><p>net.ipv4.conf.default.forwarding = 0</p><p>net.ipv4.conf.default.mc_forwarding = 0</p><p>net.ipv4.conf.default.accept_redirects = 0</p><p>net.ipv4.conf.default.secure_redirects = 0</p><p>net.ipv4.conf.default.shared_media = 1</p><p>net.ipv4.conf.default.rp_filter = 0</p><p>net.ipv4.conf.default.send_redirects = 0</p><p>net.ipv4.conf.default.accept_source_route = 0</p><p>net.ipv4.conf.default.src_valid_mark = 0</p><p>net.ipv4.conf.default.proxy_arp = 0</p><p>net.ipv4.conf.default.medium_id = 0</p><p>net.ipv4.conf.default.bootp_relay = 0</p><p>net.ipv4.conf.default.log_martians = 0</p><p>net.ipv4.conf.default.tag = 0</p><p>net.ipv4.conf.default.arp_filter = 0</p><p>net.ipv4.conf.default.arp_announce = 0</p><p>net.ipv4.conf.default.arp_ignore = 0</p><p>net.ipv4.conf.default.arp_accept = 0</p><p>net.ipv4.conf.default.arp_notify = 0</p><p>net.ipv4.conf.default.proxy_arp_pvlan = 0</p><p>net.ipv4.conf.default.disable_xfrm = 0</p><p>net.ipv4.conf.default.disable_policy = 0</p><p>net.ipv4.conf.default.force_igmp_version = 0</p><p>net.ipv4.conf.default.promote_secondaries = 0</p><p>net.ipv4.conf.default.accept_local = 0</p><p>net.ipv4.conf.default.route_localnet = 0</p><p>net.ipv4.conf.lo.forwarding = 0</p><p>net.ipv4.conf.lo.mc_forwarding = 0</p><p>net.ipv4.conf.lo.accept_redirects = 0</p><p>net.ipv4.conf.lo.secure_redirects = 1</p><p>net.ipv4.conf.lo.shared_media = 1</p><p>net.ipv4.conf.lo.rp_filter = 1</p><p>net.ipv4.conf.lo.send_redirects = 1</p><p>net.ipv4.conf.lo.accept_source_route = 0</p><p>net.ipv4.conf.lo.src_valid_mark = 0</p><p>net.ipv4.conf.lo.proxy_arp = 0</p><p>net.ipv4.conf.lo.medium_id = 0</p><p>net.ipv4.conf.lo.bootp_relay = 0</p><p>net.ipv4.conf.lo.log_martians = 0</p><p>net.ipv4.conf.lo.tag = 0</p><p>net.ipv4.conf.lo.arp_filter = 0</p><p>net.ipv4.conf.lo.arp_announce = 0</p><p>net.ipv4.conf.lo.arp_ignore = 0</p><p>net.ipv4.conf.lo.arp_accept = 0</p><p>net.ipv4.conf.lo.arp_notify = 0</p><p>net.ipv4.conf.lo.proxy_arp_pvlan = 0</p><p>net.ipv4.conf.lo.disable_xfrm = 1</p><p>net.ipv4.conf.lo.disable_policy = 1</p><p>net.ipv4.conf.lo.force_igmp_version = 0</p><p>net.ipv4.conf.lo.promote_secondaries = 0</p><p>net.ipv4.conf.lo.accept_local = 0</p><p>net.ipv4.conf.lo.route_localnet = 0</p><p>net.ipv4.conf.eth0.forwarding = 0</p><p>net.ipv4.conf.eth0.mc_forwarding = 0</p><p>net.ipv4.conf.eth0.accept_redirects = 0</p><p>net.ipv4.conf.eth0.secure_redirects = 0</p><p>net.ipv4.conf.eth0.shared_media = 1</p><p>net.ipv4.conf.eth0.rp_filter = 0</p><p>net.ipv4.conf.eth0.send_redirects = 0</p><p>net.ipv4.conf.eth0.accept_source_route = 0</p><p>net.ipv4.conf.eth0.src_valid_mark = 0</p><p>net.ipv4.conf.eth0.proxy_arp = 0</p><p>net.ipv4.conf.eth0.medium_id = 0</p><p>net.ipv4.conf.eth0.bootp_relay = 0</p><p>net.ipv4.conf.eth0.log_martians = 0</p><p>net.ipv4.conf.eth0.tag = 0</p><p>net.ipv4.conf.eth0.arp_filter = 0</p><p>net.ipv4.conf.eth0.arp_announce = 0</p><p>net.ipv4.conf.eth0.arp_ignore = 0</p><p>net.ipv4.conf.eth0.arp_accept = 0</p><p>net.ipv4.conf.eth0.arp_notify = 0</p><p>net.ipv4.conf.eth0.proxy_arp_pvlan = 0</p><p>net.ipv4.conf.eth0.disable_xfrm = 0</p><p>net.ipv4.conf.eth0.disable_policy = 0</p><p>net.ipv4.conf.eth0.force_igmp_version = 0</p><p>net.ipv4.conf.eth0.promote_secondaries = 0</p><p>net.ipv4.conf.eth0.accept_local = 0</p><p>net.ipv4.conf.eth0.route_localnet = 0</p><p>net.ipv4.ip_forward = 0</p><p>net.ipv4.xfrm4_gc_thresh = 4194304</p><p>net.ipv4.ipfrag_high_thresh = 4194304</p><p>net.ipv4.ipfrag_low_thresh = 3145728</p><p>net.ipv4.ipfrag_time = 30</p><p>net.ipv4.icmp_echo_ignore_all = 0</p><p>net.ipv4.icmp_echo_ignore_broadcasts = 1</p><p>net.ipv4.icmp_ignore_bogus_error_responses = 1</p><p>net.ipv4.icmp_errors_use_inbound_ifaddr = 0</p><p>net.ipv4.icmp_ratelimit = 1000</p><p>net.ipv4.icmp_ratemask = 6168</p><p>net.ipv4.rt_cache_rebuild_count = 4</p><p>net.ipv4.ping_group_range = 1 0</p><p>net.ipv4.ipfrag_secret_interval = 600</p><p>net.ipv4.ipfrag_max_dist = 64</p><p>net.unix.max_dgram_qlen = 10</p></div><div id="question-tags" class="tags-container tags">rst syn+ack zero-window</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>22 Sep '15, 12:38</strong></p><img src="https://secure.gravatar.com/avatar/083b3e62968211b9f8af32b9431b502a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="kemaru&#39;s gravatar image" /><p>kemaru<br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="kemaru has no accepted answers">0%</span></p></div></div><div id="comments-container-46066" class="comments-container"></div><div id="comment-tools-46066" class="comment-tools"></div><div class="clear"></div><div id="comment-46066-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="46127"></span>

<div id="answer-container-46127" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-46127-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p><em>Usually</em> if the kernel hits some resource issue, you would see unanswered SYNs (though that is not always true).<br />
</p><p>At first glance, it may be that syn cookies are kicking in and the server is not getting a valid response in that ACK packet.</p><p>In your netstat -s output, there should be a line item for "invalid SYN cookies received." You <em>may</em> want to check that as the problem occurs to see if that is what you are hitting. If you suspect that, you may want to grab another capture and turn of "Relative Sequence Numbers" to aid in analysis of the client response.</p><p>If you suspect that invalid syn cookie responses is the issue, another quick way to check for that issue would be to set net.ipv4.tcp_syncookies = 0. (I don't recall, off-hand, if that requires a system restart)</p><p>$0.02</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>24 Sep '15, 15:00</strong></p><img src="https://secure.gravatar.com/avatar/ad02d2c94bb362339b32ac9e2ca8468e?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Qwert&#39;s gravatar image" /><p>Qwert<br />
<span class="score" title="16 reputation points">16</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Qwert has no accepted answers">0%</span> </br></p></div></div><div id="comments-container-46127" class="comments-container"></div><div id="comment-tools-46127" class="comment-tools"></div><div class="clear"></div><div id="comment-46127-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

