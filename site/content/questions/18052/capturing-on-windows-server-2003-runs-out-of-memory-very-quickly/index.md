+++
type = "question"
title = "Capturing on Windows Server 2003 runs out of memory very quickly"
description = '''I have been testing Wireshark v1.8.4, 32-bit version on Windows 2003 Server (32-bit, 2gig memory), Windows XP (32-bit 2gig memory) and Windows 7 (64-bit 4gig memory). All just monitoring short packets. The Windows 2003 Server use up memory much faster, and does not release it when you &quot;restart&quot; the ...'''
date = "2013-01-29T12:02:00Z"
lastmod = "2013-04-12T03:25:00Z"
weight = 18052
keywords = [ "windows", "capture", "2003", "out-of-memory", "server" ]
aliases = [ "/questions/18052" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Capturing on Windows Server 2003 runs out of memory very quickly](/questions/18052/capturing-on-windows-server-2003-runs-out-of-memory-very-quickly)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-18052-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-18052-score" class="post-score" title="current number of votes">0</div><span id="post-18052-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I have been testing Wireshark v1.8.4, 32-bit version on Windows 2003 Server (32-bit, 2gig memory), Windows XP (32-bit 2gig memory) and Windows 7 (64-bit 4gig memory). All just monitoring short packets. The Windows 2003 Server use up memory much faster, and does not release it when you "restart" the capture or when you are capturing to disk, limit 10MB. Windows 7 and XP can capture over 1 million packets before running out of memory. Windows 2003 Server will run out of memory around 50,000 packets.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-windows" rel="tag" title="see questions tagged &#39;windows&#39;">windows</span> <span class="post-tag tag-link-capture" rel="tag" title="see questions tagged &#39;capture&#39;">capture</span> <span class="post-tag tag-link-2003" rel="tag" title="see questions tagged &#39;2003&#39;">2003</span> <span class="post-tag tag-link-out-of-memory" rel="tag" title="see questions tagged &#39;out-of-memory&#39;">out-of-memory</span> <span class="post-tag tag-link-server" rel="tag" title="see questions tagged &#39;server&#39;">server</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>29 Jan '13, 12:02</strong></p><img src="https://secure.gravatar.com/avatar/96d66ec4a4b71e2cc5cb819045bd6393?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SonomaDave&#39;s gravatar image" /><p><span>SonomaDave</span><br />
<span class="score" title="11 reputation points">11</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SonomaDave has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> converted to question <strong>30 Jan '13, 00:12</strong> </span></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-18052" class="comments-container"><span id="18057"></span><div id="comment-18057" class="comment"><div id="post-18057-score" class="comment-score"></div><div class="comment-text"><p>Could you try the just released 1.8.5 which has a newer GTK? A test with a development build of 1.9.0 would be useful too.</p></div><div id="comment-18057-info" class="comment-info"><span class="comment-age">(29 Jan '13, 15:21)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="18124"></span><div id="comment-18124" class="comment"><div id="post-18124-score" class="comment-score"></div><div class="comment-text"><p>Same problem with 1.8.5. I have traced it with VS 2010 Express and it looks like it is in the GTK. Specifically, the call in function add_byte_tab() in main_proto_draw.c (line 763 in v1.8.4): gtk_container_get(... increase memory usage in Wireshark by 164K bytes under Windows Server 2003, but only 4K bytes under Windows XP. This was moving from 1st to 2nd frame of a captured file.</p><p>I can send you the captured file, if you wish. The capture file is 973K bytes in size, but will run out of memory in the 2gig Windows Server when you move down through the file.</p><p>Where can I download 1.9.0?</p></div><div id="comment-18124-info" class="comment-info"><span class="comment-age">(30 Jan '13, 12:45)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18132"></span><div id="comment-18132" class="comment"><div id="post-18132-score" class="comment-score"></div><div class="comment-text"><p>Also, has anyone had experience with running Wireshark on Windows Server 2008? If so, is the Wireshark memory usage on Windows Server 2008 like Windows 7 and XP, or is it like Windows Server 2003? I can provide a captured file if someone can try Windows Server 2008. Thanks....</p></div><div id="comment-18132-info" class="comment-info"><span class="comment-age">(30 Jan '13, 14:01)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18137"></span><div id="comment-18137" class="comment"><div id="post-18137-score" class="comment-score"></div><div class="comment-text"><p>You can download development builds frome here <a href="http://www.wireshark.org/download/automated/">http://www.wireshark.org/download/automated/</a></p></div><div id="comment-18137-info" class="comment-info"><span class="comment-age">(30 Jan '13, 14:37)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="18139"></span><div id="comment-18139" class="comment"><div id="post-18139-score" class="comment-score"></div><div class="comment-text"><p>I installed Wireshark-win32-1.9.0-SVN-47367.exe. Same problem. After loading the captured file, if I move down through the frames one at a time, by the time I get to frame 1600, Wireshark is using 1.5 Gig of memory on Windows Server 2003.</p><p>On Windows 7 or XP, when I do the same thing, the memory usage fluctuates up and down within a 3 meg range. The capture file is only 973K bytes long and has 2953 frames. Viewing all 2953 frame this way, Wireshark only is using 86Meg of memory on Windows XP.</p><p>I am going to try in install a trial version of Windows Server 2008 R2 to see what happens on it.</p></div><div id="comment-18139-info" class="comment-info"><span class="comment-age">(30 Jan '13, 15:49)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18142"></span><div id="comment-18142" class="comment not_top_scorer"><div id="post-18142-score" class="comment-score"></div><div class="comment-text"><p>Good news. No problem on Windows Server 2008, 32-bit. I am able to scan through the 2953 frames of my capture file with Wireshark using only 43 Meg of memory. A far cry from 1.5 Gig on Windows Server 2003. Thanks Anders for your help.</p></div><div id="comment-18142-info" class="comment-info"><span class="comment-age">(30 Jan '13, 19:30)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18144"></span><div id="comment-18144" class="comment not_top_scorer"><div id="post-18144-score" class="comment-score"></div><div class="comment-text"><p>I have to retract my last comment. Here is the latest. Note: Windows servers are running as VM under Redhat Linux using xen. -Wireshark memory problem occurs on both Windows Server 2003 and Windows Server 2008, 32 bit version, when logged in via MS Remote Desktop. -Wireshark memory problem does NOT occur when logged in to the xen console to Windows Server 2003 and 2008. -Wireshark memory problem does NOT occur when logged in to Windows 7 64-bit via MS Remote Desktop. Windows 7 running native on Dell PC. Wireshark is 32-bit version.</p><p>Next up, Windows Server 2008 R2, 64-bit.</p></div><div id="comment-18144-info" class="comment-info"><span class="comment-age">(30 Jan '13, 22:57)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18145"></span><div id="comment-18145" class="comment not_top_scorer"><div id="post-18145-score" class="comment-score"></div><div class="comment-text"><p>I have just completed my test on Windows Server 2008 R2, 64-bit, running as VM under RHEL with xen. Results are same as on 32-bit: -Wireshark memory problem occurs on both Windows Server 2008 R2, 64 bit, when logged in via MS Remote Desktop. Both Wireshark 32-bit and 64-bit have the problem.</p><p>-Wireshark memory problem does NOT occur when logged in to the xen console to Windows Server 2008 R2, 64-bit. Both Wireshark 32-bit and 64-bit do NOT have the problem.</p><p>The common theme of when the problem occurs is Windows Server 2003, 2008 32-bit, or 2008 64-bit when logged in via MS Remote Desktop.</p></div><div id="comment-18145-info" class="comment-info"><span class="comment-age">(30 Jan '13, 23:23)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18149"></span><div id="comment-18149" class="comment not_top_scorer"><div id="post-18149-score" class="comment-score"></div><div class="comment-text"><p>So the memory problem may be in the remotedesktop or GTK in any case not much Wireshark developers can do about it.</p></div><div id="comment-18149-info" class="comment-info"><span class="comment-age">(31 Jan '13, 00:28)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="18153"></span><div id="comment-18153" class="comment not_top_scorer"><div id="post-18153-score" class="comment-score"></div><div class="comment-text"><p>Remote Desktop does some funky things with the graphics, I've seen issue with other applications. As <span>@Anders</span> says this is likely to be GTK issue. Please file an issue with the bug tracker, attaching the capture that shows the issue.</p></div><div id="comment-18153-info" class="comment-info"><span class="comment-age">(31 Jan '13, 01:22)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="18187"></span><div id="comment-18187" class="comment not_top_scorer"><div id="post-18187-score" class="comment-score"></div><div class="comment-text"><p>Bug 8281 - Wireshark out-of-memory crash on Windows Server when logged in via Remote Desktop</p></div><div id="comment-18187-info" class="comment-info"><span class="comment-age">(31 Jan '13, 12:39)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="18378"></span><div id="comment-18378" class="comment not_top_scorer"><div id="post-18378-score" class="comment-score"></div><div class="comment-text"><p>Looks like gtk is causing the same problem with deluge. See: <a href="http://www.mail-archive.com/deluge-dev@googlegroups.com/msg02359.html">http://www.mail-archive.com/<span class="__cf_email__" data-cfemail="cda9a8a1b8aaa8e0a9a8bb8daaa2a2aaa1a8aabfa2b8bdbee3aea2a0">[email protected]</span>/msg02359.html</a></p><p>In looking at gtk bugs I found: <a href="https://bugzilla.gnome.org/show_bug.cgi?id=665013">https://bugzilla.gnome.org/show_bug.cgi?id=665013</a> But it looks like that problem has been fixed, and that Wireshark is using gtk with the fix. Also, the bug was only for Remote Desktop when using 16-bit colors. I have verified that the problem occurs for all color options, from 15 to 32-bit.</p><p>Can someone help me write a gtk bug remote? There are so many options, I don't know how to fill out the forms. Thanks...</p></div><div id="comment-18378-info" class="comment-info"><span class="comment-age">(06 Feb '13, 14:27)</span> <span class="comment-user userinfo">SonomaDave</span></div></div><span id="20377"></span><div id="comment-20377" class="comment not_top_scorer"><div id="post-20377-score" class="comment-score"></div><div class="comment-text"><p>I have exactly the same type of problems both in Windows 2003 x32 and windows 2008 R2 x64 after 1.8.4 release.</p><p>I have also been trying with a new GTK, GTK3 and same problem percist.</p></div><div id="comment-20377-info" class="comment-info"><span class="comment-age">(12 Apr '13, 03:25)</span> <span class="comment-user userinfo">Tobias21</span></div></div></div><div id="comment-tools-18052" class="comment-tools"><span class="comments-showing"> showing 5 of 13 </span> <a href="#" class="show-all-comments-link">show 8 more comments</a></div><div class="clear"></div><div id="comment-18052-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

