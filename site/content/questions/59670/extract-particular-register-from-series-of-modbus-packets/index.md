+++
type = "question"
title = "Extract particular Register from series of Modbus packets"
description = '''I am using Wireshark to analyze Modbus data exchanged between a device and my PC. When I use Modbus &quot;MODICOM FLT&quot; preference I can see the floating point parameter I need (i.e. Register 5523). It has value 1234.900635 in the image below. How can I export this parameter for many times to make a time ...'''
date = "2017-02-24T12:23:00Z"
lastmod = "2017-03-02T07:07:00Z"
weight = 59670
keywords = [ "modbus", "modicon" ]
aliases = [ "/questions/59670" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Extract particular Register from series of Modbus packets](/questions/59670/extract-particular-register-from-series-of-modbus-packets)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-59670-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-59670-score" class="post-score" title="current number of votes">0</div><span id="post-59670-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I am using Wireshark to analyze Modbus data exchanged between a device and my PC. When I use Modbus "MODICOM FLT" preference I can see the floating point parameter I need (i.e. Register 5523). It has value 1234.900635 in the image below. How can I export this parameter for many times to make a time plot?. <img src="https://osqa-ask.wireshark.org/upfiles/modbusTrace.jpg" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-modbus" rel="tag" title="see questions tagged &#39;modbus&#39;">modbus</span> <span class="post-tag tag-link-modicon" rel="tag" title="see questions tagged &#39;modicon&#39;">modicon</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>24 Feb '17, 12:23</strong></p><img src="https://secure.gravatar.com/avatar/dc183a0a76a78266937363c87d768eaa?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="bmain57&#39;s gravatar image" /><p><span>bmain57</span><br />
<span class="score" title="0 reputation points">0</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="bmain57 has no accepted answers">0%</span></p></img></div></div><div id="comments-container-59670" class="comments-container"></div><div id="comment-tools-59670" class="comment-tools"></div><div class="clear"></div><div id="comment-59670-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="59673"></span>

<div id="answer-container-59673" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-59673-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-59673-score" class="post-score" title="current number of votes">1</div><span id="post-59673-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>This is <em>probably</em> better handled with <a href="https://www.wireshark.org/docs/man-pages/tshark.html"><code>tshark</code></a>. If you want to export <em>all</em> register values, then you can use something like:</p><pre><code>tshark -r modbusTrace.pcap -Y &quot;modbus.reg32&quot; -T fields -e modbus.reg32</code></pre><p>However, if you <em>only</em> want the value for register 5523, then I think this is only possible if there are always a fixed number of <code>modbus.reg32 values</code> returned and Register 5523 is always the <em>N</em>th one - in that case you can specify which <strong><em>occurrence</em></strong> of the field to display using a more targeted command, such as:</p><p>Windows: <code>     tshark.exe -r modbusTrace.pcap -Y "modbus.reg32" -o "gui.column.format:\"Register 5523\",\"%Cus:modbus.reg32:N\""</code></p><p>*nix: <code>     tshark -r modbusTrace.pcap -Y "modbus.reg32" -o 'gui.column.format:"Register 5523","%Cus:modbus.reg32:N"'</code></p><p>... where <em><code>N</code></em> is the occurrence of the field you're interested in.</p><p><em>(You can add other fields as well, such as Frame number, time, etc., if you like. Run "<code>tshark -G column-formats</code>" for additional help with that.)</em></p><p>If you redirect the output to a file, you should be able to import it into another program (such as your favorite spreadsheet program), so that you can plot the values.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>24 Feb '17, 13:52</strong></p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p><span>cmaynard ♦♦</span><br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="cmaynard has 108 accepted answers">20%</span></p></div></div><div id="comments-container-59673" class="comments-container"><span id="59684"></span><div id="comment-59684" class="comment not_top_scorer"><div id="post-59684-score" class="comment-score"></div><div class="comment-text"><p>I really appreciate the time you spend giving me such a detailed response. And it works great for listing the register numbers. What I want, however, is the value of the register (in the example above (register 5523 has the value 1234.900635). I am writing a more detailed response to your answer in my "answer" below since it allows images.</p></div><div id="comment-59684-info" class="comment-info"><span class="comment-age">(25 Feb '17, 11:21)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59685"></span><div id="comment-59685" class="comment not_top_scorer"><div id="post-59685-score" class="comment-score"></div><div class="comment-text"><p>I really appreciate your answer above! And it works great for listing the register numbers. When I use your first solution:</p><p><strong>tshark -r modbusTrace.pcapng -Y "modbus.reg32" -T fields -e modbus.reg32 &gt; test1.csv</strong></p><p>I get all the register numbers. The image below shows a small piece of the test1.csv output file:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/cm_sol1Table1.jpg" width="640" /></p><p>It is really interesting when I run your second solution, I get the vertical column of this table that that matches the number "N". So If I use N=20</p><p><strong>tshark.exe -r modbusTrace.pcapng -Y "modbus.reg32" -o "gui.column.format:\"Register 5523\",\"%Cus:modbus.reg32:20\"" &gt; test2.csv</strong></p><p>I get just the 20th vertical column of the above table:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/cm_sol2Table.jpg" alt="alt text" /></p><p>Now what I am really looking for is the value of a particular register, not the register number. For example, register 5523 has the value of 1234.900635</p><p><img src="https://osqa-ask.wireshark.org/upfiles/valueof5523.jpg" alt="alt text" /></p><p>Is there a tshark command that will allow me to get that?</p><p>And I want to thank you so much for your previous response. Even though it didn't give me the exact parameter I wanted, I am learning more from your short comments that scouring manuals for hours.</p></div><div id="comment-59685-info" class="comment-info"><span class="comment-age">(25 Feb '17, 11:24)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59709"></span><div id="comment-59709" class="comment"><div id="post-59709-score" class="comment-score">1</div><div class="comment-text"><p>What version of Wireshark are you using? Also, maybe you could post a small capture file (even one with a single packet should suffice) so folks can see exactly which field it is that you're interested in and how best to retrieve it.</p></div><div id="comment-59709-info" class="comment-info"><span class="comment-age">(27 Feb '17, 07:42)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59720"></span><div id="comment-59720" class="comment not_top_scorer"><div id="post-59720-score" class="comment-score"></div><div class="comment-text"><p>I am using Wireshark 2.2.0 on Win7 64 bit. I would like to upload my trace file, how do I upload a file on this site? (Also, in my original question above do have an image of the Wireshark GUI which shows the register I am trying to get).</p></div><div id="comment-59720-info" class="comment-info"><span class="comment-age">(27 Feb '17, 17:26)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59723"></span><div id="comment-59723" class="comment not_top_scorer"><div id="post-59723-score" class="comment-score"></div><div class="comment-text"><p>You can share a capture in a publicly accessible spot, e.g. <a href="http://cloudshark.org">CloudShark</a>, Google Drive, DropBox etc.</p><p>Edit your question with a link to the file.</p></div><div id="comment-59723-info" class="comment-info"><span class="comment-age">(28 Feb '17, 02:57)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="59729"></span><div id="comment-59729" class="comment not_top_scorer"><div id="post-59729-score" class="comment-score"></div><div class="comment-text"><p>OK, my sample trace is here: <a href="https://www.cloudshark.org/captures/cf81fdc7e257">https://www.cloudshark.org/captures/cf81fdc7e257</a></p></div><div id="comment-59729-info" class="comment-info"><span class="comment-age">(28 Feb '17, 07:43)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59733"></span><div id="comment-59733" class="comment not_top_scorer"><div id="post-59733-score" class="comment-score"></div><div class="comment-text"><p>OK, well with older versions of Wireshark (such as 1.12.13), you could do this:</p><pre><code>tshark.exe -r modbusTrace.pcap -Y &quot;modbus.register.modicon_float&quot; -o mbtcp.mbus_register_format:&quot;MODICON FLT&quot; -o gui.column.format:&quot;Register 5523&quot;,&quot;%Cus:modbus.register.modicon_float:N&quot;</code></pre><p>I don't know how to achieve this same thing using newer versions of Wireshark, such as the version you're using. It seems that you can now only display the <code>modbus.reg32</code> value. This looks like a bug to me.</p></div><div id="comment-59733-info" class="comment-info"><span class="comment-age">(28 Feb '17, 08:32)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59773"></span><div id="comment-59773" class="comment not_top_scorer"><div id="post-59773-score" class="comment-score"></div><div class="comment-text"><p>I installed Wireshark 1.12.13 and ran the command you suggested, however I get the error message: tshark: Invalid -o flag "mbtcp.mbus_register_format:"</p></div><div id="comment-59773-info" class="comment-info"><span class="comment-age">(01 Mar '17, 11:18)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59775"></span><div id="comment-59775" class="comment not_top_scorer"><div id="post-59775-score" class="comment-score"></div><div class="comment-text"><p>I just tried the command again and it worked. Can you post your entire command?</p></div><div id="comment-59775-info" class="comment-info"><span class="comment-age">(01 Mar '17, 11:43)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59779"></span><div id="comment-59779" class="comment not_top_scorer"><div id="post-59779-score" class="comment-score"></div><div class="comment-text"><p>tshark.exe -r modbusTrace.pcapng -Y "modbus.register.modicon_float" -o mbtcp.mbus_register_format: "MODICON FLT" -o gui.column.format: "Register 5523","%Cus:modbus.register.modicon_float:143" &gt; test5.csv</p></div><div id="comment-59779-info" class="comment-info"><span class="comment-age">(01 Mar '17, 12:13)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59780"></span><div id="comment-59780" class="comment not_top_scorer"><div id="post-59780-score" class="comment-score"></div><div class="comment-text"><p><code>mbtcp.mbus_register_format: "MODICON FLT"</code></p><p>You have a space between the colon and the quote character. Try again with no space.</p></div><div id="comment-59780-info" class="comment-info"><span class="comment-age">(01 Mar '17, 12:16)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59781"></span><div id="comment-59781" class="comment not_top_scorer"><div id="post-59781-score" class="comment-score"></div><div class="comment-text"><p>Here is the Command Line capture of the error:</p><p>C:\Users\bmain\Documents\Ansel\SSMM\PWM_SporaticError&gt;tshark.exe -r modbusTrace. pcapng -Y "modbus.register.modicon_float" -o mbtcp.mbus_register_format: "MODICO N FLT" -o gui.column.format: "Register 5523","%Cus:modbus.register.modicon_float :143" &gt; test5.csv</p><p><strong>(tshark.exe:17620): WARNING</strong> : No such preference "modbus.mbus_register_form at" at line 3131 of C:\Users\bmain\AppData\Roaming\Wireshark\preferences (save preferences to remove this warning) tshark: Invalid -o flag "mbtcp.mbus_register_format:"</p></div><div id="comment-59781-info" class="comment-info"><span class="comment-age">(01 Mar '17, 12:18)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59783"></span><div id="comment-59783" class="comment"><div id="post-59783-score" class="comment-score">1</div><div class="comment-text"><p><code>mbtcp.mbus_register_format: "MODICO N FLT"</code></p><p>Once again, you have a space between the colon and quote. Try removing it. And you seem to have <em>added</em> a space where it doesn't belong. It's not <code>"MODICO N FLT"</code> but <code>"MODICON FLT"</code>.</p></div><div id="comment-59783-info" class="comment-info"><span class="comment-age">(01 Mar '17, 12:22)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59784"></span><div id="comment-59784" class="comment"><div id="post-59784-score" class="comment-score">1</div><div class="comment-text"><p>Since you seem to be having trouble with that command-line option, you can omit it if you've already set the preference in Wireshark. I merely added it to the command-line so it would always override whatever setting you might have had in Wireshark.</p></div><div id="comment-59784-info" class="comment-info"><span class="comment-age">(01 Mar '17, 12:43)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59786"></span><div id="comment-59786" class="comment not_top_scorer"><div id="post-59786-score" class="comment-score"></div><div class="comment-text"><p>I fixed my spacing but now get a new error:</p><p>C:\Users\bmain\Documents\Ansel\SSMM\PWM_SporaticError&gt;tshark.exe -r modbusTrace. pcapng -Y "modbus.register.modicon_float" -o mbtcp.mbus_register_format:"MODICON FLT" -o gui.column.format:"Register 5523","%Cus:modbus.register.modicon_float:1 43" &gt; test5.csv</p><p><strong>(tshark.exe:13608): WARNING</strong> : No such preference "modbus.mbus_register_form at" at line 3131 of C:\Users\bmain\AppData\Roaming\Wireshark\preferences (save preferences to remove this warning)</p><p>C:\Users\bmain\Documents\Ansel\SSMM\PWM_SporaticError&gt;</p><p>Line 3131 is the last line of the sequence below.</p><h1 id="register-format">Register Format</h1><h1 id="one-of-uint16-int16-uint32-int32-ieee-flt-modicon-flt">One of: UINT16 , INT16 , UINT32 , INT32 , IEEE FLT , MODICON FLT</h1><h1 id="case-insensitive.">(case-insensitive).</h1><p>modbus.mbus_register_format: MODICON FLT</p><p>I also noticed that my preference file header says version 2.2.0 even though I uninstalled that version and installed 1.12.13 as you suggested earlier.</p></div><div id="comment-59786-info" class="comment-info"><span class="comment-age">(01 Mar '17, 14:55)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59787"></span><div id="comment-59787" class="comment not_top_scorer"><div id="post-59787-score" class="comment-score"></div><div class="comment-text"><p>Try again line 3131 of preferences:</p><p>Register Format One of: UINT16 , INT16 , UINT32 , INT32 , IEEE FLT , MODICON FLT (case-insensitive). modbus.mbus_register_format: MODICON FLT</p><p>In my previous post I forgot to strip off the pound signs from the pref file test</p></div><div id="comment-59787-info" class="comment-info"><span class="comment-age">(01 Mar '17, 14:58)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59788"></span><div id="comment-59788" class="comment not_top_scorer"><div id="post-59788-score" class="comment-score"></div><div class="comment-text"><p>Register Format</p><p>One of: UINT16 , INT16 , UINT32 , INT32 , IEEE FLT , MODICON FLT</p><p>(case-insensitive).</p><p>modbus.mbus_register_format: MODICON FLT</p></div><div id="comment-59788-info" class="comment-info"><span class="comment-age">(01 Mar '17, 15:00)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59789"></span><div id="comment-59789" class="comment not_top_scorer"><div id="post-59789-score" class="comment-score"></div><div class="comment-text"><p>Can you upload your AppData\Roaming\Wireshark\preferences file for me if this is the issue?</p></div><div id="comment-59789-info" class="comment-info"><span class="comment-age">(01 Mar '17, 15:05)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59790"></span><div id="comment-59790" class="comment"><div id="post-59790-score" class="comment-score">1</div><div class="comment-text"><p>So <code>tshark</code> is just warning you of an unknown preference, namely <code>modbus.mbus_register_form</code>. It's just a warning though. Did you look at the contents of your <code>test5.csv</code> file? It should contain the information you're after.<br />
</p><p>If you want to eliminate the warning, you can do as instructed and save your preferences file from Wireshark. When you do that, Wireshark should remove all unknown preferences. Another option is to simply rename your preferences file (e.g., preferences-2.2.0) and the next time you run the <code>tshark</code> command, <code>tshark</code> will use default preferences except for any you specify on the command-line.</p><p>Ideally this could be solved using Wireshark 2.2.x though. Perhaps it can be and I'm just missing something myself, but if it can't be, then a bug report should be opened because this seems like a regression to me. You shouldn't have to downgrade Wireshark to solve this problem. Wireshark bugs can be filed at <a href="https://bugs.wireshark.org/bugzilla/">https://bugs.wireshark.org/bugzilla/</a>.</p></div><div id="comment-59790-info" class="comment-info"><span class="comment-age">(01 Mar '17, 15:31)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="59794"></span><div id="comment-59794" class="comment not_top_scorer"><div id="post-59794-score" class="comment-score"></div><div class="comment-text"><p>Yes, test5.csv does have the data!! Thanks for your patience in solving this issue. I am so relieved. I have requested a bugzilla login so I can submit the bug. By the way, while I am waiting for the fix, can I run two different versions of Wireshark on the same win7 computer? It seems like multiple versions will share the same preferences file and thus lead to some confusion (like the warning I was getting earlier).</p></div><div id="comment-59794-info" class="comment-info"><span class="comment-age">(01 Mar '17, 16:36)</span> <span class="comment-user userinfo">bmain57</span></div></div><span id="59804"></span><div id="comment-59804" class="comment"><div id="post-59804-score" class="comment-score">1</div><div class="comment-text"><p><em>can I run two different versions of Wireshark on the same win7 computer?</em></p><p>It <em>should</em> be possible, although only one of them can be associated with .pcap files though, and only one of them will take precedence if the installation directory is added to the %PATH%. But try installing the 2 versions in different locations to find out.</p><p>Alternatively ...</p><ul><li>you could install the PortableApps version of one of them on a USB flash drive and run it from there instead of installing it on your PC.</li><li>you could compile each version yourself and run it from your build directory instead of installing it, per se.</li><li>In the old days, I believe a zip file was available and you could just unzip it and run it from the unzip folder, again without installing it, per se. I don't know if that's still possible, but it doesn't look like zips are available anymore, which is too bad. Perhaps another bug report asking for zips to be created and made available on the download site could be opened too.</li></ul></div><div id="comment-59804-info" class="comment-info"><span class="comment-age">(02 Mar '17, 07:07)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div></div><div id="comment-tools-59673" class="comment-tools"><span class="comments-showing"> showing 5 of 21 </span> <a href="#" class="show-all-comments-link">show 16 more comments</a></div><div class="clear"></div><div id="comment-59673-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

