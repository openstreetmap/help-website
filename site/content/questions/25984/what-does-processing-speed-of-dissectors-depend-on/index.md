+++
type = "question"
title = "What does processing speed of Dissectors depend on?"
description = '''Hi guys, I&#x27;m analyzing the processing speed of incoming data and dissector in order to know how they are different. I use the tshark command on Windows and surf Youtube to increase network speed rate : tshark -i 1 -P -w D:/sonnh.pcap -b filesize:1000 -b files:4  I change the code to print out the nu...'''
date = "2013-10-14T19:20:00Z"
lastmod = "2013-10-15T05:58:00Z"
weight = 25984
keywords = [ "dumpcap", "dissector.speed" ]
aliases = [ "/questions/25984" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [What does processing speed of Dissectors depend on?](/questions/25984/what-does-processing-speed-of-dissectors-depend-on)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25984-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi guys, I'm analyzing the processing speed of incoming data and dissector in order to know how they are different. I use the tshark command on Windows and surf Youtube to increase network speed rate :</p><pre><code>tshark -i 1 -P -w D:/sonnh.pcap -b filesize:1000 -b files:4</code></pre><p>I change the code to print out the number of incoming packet (which are written to .pcap file by dumpcap) and the number of outgoing packets (which are dissected by dissector together). Note that: dumpcap doesn't write packets one by one, it captures a group of packet (e.g: 10 packet a time) and then write this group to a .pcap file, then Dissector also take a group of packet from file to dissect. As I saw in the log, the number of packet in Dumpcap group and Dissector group are different:</p><pre><code>    Line    Number of Incoming - Dissected packets
     1.     17:16
     2.     11:12
     3.     7:7
     4.     19:17
     5.     17:14
     6.     230:235
     7.     2012:637
     8.     89:839
     9.     2444:37
     10.        1:500
     11.        92:55
     12.        21:16
     13.        0:18</code></pre><p>In theory, if tshark works well, the sum of the number of incoming and dissected packets should be identical (100% dissected, drop 0%). The difference of number of incoming packets is because of the speed of network, that is ok, nothing wrong. But I wonder why the number of dissected packets are so different from the number of incoming. As can be seen in line 1:</p><pre><code> Line   Number of Incoming - Dissected packets
  1.        17:16</code></pre><p>There is 1 packet left are waiting for dissector and this one is dissected in the line 2:</p><pre><code>Line    Number of Incoming - Dissected packets
  2.        11:12</code></pre><p>so, totally,the sums are identical. But in the line 9:</p><pre><code>Line    Number of Incoming - Dissected packets
9.              2444:37</code></pre><p>The number of dissected packs is only 37 vs 2444 of incoming. It is not a real capability of Dissector because in the line 8:</p><pre><code>Line    Number of Incoming - Dissected packets
    8.      89:839</code></pre><p>The dissector can handle 839 packets vs 89 packets of Incoming. So it means dissector is able to handle a large number of packets but why it only dissect only 37 packets in line 9. From that point, I have some questions:</p><ol><li>Why does the number of dissected packets vary in every time?</li><li>What does the number of dissected packets depend on? (What make the difference of number of dissected packets)</li><li>Why doesn't it take all incoming packets ?</li><li>Does this mean the processing speed of Dissectors is less than Dumpcap (i don't think so because we don't have enough evidence)? If Yes, <strong>is there any way to increase the number of dissector corresponding to the number of incoming</strong>. Sorry for asking too deep in code detail but I hope there 's someone in this forum who work as developer can help me with their experience.</li></ol><p>Please, if you are expert or just have any idea, suggestion, or experience on that, please help me to answer. Thank you so much.</p></div><div id="question-tags" class="tags-container tags">dumpcap dissector.speed</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>14 Oct '13, 19:20</strong></p><img src="https://secure.gravatar.com/avatar/824a7342f59ff90e6040505b38626416?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="hoangsonk49&#39;s gravatar image" /><p>hoangsonk49<br />
<span class="score" title="81 reputation points">81</span><span title="28 badges"><span class="badge1">●</span><span class="badgecount">28</span></span><span title="29 badges"><span class="silver">●</span><span class="badgecount">29</span></span><span title="33 badges"><span class="bronze">●</span><span class="badgecount">33</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="hoangsonk49 has 2 accepted answers">28%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 15 Oct '13, 02:54</p></div></div><div id="comments-container-25984" class="comments-container"></div><div id="comment-tools-25984" class="comment-tools"></div><div class="clear"></div><div id="comment-25984-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="25985"></span>

<div id="answer-container-25985" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25985-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>I'm not sure your experiment is going to be useful, because you're probably getting thrown off by side effects that will have a more or less great impact on your measurements. Keep in mind that, while dumpcap is writing to file, tshark is reading that file at the same time. Meaning: you have file I/O from two processes - one is writing, one is reading, so there is going to be some serialization of who accesses the file when. Also, as you noticed, dumpcap will often buffer frames in memory and write them to disk in a bunch, which means that tshark will not be able to read them as soon as they really arrived.</p><p>All in all, dissecting packets may be slower than writing them to disk, but I doubt it. File I/O is usually a lot slower than in-memory processing, so I guess your test is basically a measurement of how fast your capture file is written and read again, biases by serialization of allowing access to the file.</p><p>Now, I'll sit and wait for Guy's answer - this is probably more in his area of expertise :-)</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>14 Oct '13, 22:24</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p>Jasper ♦♦<br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 14 Oct '13, 22:25</p></div></div><div id="comments-container-25985" class="comments-container"><span id="25986"></span><div id="comment-25986" class="comment"><div id="post-25986-score" class="comment-score"></div><div class="comment-text"><p>Hi Jasper, I agree with you about</p><blockquote><p>while dumpcap is writing to file, tshark is reading that file at the same time</p></blockquote><p>we can consider they are doing at the same time, but actually, they have an order: write-read-write-read... at least in my experiment, I'm able to see this in the log.</p><blockquote><p>dumpcap will often buffer frames in memory and write them to disk in a bunch, which means that tshark will not be able to read them as soon as they really arrived</p></blockquote><p>In the question number 4, I also say that I don't have enough evidence to say which is faster. But it doesn't matter because my objective is not measurement. My concern is why Dissector only take a number of packet differently. For example: in the line 9, there are <strong>2444 incoming packets</strong> but Dissector takes only about <strong>37 outgoing packets</strong> to dissect even they are able to do more as they dissect <strong>839 packets</strong> in the line 8. In line 1,2, the number of packet incoming and outgoing are often similar but sometime they are too different. It makes sense to me if dumpcap write x packets into pcap, then Dissector take y packets to dissect and <strong>y = x</strong> or close to x as much as possible. I'm trying to find out what decide the number y in stead of x and how to make it close to x. And one more question: How to start debug mode to print out g_log (both of tshark and dumpcap). Thanks</p></div><div id="comment-25986-info" class="comment-info"><span class="comment-age">(14 Oct '13, 23:54)</span> hoangsonk49</div></div><span id="25990"></span><div id="comment-25990" class="comment"><div id="post-25990-score" class="comment-score"></div><div class="comment-text"><p>Is there any possible reason related to the pipe? Because as I check, the number of outgoing packets was read from the header of message from pipe (1 byte indicator, 3 bytes for message length)</p><blockquote><pre><code>/* convert header values */
pipe_convert_header((guchar*)header,4,indicator,&amp;required);</code></pre></blockquote><p>--&gt; To have "required" : number of byte to read</p><blockquote><pre><code>/* read the actual block data */
newly = pipe_read_bytes(pipe_fd, msg, required, err_msg);</code></pre></blockquote><p>--&gt; To have "msg" : value reading from "required" bytes. It is also the number of packets which are going to be dissected</p></div><div id="comment-25990-info" class="comment-info"><span class="comment-age">(15 Oct '13, 03:00)</span> hoangsonk49</div></div><span id="26015"></span><div id="comment-26015" class="comment"><div id="post-26015-score" class="comment-score"></div><div class="comment-text"><p>Keep in mind that dumpcap only alerts tshark to there being additional packets every once in a while (every 500 msec: see the DUMPCAP_UPD_TIME macro in dumpcap.c). So you may have times when tshark does less work than dumpcap simply because tshark is waiting for packets. Theoretically tshark should catch up after the next time tick.</p></div><div id="comment-26015-info" class="comment-info"><span class="comment-age">(15 Oct '13, 10:30)</span> JeffMorriss ♦</div></div><span id="26037"></span><div id="comment-26037" class="comment"><div id="post-26037-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your comment. As I understand,the DUMPCAP_UPD_TIME is used for non-overload slow displays. During this duration, dumpcap does nothing and wait for tshark and display, right? Now, if I don't care about what is printing on display, should I increase the DUMPCAP_UPD_TIME (for example: 750 ms or 1s) so that Dumpcap have a "longer delay" for tshark does its work. Is there any problem? Thanks.</p></div><div id="comment-26037-info" class="comment-info"><span class="comment-age">(15 Oct '13, 18:55)</span> hoangsonk49</div></div><span id="26043"></span><div id="comment-26043" class="comment"><div id="post-26043-score" class="comment-score"></div><div class="comment-text"><p>I have just done with DUMPCAP_UPD_TIME = 1000 and DUMPCAP_UPD_TIME = 100 ms. When DUMPCAP_UPD_TIME = 1000, the number of dissecting packets increase a lot but the number of incoming packet to dumpcap each time also increase more rapidly (I use speed limiter = 2000 kB/s to make sure that the network always stabilize at speed rate ~ 2 MB/s). It also happens similarly to DUMPCAP_UPD_TIME = 1000. So totally, we still got the problem.</p><blockquote><p>So you may have times when tshark does less work than dumpcap simply because tshark is waiting for packets</p></blockquote><p>In the line 9: 2444 packets already written by dumpcap and THEN only 37 packets are dissected by tshark (even 2444 packets ready for dissecting and tshark does not need to wait for anything) while Dissector can dissect 839 packets as it have done in the line 8.</p></div><div id="comment-26043-info" class="comment-info"><span class="comment-age">(16 Oct '13, 00:51)</span> hoangsonk49</div></div><span id="26061"></span><div id="comment-26061" class="comment not_top_scorer"><div id="post-26061-score" class="comment-score"></div><div class="comment-text"><blockquote><p>During this duration, dumpcap does nothing and wait for tshark and display, right? Now, if I don't care about what is printing on display, should I increase the DUMPCAP_UPD_TIME (for example: 750 ms or 1s) so that Dumpcap have a "longer delay" for tshark does its work.</p></blockquote><p>Actually I think you're going for the opposite: you want tshark to dissect packets as soon as they're available, right? So there is less variability between how many packets dumpcap processes and how many tshark processes. To do that, decrease DUMPCAP_UPD_TIME to a small number.</p></div><div id="comment-26061-info" class="comment-info"><span class="comment-age">(16 Oct '13, 06:23)</span> JeffMorriss ♦</div></div><span id="26152"></span><div id="comment-26152" class="comment not_top_scorer"><div id="post-26152-score" class="comment-score"></div><div class="comment-text"><p>I have done with 2 cases: <strong>DUMPCAP_UPD_TIME = 1000 ms</strong> and <strong>DUMPCAP_UPD_TIME = 100 ms</strong>, let 's see the difference. With <strong>DUMPCAP_UPD_TIME = 1000 ms</strong>, the number of incoming packets: (<strong>8000 ~ 19000</strong>) vs the number of outgoing packets: (<strong>1000 ~ 2000</strong>). With <strong>DUMPCAP_UPD_TIME = 100 ms</strong>, the number of incoming packets: (<strong>2000 ~ 8000</strong>) vs the number of outgoing packets: (<strong>300 ~ 50</strong>0). So, we have a less variability between how many packets dumpcap processes and how many tshark processes, but if we focus on the percentage of outgoing packets/incoming packets, the performance might be decrease so that when we stop tshark (by using -a duration:120), only dumpcap stops while tshark is still running and the delay is still long.</p></div><div id="comment-26152-info" class="comment-info"><span class="comment-age">(17 Oct '13, 19:36)</span> hoangsonk49</div></div></div><div id="comment-tools-25985" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-25985-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="25992"></span>

<div id="answer-container-25992" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25992-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>Does this mean the processing speed of Dissectors is less than Dumpcap (i don't think so because we don't have enough evidence)?</p></blockquote><p>well, just by applying logic, I would answer: Yes</p><p>Reason: Both dumpcap and tshark have the same amount of I/O work (if we ignore file system caches for a while). So, that amount of time is the same (dumpcap writing data, tshark reading the same amount of data). Then tshark has <strong>a lot of additional work</strong> due to the dissection of frames. So, yes dissecting packets with tshark will always be slower than just writing the packets to disk with dumpcap. This is due to the way how dumpcap 'delivers' packets to tshark, through a file they use both.</p><p>Thus, I believe the specific problem you have found is a structural problem and I don't know if there is a general or an easy solution for this. There will always be situations where dumpcap will be ahead of tshark, due to the time tshark needs to dissect the frames and it gets worse the longer tshark runs, due to larger lists and hash tables tshark needs to fill, search and possibly reorganize (hash table collisions - although I did <strong>not</strong> check where exactly that might happen!!). File system caching might help, as the I/O work of tshark (reading what dumpcap just wrote) has a much lower impact than for dumpcap (writing new data), but still....</p><blockquote><p>I change the code to print out the number of incoming packet (which are written to .pcap file by dumpcap) and the number of outgoing packets (which are dissected by dissector together).</p></blockquote><p>Can you please post the code change, so we can check if the changes are appropriate to measure what you are trying to measure ;-))</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>15 Oct '13, 05:58</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div><div class="post-update-info post-update-info-edited"><p>edited 15 Oct '13, 07:12</p></div></div><div id="comments-container-25992" class="comments-container"><span id="26036"></span><div id="comment-26036" class="comment"><div id="post-26036-score" class="comment-score"></div><div class="comment-text"><blockquote><p>So, yes dissecting packets with tshark will always be slower than just writing the packets to disk with dumpcap</p></blockquote><p>OK, I agree with you that it is logical answer. With this thought, I think it would cause a delay increasing between incoming and outgoing packets but in fact with my experiment, there is no delay and it only happens to the high speed rate incoming. That 's why I have to print out and compare the number of incoming and outgoing packets. And after seeing the log, maybe the important thing is not a processing speed, it is how Dissector takes packets to dissect. As in block quote:</p><pre><code>8.     89:839
 9.     2444:37</code></pre><p>Why Dissector takes only 37 packets in line 9 while it is able to do more as it has just done in line 8. Now, It is not a problem of the speed, it is problem of how it decide the number of packets which are going to be dissected. If I can do as line 8, the problem could be solved.</p><blockquote><p>Can you please post the code change, so we can check if the changes are appropriate to measure what you are trying to measure ;-))</p></blockquote><p>Of course, here you are. In the dumpcap.c, function capture_loop_start(), I print out:</p><blockquote><p>print_log_1(global_ld.packet_count);</p></blockquote><p>In the tshark.c , function capture_input_new_packets(), I print out:</p><blockquote><p>print_log_2(to_read,packet_count);</p></blockquote><p>Please correct me if I did something wrong. Thanks.</p></div><div id="comment-26036-info" class="comment-info"><span class="comment-age">(15 Oct '13, 18:40)</span> hoangsonk49</div></div><span id="26067"></span><div id="comment-26067" class="comment"><div id="post-26067-score" class="comment-score"></div><div class="comment-text"><p>and what's the code of print_log_1() and print_log_2()?</p></div><div id="comment-26067-info" class="comment-info"><span class="comment-age">(16 Oct '13, 07:12)</span> Kurt Knochner ♦</div></div><span id="26096"></span><div id="comment-26096" class="comment"><div id="post-26096-score" class="comment-score"></div><div class="comment-text"><p>Here is the code of print. In both of function print, we open the same file and insert new values</p><p>tshark.c , function capture_input_new_packets()</p><blockquote><p>fprintf(sOut,"\nTo_read: %d/%u",to_read,packet_count);</p></blockquote><p>dumpcap.c, function capture_loop_start()</p><blockquote><p>fprintf(sOut,"\nPacket_count: %u",packet_count);</p></blockquote><p>packet_count in tshark.c is an ID of the latest packet since the last processing of tshark while packet_count in dumpcap.c is an ID of the latest packet which is written into pcap by dumpcap.</p></div><div id="comment-26096-info" class="comment-info"><span class="comment-age">(16 Oct '13, 18:35)</span> hoangsonk49</div></div><span id="26106"></span><div id="comment-26106" class="comment"><div id="post-26106-score" class="comment-score"></div><div class="comment-text"><blockquote><p>In both of function print, we open the same file and insert new values</p></blockquote><p>O.K. I'm sorry to be annoying but you did not post the whole code.</p><p>If you reopen a file and write things to it, couldn't there be a bug in that code that leads to a mismatch of tshark and dumpcap packet count?</p><p>Without the full code of print_log_1() and print_log_2(), it is impossible to check (or even understand) your results.</p></div><div id="comment-26106-info" class="comment-info"><span class="comment-age">(17 Oct '13, 01:47)</span> Kurt Knochner ♦</div></div><span id="26108"></span><div id="comment-26108" class="comment"><div id="post-26108-score" class="comment-score"></div><div class="comment-text"><p>Ok, sorry, here is the code:</p><pre><code>    void print_log_1(gint packet_count)
{
    FILE *sOut;
    sOut = fopen(&quot;D:/asonnhx.txt&quot;,&quot;ab&quot;);
    fprintf(sOut,&quot;\nPacket_count: %u&quot;,packet_count);
    fclose(sOut);
}
        void print_log_2(int to_read, guint16 t)
{
    FILE *sOut;
    sOut = fopen(&quot;D:/asonnhx.txt&quot;,&quot;ab&quot;);
    fprintf(sOut,&quot;\nTo_read: %d/%u&quot;,to_read,t);
    fclose(sOut);
}</code></pre><p>Thanks.</p></div><div id="comment-26108-info" class="comment-info"><span class="comment-age">(17 Oct '13, 02:14)</span> hoangsonk49</div></div><span id="26110"></span><div id="comment-26110" class="comment not_top_scorer"><div id="post-26110-score" class="comment-score"></div><div class="comment-text"><p>Hm.. the same file name? Isn't there a race condition if both (tshark and dumpcap) try to open and write to the file at the same time?</p></div><div id="comment-26110-info" class="comment-info"><span class="comment-age">(17 Oct '13, 02:23)</span> Kurt Knochner ♦</div></div><span id="26120"></span><div id="comment-26120" class="comment not_top_scorer"><div id="post-26120-score" class="comment-score"></div><div class="comment-text"><p>No, there isn't. I use the same file name just to see the order of output. Sometime I see it has unusual organization (according to what I expect) but most of output going in expected order: incoming-outgoing-incoming-outgoing...</p></div><div id="comment-26120-info" class="comment-info"><span class="comment-age">(17 Oct '13, 03:29)</span> hoangsonk49</div></div></div><div id="comment-tools-25992" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-25992-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

