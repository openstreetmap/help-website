+++
type = "question"
title = "configure extcap sshdump"
description = '''Hello, I&#x27;m trying to use the remote ssh functionnality to capture CAN frames (virtual vcan0) But I have got an error message, see below :  Can someone help me ? Thank you. Cheers. EDIT: @sindy /usr/sbin/tcpdump -i can0 -w /tmp/can_test.pcap is ok: the file generated by the remote machine (beaglebone...'''
date = "2017-07-12T08:27:00Z"
lastmod = "2017-07-25T03:05:00Z"
weight = 62708
keywords = [ "can", "sshdump", "vcan0", "virtual", "extcap" ]
aliases = [ "/questions/62708" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [configure extcap sshdump](/questions/62708/configure-extcap-sshdump)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-62708-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-62708-score" class="post-score" title="current number of votes">0</div><span id="post-62708-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello,</p><p>I'm trying to use the remote ssh functionnality to capture CAN frames (virtual vcan0) But I have got an error message, see below :</p><p><img src="https://osqa-ask.wireshark.org/upfiles/SnipImage.JPG" alt="alt text" /><br />
Can someone help me ? Thank you. Cheers.</p><p><strong>EDIT:</strong><br />
<a href="https://ask.wireshark.org/users/19586/sindy"></a><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a></a> <code>/usr/sbin/tcpdump -i can0 -w /tmp/can_test.pcap</code> is ok: the file generated by the remote machine (beaglebone black) is readable by WS on the local machine</p><p>However, with the plain <code>tcpdump</code>, no packets are captured: <img src="https://osqa-ask.wireshark.org/upfiles/SnipImage.JPG" alt="alt text" /> <img src="https://osqa-ask.wireshark.org/upfiles/CaptureNoPacket_a7HOJlz.PNG" alt="alt text" /></p><p>So the functionnality ssh remote does not work with your indications.</p><p>The only way I found to capture these packets is describe below (as evidenced by) :</p><ol><li>I log on the remote</li><li>create a pipe</li><li>start WS</li></ol><p>Then the packets are captured:</p><p><code>ssh [email protected] "dumpcap -i can0 -P -w -" | wireshark -k -i -</code></p><p><img src="https://osqa-ask.wireshark.org/upfiles/CaptureSSH.PNG" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-can" rel="tag" title="see questions tagged &#39;can&#39;">can</span> <span class="post-tag tag-link-sshdump" rel="tag" title="see questions tagged &#39;sshdump&#39;">sshdump</span> <span class="post-tag tag-link-vcan0" rel="tag" title="see questions tagged &#39;vcan0&#39;">vcan0</span> <span class="post-tag tag-link-virtual" rel="tag" title="see questions tagged &#39;virtual&#39;">virtual</span> <span class="post-tag tag-link-extcap" rel="tag" title="see questions tagged &#39;extcap&#39;">extcap</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>12 Jul '17, 08:27</strong></p><img src="https://secure.gravatar.com/avatar/177e55c0d5e8a290e016f63356e5f9fe?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="lamoule74&#39;s gravatar image" /><p><span>lamoule74</span><br />
<span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="lamoule74 has 2 accepted answers">66%</span> </br></br></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>25 Jul '17, 03:29</strong> </span></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></img></div></div><div id="comments-container-62708" class="comments-container"><span id="62724"></span><div id="comment-62724" class="comment"><div id="post-62724-score" class="comment-score"></div><div class="comment-text"><p>I guess your capture filter syntax is incorrect. Can you provide all of your remote ssh options including your remote capture filter?</p></div><div id="comment-62724-info" class="comment-info"><span class="comment-age">(12 Jul '17, 13:41)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="62729"></span><div id="comment-62729" class="comment"><div id="post-62729-score" class="comment-score"></div><div class="comment-text"><p>Actually I don't have a filter... When I'm using WS without "normally", I'm not lauching the sniffing interface without a filter, I specify the filter CAN with dissector j1939 later..</p><p>See below</p><p><img src="https://osqa-ask.wireshark.org/upfiles/SnipImage2.JPG" alt="alt text" /></p><p>A detail : I'm trying this from a virtual machine.</p><p>I'll try with a true session...</p></div><div id="comment-62729-info" class="comment-info"><span class="comment-age">(12 Jul '17, 23:40)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62733"></span><div id="comment-62733" class="comment"><div id="post-62733-score" class="comment-score"></div><div class="comment-text"><p>I think this is a known bug in the ssh interface. Try using a single space as "Remote capture filter".</p></div><div id="comment-62733-info" class="comment-info"><span class="comment-age">(13 Jul '17, 02:01)</span> <span class="comment-user userinfo">stig ♦</span></div></div><span id="62739"></span><div id="comment-62739" class="comment"><div id="post-62739-score" class="comment-score"></div><div class="comment-text"><p>hey Stig, it displays a different error message :</p><p><img src="https://osqa-ask.wireshark.org/upfiles/SnipImage3_pfcvLHQ.JPG" alt="alt text" /></p></div><div id="comment-62739-info" class="comment-info"><span class="comment-age">(13 Jul '17, 04:50)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62742"></span><div id="comment-62742" class="comment"><div id="post-62742-score" class="comment-score"></div><div class="comment-text"><p>dumpcap produces pcapng by default which isn't supported for pipes, so you need to append a <code>-P</code> to the command. I'm not certain if that should be added to the "Remote capture binary" or the "Remote capture filter" fields.</p></div><div id="comment-62742-info" class="comment-info"><span class="comment-age">(13 Jul '17, 05:43)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="62743"></span><div id="comment-62743" class="comment not_top_scorer"><div id="post-62743-score" class="comment-score"></div><div class="comment-text"><p>hey grahamb</p><p>command unknow with -P. this is a p capslock right?</p><p><img src="https://osqa-ask.wireshark.org/upfiles/SnipImage4.JPG" alt="alt text" /></p></div><div id="comment-62743-info" class="comment-info"><span class="comment-age">(13 Jul '17, 06:25)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62749"></span><div id="comment-62749" class="comment not_top_scorer"><div id="post-62749-score" class="comment-score"></div><div class="comment-text"><p>Yes uppercase, see the <a href="https://www.wireshark.org/docs/man-pages/dumpcap.html">dumpcap manpage</a> for more info.</p></div><div id="comment-62749-info" class="comment-info"><span class="comment-age">(13 Jul '17, 08:20)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="62750"></span><div id="comment-62750" class="comment not_top_scorer"><div id="post-62750-score" class="comment-score"></div><div class="comment-text"><p><a href="https://ask.wireshark.org/users/23858/lamoule74">@lamoule74</a>, can you request <code>tcpdump</code> instead of <code>dumpcap</code> down there on the remote machine? For tcpdump, pcap is the default output format when capturing on a single interface. As you use no capture filter, the fact that with dumpcap it needs to be prepended with <code>-f</code> while with tcpdump it goes directly should not cause issues.</p></div><div id="comment-62750-info" class="comment-info"><span class="comment-age">(13 Jul '17, 09:39)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62842"></span><div id="comment-62842" class="comment not_top_scorer"><div id="post-62842-score" class="comment-score"></div><div class="comment-text"><p><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a> tcpdump does not support the can frames apparently :</p><p><img src="https://osqa-ask.wireshark.org/upfiles/SnipImage_4it10b1.JPG" alt="alt text" /></p></div><div id="comment-62842-info" class="comment-info"><span class="comment-age">(18 Jul '17, 08:57)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62843"></span><div id="comment-62843" class="comment not_top_scorer"><div id="post-62843-score" class="comment-score"></div><div class="comment-text"><p>That's a misinterpretation of the error message. It says exactly what it reads: packet <strong>printing</strong> is not supported, i.e. the simple packet dissection engine of <code>tcpdump</code> has no clue about the internals of the CAN frames, but nevertheless they can be written to a file (as in this case no dissection is necessary). Same case e.g. with USB frames.</p><p>So use <code>/usr/sbin/tcpdump -i can0 -w /tmp/can_test.pcap</code> and then download can_test.pcap to the machine running Wireshark and open it there. If this works, remote ssh capture spawning <code>tcpdump</code> should work as well, because it does use <code>-w -</code> to allow piping of pcap rather than text output.</p></div><div id="comment-62843-info" class="comment-info"><span class="comment-age">(18 Jul '17, 09:16)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62864"></span><div id="comment-62864" class="comment not_top_scorer"><div id="post-62864-score" class="comment-score"></div><div class="comment-text"><p><a href="https://ask.wireshark.org/users/19586/sindy"></a><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a> The cuplrit seems to be the "Remote capture binary" text field: <img src="https://osqa-ask.wireshark.org/upfiles/Capture_QLygG6e.PNG" alt="alt text" /></p><p>No args are allowed (I've also tried with simple and double quotes).</p><p>If I try the <code>/usr/sbin/tcpdump -i can0 -w -</code> in a shell, I can capture packets.</p><p>Do you know how to add args to the capture binary field?</p></div><div id="comment-62864-info" class="comment-info"><span class="comment-age">(19 Jul '17, 00:03)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62874"></span><div id="comment-62874" class="comment not_top_scorer"><div id="post-62874-score" class="comment-score"></div><div class="comment-text"><p>No, the culprit of this particular failure is <a href="https://ask.wireshark.org/users/23858/lamoule74">@lamoule74</a> :-)</p><p>You have logged in to the remote machine in order to test <code>/usr/sbin/tcpdump -i can0</code> manually (as documented by your screenshot). So I have expected you to do exactly the same, just adding the <code>-w /tmp/can_test.pcap</code> part, to check that the contents of the resulting pcap file stored on the remote machine would be useful as I expected.</p><p>You have instead tried to add <code>-w /tmp/can_test.pcap</code> into the <code>remote capture binary</code> field of the ssh remote capture form of Wireshark.</p><p>There, you should have placed just the plain <code>tcpdump</code>. The ssh remote capture will itself add <code>-w -</code>.</p></div><div id="comment-62874-info" class="comment-info"><span class="comment-age">(19 Jul '17, 04:51)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62879"></span><div id="comment-62879" class="comment not_top_scorer"><div id="post-62879-score" class="comment-score"></div><div class="comment-text"><p>What is the Wireshark version?</p></div><div id="comment-62879-info" class="comment-info"><span class="comment-age">(19 Jul '17, 07:23)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="62880"></span><div id="comment-62880" class="comment not_top_scorer"><div id="post-62880-score" class="comment-score"></div><div class="comment-text"><p>I must let someone else convert your Answer into a Comment, I'm getting an error when trying.</p><p>Can you log in to the remote machine, run the remote capture with "plain tcpdump" as shown below, and while it is running, use <code>ps axfw | grep tcpdump</code> on the remote machine and paste here the result?</p></div><div id="comment-62880-info" class="comment-info"><span class="comment-age">(19 Jul '17, 07:25)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62881"></span><div id="comment-62881" class="comment not_top_scorer"><div id="post-62881-score" class="comment-score"></div><div class="comment-text"><p>I could not convert it either. The best I could do was append the "answer" to the end of the question and delete the "answer".</p></div><div id="comment-62881-info" class="comment-info"><span class="comment-age">(19 Jul '17, 07:36)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="62882"></span><div id="comment-62882" class="comment not_top_scorer"><div id="post-62882-score" class="comment-score"></div><div class="comment-text"><p><a href="https://ask.wireshark.org/users/1225/grahamb">@grahamb</a> the version is 2.2.7-1 I've also tried the 2.2.6</p><p><a href="https://ask.wireshark.org/users/19586/sindy">@sindy</a> here is the result of the command line :</p><p><code>[[email protected]:~] $ ps axfw | grep tcpdump  1284 ?        Ss     0:00  |       \_ /usr/sbin/tcpdump -i can0 -w - -f    1444 ?        Ss     0:00  |       \_ /usr/sbin/tcpdump -i can0 -w - -f    1522 ?        Ss     0:00  |       \_ /usr/sbin/tcpdump -i can0 -w - -f    1553 ?        Ss     0:00  |       \_ /usr/sbin/tcpdump -i can0 -w - -f    1573 ?        Ss     0:00  |       \_ /usr/sbin/tcpdump -i can0 -w - -f    1619 pts/2    S+     0:00  |           \_ /usr/sbin/tcpdump -i can0 -w -  1648 pts/3    S+     0:00              \_ grep tcpdump  1111 ?        Ss     0:00 /usr/sbin/tcpdump -i can0 -w - -f</code></p></div><div id="comment-62882-info" class="comment-info"><span class="comment-age">(19 Jul '17, 07:53)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62887"></span><div id="comment-62887" class="comment not_top_scorer"><div id="post-62887-score" class="comment-score"></div><div class="comment-text"><p>A bit crowded down there I'd say, I guess you are not actually running that many captures. These are most likely zombies from previous sessions so it deserves a cleanup. Most likely also their parent ssh sessions have survived so there is likely a lot of zombie processes on the machine running Wireshark.</p><p>Otherwise the command line composed by remote ssh capture seems fair to me. <code>-f</code> has a different meaning for <code>tcpdump</code> than for <code>dumpcap</code>, but luckily it is a harmless one (just tried).</p><p>I would assume that tcpdump only has access to interfaces as root, and that is the reason why no data are received, but it is just a wild guess at the moment. So if you use the same user for direct login to beaglebone like you do for remote ssh capture, forget that I've mentioned that.</p><p>Maybe you could provide full path to <code>dumpcap</code>, much like you do for <code>tcpdump</code>, and add the <code>-P</code> option to it in the Remote capture binary field?</p></div><div id="comment-62887-info" class="comment-info"><span class="comment-age">(19 Jul '17, 08:35)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62896"></span><div id="comment-62896" class="comment not_top_scorer"><div id="post-62896-score" class="comment-score"></div><div class="comment-text"><p>I tried to reboot the beaglebone to prevent any side effect from the previous sessions. The <code>-f</code> arg is probably added by WS because I didn't try this arg on the command line.</p><p>I added the <code>debian</code> user of the beaglebone to the <code>wireshark</code> group and <code>tcpdump</code> can capture packets when launched from the command line (not with WS). There is probably no need to switch to root. But I will try.</p><p><code>dumpcap -P</code> is one of the first thing I tried, but the Remote capture binary field doesn't let me add any command containing arguments (see screen capture above). If I write something else than <code>dumpcap</code>, WS fires an error message <code>Error by extcap pipe: bash dumpcap -P : command is missing</code></p></div><div id="comment-62896-info" class="comment-info"><span class="comment-age">(19 Jul '17, 12:37)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62897"></span><div id="comment-62897" class="comment not_top_scorer"><div id="post-62897-score" class="comment-score"></div><div class="comment-text"><p>If stating <code>"dumpcap -P"</code> to the <code>Remote capture binary</code> field (<strong>including</strong> the <code>""</code>) doesn't help either, I'd say you've collected enough evidence to file a bug or even two:</p><ul><li><p>I can see no reason why tcpdump should not work (as said, the <code>-f</code> is not harmful and the <code>-w -</code> is correctly added automatically as the output of <code>ps</code> confirms),</p></li><li><p>I can see no reason why it should not be possible to add parameters to binary name, given that <code>dumpcap</code> by default (i.e. without a command-line option) uses pcapng format, which is known not to be supported when using input pipes, even if capturing on a single interface.</p></li></ul><p>There is also <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=11370">bug 11370</a> asking for support of pcapng at queue input.</p></div><div id="comment-62897-info" class="comment-info"><span class="comment-age">(19 Jul '17, 13:06)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="62910"></span><div id="comment-62910" class="comment not_top_scorer"><div id="post-62910-score" class="comment-score"></div><div class="comment-text"><p>Ok then, let's file a bug.</p></div><div id="comment-62910-info" class="comment-info"><span class="comment-age">(20 Jul '17, 00:41)</span> <span class="comment-user userinfo">lamoule74</span></div></div><span id="62917"></span><div id="comment-62917" class="comment not_top_scorer"><div id="post-62917-score" class="comment-score"></div><div class="comment-text"><p>Please report the bug number here in a comment.</p></div><div id="comment-62917-info" class="comment-info"><span class="comment-age">(20 Jul '17, 03:00)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="62923"></span><div id="comment-62923" class="comment not_top_scorer"><div id="post-62923-score" class="comment-score"></div><div class="comment-text"><p><a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=13899">bug 13899</a></p></div><div id="comment-62923-info" class="comment-info"><span class="comment-age">(20 Jul '17, 04:38)</span> <span class="comment-user userinfo">lamoule74</span></div></div></div><div id="comment-tools-62708" class="comment-tools"><span class="comments-showing"> showing 5 of 22 </span> <a href="#" class="show-all-comments-link">show 17 more comments</a></div><div class="clear"></div><div id="comment-62708-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="63082"></span>

<div id="answer-container-63082" class="answer accepted-answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-63082-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-63082-score" class="post-score" title="current number of votes">0</div><span id="post-63082-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="lamoule74 has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>It seems to work with 2.4.0 and "Remote capture command" field set to <code>dumpcap -i can0 -P -w -</code></p><p>The "Remote interface" field seems to be ignored and <code>-w</code> - isn't added automatically, so I added the full command with parameters to make it work as below:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Capture_Taz7ckp.PNG" alt="screenshot" /></p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>25 Jul '17, 03:05</strong></p><img src="https://secure.gravatar.com/avatar/177e55c0d5e8a290e016f63356e5f9fe?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="lamoule74&#39;s gravatar image" /><p><span>lamoule74</span><br />
<span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="lamoule74 has 2 accepted answers">66%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>25 Jul '17, 06:25</strong> </span></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span></p></img></div></div><div id="comments-container-63082" class="comments-container"></div><div id="comment-tools-63082" class="comment-tools"></div><div class="clear"></div><div id="comment-63082-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

