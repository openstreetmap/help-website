+++
type = "question"
title = "Sniffing traffic from multiple switches/routers"
description = '''Hi, We have two production sites with 8 switches each. We have been experiencing some packet loss between servers and this can be quite time-consuming to troubleshoot. Currently, we have to go to site and mirror traffic from one switch at a time.  I would like to setup a server in each site with 8 n...'''
date = "2016-07-02T04:32:00Z"
lastmod = "2016-07-03T07:39:00Z"
weight = 53784
keywords = [ "switches", "multiple" ]
aliases = [ "/questions/53784" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Sniffing traffic from multiple switches/routers](/questions/53784/sniffing-traffic-from-multiple-switchesrouters)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-53784-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-53784-score" class="post-score" title="current number of votes">0</div><span id="post-53784-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>We have two production sites with 8 switches each. We have been experiencing some packet loss between servers and this can be quite time-consuming to troubleshoot. Currently, we have to go to site and mirror traffic from one switch at a time.</p><p>I would like to setup a server in each site with 8 network interfaces conneted to all switches. The plan is to mirror traffic from all switches to the Wireshark server and compare the traces to find the problem.</p><p>Can Wireshark correlate packet captures between multiple switches? How would I go about to set this up?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-switches" rel="tag" title="see questions tagged &#39;switches&#39;">switches</span> <span class="post-tag tag-link-multiple" rel="tag" title="see questions tagged &#39;multiple&#39;">multiple</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>02 Jul '16, 04:32</strong></p><img src="https://secure.gravatar.com/avatar/e51921b1a7f8840f1fe2036760d4854b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="tempus&#39;s gravatar image" /><p><span>tempus</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="tempus has no accepted answers">0%</span></p></div></div><div id="comments-container-53784" class="comments-container"><span id="53790"></span><div id="comment-53790" class="comment"><div id="post-53790-score" class="comment-score">1</div><div class="comment-text"><p>Sounds tricky. Can't <a href="https://supportforums.cisco.com/document/139236/understanding-spanrspanand-erspan">RSPAN</a> help here?</p></div><div id="comment-53790-info" class="comment-info"><span class="comment-age">(02 Jul '16, 15:57)</span> <span class="comment-user userinfo">Jaap ♦</span></div></div><span id="53791"></span><div id="comment-53791" class="comment"><div id="post-53791-score" class="comment-score"></div><div class="comment-text"><p>RSPAN could be used to reduce the number of physical ports required on the server. This would only means that Wireshark would see traffic from multiple switches aggregated on the same interface. Sometimes it's nice to use RSPAN, but when troubleshooting packet loss it's usually best not to tunnel your packet captures over multiple hops.</p></div><div id="comment-53791-info" class="comment-info"><span class="comment-age">(02 Jul '16, 16:21)</span> <span class="comment-user userinfo">tempus</span></div></div><span id="53793"></span><div id="comment-53793" class="comment"><div id="post-53793-score" class="comment-score"></div><div class="comment-text"><p>First there is capacity planning. Having all traffic coming back to a single point the capture engine (and packet filter for that matter) will have a lot of work to do.</p><p>Then there is fault finding, or non-duplicate packet finding in this case. While Wireshark and tools are equipped to remove duplications, you are looking for them and where they are missing, just the opposite. Maybe <a href="https://wiki.wireshark.org/Mate">MATE</a> can help you out, but I'm not sure.</p><p>Still, in matters of packet loss, wouldn't the interface performance counters tell you what you seek?</p></div><div id="comment-53793-info" class="comment-info"><span class="comment-age">(03 Jul '16, 01:22)</span> <span class="comment-user userinfo">Jaap ♦</span></div></div><span id="53794"></span><div id="comment-53794" class="comment"><div id="post-53794-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your answer. I'll look into what I can do with MATE. Perhaps if I can find a way to do a 'diff' between the captures of multiple interfaces.</p><p>I think I can get around the capacity problem by not mirroring from all switches (maybe only 2 or 3) at the same time. I can use capture filters with IP to only get the relevant packets.</p><p>Checking interface counters is usually the first step in the troubleshooting process, but interface counters are not always reliable in my experience.</p></div><div id="comment-53794-info" class="comment-info"><span class="comment-age">(03 Jul '16, 03:29)</span> <span class="comment-user userinfo">tempus</span></div></div><span id="53795"></span><div id="comment-53795" class="comment"><div id="post-53795-score" class="comment-score"></div><div class="comment-text"><p>To match the packets you could use the Multi Segment Analysis feature of Riverbed Packet Analyzer (I think an eval version is available) or the Match feature of TribeLab Workbench Community Edition.</p></div><div id="comment-53795-info" class="comment-info"><span class="comment-age">(03 Jul '16, 07:39)</span> <span class="comment-user userinfo">PaulOfford</span></div></div></div><div id="comment-tools-53784" class="comment-tools"></div><div class="clear"></div><div id="comment-53784-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

