+++
type = "question"
title = "How does Wireshark calculate the TCP stream index?"
description = '''How does Wireshark calculate the TCP stream index number? I&#x27;m used to seeing the first TCP packet in a trace file have a TCP stream index of 0. However, I have a trace file in which the first TCP packet has a TCP stream index of 6. There are 10,000 packets in the file, 5,619 of which are TCP. The TC...'''
date = "2011-07-15T12:48:00Z"
lastmod = "2016-03-29T10:43:00Z"
weight = 5056
keywords = [ "index", "stream" ]
aliases = [ "/questions/5056" ]
osqa_answers = 2
osqa_accepted = true
+++

<div class="headNormal">

# [How does Wireshark calculate the TCP stream index?](/questions/5056/how-does-wireshark-calculate-the-tcp-stream-index)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-5056-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-5056-score" class="post-score" title="current number of votes">0</div><span id="post-5056-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>How does Wireshark calculate the TCP stream index number? I'm used to seeing the first TCP packet in a trace file have a TCP stream index of 0. However, I have a trace file in which the first TCP packet has a TCP stream index of 6. There are 10,000 packets in the file, 5,619 of which are TCP. The TCP stream index numbers run from 6 to 196, with many gaps in the sequence. According to Statistic &gt; Conversations, there are 37 TCP conversations in this file.</p><p>If I apply “tcp” as a display filter, save only the displayed packets, and then load this new trace file, the TCP stream index numbers range sequentially from 0 to 36 with no gaps.</p><p>Is there some reason why the presence of other non-TCP traffic in the trace file should cause the TCP stream index number to have gaps in the sequence? If this is not expected behavior, I'll file a bug report at bugzilla.wireshark.org.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-index" rel="tag" title="see questions tagged &#39;index&#39;">index</span> <span class="post-tag tag-link-stream" rel="tag" title="see questions tagged &#39;stream&#39;">stream</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>15 Jul '11, 12:48</strong></p><img src="https://secure.gravatar.com/avatar/071fe61f64868d98bdf4eb060b63b6ca?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jim%20Aragon&#39;s gravatar image" /><p><span>Jim Aragon</span><br />
<span class="score" title="7187 reputation points"><span>7.2k</span></span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="33 badges"><span class="silver">●</span><span class="badgecount">33</span></span><span title="118 badges"><span class="bronze">●</span><span class="badgecount">118</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jim Aragon has 70 accepted answers">24%</span></p></div></div><div id="comments-container-5056" class="comments-container"><span id="30251"></span><div id="comment-30251" class="comment"><div id="post-30251-score" class="comment-score"></div><div class="comment-text"><p>how does conversation or stream index incerement . is it the same as a new SOCKEt call in in linux ?</p></div><div id="comment-30251-info" class="comment-info"><span class="comment-age">(27 Feb '14, 16:58)</span> <span class="comment-user userinfo">kuvineet</span></div></div><span id="30259"></span><div id="comment-30259" class="comment"><div id="post-30259-score" class="comment-score"></div><div class="comment-text"><p>Every new SYN will create a new stream index. The index will be increased by one, starting from zero.</p></div><div id="comment-30259-info" class="comment-info"><span class="comment-age">(27 Feb '14, 23:12)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-5056" class="comment-tools"></div><div class="clear"></div><div id="comment-5056-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="5057"></span>

<div id="answer-container-5057" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-5057-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-5057-score" class="post-score" title="current number of votes">1</div><span id="post-5057-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="Jim Aragon has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>It is something that bothered me too, but Sake (who implemented the stream index) gave me a perfect explanation for this: the stream index is shown only for TCP flows, but it is incremented with each conversation, even if it is a UDP conversation. If you take a closer look you'll see that the gaps between each TCP stream number have UDP conversations that "use" the hidden numbers (usually DNS request/answer pairs).</p><p>I don't remember the full details of why it is done this way but as far as I remember Sake had performance reasons, because otherwise he'd have to keep track of new TCP sessions starting while there already is a conversation counter that he could use for this.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>15 Jul '11, 13:01</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-5057" class="comments-container"><span id="5058"></span><div id="comment-5058" class="comment"><div id="post-5058-score" class="comment-score"></div><div class="comment-text"><p>The concept makes sense, but I still can't figure out the numbering. The first TCP packet is #355, with stream index 6, so there should be 6 conversations that start ahead of it in the trace file: 0-5. I selected the first UDP packet, clicked "Follow UDP stream," marked the displayed packets, and moved on to the next unmarked UDP packet. So far, I've marked 12 UDP conversations that start before the first TCP conversation and I'm only up to conversations starting with packet 41.</p></div><div id="comment-5058-info" class="comment-info"><span class="comment-age">(15 Jul '11, 13:43)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div><span id="5061"></span><div id="comment-5061" class="comment"><div id="post-5061-score" class="comment-score"></div><div class="comment-text"><p>I plead guilty :-)</p><p>Yes, it was me who did this. And as Jasper said, I did not want to introduce other variables while there is a perfectly usable conversation index available. Since there are quite a few questions being asked about the numbering, I'm not sure I made the right decision.</p><p>The fact is that not all UDP protocols keep track of state with the conversation system. So the numbering of the TCP sessions all depend on the other protocols present in the file. And the numbering can differ between versions of Wireshark when protocol dissectors start using conversations in newer versions.</p></div><div id="comment-5061-info" class="comment-info"><span class="comment-age">(15 Jul '11, 14:06)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="5062"></span><div id="comment-5062" class="comment"><div id="post-5062-score" class="comment-score"></div><div class="comment-text"><p>Would it be (much) better to have the TCP stream indexes start from 0 and increase by one, no matter what? It will add a little to the memory footprint of Wireshark (and will probably also cost a bit of extra CPU cycles)?</p></div><div id="comment-5062-info" class="comment-info"><span class="comment-age">(15 Jul '11, 14:08)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="5063"></span><div id="comment-5063" class="comment"><div id="post-5063-score" class="comment-score"></div><div class="comment-text"><p>Would it be better? Yes. Much better? Don't know if I'd go that far. Sometimes, after selecting "Follow TCP stream," I've moved to the next TCP stream by leaving the display filter in place, overwriting the number, and clicking "Apply." Sometimes it works; sometimes I find out that there is no such TCP stream. I don't know if too many people would use that functionality.</p></div><div id="comment-5063-info" class="comment-info"><span class="comment-age">(15 Jul '11, 14:31)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div><span id="5064"></span><div id="comment-5064" class="comment not_top_scorer"><div id="post-5064-score" class="comment-score"></div><div class="comment-text"><p>In my example, with 37 streams in the file, I think it could be useful to know that stream 36, for example, is the last one, rather than seeing stream number 131 (out of 37 streams) and wondering where I am.</p></div><div id="comment-5064-info" class="comment-info"><span class="comment-age">(15 Jul '11, 14:33)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div><span id="5066"></span><div id="comment-5066" class="comment"><div id="post-5066-score" class="comment-score">2</div><div class="comment-text"><p>OK, I changed it in SVN 38056, there is now a separate index for tcp streams, which means it will monotonously increase by 1 for each new TCP session.</p><p>As this is new behavior, it will be included in 1.8.x and not in 1.6.x. If you want you can use an automated build or the next 1.7.x release.</p></div><div id="comment-5066-info" class="comment-info"><span class="comment-age">(15 Jul '11, 16:44)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="5067"></span><div id="comment-5067" class="comment not_top_scorer"><div id="post-5067-score" class="comment-score"></div><div class="comment-text"><p>Thanks, Sake. I tried 38056. Looks good.</p></div><div id="comment-5067-info" class="comment-info"><span class="comment-age">(15 Jul '11, 19:59)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div><span id="5080"></span><div id="comment-5080" class="comment not_top_scorer"><div id="post-5080-score" class="comment-score"></div><div class="comment-text"><p>The change in 38056 unfortunately broke "Follow TCP Stream" functionality. This got fixed in SVN 38065.</p></div><div id="comment-5080-info" class="comment-info"><span class="comment-age">(17 Jul '11, 04:14)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div></div><div id="comment-tools-5057" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-5057-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="51259"></span>

<div id="answer-container-51259" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-51259-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-51259-score" class="post-score" title="current number of votes">0</div><span id="post-51259-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Hi Jim, I was wondering if you could help me with interpreting some captures I did... I am very new to Wireshark and I got a doozy of a network issue on my hands. Thanks so much, Michael</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>29 Mar '16, 09:19</strong></p><img src="https://secure.gravatar.com/avatar/2fb216ad983a9ab39aba627dd495c135?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Michael-YYZ&#39;s gravatar image" /><p><span>Michael-YYZ</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Michael-YYZ has no accepted answers">0%</span></p></div></div><div id="comments-container-51259" class="comments-container"><span id="51262"></span><div id="comment-51262" class="comment"><div id="post-51262-score" class="comment-score"></div><div class="comment-text"><p>I appreciate this is your first visit to the site, but this is not a forum it's a Q&amp;A site and your "answer" is not an answer to this question, or even suitable as a separate question.</p><p>If you have a particular capture that you would like help with, then please posts a new question, along with a link to the capture, describing the issue as fully as possible.</p></div><div id="comment-51262-info" class="comment-info"><span class="comment-age">(29 Mar '16, 10:43)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div></div><div id="comment-tools-51259" class="comment-tools"></div><div class="clear"></div><div id="comment-51259-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

