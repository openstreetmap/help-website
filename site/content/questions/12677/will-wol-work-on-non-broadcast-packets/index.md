+++
type = "question"
title = "Will WOL work on non-broadcast packets?"
description = '''Hi I have been trying to use the Wake on LAN feature but I have been struggling very much with it. Limitation with my router. My config is router -&amp;gt; hub -&amp;gt; PC1  |  v  PC2 (always awake).  The workaround: When I intend to do is send the magic packets to PC2 (always awake). The understanding I g...'''
date = "2012-07-12T19:49:00Z"
lastmod = "2012-08-16T17:38:00Z"
weight = 12677
keywords = [ "capture", "hub", "wol" ]
aliases = [ "/questions/12677" ]
osqa_answers = 6
osqa_accepted = false
+++

<div class="headNormal">

# [Will WOL work on non-broadcast packets?](/questions/12677/will-wol-work-on-non-broadcast-packets)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12677-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12677-score" class="post-score" title="current number of votes">0</div><span id="post-12677-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi</p><p>I have been trying to use the Wake on LAN feature but I have been struggling very much with it. Limitation with my router.</p><p>My config is</p><pre><code>router -&gt; hub -&gt; PC1
           |
           v
           PC2 (always awake).</code></pre><p>The workaround: When I intend to do is send the magic packets to PC2 (always awake). The understanding I got is that the hub will broadcast to both PC1 and PC2. PC1 is sleeping. Is it possible for me to capture that the broadcast is made to both PC1 and PC2? I currently can only see that the packet is sent to PC2.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-capture" rel="tag" title="see questions tagged &#39;capture&#39;">capture</span> <span class="post-tag tag-link-hub" rel="tag" title="see questions tagged &#39;hub&#39;">hub</span> <span class="post-tag tag-link-wol" rel="tag" title="see questions tagged &#39;wol&#39;">wol</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>12 Jul '12, 19:49</strong></p><img src="https://secure.gravatar.com/avatar/adba5a3de0a0b5ddbf6f76ef3567e194?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Pete%20the%20curious&#39;s gravatar image" /><p><span>Pete the cur...</span><br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Pete the curious has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>13 Jul '12, 02:45</strong> </span></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p><span>SYN-bit ♦♦</span><br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span></p></div></div><div id="comments-container-12677" class="comments-container"><span id="13695"></span><div id="comment-13695" class="comment"><div id="post-13695-score" class="comment-score"></div><div class="comment-text"><p>Hi all,</p><p>Just to add to the clarity on my end. I have been reading all the postings so far. I have done what Sandman described. That is the MAC address is for the PC which I intend to wake up and not the always on PC.<br />
</p><p>regards</p></div><div id="comment-13695-info" class="comment-info"><span class="comment-age">(16 Aug '12, 17:38)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div></div><div id="comment-tools-12677" class="comment-tools"></div><div class="clear"></div><div id="comment-12677-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

6 Answers:

</div>

</div>

<span id="12684"></span>

<div id="answer-container-12684" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12684-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12684-score" class="post-score" title="current number of votes">1</div><span id="post-12684-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>If the packet is truly a broadcast, it's made to <em>all</em> machines on the network segment, i.e. to every machine plugged into the hub except for the machine sending the broadcast (I don't know of any Ethernet adapters that receive their own transmissions - they might listen to their own transmissions for collision detection, but they don't treat it as an incoming packet, eve in promiscuous mode).</p><p>If the hub truly is a <a href="http://wiki.wireshark.org/HubReference"><em>hub</em></a>, rather than <a href="http://wiki.wireshark.org/SwitchReference">a switch that's called a hub</a>, and if the router and the two PCs (all of which I assume are plugged into the hub) are all running at the same speed (all at 10Mb/s or all at 100Mb/s), then, if you have an unused port on the hub, you should be able to run a sniffer on a machine plugged into that port and see all the traffic going through the hub.</p><p>You could also try running Wireshark on PC1 and, <em>even though it's awake</em>, try sending it a Wake-on-LAN packet, and see whether it shows up in Wireshark. If it shows up in Wireshark, that would strongly suggest that, if PC1 isn't waking up, the problem isn't that it's not receiving the wakeup packet - perhaps its Ethernet adapter doesn't support Wake-on-LAN, or does but doesn't have its wakeup signal wired to the appropriate support chip (i.e., the adapter supports Wake-on-LAN but the PC as a whole doesn't), or the operating system doesn't support that wakeup signal.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>12 Jul '12, 20:28</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span> </br></p></div></div><div id="comments-container-12684" class="comments-container"><span id="12685"></span><div id="comment-12685" class="comment"><div id="post-12685-score" class="comment-score"></div><div class="comment-text"><p>You could also try running Wireshark on PC1 and, even though it's awake, try sending it a Wake-on-LAN packet, and see whether it shows up in Wireshark. If it shows up in Wireshark, that would strongly suggest that, if PC1 isn't waking up, the problem isn't that it's not receiving the wakeup packet - perhaps its Ethernet adapter doesn't support Wake-on-LAN, or does but doesn't have its wakeup signal wired to the appropriate support chip (i.e., the adapter supports Wake-on-LAN but the PC as a whole doesn't), or the operating system doesn't support that wakeup signal.</p><blockquote><p>Thanks for the quick response. A simple observation is that when I send the magic packets within 1-2 minutes of PC1 shutdown, it starts up.</p></blockquote></div><div id="comment-12685-info" class="comment-info"><span class="comment-age">(12 Jul '12, 20:39)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12686"></span><div id="comment-12686" class="comment"><div id="post-12686-score" class="comment-score"></div><div class="comment-text"><p>did you check the link state of PC1 after 1-2 minutes (LEDs on the HUB)? If the link is down (for whatever reason), PC1 will not receive the WOL packet.</p></div><div id="comment-12686-info" class="comment-info"><span class="comment-age">(12 Jul '12, 20:43)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-12684" class="comment-tools"></div><div class="clear"></div><div id="comment-12684-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="12683"></span>

<div id="answer-container-12683" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12683-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12683-score" class="post-score" title="current number of votes">0</div><span id="post-12683-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>I currently can only see that the packet is sent to PC2.</p></blockquote><p>If the destination MAC address of the packet, arriving at PC2, is the broadcast address (FF:FF:FF:FF:FF:FF), you can assume that this packet will also arrive at PC1, <strong>if the link to that machine is active! Please check LEDs on the HUB/Switch</strong>. If you want to be sure, you need to capture in front of PC1 by using a <a href="http://wiki.wireshark.org/CaptureSetup/Ethernet#Capture_using_a_network_tap">network tap</a>. You cannot capture on PC1, as you have to switch it on to do that, which changes things, like enabling the network link, if it was disabled before.</p><blockquote><p>The workaround: When I intend to do is send the magic packets to PC2 (always awake).</p></blockquote><p>If you send the magic packet to PC2, you can do this in two ways. Either you send it to the MAC address of PC2 or you send it to the broadcast address, with the MAC address of PC2 as payload. However, neither case will awake PC1, even if PC1 receives the broadcast packet, as the WOL packet is not intended for PC1.</p><p>See <a href="http://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=wol.pcap">WOL sample capture</a>.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>12 Jul '12, 20:22</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>12 Jul '12, 20:52</strong> </span></p></div></div><div id="comments-container-12683" class="comments-container"><span id="12689"></span><div id="comment-12689" class="comment"><div id="post-12689-score" class="comment-score"></div><div class="comment-text"><p>Kurt You mention that "neither case will awake PC1, even if PC1 receives the broadcast packet, as the WOL packet is not intended for PC1."<br />
</p><p>What I am doing is trying to replicate the following which I read from another forum. I can see the packet and it has the mac address of PC1 but the destination address is the IP address of PC2. So judging from what u said the following does not work?</p><p>"Why a hub? Hubs are dumb and they do not direct traffic like routers and switches. Hubs and this is the key word here, "broadcast", the data to all devices connected to it. Now there are two ways you can get this to work: 1. Plug the hub in front of your router 2. Plug the hub behind your router (better) If you are going to plug it behind the router, you are going to have to have a device on the hub that is always on so the router won't kill the line, VoIP or something. Plug the hub in one of the routers LAN ports. Plug your PC and the always on device into the hub. Also if you have a setting "WoL &amp; Shutdown Link Speed" for your NIC, you should probably set it to whatever the other device supports just to be safe, usually 100Mbps. You then should create a reserved LAN IP for the always on device so it never changes to a different LAN IP. Then you will need to port forward to the always on device. Some of you may be scratching your head as to why should we port forward to the always on device and not the PC, well that is the beauty of the hub. It will broadcast the packet to it regardless which device you have port forwarded to. The reason you port forward to the always on device is that your router needs a "live" device to keep the ARP entry alive. The router forwards the packet to that LAN IP address to the hub. The hub then broadcasts the packet to all devices because it doesn't know who it is intended for. Thus your PC will wake despite it going to the other device."</p></div><div id="comment-12689-info" class="comment-info"><span class="comment-age">(12 Jul '12, 23:14)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12690"></span><div id="comment-12690" class="comment"><div id="post-12690-score" class="comment-score"></div><div class="comment-text"><p><a href="http://support.amd.com/us/Embedded_TechDocs/20213.pdf">An AMD paper on Wake-on-LAN</a> says:</p><blockquote><p>Once the LAN controller has been put into the Magic Packet mode, it scans all incoming frames addressed to the node for a specific data sequence, which indicates to the controller that this is a Magic Packet frame. A Magic Packet frame must also meet the basic requirements for the LAN technology chosen, such as SOURCE ADDRESS, DESTINATION ADDRESS (which may be the receiving station’s IEEE address or a MULTICAST address which includes the BROADCAST address), and CRC. The specific sequence consists of 16 duplications of the IEEE address of this node, with no breaks or interruptions.</p></blockquote><p>which implies that if the <em>body</em> of a Wake-on-LAN packet doesn't have the right MAC address in it - the <em>body</em>, <em>NOT</em> the Ethernet header - the LAN controller may well ignore it.</p><p>This means that if a Wake-on-LAN packet is broadcast on a network, so that its destination MAC address is FF:FF:FF:FF:FF:FF, it might <em>STILL</em> wake up only one host, <em>even though more than one host's network adapter receives it</em>. Hosts other than the one whose MAC address appears in the body may just ignore it.</p></div><div id="comment-12690-info" class="comment-info"><span class="comment-age">(12 Jul '12, 23:38)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="12698"></span><div id="comment-12698" class="comment"><div id="post-12698-score" class="comment-score"></div><div class="comment-text"><p>Kurt Regarding the working for 1-2 minutes after shutdown, I believe the ARP cache is involved. There is a status flag that shows off after a while.</p><p>My 2Wire does not seem to support port fowarding to 182.168.1.255.<br />
</p></div><div id="comment-12698-info" class="comment-info"><span class="comment-age">(13 Jul '12, 01:58)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12701"></span><div id="comment-12701" class="comment"><div id="post-12701-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Kurt Regarding the working for 1-2 minutes after shutdown, I believe the ARP cache is involved. There is a status flag that shows off after a while.</p></blockquote><p>Well, I'm not yet convinced. Can you please post a detailed summary what you do when it works (within 1-2 minutes) and what you do when it does not work.</p><blockquote><p>There is a status flag that shows off after a while.</p></blockquote><p><strong>What</strong> is <strong>off</strong> exactly?<br />
Did you check the physical link status??<br />
</p><blockquote><p>My 2Wire does not seem to support port fowarding to 182.168.1.255.</p></blockquote><p>Too bad, as that would be the best way to solve your problem.</p></div><div id="comment-12701-info" class="comment-info"><span class="comment-age">(13 Jul '12, 02:24)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-12683" class="comment-tools"></div><div class="clear"></div><div id="comment-12683-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="12693"></span>

<div id="answer-container-12693" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12693-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12693-score" class="post-score" title="current number of votes">0</div><span id="post-12693-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>Hubs and this is the key word here, "broadcast", the data to all devices connected to it.</p></blockquote><p>As Guy Harris already said the problem might be proper "addressing" of the WOL packet.</p><p>However, as you said it works for 1-2 minutes after you shutdown PC1, I believe that the link of PC1 goes down for whatever reason (maybe power settings in the BIOS) or that the ARP cache of the router is somehow involved.</p><p>I found this article, which describes pretty much how to configure your router: <a href="http://www.dslreports.com/faq/6790">http://www.dslreports.com/faq/6790</a></p><p>You just forward incoming UDP packets (port will be defined by the WOL tool) to your network broadcast IP. So, if your network is 192.168.1.0/24 you forward the UDP packet to 192.168.1.255. <strong>IF, and only IF</strong> the router uses the broadcast MAC address (FF:FF:FF:FF:FF:FF) for that broadcast IP address (some routers do, some don't), then it will work. If it does not work for your router, you can try to add a manual ARP entry, if the router supports that (192.168.1.255 -&gt; FF:FF:FF:FF:FF:FF).</p><p>I tested it with this online WOL tool: <a href="http://www.dslreports.com/wakeup">http://www.dslreports.com/wakeup</a></p><p>If the router forwards the packet, if will go to FF:FF:FF:FF:FF:FF and the payload contains the MAC address of the PC you want to wake (00:01:02:03:04:05).</p><p>The setup you described, with the "allways on" IP address, is not guaranteed to work. I guess it depends on the WOL implementation of the adapter if it accepts WOL packets solely by the mac address in the payload, ignoring the fact, that the MAC destination of the WOL packet is the one of the "allways on" IP.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Jul '12, 00:44</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>13 Jul '12, 01:48</strong> </span></p></div></div><div id="comments-container-12693" class="comments-container"><span id="12700"></span><div id="comment-12700" class="comment"><div id="post-12700-score" class="comment-score"></div><div class="comment-text"><blockquote><blockquote><p>The setup you described, with the "allways on" IP address, is not guaranteed to work. I guess it depends on the WOL implementation of the adapter if it accepts WOL packets solely by the mac address in the payload, ignoring the fact, that the MAC destination of the WOL packet is the one of the "allways on" IP.</p></blockquote></blockquote><p>I incline to think the above is more the issue here.<br />
I checked the packets and it is ok. It has the necessary 16 reptitions of the MAC addresses of the PC I wish to wake. The destination addr is the IP address of the always awake PC.</p><p>Oh yes I cannot forward to the broadcast address, 192.168.1.255. There is the limitation of the 2 wire 5012NV router. regards</p></div><div id="comment-12700-info" class="comment-info"><span class="comment-age">(13 Jul '12, 02:17)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12703"></span><div id="comment-12703" class="comment"><div id="post-12703-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I incline to think the above is more the issue here.</p></blockquote><p>I agree. You can test it. Use a local WOL tool that allows to set the payload MAC different from the dst MAC address.</p></div><div id="comment-12703-info" class="comment-info"><span class="comment-age">(13 Jul '12, 02:49)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-12693" class="comment-tools"></div><div class="clear"></div><div id="comment-12693-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="12702"></span>

<div id="answer-container-12702" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12702-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12702-score" class="post-score" title="current number of votes">0</div><span id="post-12702-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>According to the WOL specifications, the magic packet should be a broadcast packet, not a unicast packet for another mac address. However, you seem to have indicated that sending a unicast packet to the mac address of PC2 did indeed wake up PC1, but only if it was sent max 1-2 minutes after shutting PC1 down.</p><p>You may want to try different scenarios to see whether they do or do not work.</p><ol><li>Send magic WOL packet to broadcast address, 1 minute after shutting PC1 down</li><li>Send magic WOL packet to broadcast address, 5 minutes after shutting PC1 down</li><li>Send magic WOL packet to mac address of PC1, 1 minute after shutting PC1 down</li><li>Send magic WOL packet to mac address of PC1, 5 minutes after shutting PC1 down</li><li>Send magic WOL packet to mac address of PC2, 1 minute after shutting PC1 down</li><li>Send magic WOL packet to mac address of PC2, 5 minutes after shutting PC1 down</li></ol><p>1) and 2) should work, as these magic packets are according to the WOL specification.</p><p>3) and 4) might work, but it might be that the NIC stuts down to a state that it only listens to the broadcast address. Maybe this is what happens 1-2 minutes after shutting down the PC.</p><p>5) and 6) should not work IMHO, but of course the firmware of the NIC might just be tolerant enough to let it work.</p><p>If you can add a static ARP entry on your router, then you may be able to add a port forwarder to send packet 4) from a remote location. Otherwise your best bet would be to use a WOL tool on PC2 and make PC2 remotely accessible.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Jul '12, 02:43</strong></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p><span>SYN-bit ♦♦</span><br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SYN-bit has 174 accepted answers">20%</span> </br></br></p></div></div><div id="comments-container-12702" class="comments-container"><span id="12715"></span><div id="comment-12715" class="comment"><div id="post-12715-score" class="comment-score"></div><div class="comment-text"><p>1.Send magic WOL packet to broadcast address, 1 minute after shutting PC1 down 2.Send magic WOL packet to broadcast address, 5 minutes after shutting PC1 down 3.Send magic WOL packet to mac address of PC1, 1 minute after shutting PC1 down 4.Send magic WOL packet to mac address of PC1, 5 minutes after shutting PC1 down 5.Send magic WOL packet to mac address of PC2, 1 minute after shutting PC1 down 6.Send magic WOL packet to mac address of PC2, 5 minutes after shutting PC1 down</p><p>1,2 - I do not think the router allows this. Anything tried. Cannot see any packets. Not working. 3 - only one that works. 4-6 does not work.</p><p>Kurt The intend is not a PC alive on the network. I used the PC as an experiment. IF the hub broadcast approach work, I was intending to use a printer and leave it on instead.</p><p>Anyway thanks for all the help. I decided the hub workaround is not working in my case.</p></div><div id="comment-12715-info" class="comment-info"><span class="comment-age">(13 Jul '12, 21:52)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12719"></span><div id="comment-12719" class="comment"><div id="post-12719-score" class="comment-score"></div><div class="comment-text"><blockquote><p>1,2 - I do not think the router allows this. Anything tried. Cannot see any packets.</p></blockquote><p>The idea was to test this in the local network, not over the router to figure out if your network adapter accepts broadcast packets.</p><blockquote><p>4-6 does not work.</p></blockquote><p>As test 4 does not work, I assume that your adapter shuts down the pysical link after 2 minutes OR just accepts boradcast packtes after that time. Repeat tests 2 locally.</p><blockquote><p>IF the hub broadcast approach work, I was intending to use a printer and leave it on instead.</p></blockquote><p>It does not work, as your tests 5-6 have shown.</p><p>BTW: Short solution. If tests 1-2 do work locally (please test), buy a router that allows forwarding to the IP boradcast address, as I described in my answer.</p></div><div id="comment-12719-info" class="comment-info"><span class="comment-age">(14 Jul '12, 06:06)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="12720"></span><div id="comment-12720" class="comment"><div id="post-12720-score" class="comment-score"></div><div class="comment-text"><blockquote><p>The idea was to test this in the local network, not over the router to figure out if your network adapter accepts broadcast packets.</p></blockquote><p>Not sure what u had in mind here. Router cannot port forwardto a broadcast address.</p></div><div id="comment-12720-info" class="comment-info"><span class="comment-age">(14 Jul '12, 06:24)</span> <span class="comment-user userinfo">Pete the cur...</span></div></div><span id="12721"></span><div id="comment-12721" class="comment"><div id="post-12721-score" class="comment-score"></div><div class="comment-text"><p>The idea was to first determine what your NIC accepts as WOL packets and then to find a solution that matches your needs best. As 3 does work, but 4 doesn't, you are stuck with the specs which say you need to send a broadcast WOL packet. So if your current router does not support directed broadcasts, then your out of luck indeed.</p><p>Not sure what kind of router ou have, but maybe you can flash it with OpenWRT or DD-WRT? You can then SSH into the router and send a WOL packet from the router CLI.</p></div><div id="comment-12721-info" class="comment-info"><span class="comment-age">(14 Jul '12, 06:35)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="12722"></span><div id="comment-12722" class="comment"><div id="post-12722-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Not sure what u had in mind here. Router cannot port forwardto a broadcast address.</p></blockquote><p>They can. I'm talking about the network broadcast IP. Read the link in my answer above and my test. If the test with the broadcast MAC works locally, you just need a router that is able to port forward to the network broadcast IP. According to reports from other peopele (see router forums) several cheap DSL routers can do that.</p><p>Did you actually try with your router? What happens if you port forward to your internal network brodcast IP (e.g. 192.168.1.255)??</p></div><div id="comment-12722-info" class="comment-info"><span class="comment-age">(14 Jul '12, 06:39)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-12702" class="comment-tools"></div><div class="clear"></div><div id="comment-12702-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="12712"></span>

<div id="answer-container-12712" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-12712-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-12712-score" class="post-score" title="current number of votes">0</div><span id="post-12712-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Maybe a Wake on Lan "Proxy" can help as well. If you have one machine that is allways on, you can install <a href="http://desleeper.codeplex.com/">desleeper</a> on it in <a href="http://desleeper.codeplex.com/wikipage?title=deSleeper%20Architecture&amp;referringTitle=Documentation">"proxy mode"</a> (windows service). Then just port forward the required proxy ports (HINT: think about the security implications of such a construct!).</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Jul '12, 17:15</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>13 Jul '12, 17:28</strong> </span></p></div></div><div id="comments-container-12712" class="comments-container"></div><div id="comment-tools-12712" class="comment-tools"></div><div class="clear"></div><div id="comment-12712-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="13642"></span>

<div id="answer-container-13642" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-13642-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-13642-score" class="post-score" title="current number of votes">0</div><span id="post-13642-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>FYI, I am the one that wrote the Wake on LAN/WAN guide that pete quoted.</p><p><a href="http://filesharingtalk.com/threads/439573-Wake-on-WAN-guide">link text</a></p><p>I was able to get WoW working with the hub behind the router and it worked even when the PC was off for several hours or days.</p><p>The equipment I used to get this working is a Netgear WPN-824 router, Netgear DS-104 Hub, and a Sprint Airave 3G version. I used the Airwave as my always on device. I setup in the router to forward port 9 to a static LAN address for the Airwave. I used my Android phone and the free app "WoL Wake On LAN WAN" to send the magic packet while on 3G, 4G, and other outside networks to wake up my PC using the PC's MAC and port 9. It worked every single time no matter how long the PC was off. The app sends 5 packets by default. It has an option to check for "Send as Broadcast" but I never use it.</p><p>I got this method from a guy on Netgear forums who was helping someone with WoW and the PC being behind the router. I purchased the hub off of ebay on the cheap, $15, and got working rather easy.</p><p>The reason to do this, is because most consumer grade routers do not support WoW. Also most consumer grade routers will not let you forward to the router's broadcast address. People have gotten by that by either turning off java and inputing the routers braodcast address in the port forward section then turning it back on or they have modified the range value to include the routers broadcast address as a legit entry. Either way, these two methods open you up to smurf attacks or so I have read.</p><p>If you can install custom firmware, you can get around these limitations but some routers have very low memory available to install custom firmware, i.e. like mine. I can't even assign a static ARP entry, which would help and probably be much easier.</p><p>So the only options left are to either get a router that supports WoW, have 2 NICs and have 1 NIC in front of router with a Hub , or use a hub behind the router.</p><p>Lastly, I have no network certification nor any formal networking background. I am just some average joe who read and researched this stuff and got it to work after trying several different methods and weeks worth of troubleshooting. With that said, if you want me to help you, I will try my best to with the knowledge I have gleaned but don't expect miracles. You can find me over at filesharingtalk if you do want help.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>14 Aug '12, 20:49</strong></p><img src="https://secure.gravatar.com/avatar/aadeceea704e685f273032d501a59893?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Sandman&#39;s gravatar image" /><p><span>Sandman</span><br />
<span class="score" title="1 reputation points">1</span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Sandman has no accepted answers">0%</span></p></div></div><div id="comments-container-13642" class="comments-container"><span id="13685"></span><div id="comment-13685" class="comment"><div id="post-13685-score" class="comment-score"></div><div class="comment-text"><p>From your description (link in your answer).</p><blockquote><p>Cite: Some of you may be scratching your head as to <strong>why should we port forward to the always on device and not the PC</strong>, well that is the beauty of the hub. <strong>It will broadcast the packet to it regardless which device you have port forwarded to</strong>. The reason you port forward to the always on device is that your router needs a "live" device to keep the ARP entry alive. The router forwards the packet to that LAN IP address to the hub. The hub then broadcasts the packet to all devices because it doesn't know who it is intended for. Thus <strong>your PC will wake despite it going to the other device</strong>.</p></blockquote><p>Well, that only works, because the WOL implementation of your PC NIC (the one you want to awake) is (apparently) not standard conform and accepts WOL packets, even though it is neither directed to its own MAC address nor to the ethernet broadcast address. See the <a href="http://support.amd.com/us/Embedded_TechDocs/20213.pdf">WOL specs of AMD</a>. That's kind of odd, as that PC will also wake up, if you try to awake another machine on the same network.</p><p>If you try that with another NIC brand (different vendor), you might discover, that your method does not work.</p><p>Unfortunately <span>@Pete</span>-the-curious stopped communication on 14. Jul and did not provide the data we asked for. With that information we might have found a solution for him. However, based on the information he provided, I believe your method does not work for his NIC. I conclude this based on some tests results he posted.</p></div><div id="comment-13685-info" class="comment-info"><span class="comment-age">(16 Aug '12, 07:46)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="13686"></span><div id="comment-13686" class="comment"><div id="post-13686-score" class="comment-score"></div><div class="comment-text"><p>Kurt, I totally agree except for:</p><blockquote><p>That's kind of odd, as that PC will also wake up, if you try to awake another machine on the same network.</p></blockquote><p>The mac-address of the PC to be awakened is also (repeatedly) embedded in the packets payload. So sending the magic packet to mac-address A with mac-address B in the Payload would not wake up a system with mac-address C.</p><p>The whole point is whether the NIC of the PC that you try to awaken is listening to all packets or just packets destined to the broadcast address (WOL-spec), it's own mac-address and/or any mac-address.</p><p>That will probably vary!</p></div><div id="comment-13686-info" class="comment-info"><span class="comment-age">(16 Aug '12, 07:56)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="13687"></span><div id="comment-13687" class="comment"><div id="post-13687-score" class="comment-score"></div><div class="comment-text"><blockquote><p>The mac-address of the PC to be awakened is also (repeatedly) embedded in the packets payload. So sending the magic packet to mac-address A with mac-address B in the Payload would not wake up a system with mac-address C.</p></blockquote><p>You're right, it should not. Based on the description of Sandman, I'm not sure what he used as payload for the WOL packet. As it only makes sense to use the MAC address of the shutdown PC I <strong>now</strong> assume he did that. In that case you are right.</p><p>If he used the <strong>MAC address</strong> of the <strong>allways on PC</strong> (it does not really make sense, but based on his description <strong>this is what I assumed</strong>), the WOL implementation is badly broken, and it will awake by every WOL packet on the network, howsoever it recognizes a packet as a WOL packet. Maybe just by the sequence of: 1 * FFFFFFFFFFFF and 16 * "any MAC address" in the payload !??!</p><p>The method of Sandman works, if the WOL implementation ignores the frame address and only relys on the MAC address (of the shutdown PC) in the payload.</p><blockquote><p>The whole point is whether the NIC of the PC that you try to awaken is listening to all packets or just packets destined to the broadcast address (WOL-spec), it's own mac-address and/or any mac-address.</p></blockquote><p>I agree.</p></div><div id="comment-13687-info" class="comment-info"><span class="comment-age">(16 Aug '12, 08:29)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="13689"></span><div id="comment-13689" class="comment"><div id="post-13689-score" class="comment-score"></div><div class="comment-text"><p>Kurt, I said that I used the MAC address of the WoL PC and not the always on device. I even mentioned the program I used to send the magic packet.</p><blockquote><p>I used my Android phone and the free app "WoL Wake On LAN WAN" to send the magic packet while on 3G, 4G, and other outside networks to wake up my PC using the <strong>PC's MAC and port 9</strong>.</p></blockquote><p>So with the program I use to send the magic packet, I use the MAC address of the WoL PC, port 9, and the WAN address. The router sees that the packet is intended for port 9 and forwards the packet to the always on device but before it can get to the always on device, the packet has to go through the hub. The hub broadcasts the packet to all attached devices regardless because thats what it does. So every device on the hub gets the same packet but the only device that cares about the packet is the WoL PC, which sees that it contains the correct MAC address and sequence.</p></div><div id="comment-13689-info" class="comment-info"><span class="comment-age">(16 Aug '12, 12:48)</span> <span class="comment-user userinfo">Sandman</span></div></div><span id="13692"></span><div id="comment-13692" class="comment"><div id="post-13692-score" class="comment-score"></div><div class="comment-text"><p>Sandman, I was referring to the link you mentioned (<a href="http://filesharingtalk.com/threads/439573-Wake-on-WAN-guide).">http://filesharingtalk.com/threads/439573-Wake-on-WAN-guide).</a> The description therein is not that clear about the MAC address used. I did not remember that you mentioned that aspect in your answer here.<br />
</p><p>With that information it's pretty clear what's going on. Your NICs WOL implementation just looks at the payload and if it finds its own MAC address therein, it will accept the WOL packet, regardless of the frame mac address. I have no idea if that is common behavior or not, at least it does not adhere to the original <a href="http://support.amd.com/us/Embedded_TechDocs/20213.pdf">AMD definition of WOL</a>(as I read it).</p><blockquote><p>Cite: "Once the LAN controller has been put into the Magic Packet mode, it scans all <strong>incoming frames addressed to the node</strong> for a speciﬁc data sequence, which indi- cates to the controller that this is a Magic Packet frame.</p></blockquote><p>They have also described the situation with a router and the ARP cache timeout. The solution is to send the packet to the network broadcast address (one suggestion in my answer).</p><p>As you also mentioned the network broadcast method, you could add a hint, that the "hub method" might not work with all NICs, as some WOL implementations might behave differently (according to the WOL specs).</p><p>But anyway, if your method works in your environment, that's great. What else do you need ;-)<br />
</p></div><div id="comment-13692-info" class="comment-info"><span class="comment-age">(16 Aug '12, 14:04)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="13694"></span><div id="comment-13694" class="comment not_top_scorer"><div id="post-13694-score" class="comment-score"></div><div class="comment-text"><p>Ok np. The WoL FAQ says that the AMD WoL whitepaper also states that the payload can anywhere within the payload. <a href="http://wiki.wireshark.org/WakeOnLAN">http://wiki.wireshark.org/WakeOnLAN</a></p><p>I will update the guide to be more specific. Thanks for the suggestions.</p></div><div id="comment-13694-info" class="comment-info"><span class="comment-age">(16 Aug '12, 16:03)</span> <span class="comment-user userinfo">Sandman</span></div></div></div><div id="comment-tools-13642" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-13642-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

