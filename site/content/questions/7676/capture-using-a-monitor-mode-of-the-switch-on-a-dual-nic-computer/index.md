+++
type = "question"
title = "Capture using a monitor mode of the switch on a dual nic computer"
description = '''Hi, I&#x27;ve been utilizing a Windows XP computer with a second NIC card as a &quot;sniffer&quot; box. I am having a problem where I am not seeing the traffic I expect to see on the capture. I suspect I am doing something wrong on the sniffer box because I have seen this issue on multiple model Cisco switches, ru...'''
date = "2011-11-28T09:17:00Z"
lastmod = "2014-08-18T04:29:00Z"
weight = 7676
keywords = [ "cisco", "monitor", "dual-nic" ]
aliases = [ "/questions/7676" ]
osqa_answers = 3
osqa_accepted = false
+++

<div class="headNormal">

# [Capture using a monitor mode of the switch on a dual nic computer](/questions/7676/capture-using-a-monitor-mode-of-the-switch-on-a-dual-nic-computer)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7676-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7676-score" class="post-score" title="current number of votes">0</div><span id="post-7676-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, I've been utilizing a Windows XP computer with a second NIC card as a "sniffer" box. I am having a problem where I am not seeing the traffic I expect to see on the capture. I suspect I am doing something wrong on the sniffer box because I have seen this issue on multiple model Cisco switches, running different IOS version. My reason I say there is a problem is because I do not see all the send or receive traffic in some cases. I test this by doing a ping. If I am monitoring both rx and tx I should see both the echo request and the echo reply. In any case I only see one or the other, or sometimes only one. I change the monitor seession to only mirror rx or tx and do not see the results I expect. For example, if I am look at rx only on a switch port and I generate an echo request to the device plugged into the port, I would expect to only see the echo reply on my capture. If I change to monitor tx only and generate the same echo request I would expect the see the request only as it exits the switch port and is transmitted to the device in question. I had a case with Cisco to look at there being a possible bug with the monitor session and convinced three different engineers something is not right with the capture. Cisco was not able to recreate the issue and hinted that the sniffer box might not be setup right. I suspect the problem is with the method I am using on the sniffer box because of trying it at multiple locations across multiple Cisco switch models and IOS codes.</p><p>We utilize one NIC on the sniffer box for remote access and the other NIC plugs into a Cisco switch that is setup in monitor mode like this.</p><pre><code>Session 1
---------
Type              : Local Session
Source Ports      :
    Both          : Fa0/18
Destination Ports : Fa0/22
    Encapsulation : Native
          Ingress: Disabled</code></pre><p>The monitor session is configured to mirror both rx and tx traffic. The NIC on the sniffer box that is plugged into port 22 has TCP/IP unchecked in the Windows network settings along with all the other protocols (macafee, client for microsoft networks, file printer and sharing, etc.) except for the network capture driver. I'm not even sure that is required to be checked because if you uncheck everything, you still can see traffic in Wireshark that is passing through the port being monitored. Windows firewall is disabled. I normally use Windump on the sniffer just because Wireshark over a remote desktop session is not ideal. My typical Windump command would go something like this:</p><pre><code>windump -i 3 -s 0 -C 25 -W 60000 -w c:\captures\dump.pcap</code></pre><p>Interface #3 being the NIC that plugs into port 22 or the switch port running in monitor mode. Even if I don't use windump and go back to using Wireshark on the sniffer box and generate pings I only see the echo request, not the reply. I also see other traffic in the capture that suggest I am not capturing everything, such as ICMP dest. unreachable messages but I do not see the initial UDP query that caused the device to generate such ICMP dest. unreachable message.</p><p>Does anyone have any suggestions about what I may be doing wrong?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-cisco" rel="tag" title="see questions tagged &#39;cisco&#39;">cisco</span> <span class="post-tag tag-link-monitor" rel="tag" title="see questions tagged &#39;monitor&#39;">monitor</span> <span class="post-tag tag-link-dual-nic" rel="tag" title="see questions tagged &#39;dual-nic&#39;">dual-nic</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>28 Nov '11, 09:17</strong></p><img src="https://secure.gravatar.com/avatar/39cd80ed85e55962a47b03253968662c?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="networkguy09&#39;s gravatar image" /><p><span>networkguy09</span><br />
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="networkguy09 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>28 Nov '11, 09:56</strong> </span></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p><span>SYN-bit ♦♦</span><br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span></p></div></div><div id="comments-container-7676" class="comments-container"><span id="7680"></span><div id="comment-7680" class="comment"><div id="post-7680-score" class="comment-score"></div><div class="comment-text"><p>Similar to my monitoring whereas I only saw Echo Reply, never saw Echo Request. Another problem, I can not see TCp traffic althought I can see unicast UDP traffic between other two devices. BTW there are lots of TCP traffic, unicast, which should have been seen by sniffer inmy case. I tried two sniffing software. same result. I guess it Cisco SPAN bug.</p></div><div id="comment-7680-info" class="comment-info"><span class="comment-age">(28 Nov '11, 10:48)</span> <span class="comment-user userinfo">Buddy</span></div></div></div><div id="comment-tools-7676" class="comment-tools"></div><div class="clear"></div><div id="comment-7676-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="7677"></span>

<div id="answer-container-7677" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7677-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7677-score" class="post-score" title="current number of votes">0</div><span id="post-7677-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>OK, if I get this right, you are monitoring a system on port Fa0/18 using your dual-homed XP system on port Fa0/22. Then you use a third system to ping the system on port Fa0/18? On which port is this system connected? How are the vlans set up? Are you using any vlan tagged interfaces? Is the system on port Fa0/18 by any change connected to the switch(es) with a teamed NIC?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>28 Nov '11, 10:03</strong></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p><span>SYN-bit ♦♦</span><br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SYN-bit has 174 accepted answers">20%</span></p></div></div><div id="comments-container-7677" class="comments-container"><span id="7683"></span><div id="comment-7683" class="comment"><div id="post-7683-score" class="comment-score"></div><div class="comment-text"><p>The device we are monitoring is a printer. The printer has a problem where it hangs and stops responding and the only fix has been to unplug/plug the printer. So it is a single network connection to the printer plugged into port 18. Port 22 is the monitor port for which I showed the configuration in my initial post. The sniffer box has a second NIC which plugs into port 11 of the same switch. Port 11 and port 18 are both access ports in the same vlan. It doesn't seem to matter where I generate the ping.</p></div><div id="comment-7683-info" class="comment-info"><span class="comment-age">(28 Nov '11, 11:28)</span> <span class="comment-user userinfo">networkguy09</span></div></div><span id="7684"></span><div id="comment-7684" class="comment"><div id="post-7684-score" class="comment-score"></div><div class="comment-text"><p>I've done it from the sniffer box, which should use it's second NIC aka "management nic" to send the ping because the other NIC does not even have TCP/IP turned on. The SPAN is suppose to take everything both incoming and outgoing on port 18 and copy that to port 22. So in theory, I should see the echo request as it's transmitted out of port 18 and the echo reply as the printer responds and the reply is received back on port 18.</p><p>As I mentioned, I've had this problem on multiple switches now all running different IOS.</p></div><div id="comment-7684-info" class="comment-info"><span class="comment-age">(28 Nov '11, 11:28)</span> <span class="comment-user userinfo">networkguy09</span></div></div><span id="7685"></span><div id="comment-7685" class="comment"><div id="post-7685-score" class="comment-score"></div><div class="comment-text"><p>The sniffer box is the only common factor as it is the same box I've used to do captures on. I tried something else since I wrote this thread. I started up Wireshark looking at my second NIC (the one plugged into port 22) and shutdown port 11 on the switch (the interface I used for remote management).</p></div><div id="comment-7685-info" class="comment-info"><span class="comment-age">(28 Nov '11, 11:28)</span> <span class="comment-user userinfo">networkguy09</span></div></div><span id="7686"></span><div id="comment-7686" class="comment"><div id="post-7686-score" class="comment-score"></div><div class="comment-text"><p>I then did a ping from my desktop (which resides on a different vlan, etc.) saw my ping was answered by the printer, left the capture running and port 11 shutdown for about an hour. Turned port 11 back up, remote desktop into the sniffer box and stopped the capture. The capture has no ICMP at all. I am at a lose to understand why the capture is not showing traffic I know to have traversed port 18.</p></div><div id="comment-7686-info" class="comment-info"><span class="comment-age">(28 Nov '11, 11:28)</span> <span class="comment-user userinfo">networkguy09</span></div></div><span id="7691"></span><div id="comment-7691" class="comment"><div id="post-7691-score" class="comment-score"></div><div class="comment-text"><p>Is there VPN software on the monitoring box? You might want to have a look at <a href="http://wiki.wireshark.org/CaptureSetup/InterferingSoftware">http://wiki.wireshark.org/CaptureSetup/InterferingSoftware</a>.</p><p>Also, have you tried another system on the span port to see it can capture the packets OK?</p></div><div id="comment-7691-info" class="comment-info"><span class="comment-age">(28 Nov '11, 15:19)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div></div><div id="comment-tools-7677" class="comment-tools"></div><div class="clear"></div><div id="comment-7677-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="7698"></span>

<div id="answer-container-7698" class="answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7698-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7698-score" class="post-score" title="current number of votes">0</div><span id="post-7698-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>It was McAfee. Amazing how much time was spent on this problem and no one (including myself) thought to look at McAfee. Thanks for the ideas!</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>29 Nov '11, 05:25</strong></p><img src="https://secure.gravatar.com/avatar/39cd80ed85e55962a47b03253968662c?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="networkguy09&#39;s gravatar image" /><p><span>networkguy09</span><br />
<span class="score" title="16 reputation points">16</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="networkguy09 has no accepted answers">0%</span></p></div></div><div id="comments-container-7698" class="comments-container"></div><div id="comment-tools-7698" class="comment-tools"></div><div class="clear"></div><div id="comment-7698-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="35530"></span>

<div id="answer-container-35530" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-35530-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-35530-score" class="post-score" title="current number of votes">0</div><span id="post-35530-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Similar to your problem : I only saw Echo Reply, never saw Echo Reques!!! I install new version of Wireshark(1.12 version) old version of my wireshark was 1.10 my problem is resolve!! I relized my problem fluky!!!</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>18 Aug '14, 04:29</strong></p><img src="https://secure.gravatar.com/avatar/50e7cd986f77ed0d9366be1e104236dd?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="masood%20khiaraji&#39;s gravatar image" /><p><span>masood khiaraji</span><br />
<span class="score" title="1 reputation points">1</span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="masood khiaraji has no accepted answers">0%</span></p></div></div><div id="comments-container-35530" class="comments-container"></div><div id="comment-tools-35530" class="comment-tools"></div><div class="clear"></div><div id="comment-35530-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

