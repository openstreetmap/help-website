+++
type = "question"
title = "A question about Window Scaling"
description = '''Hello All I am new to Wireshark, and was watching one of Laura Chappell excellent videos (I love those videos), where she mentioned intermediate devices (router, etc) can mess with your TCP header, for example &#x27;Window Size Scaling Factor&#x27; So if Computer A says I have a &#x27;Window Size&#x27; of 256 and by th...'''
date = "2016-10-23T00:36:00Z"
lastmod = "2016-10-23T21:40:00Z"
weight = 56586
keywords = [ "windowscaling" ]
aliases = [ "/questions/56586" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [A question about Window Scaling](/questions/56586/a-question-about-window-scaling)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-56586-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-56586-score" class="post-score" title="current number of votes">0</div><span id="post-56586-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello All</p><p>I am new to Wireshark, and was watching one of Laura Chappell excellent videos (I love those videos), where she mentioned intermediate devices (router, etc) can mess with your TCP header, for example 'Window Size Scaling Factor'</p><p>So if Computer A says I have a 'Window Size' of 256 and by the way I can sale this by 256 (e.g. the Window Scaling Factor) meaning I can actually support a Window Size of 65536, but the router amends the Window Scaling Factor (or nulls it) so it is effectively 1;</p><p>Meaning Computer B hears the message I can support Window Size of 256 x 1 = 256 (e.g. very bad for performance). I have two questions about this please.</p><p>1: Why does Computer A not just say at I can support of Window Size of 65536 with a scaling factor of 1 in the first place? Therefore if the router a nulls the scaling factor it does not matter as you still tell the other party you can support 65536.</p><p>2: Why does the router mess this this in the first place? I can understand the router needs to consider the maximum MTU (Ethernet Frame Size, I believe this refers to), and possible the segment size (IP data) but the Window Size as far as I am aware is just the receiver telling the sender I can receive this many segments (collection of bytes) before I need to send you an ACK. Therefore I cannot see what the Window Size and therefore the Window Scaling Factor has to do with the router in the path; and therefore why the router would want to mess with it.</p><p>Thanks All in advance EBrant</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-windowscaling" rel="tag" title="see questions tagged &#39;windowscaling&#39;">windowscaling</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>23 Oct '16, 00:36</strong></p><img src="https://secure.gravatar.com/avatar/ff39c11ae2cb05528da757366e76d84b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="EBrant&#39;s gravatar image" /><p><span>EBrant</span><br />
<span class="score" title="1 reputation points">1</span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="9 badges"><span class="bronze">●</span><span class="badgecount">9</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="EBrant has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>23 Oct '16, 22:46</strong> </span></p><img src="https://secure.gravatar.com/avatar/2337f0406681e5c72ea0e6f1f0d6c0b0?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jaap&#39;s gravatar image" /><p><span>Jaap ♦</span><br />
<span class="score" title="11680 reputation points"><span>11.7k</span></span><span title="16 badges"><span class="silver">●</span><span class="badgecount">16</span></span><span title="101 badges"><span class="bronze">●</span><span class="badgecount">101</span></span></p></div></div><div id="comments-container-56586" class="comments-container"></div><div id="comment-tools-56586" class="comment-tools"></div><div class="clear"></div><div id="comment-56586-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="56587"></span>

<div id="answer-container-56587" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-56587-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-56587-score" class="post-score" title="current number of votes">1</div><span id="post-56587-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>1: Why does ComputerA not just say it can support a Window Size of 65536 with a scaling factor of 1 in the first place?</p></blockquote><p>The basic field of the TCP header carrying the window size is just two bytes in size, so the maximum window size it can express is 65535. The purpose of introduction of the window size scaling mechanism was to extend the range that can be expressed using those two bytes (for the price of losing resolution which is negligible compared to the benefits).</p><p>If your example of value 256 and scaling factor 256 is a real life one, not just illustrative, it would really be possible not to use the scaling factor at all and state the window size of 65535 using the two bytes. But you would have to ask the authors of the TCP stack implementation on ComputerA why they did it the former way. Wireshark can only show you <strong>what</strong> has happened; if you want to know <strong>why</strong> that happened, you need to see RFCs and/or ITU recommendations and the source codes of the protocol stacks and applications.</p><blockquote><p>2: Why does the router mess with this in the first place?</p></blockquote><p>There may be several reasons:</p><ul><li><p>it may be simply too old to recognize the Window scale factor option so it ignores it</p></li><li><p>it may contain a bug making it ignore the Window scale factor option</p></li><li><p>it may have a small memory and a reason to inspect the data flowing through it, so it has to reduce the window size to a value allowing it to handle the data.</p></li></ul></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>23 Oct '16, 01:00</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>23 Oct '16, 01:11</strong> </span></p></div></div><div id="comments-container-56587" class="comments-container"><span id="56591"></span><div id="comment-56591" class="comment"><div id="post-56591-score" class="comment-score"></div><div class="comment-text"><p>Hello PacketHunter and Sindy, thanks for both taking the time to explain. this has really helped to clear things up.</p><p>So if I have understand you both in a nutshell Windows Size is a two byte (16 bit fieled) meaning a maximum of 65535 -1 = 65534 (64k)</p><p>however the scaling factor option (e.g. use one of the previously free options flags so do how have to re-engineer, or possible the options flag was always there) means you can scale up to 16MB Window Size. Is that correct so far please?</p><p>Also, from what I understand from above, if I send a SYN with a small Windows size (256) and a scale factor of 8 (meaning my window can scale to 64k) the receiver who is about the send a SYN-ACK thinks OK this guy can do Windows scaling and therefore I will 'also' send a smallish window size with a scale option set (e.g. reply in a similar manor) rather than sending say a window size of say 64k with no scaling option set in my SYN-ACK.</p><p>Is the above correct/reasonable assumption so far please?</p><p>Then looking at the interconnected device (router/firewall etc), if it has low RAM, slowish CPU etc. but wants to inspect the packets (for filtering or whatever reason) is it correct to say/assume the router/firewall "likes a smaller window size" as it knows that when the number of packets have been sent by the client up to the window size the client will then wait for a ACK from the other side for these packets (segment/s) it sent, giving the router that split second of time to inspect/filter/amend the packet etc before passing them on.</p><p>is my assumption above correct please?</p><p>Thanks again EBrant</p></div><div id="comment-56591-info" class="comment-info"><span class="comment-age">(23 Oct '16, 09:54)</span> <span class="comment-user userinfo">EBrant</span></div></div><span id="56592"></span><div id="comment-56592" class="comment"><div id="post-56592-score" class="comment-score"></div><div class="comment-text"><blockquote><p>is my assumption above correct please?</p></blockquote><p>Mostly.</p><blockquote><p>however the scaling factor option means you can scale up to 16MB Window Size.</p></blockquote><p>16 MB is the maximum window size for a scaling factor of 8, but the scaling factor may be higher.</p><blockquote><p>if I send a SYN with a small Windows size (256) and a scale factor of 8 (meaning my window can scale to 64k)...</p></blockquote><p>No. If you send a small window size (256) and a scale factor of 8, it means the <strong>current size</strong> of your receive window is 65536 bytes. The <strong>maximum size</strong> is 65535×256, i.e. about 16 MBytes.</p><blockquote><p>... the receiver who is about the send a SYN-ACK thinks OK this guy can do Windows scaling and therefore I will 'also' send a smallish window size with a scale option set (e.g. reply in a similar manor) rather than sending say a window size of say 64k with no scaling option set in my SYN-ACK.</p></blockquote><p>There is no rule that the window size scaling factor must be the same in both directions. However, the presence of the window size scaling factor option in the <code>SYN,ACK</code> packet of the server, regardless the scaling factor value, confirms to the client that the server supports window size scaling. If the client sends the window scaling factor option in its <code>SYN</code> packet but doesn't receive one from the server, it must use a scaling factor of 0. Similarly, if there is no window scaling factor option in the <code>SYN</code> packet from the client, the server knows there is no point in using a scaling factor as the client doesn't support it, so it doesn't send that option in its <code>SYN,ACK</code> packet.</p></div><div id="comment-56592-info" class="comment-info"><span class="comment-age">(23 Oct '16, 10:47)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="56593"></span><div id="comment-56593" class="comment"><div id="post-56593-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>the client will then wait for a ACK from the other side for these packets (segments) it sent, giving the router that split second of time to inspect/filter/amend the packet etc before passing them on.</p></blockquote><p>If processing time would be a concern, it wouldn't be enough to rely on smaller window size and the router would have to take active measures, i.e. not to forward the packets until it analyses them.</p></div><div id="comment-56593-info" class="comment-info"><span class="comment-age">(23 Oct '16, 10:58)</span> <span class="comment-user userinfo">sindy</span></div></div></div><div id="comment-tools-56587" class="comment-tools"></div><div class="clear"></div><div id="comment-56587-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="56590"></span>

<div id="answer-container-56590" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-56590-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-56590-score" class="post-score" title="current number of votes">1</div><span id="post-56590-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Hm, the behavior might become clear, if we look at the TCP handshake.</p><p>First a few words on</p><p><strong>Window Scaling:</strong></p><p>This is nowadays supported by virtually all recent TCP stacks. Both, client and sender, send an aptly named TCP option with the SYN flag. The scale option will be translated to a power of 2. So Windows Scaling 8 will translate to a factor of 2^8 = 256.</p><p>The TCP window size is a 16 bit field, which limits the window size to 2^16-1 bytes. With a scale factor of 8 this connection could now use 2^(16+8)-1 bytes. This is especially nice for "long fat networks" (LFN, some times called "elefant").</p><p>If one side signales a scale factor of 0 that translates to "hey, you other guy signal a really large receive window which I will use. But me, I stay with a limit of 2^16-1 Byte"</p><p><strong>Selecting an initial Window Size</strong></p><p>If your systems selects a window size of 256 with a scale factor of 8 (= multiply by 256) the window size can be expanded way beyond 64 kByte. This allows a much greater throughput, if the connection uses requires it. Hint: A Gigabit link with a 1 millisecond RTT easily runs well with a 125 kByte window.</p><p>A scale factor of 1 would prevent the connection from using the full throughput.</p><p><strong>Routers messing with the hand shake</strong></p><p>In certain situations a device in the network will mess up the hand shake. Possible perpetrators are WAN-optimizers, faulty or misconfigured load balancers, routers or firewalls with a silly NAT algorithms or another configuration problem.</p><p>One such culprit could be a firewall or router manufactured by Cisco that uses a feature called "TCP normalization".</p><p>Assume the following network:</p><pre><code>Node-A - Router-A --- Network --- Router-B - Node-B</code></pre><p>Say, Node-A sends a packet with a Window Size 64 kByte and scale factor 0. Router-B passes the Window Scaling option from the TCP header incoming packets and forwards the packet to Node-B. Node-B responds with a scale factor of 8 and a Window Size of 256, which would translate to 64 kB.</p><p>Trouble starts, if this outbound packet is modified by any router / load-balancer / optimizing magic device and the scaling option is removed:</p><p>Node A assumes that Window Scaling is disabled for this connection, as the SYN-ACK did not include a Scale-Option. As Node B assumes that we have Window Scaling and signals a very small number as window size, the connection will slow down to a crawl.</p><p>Good hunting</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>23 Oct '16, 06:28</strong></p><img src="https://secure.gravatar.com/avatar/3b60e92020a427bb24332efc0b560943?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="packethunter&#39;s gravatar image" /><p><span>packethunter</span><br />
<span class="score" title="2137 reputation points"><span>2.1k</span></span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="48 badges"><span class="bronze">●</span><span class="badgecount">48</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="packethunter has 8 accepted answers">8%</span></p></div></div><div id="comments-container-56590" class="comments-container"><span id="56594"></span><div id="comment-56594" class="comment"><div id="post-56594-score" class="comment-score">1</div><div class="comment-text"><p>Actually, Window Scaling can increase the senders transmit window to 1 GByte, if the scale factor 14 is used: <em>The window size would be expanded by 14, i. e. multiplied by 2^14 = 8192.</em> 2^30 = 1 GByte</p><p>The window size signals, how much data the other end may transmit, without waiting for an acknowledgement. The window size may grow or shrink, depending on the current load of the receiver.</p><p>Say, you upload up a large file to an FTP server. If the server starts the conversation with a window size of 64 kByte the client can send so many bytes without waiting for an acknowledgement.</p><p>If the server wants to slow the client, because the disk is slow, CPU is busy or any other reason, the server can shrink the window size. In the worst of all cases the window size goes down to 0, which would be like "hold your data for a moment, I need to process what to you send me so far". The window size usually goes up within a few milliseconds.</p><p>The server can increase the window size (with window scaling beyond 64 kB). This tells the client "keep it coming, I can keep up with you".</p><p>A good description of the window size is given by Jeremy Stretch on his web site <a href="http://packetlife.net/blog/2010/aug/4/tcp-windows-and-window-scaling/">packetlife.net</a>.</p><p>If one side starts the conversation with a window size of 256 and a scale factor of 8 the initial window would be 64 kByte. Still, the window size can increase to 65535 * 256 = 16 MByte.</p><p>The other end may or may not use the window size. This largely depends on the application. For example, FTP would benefit from a large window. SMB is delivering smaller data chunks and might not benefit from a large window size.</p></div><div id="comment-56594-info" class="comment-info"><span class="comment-age">(23 Oct '16, 10:59)</span> <span class="comment-user userinfo">packethunter</span></div></div><span id="56596"></span><div id="comment-56596" class="comment"><div id="post-56596-score" class="comment-score"></div><div class="comment-text"><p>Thanks very much again Sindy and PacketHunter fro your detailed replies, its nice to know there are people out there that will really help you out. Next I will buy some books (it's going to take a while but I am determined to learn this well). EBrant :)</p></div><div id="comment-56596-info" class="comment-info"><span class="comment-age">(23 Oct '16, 21:40)</span> <span class="comment-user userinfo">EBrant</span></div></div></div><div id="comment-tools-56590" class="comment-tools"></div><div class="clear"></div><div id="comment-56590-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

