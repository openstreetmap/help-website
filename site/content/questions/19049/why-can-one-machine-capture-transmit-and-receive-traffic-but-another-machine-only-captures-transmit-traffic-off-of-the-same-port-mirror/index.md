+++
type = "question"
title = "Why can one machine capture transmit and receive traffic but another machine only captures transmit traffic off of the same port mirror?"
description = '''This is a very odd problem we have run into... We have configured a many-to-one port mirror on a switch to forward all traffic from the mirrored servers to a Linux monitor server. We tested the many-to-one port mirror with laptops pinging each other and used another laptop running Wireshark 1.0.2 to...'''
date = "2013-03-01T10:30:00Z"
lastmod = "2013-03-06T15:29:00Z"
weight = 19049
keywords = [ "received", "transmits", "packets", "windows7", "wireshark" ]
aliases = [ "/questions/19049" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Why can one machine capture transmit and receive traffic but another machine only captures transmit traffic off of the same port mirror?](/questions/19049/why-can-one-machine-capture-transmit-and-receive-traffic-but-another-machine-only-captures-transmit-traffic-off-of-the-same-port-mirror)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-19049-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-19049-score" class="post-score" title="current number of votes">0</div><span id="post-19049-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>This is a very odd problem we have run into...</p><p>We have configured a many-to-one port mirror on a switch to forward all traffic from the mirrored servers to a Linux monitor server. We tested the many-to-one port mirror with laptops pinging each other and used another laptop running Wireshark 1.0.2 to capture the traffic, proving that everything is working.</p><p>When we added the Linux monitor server to the mix the monitor shows that it is only getting the traffic being transmitted from the mirrored server ports and not getting the traffic being received on those ports.</p><p>We moved the connection from the Linux monitor server to the laptop with Wireshark 1.0.2 and ran a new capture which showed both the transmit and receive traffic, in this case pings to the servers on the mirrored ports and their replies to the PC on the LAN sending the pings.</p><p>When a SysAdmin put a laptop running Wireshark 1.8.5 on the connection and ran a new capture of the still running pings his capture only showed the transmit traffic from the mirrored servers, the ping replies, and did not show the pings the servers were receiving.</p><p>We immediately swapped back to the Wireshark 1.0.2 laptop and confirmed that it was capturing both the pings and the replies, the transmit and received traffic from the mirrored servers.</p><p>A tcpdump from a Linux laptop on that same connection also captured the pings and replies, transmited and received traffic from the servers.</p><p>We compared the capture settings we were using for Wireshark 1.0.2 and Wireshark 1.8.5 and they were the same. Both were configured to capture packets in promiscuous mode with a 5 megabyte buffer. Both laptops were auto-negotiating at full Gig, though the Wireshark 1.0.2 laptop is running Windows XP SP3 and the Wireshark 1.8.5 laptop is running Windows 7. In both cases we did not have any capture filters applied.</p><p>We are stumped on this one. The Wireshark 1.0.2 captures confirm that all the traffic, transmited and reveived, is being mirred from the servers, but Wireshark 1.8.5 and the Linux monitor server are only capturing the traffic being transmitted by the mirrored servers.</p><p>Has anyone else ever seen or heard of this issue?</p><p>Many Thanks! Jandrys</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-received" rel="tag" title="see questions tagged &#39;received&#39;">received</span> <span class="post-tag tag-link-transmits" rel="tag" title="see questions tagged &#39;transmits&#39;">transmits</span> <span class="post-tag tag-link-packets" rel="tag" title="see questions tagged &#39;packets&#39;">packets</span> <span class="post-tag tag-link-windows7" rel="tag" title="see questions tagged &#39;windows7&#39;">windows7</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>01 Mar '13, 10:30</strong></p><img src="https://secure.gravatar.com/avatar/612d4627a1e646a5557ce9657c4aa9cd?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jandrysik&#39;s gravatar image" /><p><span>Jandrysik</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jandrysik has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>01 Mar '13, 15:13</strong> </span></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span></p></div></div><div id="comments-container-19049" class="comments-container"><span id="19068"></span><div id="comment-19068" class="comment"><div id="post-19068-score" class="comment-score"></div><div class="comment-text"><p>Hi,</p><p>I'm a bit confused when and what did or did not work. Could you please put together two cases where you describe which system was connected to which switch port (just symbolic), who was talking to whom (symbolic names) and what you did see (or not).</p><p>Thanks<br />
Kurt</p></div><div id="comment-19068-info" class="comment-info"><span class="comment-age">(01 Mar '13, 13:09)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="19073"></span><div id="comment-19073" class="comment"><div id="post-19073-score" class="comment-score"></div><div class="comment-text"><p>Kurt,</p><p>Here are four cases, two successes and two failures.</p><p>Situation:</p><p>PC A is pinging Server B and Server C. Server B and Server C are both on the same network and the same switch. The switch has a 'many-to-one' port mirror configured to forward all traffic sent and received (Tx/Rx) by Server B and Server C to a monitor port.</p></div><div id="comment-19073-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:04)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19074"></span><div id="comment-19074" class="comment"><div id="post-19074-score" class="comment-score"></div><div class="comment-text"><p>Case 1 - SUCCESS:</p><p>A 32-bit Windows XP laptop running Wireshark 1.0.2 is connected to the monitor port on the switch. The Wireshark capture has promiscuous mode enabled and is using a 5 megabyte buffer but no capture filter. The Windows firewall is disabled on the laptop.</p><p>Wireshark 1.0.2 is able to capture the traffic transmitted and received by Server B and C.</p><p>When the IP address of PC A is used as a viewing filter Wireshark displays the pings from PC A to Servers B and C, and the ping replies from Servers B and C to PC A.</p></div><div id="comment-19074-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:05)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19075"></span><div id="comment-19075" class="comment"><div id="post-19075-score" class="comment-score"></div><div class="comment-text"><p>Case 2 - FAILURE:</p><p>A 64-bit Windows 7 laptop running Wireshark 1.8.5 is connected to the monitor port on the switch. The Wireshark capture has promiscuous mode enabled and is using a 5 megabyte buffer but no capture filter. The Windows firewall is disabled on the laptop.</p><p>Wireshark 1.8.5 is ONLY able to capture the traffic transmitted by Servers B and C.</p><p>When the IP address of PC A is used as a viewing filter Wireshark ONLY displays the ping replies from Servers B and C to PC A. Wireshark does NOT display the original pings from PC A to Servers B and C.</p></div><div id="comment-19075-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:05)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19076"></span><div id="comment-19076" class="comment"><div id="post-19076-score" class="comment-score"></div><div class="comment-text"><p>Case 3 - SUCCESS:</p><p>A Linux laptop is connected to the monitor port on the switch.</p><p>A tcpdump command on the laptop's NIC is able to capture the traffic transmitted and received by Server B and C.</p><p>When the tcpdump is run using the IP address of PC A as a filter the capture displays the pings from PC A to Servers B and C, and the ping replies from Servers B and C to PC A.</p></div><div id="comment-19076-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:06)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19077"></span><div id="comment-19077" class="comment not_top_scorer"><div id="post-19077-score" class="comment-score"></div><div class="comment-text"><p>Case 4 - FAILURE:</p><p>The Linux monitor server is connected to the monitor port on the switch.</p><p>A tcpdump on the Linux monitor server's NIC is ONLY able to capture the traffic transmitted by Servers B and C.</p><p>When the tcpdump is run using the IP address of PC A as a filter the capture ONLY displays the ping replies from Servers B and C to PC A. The capture does NOT display the original pings from PC A to Servers B and C.</p></div><div id="comment-19077-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:07)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19078"></span><div id="comment-19078" class="comment not_top_scorer"><div id="post-19078-score" class="comment-score"></div><div class="comment-text"><p>Our Network Engineers and System Administrators are all scratching their heads on this one.</p><p>Please let me know if you have any questions, comments or recommendations regarding this issue. Thanks! Jandrys</p></div><div id="comment-19078-info" class="comment-info"><span class="comment-age">(01 Mar '13, 15:07)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19089"></span><div id="comment-19089" class="comment not_top_scorer"><div id="post-19089-score" class="comment-score"></div><div class="comment-text"><p>How is this Linux monitor server setup? Is it a dedicated platform? Standalone, like the Linux laptop, or part of a regular server, of a virtual machine?</p></div><div id="comment-19089-info" class="comment-info"><span class="comment-age">(02 Mar '13, 04:23)</span> <span class="comment-user userinfo">Jaap ♦</span></div></div><span id="19122"></span><div id="comment-19122" class="comment not_top_scorer"><div id="post-19122-score" class="comment-score"></div><div class="comment-text"><p>The Linux monitor server is a dedicated standalone Red Hat 6 server.</p><p>Thanks, Jandrysik</p></div><div id="comment-19122-info" class="comment-info"><span class="comment-age">(04 Mar '13, 06:13)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19123"></span><div id="comment-19123" class="comment not_top_scorer"><div id="post-19123-score" class="comment-score"></div><div class="comment-text"><p>do your captures contain VLAN tags?</p></div><div id="comment-19123-info" class="comment-info"><span class="comment-age">(04 Mar '13, 06:41)</span> <span class="comment-user userinfo">Landi</span></div></div><span id="19151"></span><div id="comment-19151" class="comment not_top_scorer"><div id="post-19151-score" class="comment-score"></div><div class="comment-text"><p>Landi, No, the two mirrored server ports and the monitor port are all untagged and on the same VLAN. Thanks, Jandrysik</p></div><div id="comment-19151-info" class="comment-info"><span class="comment-age">(05 Mar '13, 06:35)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19153"></span><div id="comment-19153" class="comment not_top_scorer"><div id="post-19153-score" class="comment-score"></div><div class="comment-text"><p>Landi, I pulled up one of the successful captures, checked the IP flags in the packets and did not see any VLAN tags. Thanks, Jandrysik</p></div><div id="comment-19153-info" class="comment-info"><span class="comment-age">(05 Mar '13, 08:19)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19154"></span><div id="comment-19154" class="comment not_top_scorer"><div id="post-19154-score" class="comment-score"></div><div class="comment-text"><p>Our SysAdmin team suspects this is an issue with 64-bit vs 32-bit OS versions. They are doing some more testing and are going to reload the Linux monitor server with 32-bit OS.</p><p>They are also going to re-install Wireshark 1.8.5 on 32-bit Windows laptop to see if it will correctly capture both the transmitted and received traffic from the mirrored ports.</p><p>Thanks, Jandrysik</p></div><div id="comment-19154-info" class="comment-info"><span class="comment-age">(05 Mar '13, 09:31)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19171"></span><div id="comment-19171" class="comment not_top_scorer"><div id="post-19171-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Our SysAdmin team suspects this is an issue with 64-bit vs 32-bit OS versions. They are also going to re-install Wireshark 1.8.5</p></blockquote><p>I don't think this problem is related to Wireshark and/or 32/64 Bit, as Case 3 works on a Linux Laptop and Case 4 does not work on another Linux system, both using tcpdump and not Wireshark.</p><p>Did you check if the capturing interface negotiated the right speed and duplex with the switch (Gigabit / Full) in Case 2 and 4 (Failure)?</p></div><div id="comment-19171-info" class="comment-info"><span class="comment-age">(05 Mar '13, 11:51)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="19175"></span><div id="comment-19175" class="comment not_top_scorer"><div id="post-19175-score" class="comment-score"></div><div class="comment-text"><p>Kurt, That was one of the first things we checked during the captures. All of the interfaces involved are auto-negotiating at full Gigabit, including on the failed attempts.</p><p>Please keep in mind that the failed captures are perfect examples of a Tx / transmit only port mirror capture. No malformed or partial packets. They are nice, clean captures of only the transmit traffic.</p><p>I would have expected to see malformed packets if there were auto-negotiation problems between the switch monitor port and the laptops / server.</p><p>Thanks for the suggestion though! Jandrysik</p></div><div id="comment-19175-info" class="comment-info"><span class="comment-age">(05 Mar '13, 12:28)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19181"></span><div id="comment-19181" class="comment not_top_scorer"><div id="post-19181-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Kurt, That was one of the first things we checked during the captures.</p></blockquote><p>well, just an idea ;-)</p><p>Unfortunately this makes no sense at all as there is no common part in the four cases that could cause/explain the problem !??!</p><p>What are the Linux versions on the Laptop and on the Monitoring server? What types of interfaces (brand/modell) did you use on Linux (dmesg | grep eth0)?</p><p>BTW: Did you check if a local firewall blocked the packets (as stupid as this may sound).</p><p><a href="http://ask.wireshark.org/questions/10377/when-i-capture-ping-test-in-wireshark-i-only-see-the-reply-and-no-request-why">http://ask.wireshark.org/questions/10377/when-i-capture-ping-test-in-wireshark-i-only-see-the-reply-and-no-request-why</a></p></div><div id="comment-19181-info" class="comment-info"><span class="comment-age">(05 Mar '13, 12:53)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="19220"></span><div id="comment-19220" class="comment not_top_scorer"><div id="post-19220-score" class="comment-score"></div><div class="comment-text"><p>Server is a Dell R720 with the the Broadcom 5720 quad port card. Server is running RedHat EL 6.4 x64bit.</p><p>SysAdmin test laptop is a Dell Latitude E5500 with a Broadcomm 5756. 4 different OS's</p><pre><code>RHEL 6.3 - 32bit  --&gt; Does not work
RHEL 6.3 - 64bit  --&gt; Does not work

Fedora Live 32bit  --&gt;  Works
Fedora Live 64bit  --&gt;  Works</code></pre><p>And yes, the local firewalls are disabled on the laptops and the Linux monitor server.</p><p>Thanks again to everyone for the help and suggestions regarding this problem. Jandrysik</p></div><div id="comment-19220-info" class="comment-info"><span class="comment-age">(06 Mar '13, 07:53)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19225"></span><div id="comment-19225" class="comment not_top_scorer"><div id="post-19225-score" class="comment-score"></div><div class="comment-text"><p>So, it depends on the OS if tcpdump works, on the <strong>same</strong> hardware? It does not work with RHEL and it works with Fedora? Very strange!!</p><p>Do you have any IP configuration on the capturing interfaces in either case? If so, can you please try to disable that IP configuration and run the interface just as a capturing interfaces (cli: ifconfig eth0 0.0.0.0).</p></div><div id="comment-19225-info" class="comment-info"><span class="comment-age">(06 Mar '13, 08:38)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="19231"></span><div id="comment-19231" class="comment not_top_scorer"><div id="post-19231-score" class="comment-score"></div><div class="comment-text"><p>Kurt, Yep, this is a odd one. Different OS running on the exact same hardware and tcpdump either works or fails depending on the OS.</p><p>Nope, we do not have an IP configurated on the capturing interfaces on the laptops or the Linux monitor server.</p><p>Our SysAdmin is still waiting to hear back from Red Hat regarding this.</p><p>Thanks again! Jandrysik</p></div><div id="comment-19231-info" class="comment-info"><span class="comment-age">(06 Mar '13, 09:24)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19234"></span><div id="comment-19234" class="comment not_top_scorer"><div id="post-19234-score" class="comment-score"></div><div class="comment-text"><p>can you try CentOS 6.3 instead of RHEL 6.3? Just curios....</p></div><div id="comment-19234-info" class="comment-info"><span class="comment-age">(06 Mar '13, 09:52)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="19250"></span><div id="comment-19250" class="comment not_top_scorer"><div id="post-19250-score" class="comment-score"></div><div class="comment-text"><p>Kurt, The SysAdmins had a copy of CentOS 6.2 that they tried. It failed as well... Thanks, Jandrysik</p></div><div id="comment-19250-info" class="comment-info"><span class="comment-age">(06 Mar '13, 15:08)</span> <span class="comment-user userinfo">Jandrysik</span></div></div><span id="19252"></span><div id="comment-19252" class="comment not_top_scorer"><div id="post-19252-score" class="comment-score"></div><div class="comment-text"><p>Unbelievable.... Please post the solution to this problem if you ever find it! Thanks Kurt</p></div><div id="comment-19252-info" class="comment-info"><span class="comment-age">(06 Mar '13, 15:29)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-19049" class="comment-tools"><span class="comments-showing"> showing 5 of 22 </span> <a href="#" class="show-all-comments-link">show 17 more comments</a></div><div class="clear"></div><div id="comment-19049-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

