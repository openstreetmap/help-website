+++
type = "question"
title = "how to stop tshark from writing to a temp file?"
description = '''Hello I have looked in the forum but i wasn&#x27;t able to find the right question here nor answer i&#x27;m looking for. I&#x27;m using windows 2008 server and using tshark to capture directy from the NIC card and output a CSV text of atributes to the screen. (stdout) But I got a number of times when tshark stoppe...'''
date = "2013-08-03T04:21:00Z"
lastmod = "2013-08-09T14:54:00Z"
weight = 23523
keywords = [ "temp", "tshark", "file" ]
aliases = [ "/questions/23523" ]
osqa_answers = 4
osqa_accepted = false
+++

<div class="headNormal">

# [how to stop tshark from writing to a temp file?](/questions/23523/how-to-stop-tshark-from-writing-to-a-temp-file)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-23523-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello</p><p>I have looked in the forum but i wasn't able to find the right question here nor answer i'm looking for. I'm using windows 2008 server and using tshark to capture directy from the NIC card and output a CSV text of atributes to the screen. (stdout)</p><p>But I got a number of times when tshark stopped working. after checking i have found out that it writes a TMP file into C:\Users\%Username%\AppData\Local\Temp</p><p>It has grown too big and i must stop the process to delete it and then start the process again. I have checked but i wasn't able to find a way to disable the tmp file. I tried the -w - or the -b but none has any effect.</p><p>Can someone please point me to the correct way to stop the temp file. or the a correct way to deal with this issue without stopping the service? like rotate the tmp file or limiting at a fixed size etc..</p><p>thank you Lior<br />
</p></div><div id="question-tags" class="tags-container tags">temp tshark file</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>03 Aug '13, 04:21</strong></p><img src="https://secure.gravatar.com/avatar/2e1b2f81089b35501974478f754ca06b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="liorh007&#39;s gravatar image" /><p>liorh007<br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="liorh007 has no accepted answers">0%</span> </br></p></div><div class="post-update-info post-update-info-edited"><p>edited 03 Aug '13, 04:23</p></div></div><div id="comments-container-23523" class="comments-container"><span id="23543"></span><div id="comment-23543" class="comment"><div id="post-23543-score" class="comment-score"></div><div class="comment-text"><p>Hi thank you all for the answers , but here is more info. 1. I must use tshark as a service for long time 24/7. it never got stuck , but i got a very large temp file 2. I'm using the -R filter option with -T fields and -e for attributes to create a CSV text output. 3. the computer is very strong with few cpu's and lots of memory 4. Guy is right and dumpcap won't help me. 5. I have taken the advice of using the -b filesize/num and added an output file with -w, however they don't work with -R so i'm back in/to square one :-(</p><p>is there any way to make it work? the key is having the -b work with -R ;-) also i'm willing to think outside the box and maybe : is there a way to make dumpcap output a filtered CSV text info a file by itself and i would us this file as an input?</p><p>thank you</p></div><div id="comment-23543-info" class="comment-info"><span class="comment-age">(04 Aug '13, 23:04)</span> liorh007</div></div></div><div id="comment-tools-23523" class="comment-tools"></div><div class="clear"></div><div id="comment-23523-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

4 Answers:

</div>

</div>

<span id="23524"></span>

<div id="answer-container-23524" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-23524-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Try using dumpcap it works really well and can create multiple files for you, you can provide the time or volume after which a new file should be created as well as you can provide the max number of files that should be rotated</p><p>eg: dumpcap -i any -b filesize:153600 -b files:2000 -Z none -f port 2123 -w c:\Traces\tracesaug.snoop</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>03 Aug '13, 10:18</strong></p><img src="https://secure.gravatar.com/avatar/3ac62e4a103b118d6c93f65777d77402?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="RAVI_TANDON&#39;s gravatar image" /><p>RAVI_TANDON<br />
<span class="score" title="10 reputation points">10</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="RAVI_TANDON has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 03 Aug '13, 10:19</p></div></div><div id="comments-container-23524" class="comments-container"><span id="23527"></span><div id="comment-23527" class="comment"><div id="post-23527-score" class="comment-score"></div><div class="comment-text"><p>Hi thank you for the answer , however as i checked dumpcap does not support filters, which is what i'm doing with tshark to output the CSV atributes . so i must use tshark. is there a way to combine the dumpcap file features with tshark? i can live with rotating files, (ie delete them as needed) thank you Lior</p></div><div id="comment-23527-info" class="comment-info"><span class="comment-age">(03 Aug '13, 14:00)</span> liorh007</div></div><span id="23529"></span><div id="comment-23529" class="comment"><div id="post-23529-score" class="comment-score"></div><div class="comment-text"><blockquote><p>is there a way to combine the dumpcap file features with tshark?</p></blockquote><p>Yes. See my answer.</p></div><div id="comment-23529-info" class="comment-info"><span class="comment-age">(03 Aug '13, 14:35)</span> Guy Harris ♦♦</div></div><span id="23535"></span><div id="comment-23535" class="comment"><div id="post-23535-score" class="comment-score"></div><div class="comment-text"><p>@liorh007, dumpcap supports capture filters, what is the filter expression you're using.</p></div><div id="comment-23535-info" class="comment-info"><span class="comment-age">(04 Aug '13, 08:15)</span> grahamb ♦</div></div><span id="23539"></span><div id="comment-23539" class="comment"><div id="post-23539-score" class="comment-score"></div><div class="comment-text"><p>"filter" is a word that's sometimes used to refer to actual <em>filters</em>, i.e. packet-matching expressions used to choose which packets to capture/save/show and which ones not to capture/save/show, and other times used to refer to <em>named fields</em> (whenever I catch "filter" used in a bug title to mean "named field", I fix it).</p><p>If he means "named fields", which I'm guessing he does from "dumpcap does not support filters, which is what i'm doing with tshark to output the CSV atributes", then dumpcap won't do the job.</p></div><div id="comment-23539-info" class="comment-info"><span class="comment-age">(04 Aug '13, 11:43)</span> Guy Harris ♦♦</div></div></div><div id="comment-tools-23524" class="comment-tools"></div><div class="clear"></div><div id="comment-23524-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="23528"></span>

<div id="answer-container-23528" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-23528-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Unfortunately, TShark currently doesn't support any mechanism other than temporary files to pass packets from dumpcap to it; that's <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=2743">bug 2743</a>. That bug would require some work to fix.</p><p>You could, however, use flags such as <code>-b filesize:</code><em>size</em> and <code>-b files:</code><em>nfiles</em> with TShark as well; they're passed on to dumpcap. Pick a small value for <em>nfiles</em> and a not-too-large value for <em>size</em>, and that won't take up too much disk space - only <em>nfiles</em> will be kept around, each one having a size approximately as big as <em>size</em>.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>03 Aug '13, 14:25</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p>Guy Harris ♦♦<br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 03 Aug '13, 14:35</p></div></div><div id="comments-container-23528" class="comments-container"><span id="23534"></span><div id="comment-23534" class="comment"><div id="post-23534-score" class="comment-score"></div><div class="comment-text"><p>Note that running tshark for an extended period of time (you mention "service" in your question) is not recommended, it will run out of memory at some point. This is because tshark (and Wireshark) store data about conversations which accumulates during a run.</p><p>dumpcap doesn't do this, hence why it's recommend for long-running processes.</p></div><div id="comment-23534-info" class="comment-info"><span class="comment-age">(04 Aug '13, 08:14)</span> grahamb ♦</div></div><span id="23538"></span><div id="comment-23538" class="comment"><div id="post-23538-score" class="comment-score"></div><div class="comment-text"><p>I infer from "using tshark to capture directy from the NIC card and output a CSV text of atributes to the screen. (stdout)" that dissecting packets is the reason for running TShark, so dumpcap <em>won't</em> suffice for his purpose.</p></div><div id="comment-23538-info" class="comment-info"><span class="comment-age">(04 Aug '13, 11:39)</span> Guy Harris ♦♦</div></div></div><div id="comment-tools-23528" class="comment-tools"></div><div class="clear"></div><div id="comment-23528-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="23544"></span>

<div id="answer-container-23544" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-23544-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><ol><li>I must use tshark as a service for long time 24/7.</li></ol></blockquote><p>Sadly, eventually that 24/7 will have to end, as TShark, in order to dissect packets, saves various bits of state in its address space, and runs the risk of eventually running out of "memory" (address space/swap space, in reality).</p><blockquote><p>it never got stuck , but i got a very large temp file</p></blockquote><p>Then you weren't using the <code>-b</code> flags in question, because it wasn't rotating the files.</p><blockquote><ol><li>I'm using the -R filter option</li></ol></blockquote><p>Then you're out of luck, as</p><ol><li>in order to use the <code>-b</code> options, you need to be saving to a file;</li><li>the <code>-R</code> option currently isn't supported if you're not saving to a file.</li></ol><blockquote><ol><li>the computer is very strong with few cpu's and lots of memory</li></ol></blockquote><p>No matter how much memory you have, with enough packets, TShark can eat up all your memory and swap space (unless you're on an OS where swap space is easily expandable, in which case it'll eat up all your disk space instead). If your computer is running a 32-bit version of TShark, TShark will probably eat up all its address space before it even gets a chance to eat up all the memory and swap space.</p><ol><li><ol><li>I have taken the advice of using the -b filesize/num and added an output file with -w, however they don't work with -R so i'm back in/to square one :-(</li></ol></li></ol><p>And there's currently a 1km high wall around that square, unfortunately.</p><blockquote><p>is there any way to make it work?</p></blockquote><p>No, because...</p><blockquote><p>the key is having the -b work with -R</p></blockquote><p>...and you can't currently do that.</p><blockquote><p>is there a way to make dumpcap output a filtered CSV text info a file by itself</p></blockquote><p>No. dumpcap was <em>explicitly designed</em> to be incapable of doing that. It might have to run with extra privileges in order to capture traffic, so the ability to dissect packets was explicitly left <em>out</em> of it to reduce the amount of code in it that could cause problems if there's a bug in it that opens a security hole.</p><p>At best, you could run dumpcap with the <code>-b</code> options to have it produce a sequence of capture files, but <em>not</em> remove them. You could then try running a script that watches for new capture files to appear and, when a new file appears, runs TShark on each of the <em>older</em> capture files, removing each one after it's processed. Note, however, that this means that if, in order to dissect a packet in a particular file, information from a packet in an <em>earlier</em> file is required, the later packet won't be able to be fully dissected, so, if the fields you're using with <code>-e</code> require a full dissection, you might not get the information you want. (The information in question is part of the stuff that eventually will fill up TShark's address space.)</p><p>What information are you trying to get? There might be <em>other</em> programs that can get that information for you.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>04 Aug '13, 23:35</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p>Guy Harris ♦♦<br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span></p></div></div><div id="comments-container-23544" class="comments-container"><span id="23546"></span><div id="comment-23546" class="comment"><div id="post-23546-score" class="comment-score"></div><div class="comment-text"><p>Hi Thank you for the answer. I'm capturing RADIUS traffic and i split it into CSV fields like username,disconnection reason,packets used, etc... so i need to capture ALL traffic and can't relay on files that might not hold all the info i need. also i need to make decisions based on that info in REALTIME.</p><p>but as i said i'm willing to try anything. also since the current TEMP solution I found now is to "stop" the service once during "off hours" delete the tmp file and then restart the service again, solving the memory issues you said.</p><p>The other solution would be to setup a 2nd computer that would get the info and save only, so when I stop the main service I can read the missing info from the 2nd server. but this idea is only on paper now.</p><p>also about reading from a dumpcap rotated file, I need to figure out how to make the tshark read the files one after the other this makes it more complicated and i really need the realtime speed.</p><p>any help in making it work would be forever thanked :-)</p></div><div id="comment-23546-info" class="comment-info"><span class="comment-age">(05 Aug '13, 01:34)</span> liorh007</div></div></div><div id="comment-tools-23544" class="comment-tools"></div><div class="clear"></div><div id="comment-23544-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="23687"></span>

<div id="answer-container-23687" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-23687-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>I'm <strong>capturing RADIUS traffic</strong> and i split it into CSV fields like username,disconnection reason,packets used, etc.</p></blockquote><p>In that case, I recommend a radius sniffer, like one of these.</p><blockquote><p><a href="http://sourceforge.net/projects/raddump/">http://sourceforge.net/projects/raddump/</a><br />
<a href="http://www.manpagez.com/man/8/radsniff/">http://www.manpagez.com/man/8/radsniff/</a></p></blockquote><p>Combined with some scripting, you should be able to achieve your goal.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Aug '13, 14:54</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div></div><div id="comments-container-23687" class="comments-container"></div><div id="comment-tools-23687" class="comment-tools"></div><div class="clear"></div><div id="comment-23687-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

