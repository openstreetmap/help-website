+++
type = "question"
title = "tshark -T fields question"
description = '''Hi, We have some web services that we&#x27;d like to capture packets for using tshark. Some of the service traffic is dissected using -R xml argument and some are dissected using -R data argument. We like to see the payload using the -T fields argument. So with -R data we run the following command. tshar...'''
date = "2012-05-25T07:05:00Z"
lastmod = "2012-06-01T09:07:00Z"
weight = 11331
keywords = [ "xml" ]
aliases = [ "/questions/11331" ]
osqa_answers = 3
osqa_accepted = false
+++

<div class="headNormal">

# [tshark -T fields question](/questions/11331/tshark-t-fields-question)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-11331-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-11331-score" class="post-score" title="current number of votes">0</div><span id="post-11331-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, We have some web services that we'd like to capture packets for using tshark. Some of the service traffic is dissected using -R xml argument and some are dissected using -R data argument. We like to see the payload using the -T fields argument. So with -R data we run the following command. <code>tshark -i 1 -R data -T fields -e frame - frame.time -e ip.src -e ip.dst -e tcp -e data -V -l</code> the output for this is something like this</p><pre><code>Frame 538: 814 bytes on wire (6512 bits), 814 bytes captured (6512 bits)    May 22, 2012 11:52:49.933924000 192.168.0.19    192.168.0.16    Transmission Control Protocol, Src Port: sunproxyadmin (8081), Dst Port: 35946 (35946), Seq: 1, Ack: 745, Len: 748  485454502f312e312035303020496e7465726e616c20536572</code></pre><p>We'd like to run a similar command to get the actual text of the XML So to get an ouput such as</p><pre><code>Frame 538: 814 bytes on wire (6512 bits), 814 bytes captured (6512 bits)    May 22, 2012 11:52:49.933924000 192.168.0.19    192.168.0.16    Transmission Control Protocol, Src Port: sunproxyadmin (8081), Dst Port: 35946 (35946), Seq: 1, Ack: 745, Len: &lt;test&gt;mytest&lt;/test&gt;</code></pre><p>We tried something like this <code>tshark -i 1 -R xml -T fields -e frame - frame.time -e ip.src -e ip.dst -e tcp -e xml -V -l</code> but we didn't get the desired output. IS there a way to run -T fields command to get the xml payload in the output?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-xml" rel="tag" title="see questions tagged &#39;xml&#39;">xml</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>25 May '12, 07:05</strong></p><img src="https://secure.gravatar.com/avatar/c6ad098816c0b0afd0415f75e76ef68d?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="aaghili&#39;s gravatar image" /><p><span>aaghili</span><br />
<span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="aaghili has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>25 May '12, 08:37</strong> </span></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-11331" class="comments-container"></div><div id="comment-tools-11331" class="comment-tools"></div><div class="clear"></div><div id="comment-11331-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="11332"></span>

<div id="answer-container-11332" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-11332-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-11332-score" class="post-score" title="current number of votes">0</div><span id="post-11332-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Can you try this:</p><blockquote><p><code>tshark -i 1 -R xml -T fields -e &lt;your other fields&gt;</code> <strong><code>-e text</code></strong><br />
</p></blockquote><p>Please check this <a href="http://ask.wireshark.org/questions/11168/capturing-of-line-based-text-data">question</a> (similar problem).</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>25 May '12, 07:08</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>25 May '12, 07:24</strong> </span></p></div></div><div id="comments-container-11332" class="comments-container"><span id="11339"></span><div id="comment-11339" class="comment"><div id="post-11339-score" class="comment-score"></div><div class="comment-text"><p>Thank you for the response. When I set it up as you said I don't see any xml text. Its just blank</p></div><div id="comment-11339-info" class="comment-info"><span class="comment-age">(25 May '12, 10:37)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11340"></span><div id="comment-11340" class="comment"><div id="post-11340-score" class="comment-score"></div><div class="comment-text"><p>this is what I get. HAve you tested this and it works for you? <code>Frame 117 (851 bytes on wire, 851 bytes captured) May 25, 2012 10:35:11.582303000 10.203.192.79 10.202.160.99 Transmission Control Protocol, Src Port: cdid (3315), Dst Port: http (80), Seq: 55761, Ack: 1, Len: 797</code></p></div><div id="comment-11340-info" class="comment-info"><span class="comment-age">(25 May '12, 10:38)</span> <span class="comment-user userinfo">aaghili</span></div></div></div><div id="comment-tools-11332" class="comment-tools"></div><div class="clear"></div><div id="comment-11332-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="11341"></span>

<div id="answer-container-11341" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-11341-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-11341-score" class="post-score" title="current number of votes">0</div><span id="post-11341-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>This is what I get, when I load this page:</p><p><strong>URL:</strong><br />
</p><blockquote><p><code>http://www.w3schools.com/xml/simple.xml</code></p></blockquote><p><strong>Command:</strong><br />
</p><blockquote><p><code>tshark.exe" -i 3  -T fields -e frame.number -e frame.time -e ip.src -e ip.dst -e data -e text port 80</code><br />
</p></blockquote><p><strong>Output:</strong></p><p><code>Capturing on LAN 1       May 25, 2012 19:46:55.097596000 192.168.90.51   66.29.212.73 GET /xml/simple.xml HTTP/1.1\r\n,\r\n 2       May 25, 2012 19:46:55.243759000 66.29.212.73    192.168.90.51 HTTP/1.1 200 OK\r\n,Accept-Rang es: bytes\r\n,ETag: "e5309bb5a12ecd1:0"\r\n,Vary: Accept-Encoding\r\n,X-Powered- By: ASP.NET\r\n,\r\n,Content-encoded entity body (gzip): 574 bytes -&gt; 1135 bytes ,?&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/descr iption&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;, &lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/descripti on&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/breakfast_menu&gt; 3       May 25, 2012 19:46:55.443582000 192.168.90.51   66.29.212.73</code></p><p><strong>tshark Version:</strong><br />
TShark 1.7.1 (SVN Rev 41970 from /trunk) (Windows 7 64 Bit).</p><p><strong>Questions:</strong><br />
</p><ol><li>What's your version of tshark?<br />
</li><li>Can you please try the command above (without -R xml)?<br />
</li><li>Can you post a sample capture on <a href="http://cloudshark.org">cloudshark.org</a>?<br />
</li></ol><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>25 May '12, 10:53</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>25 May '12, 11:08</strong> </span></p></div></div><div id="comments-container-11341" class="comments-container"><span id="11342"></span><div id="comment-11342" class="comment"><div id="post-11342-score" class="comment-score"></div><div class="comment-text"><p>I get the same result. its blank. This service does get dissected correctly as XML when I run this command. tshark -i 7 -R xml -V -l When I run this command I can see the packet. The issue is the XML is so large that this outputs over 20000 lines. The reason I'd like to use the -T fields is so I can get one single line that's very large instead of 20000 small lines. Our app reads the standard out of tshark output. Thank you for the help!</p></div><div id="comment-11342-info" class="comment-info"><span class="comment-age">(25 May '12, 11:09)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11343"></span><div id="comment-11343" class="comment"><div id="post-11343-score" class="comment-score"></div><div class="comment-text"><p>the version of tshark is 1.2.10 running on linux 64bit.</p></div><div id="comment-11343-info" class="comment-info"><span class="comment-age">(25 May '12, 11:11)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11345"></span><div id="comment-11345" class="comment"><div id="post-11345-score" class="comment-score"></div><div class="comment-text"><p>can you upgrade tshark?</p></div><div id="comment-11345-info" class="comment-info"><span class="comment-age">(25 May '12, 11:20)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11356"></span><div id="comment-11356" class="comment"><div id="post-11356-score" class="comment-score"></div><div class="comment-text"><p>sure where do you download the latest linux version 64bit?</p></div><div id="comment-11356-info" class="comment-info"><span class="comment-age">(25 May '12, 14:40)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11358"></span><div id="comment-11358" class="comment"><div id="post-11358-score" class="comment-score"></div><div class="comment-text"><p>Use your distributions package manager, or compile your own. Compilation details can be found <a href="http://www.wireshark.org/docs/wsdg_html_chunked/">here</a>.</p></div><div id="comment-11358-info" class="comment-info"><span class="comment-age">(25 May '12, 14:46)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="11374"></span><div id="comment-11374" class="comment not_top_scorer"><div id="post-11374-score" class="comment-score"></div><div class="comment-text"><p>ok I now get what you're getting but that is not the valid xml that is being sent back. take a look at your xml text. That's just some tags not the actual response for the site. Is there a way to see the actual payload of the xml response?</p></div><div id="comment-11374-info" class="comment-info"><span class="comment-age">(26 May '12, 06:22)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11376"></span><div id="comment-11376" class="comment not_top_scorer"><div id="post-11376-score" class="comment-score"></div><div class="comment-text"><p>That's the response of the server. It contains the HTTP response headers and the data (XML). If you remove the HTTP headers (with a script) you will get the XML data.</p></div><div id="comment-11376-info" class="comment-info"><span class="comment-age">(26 May '12, 09:01)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11378"></span><div id="comment-11378" class="comment not_top_scorer"><div id="post-11378-score" class="comment-score"></div><div class="comment-text"><p>ok I now get what you're getting but that is not the valid xml that is being sent back. take a look at your xml text. That's just some tags not the actual response for the site. Is there a way to see the actual payload of the xml response?</p><p>Here what the payload is &lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!-- Edited by XMLSpy® --&gt;&lt;breakfast_menu&gt; &lt;food&gt;&lt;name&gt;Belgian Waffles&lt;/name&gt;&lt;price&gt;$5.95&lt;/price&gt;&lt;description&gt;two of our famous Belgian Waffles with plenty of real maple syrup&lt;/description&gt; &lt;calories&gt;650&lt;/calories&gt;&lt;/food&gt;&lt;food&gt;&lt;name&gt;Strawberry Belgian Waffles&lt;/name&gt; &lt;price&gt;$7.95&lt;/price&gt;&lt;description&gt;light Belgian waffles covered with strawberries and whipped cream&lt;/description&gt;&lt;calories&gt;900&lt;/calories&gt;&lt;/food&gt;&lt;food&gt;&lt;name&gt;Berry-Berry Belgian Waffles&lt;/name&gt; &lt;price&gt;$8.95&lt;/price&gt;&lt;description&gt;light Belgian waffles covered with an assortment of fresh berries and whipped cream&lt;/description&gt;&lt;calories&gt;900&lt;/calories&gt; &lt;/food&gt;</p></div><div id="comment-11378-info" class="comment-info"><span class="comment-age">(26 May '12, 09:33)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11379"></span><div id="comment-11379" class="comment not_top_scorer"><div id="post-11379-score" class="comment-score"></div><div class="comment-text"><p>sorry I'm not sure if I understand. The payload isn't this<br />
&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/descr iption&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;, &lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/descripti on&gt;,&lt;/calories&gt;,&lt;/food&amp;gt I posted what the payload should be below. How do I get that? This is just some closing xml tags. Is this a bug?</p></div><div id="comment-11379-info" class="comment-info"><span class="comment-age">(26 May '12, 09:36)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11380"></span><div id="comment-11380" class="comment not_top_scorer"><div id="post-11380-score" class="comment-score"></div><div class="comment-text"><p>Extracting the text part does so only for each packet separately. You will have to combine the output to get the whole XML response.</p><p>I believe what you are looking for is the output of "Follow TCP stream" (Wireshark GUI). If that's the case, there is a new option in tshark 1.7.x, that does almost the same:</p><blockquote><p><code>tshark.exe -nr xml.cap  -z follow,tcp,ascii,5 -q</code><br />
</p></blockquote><p>This will print all data of TCP stream #5 in ASCII format.</p><p>To figure out which stream contains XML data, you can use this command:</p><blockquote><p><code>tshark.exe -nr xml.cap -R xml -T fields -e tcp.stream</code><br />
</p></blockquote><p>It will print the stream number of every TCP stream that contains XML data.</p><p>Unfortunately you cannot do this on the fly, during data capture (-i). So you have to capture the data first and then analyze it.</p><p>Furthermore I was not yet able to get the out always in ASCII. Sometimes the output of <code>-z follow,tcp,ascii,n</code> is binary and I don't know why. Maybe it's due to GZIP encoding.</p><p>If it's the same for you, I suggest to use tcpflow instead. See my answer for this question:</p><blockquote><p><code>http://ask.wireshark.org/questions/10023/command-line-option-for-follow-tcp-stream</code></p></blockquote></div><div id="comment-11380-info" class="comment-info"><span class="comment-age">(26 May '12, 11:00)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11386"></span><div id="comment-11386" class="comment not_top_scorer"><div id="post-11386-score" class="comment-score"></div><div class="comment-text"><p>thank you kurt! I'll try this next week with some of our internal services and let you know. Al</p></div><div id="comment-11386-info" class="comment-info"><span class="comment-age">(26 May '12, 15:28)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11392"></span><div id="comment-11392" class="comment not_top_scorer"><div id="post-11392-score" class="comment-score"></div><div class="comment-text"><p>O.K.</p><p>BTW: If you like my answer, you can select it as the right one. see faq.</p></div><div id="comment-11392-info" class="comment-info"><span class="comment-age">(27 May '12, 01:21)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11397"></span><div id="comment-11397" class="comment not_top_scorer"><div id="post-11397-score" class="comment-score"></div><div class="comment-text"><p>This option doesn't work for me. Because the output is not sent to standard out but to a file and I need to sniff on an interface. So if I run the command as such 'tshark -i 2 -z follow,tcp,ascii,1 -q' the ouput is written to std out when I hit ctrl-C (only). Our application needs to read the standard out of tshark on the fly. Another way I could get around this problem is to force tshark to dissect all packets as data packets. So even an XML packet be decoded as a data packet. Is there such an option? I want to run tshark -i 2 -R data and see an XML packet in the output of this command.</p></div><div id="comment-11397-info" class="comment-info"><span class="comment-age">(27 May '12, 05:49)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11405"></span><div id="comment-11405" class="comment not_top_scorer"><div id="post-11405-score" class="comment-score"></div><div class="comment-text"><p>as I said, you can't use <strong><code>-z follow,tcp,ascii,x</code></strong> while sniffing on an interface, as you can't know in which tcp stream (x) your XML data will occur.</p><p>If you need that, you have these options</p><ol><li><p>run wireshark with the options described above (no <strong><code>-z follow,tcp</code></strong>) and re-assemble the dumped data yourself to get the whole XML data.</p></li><li><p>Use libpcap in your own program and extract whatever you need. However, even then you will have to re-assemble several packets to get the whole XML data, and that's not really easier than using tshark.</p></li></ol><p>You could tell us more what you want to achieve. Maybe there is another way to achieve that.</p></div><div id="comment-11405-info" class="comment-info"><span class="comment-age">(27 May '12, 12:14)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11407"></span><div id="comment-11407" class="comment not_top_scorer"><div id="post-11407-score" class="comment-score"></div><div class="comment-text"><p>If wanted to use option 1. how would I run to get all the packets to re-assemble. If I run the following tshark.exe -i 2 -T fields -e frame.number -e frame.time -e ip.src -e ip.dst -e data -e text port 80 i always get this &lt;/name&gt;,&lt;/price&gt;,&lt;/description&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;,&lt;/price&gt;,&lt;/descr iption&gt;,&lt;/calories&gt;,&lt;/food&gt;,&lt;/name&gt;t; and not the whole payload. I need to see the whole payload to re-assemble. Basically what I want is to see the whole XML payload either in text/ or hex. I don't mind re-assembling packets.</p></div><div id="comment-11407-info" class="comment-info"><span class="comment-age">(27 May '12, 12:46)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11409"></span><div id="comment-11409" class="comment not_top_scorer"><div id="post-11409-score" class="comment-score"></div><div class="comment-text"><p>O.K. it looks like <strong><code>-e text</code></strong> does not work properly if the data is GZIP compressed. In that case only part of the data will be printed in ASCII. I will check the code and see if I find any problem (no promisses). If the whole payload in HEX is O.K. for you, you could use option <strong>-x</strong>:</p><blockquote><p><code>tshark.exe -i 2 -x port 80</code></p></blockquote><p>Then extract the data from the output. This works on my system. If the content is compressed, tshark will first print the compressed content and then the "Uncompressed entity body".</p><p>Option <strong>-V</strong> works as well. It's more data to parse, but possibly easier to parse.</p><p>You could even try this:</p><blockquote><p>`tshark -i 2 -V -T pdml</p></blockquote><p>Then look for <strong>'field name="xml.tag"'</strong></p></div><div id="comment-11409-info" class="comment-info"><span class="comment-age">(27 May '12, 13:10)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="11412"></span><div id="comment-11412" class="comment not_top_scorer"><div id="post-11412-score" class="comment-score"></div><div class="comment-text"><p>I check the options you mentioned. if the -T Fields option would give me the whole packet that would have worked best. I don't think this is gzip issue. I tried this with other services and I was getting the same result. It seems like its a bug. Because the only things it prints is the end xml tags only like this. &lt;/food&gt;. not the openning tag or the actual body of the element but only the end element.<br />
BTW the reason the -T fields would work best is that the output is on a single line. If I do -R xml then the output comes out in many lines so its much harder to process</p></div><div id="comment-11412-info" class="comment-info"><span class="comment-age">(27 May '12, 14:29)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11450"></span><div id="comment-11450" class="comment not_top_scorer"><div id="post-11450-score" class="comment-score"></div><div class="comment-text"><p>ok I checked these options and non will be an advantage over just running it like this. tshark -i 2 -R xml -V port 80. Again the problem is that when this is sent to standard out it puts each tag as a separate line. So a large xml payload could have 30000 lines that we need to process. The nice thing about the -T fields option (if it worked) would be that the payload is sent to standard out in a single line no matter how large it is. Much easier to process with better performance.</p></div><div id="comment-11450-info" class="comment-info"><span class="comment-age">(29 May '12, 09:32)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11532"></span><div id="comment-11532" class="comment not_top_scorer"><div id="post-11532-score" class="comment-score"></div><div class="comment-text"><p>Can you tell me where in the code I can look to find out about this issue? basically I'd like to see the where the ouput of this command is generated.</p><p>tshark.exe -i 3 -T fields -e frame.number -e frame.time -e ip.src -e ip.dst -e data -e text port 80</p><p>Thanks</p></div><div id="comment-11532-info" class="comment-info"><span class="comment-age">(01 Jun '12, 07:40)</span> <span class="comment-user userinfo">aaghili</span></div></div><span id="11533"></span><div id="comment-11533" class="comment not_top_scorer"><div id="post-11533-score" class="comment-score"></div><div class="comment-text"><p>tshark.c:process_packet() -&gt; print_packet() -&gt; print.c:proto_tree_write_fields()</p></div><div id="comment-11533-info" class="comment-info"><span class="comment-age">(01 Jun '12, 08:06)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-11341" class="comment-tools"><span class="comments-showing"> showing 5 of 20 </span> <a href="#" class="show-all-comments-link">show 15 more comments</a></div><div class="clear"></div><div id="comment-11341-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="11536"></span>

<div id="answer-container-11536" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-11536-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-11536-score" class="post-score" title="current number of votes">0</div><span id="post-11536-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>O.K. here is (probably) my last attempt for a solution/explanation ;-)</p><p>If you run the following command, you will see the XML tags and the XML data.</p><blockquote><p><code>tshark.exe -r xml_sample.cap -T fields -R xml -e frame.number -e xml.tag -e xml.cdata -E separator=;</code></p></blockquote><p>HOWEVER, there is no field <strong>xml.data</strong> to print the whole XML structure. You are free to extend wireshark/tshark with such a field.</p><p>The alternative would be <strong>-e text</strong> (the 'content-encoded entity body') of the http response.</p><blockquote><p><code>tshark.exe -r xml_sample.cap -T fields -R xml -frame.number -e text --E separator=;</code></p></blockquote><p><strong>HOWEVER</strong> this does <strong>NOT</strong> print the full HTTP response. I'm not sure if this works as designed, or if it is a bug (gzip encoding). Please open a bug report, if you think this is a bug.</p><p>Then, the above command (-R xml) works <strong>ONLY</strong> while reading from a file, it does NOT work while reading from an interface (-i), at least not on my test system. So, your attempt to collect the whole XML data structure in one line, on-the-fly, will not work.</p><p>Look at the man page for a possible explanation for this (option -R):</p><blockquote><p><code>Cause the specified filter (which uses the syntax of read/display</code><br />
<code>filters, rather than that of capture filters) to be applied before</code><br />
<code>printing a decoded form of packets or writing packets to a file;</code><br />
<code>packets not matching the filter are discarded rather than being printed</code><br />
<code>or written.</code><br />
</p></blockquote><p>If the packets that did not match the filter "xml" are dropped, then tshark is probably not able to build the required internal state to collect the whole xml data.</p><p>Can someone with better knowldge about the internals, please comment on this?</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>01 Jun '12, 09:07</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>01 Jun '12, 09:14</strong> </span></p></div></div><div id="comments-container-11536" class="comments-container"></div><div id="comment-tools-11536" class="comment-tools"></div><div class="clear"></div><div id="comment-11536-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

