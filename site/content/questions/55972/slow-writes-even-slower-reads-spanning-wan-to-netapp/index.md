+++
type = "question"
title = "slow writes, even slower reads spanning WAN to Netapp"
description = '''Win7 workstation -&amp;gt; LAN -&amp;gt; ASA -&amp;gt; Cisco ASR -&amp;gt; DMVPN -&amp;gt; ASR -&amp;gt; Palo Alto -&amp;gt; Nexus -&amp;gt; NetApp We are experiencing the symptoms described in the title. This is not new, it predates me, and it happens at multiple spoke sites in our DMVPN. Each vendor just seems to point the finge...'''
date = "2016-09-28T11:57:00Z"
lastmod = "2017-02-19T21:17:00Z"
weight = 55972
keywords = [ "wan", "netapp", "cifs", "smb" ]
aliases = [ "/questions/55972" ]
osqa_answers = 3
osqa_accepted = false
+++

<div class="headNormal">

# [slow writes, even slower reads spanning WAN to Netapp](/questions/55972/slow-writes-even-slower-reads-spanning-wan-to-netapp)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-55972-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-55972-score" class="post-score" title="current number of votes">2</div><span id="post-55972-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Win7 workstation -&gt; LAN -&gt; ASA -&gt; Cisco ASR -&gt; DMVPN -&gt; ASR -&gt; Palo Alto -&gt; Nexus -&gt; NetApp</p><p>We are experiencing the symptoms described in the title. This is not new, it predates me, and it happens at multiple spoke sites in our DMVPN. Each vendor just seems to point the finger at the other with no real data reinforcing their point. Cisco has cleared any real issues at the hardware level.<br />
</p><p><img src="https://osqa-ask.wireshark.org/upfiles/loss-at-6.0-seconds.png" alt="alt text" /></p><p><img src="https://osqa-ask.wireshark.org/upfiles/loss-at-5.3-seconds_nF2E3Nj.png" alt="alt text" /></p><p><img src="https://osqa-ask.wireshark.org/upfiles/IO_4i0vYxw.png" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-wan" rel="tag" title="see questions tagged &#39;wan&#39;">wan</span> <span class="post-tag tag-link-netapp" rel="tag" title="see questions tagged &#39;netapp&#39;">netapp</span> <span class="post-tag tag-link-cifs" rel="tag" title="see questions tagged &#39;cifs&#39;">cifs</span> <span class="post-tag tag-link-smb" rel="tag" title="see questions tagged &#39;smb&#39;">smb</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>28 Sep '16, 11:57</strong></p><img src="https://secure.gravatar.com/avatar/2995c7d99c20cb44084f842832dc6b03?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="wdurand&#39;s gravatar image" /><p><span>wdurand</span><br />
<span class="score" title="50 reputation points">50</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="wdurand has no accepted answers">0%</span> </br></p></img></div></div><div id="comments-container-55972" class="comments-container"><span id="55973"></span><div id="comment-55973" class="comment"><div id="post-55973-score" class="comment-score"></div><div class="comment-text"><p>Hm hard to tell, with the info you gave. Could share us a tracefile at public accessible palce. You could use <a href="https://www.tracewrangler.com/">https://www.tracewrangler.com/</a> to do some anonymisation.</p></div><div id="comment-55973-info" class="comment-info"><span class="comment-age">(28 Sep '16, 12:16)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="55983"></span><div id="comment-55983" class="comment"><div id="post-55983-score" class="comment-score"></div><div class="comment-text"><p>Let me know if this works, if not I'll try something else. thanks.</p><p><a href="https://www.dropbox.com/sh/o7a5bigcg9aixmm/AADxJRAUGxlwARnG1m0LJVKGa?dl=0">https://www.dropbox.com/sh/o7a5bigcg9aixmm/AADxJRAUGxlwARnG1m0LJVKGa?dl=0</a></p></div><div id="comment-55983-info" class="comment-info"><span class="comment-age">(29 Sep '16, 04:31)</span> <span class="comment-user userinfo">wdurand</span></div></div><span id="55989"></span><div id="comment-55989" class="comment"><div id="post-55989-score" class="comment-score">2</div><div class="comment-text"><p>While writing retransmissions can be seen. While reading there are less Bytes in flight. I think it could be a window size problem, but to be more reliable we must see the handshake which is not included in the trace. So we need a new one which has the handshake included.</p><hr /><p>Update: So I have deleted my first answer, because I spotted some thing that I neeed to investigate. The SMB response goes up in worst case up to 2 sec. And I will connvert this answer into a comment, because at the moment it is no answer for me.</p></div><div id="comment-55989-info" class="comment-info"><span class="comment-age">(29 Sep '16, 10:13)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="55991"></span><div id="comment-55991" class="comment"><div id="post-55991-score" class="comment-score"></div><div class="comment-text"><p>I uploaded a regular Windows file copy of a 1G file to the netapp, C to H, then I did a copy back to the workstation, H to C.</p></div><div id="comment-55991-info" class="comment-info"><span class="comment-age">(29 Sep '16, 10:48)</span> <span class="comment-user userinfo">wdurand</span></div></div><span id="55995"></span><div id="comment-55995" class="comment"><div id="post-55995-score" class="comment-score"></div><div class="comment-text"><p>Well as I told without the three way handshake. The trace is not much worth. So maybe you need to disconnect and reconnect the network drive while capturing. Or you could try to reproduce the problem with FTP or SCP???</p></div><div id="comment-55995-info" class="comment-info"><span class="comment-age">(29 Sep '16, 11:41)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56020"></span><div id="comment-56020" class="comment not_top_scorer"><div id="post-56020-score" class="comment-score"></div><div class="comment-text"><p>Okay, so I tried the copy another way. I closed all sessions on the netapp that were associated with my userid.<br />
cifs session close -node SCORSAN01 -windows-user I then started a pcap session, mapped the H drive and transferred a 200MB file up. I repeated the process after disconnecting again and reading the file back to the workstation. Please see captures.</p></div><div id="comment-56020-info" class="comment-info"><span class="comment-age">(30 Sep '16, 07:48)</span> <span class="comment-user userinfo">wdurand</span></div></div><span id="56031"></span><div id="comment-56031" class="comment not_top_scorer"><div id="post-56031-score" class="comment-score"></div><div class="comment-text"><p>Yes the tracefiles are working. So one question is why 198.207.240.111 only a MSS of 1360 advertises?</p></div><div id="comment-56031-info" class="comment-info"><span class="comment-age">(30 Sep '16, 11:56)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56034"></span><div id="comment-56034" class="comment not_top_scorer"><div id="post-56034-score" class="comment-score"></div><div class="comment-text"><p>I have updated my answer.</p></div><div id="comment-56034-info" class="comment-info"><span class="comment-age">(30 Sep '16, 15:19)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56091"></span><div id="comment-56091" class="comment not_top_scorer"><div id="post-56091-score" class="comment-score"></div><div class="comment-text"><p>That is set on the tunnel interface for DMVPN.<br />
</p><p>interface Tunnel0 ip mtu 1400 ip tcp adjust-mss 1360 load-interval 30</p></div><div id="comment-56091-info" class="comment-info"><span class="comment-age">(03 Oct '16, 06:25)</span> <span class="comment-user userinfo">wdurand</span></div></div><span id="56094"></span><div id="comment-56094" class="comment not_top_scorer"><div id="post-56094-score" class="comment-score"></div><div class="comment-text"><p>Ok then it is like I have thought the mss is correct.</p></div><div id="comment-56094-info" class="comment-info"><span class="comment-age">(03 Oct '16, 06:56)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56106"></span><div id="comment-56106" class="comment not_top_scorer"><div id="post-56106-score" class="comment-score"></div><div class="comment-text"><p>Well you try to tune some parameters at both sides, as I think the limitaion is either the receive or the congestion window. But you really should do this very carefully.</p><p>Some tuning hints could be found here: <a href="http://www.speedguide.net/articles/windows-7-vista-2008-tweaks-2574">http://www.speedguide.net/articles/windows-7-vista-2008-tweaks-2574</a></p><p>and here: <a href="http://www.speedguide.net/articles/windows-8-10-2012-server-tcpip-tweaks-5077">http://www.speedguide.net/articles/windows-8-10-2012-server-tcpip-tweaks-5077</a></p><p>and here: <a href="http://smallvoid.com/article/winnt-tcp-slow-start.html">http://smallvoid.com/article/winnt-tcp-slow-start.html</a></p></div><div id="comment-56106-info" class="comment-info"><span class="comment-age">(03 Oct '16, 12:28)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56507"></span><div id="comment-56507" class="comment not_top_scorer"><div id="post-56507-score" class="comment-score"></div><div class="comment-text"><p>An excellent question. We will discuss this at Sharkfest Europe!</p></div><div id="comment-56507-info" class="comment-info"><span class="comment-age">(19 Oct '16, 06:30)</span> <span class="comment-user userinfo">packethunter</span></div></div><span id="56562"></span><div id="comment-56562" class="comment not_top_scorer"><div id="post-56562-score" class="comment-score"></div><div class="comment-text"><p>Which Palo Alto Networks Firewall is used? Is there a Security Profile in place for the Firewall Rule which matches the session?</p></div><div id="comment-56562-info" class="comment-info"><span class="comment-age">(21 Oct '16, 06:02)</span> <span class="comment-user userinfo">Markus_W</span></div></div><span id="56566"></span><div id="comment-56566" class="comment not_top_scorer"><div id="post-56566-score" class="comment-score"></div><div class="comment-text"><p>What Bandwidth does the WAN have?</p></div><div id="comment-56566-info" class="comment-info"><span class="comment-age">(21 Oct '16, 07:01)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="56828"></span><div id="comment-56828" class="comment not_top_scorer"><div id="post-56828-score" class="comment-score"></div><div class="comment-text"><p>The client does increase the amount concurrent read request over time in a linear way. In my test scenario I haven't seen this behavior. Maybe it is due to your iRTT of 23ms? But I don't know for sure as I am not a SMB expert. Maybe You can try to tune the next parameter, but you should do it in very carefully way. Because their might be a very good reason why the default is 0.</p><pre><code>Client

DisableBandwidthThrottling

HKLM\system\CurrentControlSet\Services\lanmanworkstation\parameters\(REG_DWORD)

The default is 0. This setting is available starting with Windows Server 2008 SP2. By default, the SMB redirector throttles throughput across high-latency network connections in some cases to avoid network-related timeouts. Setting this registry value to 1 disables this throttling, enabling higher file transfer throughput over high-latency network connections.</code></pre></div><div id="comment-56828-info" class="comment-info"><span class="comment-age">(30 Oct '16, 01:42)</span> <span class="comment-user userinfo">Christian_R</span></div></div></div><div id="comment-tools-55972" class="comment-tools"><span class="comments-showing"> showing 5 of 15 </span> <a href="#" class="show-all-comments-link">show 10 more comments</a></div><div class="clear"></div><div id="comment-55972-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

3 Answers:

</div>

</div>

<span id="56793"></span>

<div id="answer-container-56793" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-56793-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-56793-score" class="post-score" title="current number of votes">2</div><span id="post-56793-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>At the end of my talk about SMB2 during Sharkfest Europe I have invited the attendees to look at this post to get a feeling for the protocol. I guess, people are interested in SMB2 since the view counters went up over the last week.</p><p>My analysis can be found on <a href="https://blog.packet-foo.com/2016/10/trace-file-case-files-smb2-performance/">Jasper's blog</a> as it became too big for this website.</p><p>Any comments, add-ons etc are very welcome.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>28 Oct '16, 12:33</strong></p><img src="https://secure.gravatar.com/avatar/3b60e92020a427bb24332efc0b560943?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="packethunter&#39;s gravatar image" /><p><span>packethunter</span><br />
<span class="score" title="2137 reputation points"><span>2.1k</span></span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="48 badges"><span class="bronze">●</span><span class="badgecount">48</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="packethunter has 8 accepted answers">8%</span> </br></br></p></img></div></div><div id="comments-container-56793" class="comments-container"></div><div id="comment-tools-56793" class="comment-tools"></div><div class="clear"></div><div id="comment-56793-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="59542"></span>

<div id="answer-container-59542" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-59542-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-59542-score" class="post-score" title="current number of votes">1</div><span id="post-59542-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>This is a complex problem and to properly understand what is going on, we need to understand:</p><ul><li>TCP "Transmit Window", "Send Window", "packets in flight" or "CWND".</li><li>TCP "Slow Start" exponential throughput ramp up - versus,</li><li>TCP "Congestion Avoidance" (when congestion is detected, halve the transmit window then ramp up linearly).</li><li>TCP Selective Acknowledgements (SACKs).</li><li>TCP Duplicate SACKs (D-SACKs) and Duplicate ACKs (Dup-ACKs) which are very different despite sounding similar.</li><li>Cisco ASA Firewall behaviour (the ASA handles packet losses itself, effectively hiding them from the downstream side).</li><li>Out-Of-Order packets (OOO).</li></ul><p>This problem is also addressed in a set of 4 articles on www.lovemytool.com. The first 2 articles are already there and the following 2 articles will be published approximately a month apart.</p><p><a href="http://www.lovemytool.com/blog/2016/12/slow-writes-slower-reads-by-bob-brownell.html">http://www.lovemytool.com/blog/2016/12/slow-writes-slower-reads-by-bob-brownell.html</a></p><p><a href="http://www.lovemytool.com/blog/2017/02/cisco-asa-behaviour-with-packet-losses-and-overtaking-using-netdata-visibility-by-bob-brownell.html">http://www.lovemytool.com/blog/2017/02/cisco-asa-behaviour-with-packet-losses-and-overtaking-using-netdata-visibility-by-bob-brownell.html</a></p><p>Those articles contain detailed charts that visually display the behaviours involved. Only a summary of the relevant observations is provided here.</p><p>Here is the network "diagram":</p><p>Win7 workstation -&gt; LAN -&gt; ASA -&gt; Cisco ASR -&gt; DMVPN -&gt; ASR -&gt; Palo Alto -&gt; Nexus -&gt; NetApp</p><p>Note that the PC where the captures were taken is on the left hand side and we have an ASA firewall on the local side of the DMVPN WAN. Thus, any packet losses or OOO packets that occur on the other side of that ASA are hidden from us. We have to infer them from the received SACKs, redundant retransmissions and the timing of those events.</p><p><strong><em>Findings - Both Directions:</em></strong></p><p>1) The underlying cause of the throughput reductions are out-of-order packets (OOO) on the other side of the local ASA firewall. That is, somewhere between the local ASA firewall and NetApp.</p><p>Win7 workstation -&gt; LAN -&gt; ASA -&gt; Cisco ASR -&gt; DMVPN -&gt; ASR -&gt; Palo Alto -&gt; Nexus -&gt; NetApp |&lt;---- Out of Order Packets Occur Somewhere Here ----&gt;|</p><p>2) Very early in each transfer, during the "Slow Start" ramp up, OOO packets and their respective SACKs or Dup-ACKs generated from the receiver cause the sender to enter "Congestion Avoidance" mode. This involves halving the transmit window (often multiple times) and then ramping up linearly (just one extra packet is added per round trip). This is the underlying cause of the "sawtooth" throughput patterns.</p><p>3) The minimum round trip time (RTT) between the PC and NetApp is 22.9 ms.</p><p>4) All SMB requests are handled in blocks of 64 KB.</p><p><strong><em>Observations (C-to-H):</em></strong></p><p>a) We are sending the data, so we see the data packets leave the PC in the correct order.</p><p>b) The slow start ramps up to 102 packets in flight after just 8 round trips. Just for interest, the server's Receive Window is 300 KB at this point.</p><p>c) However, we then receive SACKs from the NetApp (starting with packet #608).</p><p>d) These SACKs indicate that data packets #499 to #572 were not received but #573 to #606 were.</p><p>e) Based on the SACKs, our PC begins to retransmit that large data block, as #615 to #736.</p><p>f) Just 1.2 ms after the first SACK, we receive normal ACKs acknowledging the whole original block of 102 packets.</p><p>g) Given the RTT of 23 ms, those ACKs can only mean that the original block of 102 was eventually received intact. The SACKs tell us that #499 to #572 must have been overtaken so that #573 to #606 arrived at the NetApp before them. Packets #499 to #572 probably arrived at the NetApp just 1.2 ms late.</p><p>h) Due to the apparent (but we know not real) large packet loss, the PC halved its transmit window so that only 54 packets are sent in the next burst (#609, #614, #737-#791). Halving packets per round trip is halving the data throughput.</p><p>i) Interestingly, we receive several Dup-ACKs indicating that #609 was not received so we retransmit it as #801.</p><p>j) Just 2 ms later, we receive normal ACKs for all 54 packets. Again, we can infer OOO at the receiving NetApp.</p><p>k) This additional "packet loss" triggers a further halving of the PC's transmit window. Just 25 packets (#838 to #862) are transmitted in the next burst.</p><p>l) Since we're now in "Congestion Avoidance" mode, subsequent packet bursts increase by only one packet per round trip. We see 26, 27, 28, ... packets per round trip eventually ramping all the way up to 539. We remain in "Congestion Avoidance" mode for the rest of the file transfer, never seeing "Slow Start" again. This is why we observe the linear throughput increase until the end.</p><p>m) As the TCP data throughput ramps up, the PC is able to include more and more 64 KB SMB blocks in each TCP round trip. Thus, the PC increases its concurrent SMB write requests to fill the available throughput.</p><p>m) 539 packets is around 730 KB, so the final round trip delivers data for 12 SMB blocks (at 64 KB each) in the final burst.</p><p>n) Just out of interest, the server keeps stepping up its Receive Window so that it is always approximately double what we are transmitting.</p><p><strong><em>Observations (H-to-C):</em></strong></p><p>A) We are receiving the data, so the activity on the sender side of the local Cisco ASA firewall is hidden from us.</p><p>B) The ASA receives packets out-of-order on the other side, sends its own SACKs back to the NetApp then buffers packets until "gaps" are filled. Only when it has packets in the correct order does it release them to us.</p><p>C) The server's slow start ramps up to 79 packets (107 KB, #735 to #821) in flight after 13 round trips. Just for interest, the client's Receive Window is 1 MB at this point in time.</p><p>D) The PC transmits ACKs for all those data packets but then receives 24 unnecessary retransmissions (#824 to #870) in about 1 ms less than the minimum RTT. These are non-contiguous and represent just 24 of the 79 packets in the previous "burst".</p><p>E) 2.2 ms after the first retransmission, we receive the next full "burst" of data packets - which is now halved to 39 packets (#872 to #914).</p><p>F) From the "C-to-H" trace, we know that the OOO occurs on the other side of the local ASA firewall. From the retransmissions and their timing, we can infer that the first 21 packets of the burst of 79 arrived at the other side of our local ASA out-of-order and later than the others in the burst.</p><p>G) We infer that the ASA sent SACKs back to the NetApp, informing it that the first 21 (and 3 more non-contiguous packets) were not received.</p><p>H) However, once the local ASA received the 24 late packets (which were only about 1 ms late) it released the full original burst of 79 packets to us in the correct order.</p><p>I) The NetApp responded to the ASA's SACKs by retransmitting the 21 + 3 "missing" packets. The ASA then passed those retransmitted packets straight through - which we observe in the trace as unnecessary retransmissions.</p><p>J) When the NetApp received our PC's ACKs for the full burst of 79 packets, it ceased retransmitting and sent the next normal burst. However, since it had detected "packet loss" it halved its transmit window so that this burst was just 39 packets and is now in "Congestion Avoidance" mode.</p><p>I) Our PC transmitted D-SACKs (#828-#831, #835-#837, #843-847, #855-861, #865-867, #869, #871) in response to all 24 unnecessary retransmitted data packets (#824 to #870).</p><p>J) The NetApp interpreted those D-SACKs as normal Dup-ACKs and retransmitted yet another unnecessary packet (#916). Due to these further apparent packet losses, it further halved its transmit window to just 19 packets in the next burst.</p><p>K) Being in "Congestion Avoidance" mode, the NetApp increases its subsequent bursts by just one packet per round trip and we observe the following round trips delivering bursts of 20, 21, 22 and 23 packets.</p><p>L) The OOO behaviour as above (D)-(J) re-occurs several times, causing all those "sawtooth" changes in the observed throughput. At the best point in the flow, we manage to achieve 424 packets (575 KB) per round trip.</p><p>M) To help you follow along, packets #3221 and #172758 are just two examples of unnecessary retransmissions at the start of transmit window halvings.</p><p>N) As well as the Cisco ASA firewall "misleading" us by hiding the OOO activity, the large 2.5 second SRTs reported by Wireshark during the read test are also somewhat misleading. They are not a symptom of any server problem at all. They are a symptom of the way the client requests the data from the server. This can be a story for another day.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>19 Feb '17, 21:17</strong></p><img src="https://secure.gravatar.com/avatar/35a0c1d0cf15b9d54d73bf54ae28abcd?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Philst&#39;s gravatar image" /><p><span>Philst</span><br />
<span class="score" title="431 reputation points">431</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="16 badges"><span class="bronze">●</span><span class="badgecount">16</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Philst has 6 accepted answers">27%</span></p></img></div></div><div id="comments-container-59542" class="comments-container"></div><div id="comment-tools-59542" class="comment-tools"></div><div class="clear"></div><div id="comment-59542-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="56735"></span>

<div id="answer-container-56735" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-56735-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-56735-score" class="post-score" title="current number of votes">0</div><span id="post-56735-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>My 2 cents:</p><p>C_to_H_200MB: Trace taken on the sender side. Throughput is <em>linearly</em> increasing till 240Mbit/s at the end, like the receiver window size, growing all along. Windows size is not filled from sender point of view.</p><p>H_to_C_200MB: Trace taken on the receiver side. Throughput grows linearly (max of 180Mb/s), but is stopped each time there's a retransmission, sender seems to be very sensitive to that.</p><p>I'd make the test with a Linux &amp; macOS client.</p><p>If changes, I'd check and disable some "Slow start" / Heuristic features of Windows:</p><p><a href="http://betanews.com/2011/01/20/use-hidden-windows-tweaks-to-speed-up-your-internet-and-network-connections/">http://betanews.com/2011/01/20/use-hidden-windows-tweaks-to-speed-up-your-internet-and-network-connections/</a> <a href="https://www.duckware.com/blog/how-windows-is-killing-internet-download-speeds/index.html">https://www.duckware.com/blog/how-windows-is-killing-internet-download-speeds/index.html</a> <a href="http://www.speedguide.net/faq/windows-scaling-heuristics-changes-my-tcp-autotuning-339">http://www.speedguide.net/faq/windows-scaling-heuristics-changes-my-tcp-autotuning-339</a></p><p>Else, throughput is high, and RTT of 30ms, I'd try to open more both RX windows size and TX buffer at the beginning of the TCP connection to see if transfer throughput is no longer linearly growing.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 Oct '16, 04:58</strong></p><img src="https://secure.gravatar.com/avatar/822be38630e1b9b5a1505f259322c63b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="TomLaBaude&#39;s gravatar image" /><p><span>TomLaBaude</span><br />
<span class="score" title="66 reputation points">66</span><span title="17 badges"><span class="badge1">●</span><span class="badgecount">17</span></span><span title="17 badges"><span class="silver">●</span><span class="badgecount">17</span></span><span title="24 badges"><span class="bronze">●</span><span class="badgecount">24</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="TomLaBaude has 2 accepted answers">66%</span></p></div></div><div id="comments-container-56735" class="comments-container"></div><div id="comment-tools-56735" class="comment-tools"></div><div class="clear"></div><div id="comment-56735-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</hr>

</div>

</div>

