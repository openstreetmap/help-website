+++
type = "question"
title = "Win7: Network traffic blocked although firewall off?"
description = '''Hi, I&#x27;ve been using an application for receiving UDP packets from a network device. The app is written by myself. It&#x27;s been working fine on Windows XP for years. I had to switch to Win7 a couple of weeks ago. Suddenly receiving those packets does not work that well anymore. I mean it does now and th...'''
date = "2013-11-29T00:47:00Z"
lastmod = "2013-11-29T16:16:00Z"
weight = 27549
keywords = [ "packets", "blocked" ]
aliases = [ "/questions/27549" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Win7: Network traffic blocked although firewall off?](/questions/27549/win7-network-traffic-blocked-although-firewall-off)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-27549-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-27549-score" class="post-score" title="current number of votes">0</div><span id="post-27549-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>I've been using an application for receiving UDP packets from a network device. The app is written by myself. It's been working fine on Windows XP for years. I had to switch to Win7 a couple of weeks ago. Suddenly receiving those packets does not work that well anymore. I mean it does now and then, but not at 100%. Lots of packets seem to get lost or blocked by something.</p><p>I disabled the Win7 firewall completely on all profiles (also tried turning it on and creating specific rules for this kind of traffic). Nothing!</p><p>Wireshark tells me, the packets ARE getting through. I can see them: timestamp, sequence number, payload - it all fits. But I learned here in the forum that Winpcap captures information BEFORE the firewall (or whatever might be blocking things?!). But it's good to know for starters that in general the packets are getting sent to and also received by the computer.</p><p>Since all that worked very well on XP, my question is, is there or could there be something else on Win7 acting like a firewall? Win7 seems to be a lot more restrictive (supposedly "protective") towards network traffic compared to XP. How could I find out what else is blocking the packets?</p><p>These computers are remotely managed desktops of the company I work for. I would not be surprised if there was more to it than just the firewall settings I can see myself. But IT helpdesk is not really helpful on things like these. Most of these people merely deal with petty Outlook or Word issues. I'm sure (and have experienced it myself) that problems like the one I described are beyond them. So I'll have to find a way myself to "bypass" their "security".</p><p>Regards, Mac</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-packets" rel="tag" title="see questions tagged &#39;packets&#39;">packets</span> <span class="post-tag tag-link-blocked" rel="tag" title="see questions tagged &#39;blocked&#39;">blocked</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>29 Nov '13, 00:47</strong></p><img src="https://secure.gravatar.com/avatar/72b2b17408b60426af6ec457395513c4?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="MacShark&#39;s gravatar image" /><p><span>MacShark</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="MacShark has no accepted answers">0%</span></p></div></div><div id="comments-container-27549" class="comments-container"></div><div id="comment-tools-27549" class="comment-tools"></div><div class="clear"></div><div id="comment-27549-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="27562"></span>

<div id="answer-container-27562" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-27562-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-27562-score" class="post-score" title="current number of votes">0</div><span id="post-27562-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>I disabled the Win7 firewall completely on all profiles (also tried turning it on and creating specific rules for this kind of traffic). Nothing!</p></blockquote><p>I see several possible problems:</p><p><strong>1. Security Software</strong></p><p>Besides the Win7 firewall, there are many other tools that can block network communication. Some are:</p><ul><li>AntiVirus</li><li>VPN clients (rather unusual to block incoming frames)</li><li>Endpoint Security</li><li>IDS/IPS</li><li>etc.</li></ul><p>Did you disable all kind of security software to figure out if anyone drops your frames?</p><p><strong>2. Malformed UDP packet</strong></p><p>I can remember a similar question. UDP port xyz working on XP but failure on Win7.</p><blockquote><p><a href="http://ask.wireshark.org/questions/20269/udp-port-1025-works-in-xp-but-not-win-7">http://ask.wireshark.org/questions/20269/udp-port-1025-works-in-xp-but-not-win-7</a></p></blockquote><p>My suggestion was to check if the OS drops the frames for some reason (bad checksum, bad address, etc.)</p><p>So, please run <code>netstat -s</code> on the Win7 box and check if the dropped counter raises as soon as you generate traffic with your application. See the marked counters below.</p><pre><code>netstat -s

IPv4 Statistics

  Packets Received                   = 1070088
  Received Header Errors             = 0
  Received Address Errors            = 271
  Datagrams Forwarded                = 0
  Unknown Protocols Received         = 0
  Received Packets Discarded         = 67898
  Received Packets Delivered         = 1108133
  Output Requests                    = 1979878
  Routing Discards                   = 0
  Discarded Output Packets           = 5809
  Output Packet No Route             = 1
  Reassembly Required                = 0
  Reassembly Successful              = 0
  Reassembly Failures                = 0
  Datagrams Successfully Fragmented  = 0
  Datagrams Failing Fragmentation    = 0
  Fragments Created                  = 0

UDP Statistics for IPv4

  Datagrams Received    = 40722
  No Ports              = 352
  Receive Errors        = 67544
  Datagrams Sent        = 61341</code></pre><p><strong>3. Capture file</strong></p><p>Finally: Is it possible to post a sample capture file with some frames on google drive, dropbox, cloudshark.org or mega.co.nz?</p><p>Please also add the output of the following command (on the receiving system - as I understand it: Win7):</p><blockquote><p>netstat -na | find ":5000"</p></blockquote><p>Please replace 5000 with the port of your application.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>29 Nov '13, 05:50</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></p></div></div><div id="comments-container-27562" class="comments-container"><span id="27566"></span><div id="comment-27566" class="comment"><div id="post-27566-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your response!</p><p>Re 1. Yes, that's what I'm kinda suspecting. But the computers involved do not allow disabling more than the firewall, at least not "legally". ;-) Anything else would be a violation of security regulations of my employer, at least for this kind of computer (the remotely managed kind). The only way of letting go of security software - and this is what I'm doing right now - is setting up a computer with a manually installed Win7, without the remote management part.</p><p>Re 2. The number of "Received Packets Discarded" does go up, but not considerably. It also does so even when the app is NOT running which can only be caused by the primary network adapter connecting the computer to the LAN (which unfortunately is required for the whole system to work). I'll start another test run when I'm at the workstation itself (it's mostly remote desktop right now). Then I can disable the primary network adapter. "Header Errors" and "Address Errors" do not change. Neither does "Receive Errors". By the way, the same connection for receiving those packets is also used for uploading images to said device, but via TCP. Could this have an impact on any of these counters too?</p><p>Re 3. Most network storage sites (including dropbox) are not accessible from within my company's network. Talking about trying to do my work ... ! :( I'll upload the latest wireshark log file to my personal dropbox account when I'm home. One more thing: When doing "netstat -na" the port used for receiving said packets (1042) does not show up in the list printed ... !?</p><p>Mac</p></div><div id="comment-27566-info" class="comment-info"><span class="comment-age">(29 Nov '13, 07:14)</span> <span class="comment-user userinfo">MacShark</span></div></div><span id="27569"></span><div id="comment-27569" class="comment"><div id="post-27569-score" class="comment-score"></div><div class="comment-text"><p>Oops, with the primary network adapter removed, leaving the device the only thing connected, "Received Packets Discarded" does NOT change until packets are lost, meaning: do not get received by the app. As soon as the app complains about not getting anything anymore, the counter increases, pretty much (or maybe even exactly) the same rate packets should be received by the application.</p><p>The wireshark log is now here (thanks to personal smartphone): <a href="https://www.dropbox.com/sh/0ozvkivj5daa41k/1dmpQVrbQJ">https://www.dropbox.com/sh/0ozvkivj5daa41k/1dmpQVrbQJ</a></p><p>Does that make the UDP packets "malformed"? Can you see in which way and what to do about it in the log?</p><p>Mac</p><p>PS: To make things a bit more specific: I uploaded another log file to the same location where I extracted a couple of packets. Packet no. 4 in this log file was the last one to be received. The next one, no. 5 (the only one of size 1463 in there), was the first one to not get through.</p><p>Please don't be confused by port no. 1043 there. It's either this or 1042, as mentioned above.</p></div><div id="comment-27569-info" class="comment-info"><span class="comment-age">(29 Nov '13, 07:39)</span> <span class="comment-user userinfo">MacShark</span></div></div><span id="27571"></span><div id="comment-27571" class="comment"><div id="post-27571-score" class="comment-score"></div><div class="comment-text"><blockquote><p>One more thing: When doing "netstat -na" the port used for receiving said packets (1042) does not show up in the list printed ... !?</p></blockquote><p>well, if you don't see that, it will <strong>not</strong> work. You should see this</p><pre><code> UDP    0.0.0.0:1042            *:*
 UDP    0.0.0.0:1043            *:*</code></pre><p>There are several reasons why you don't see that entry.</p><ul><li>Your software did not start</li><li>Your software was not able to create/open a socket</li><li>Your software was blocked by some other software, probably security related tools</li></ul><p>There is nothing Wireshark can do for you, as the traffic apparently reaches the machine (you said you see it in Wireshark), but there is no software ready to handle the traffic. Actually, you should see ICMP 'port unreachable' messages in the capture file, unless you had a capture filter for the port only.</p><p><strong>Solution</strong> for your problem: Figure out why your software did not open a socket to receive data.</p></div><div id="comment-27571-info" class="comment-info"><span class="comment-age">(29 Nov '13, 09:19)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="27572"></span><div id="comment-27572" class="comment"><div id="post-27572-score" class="comment-score"></div><div class="comment-text"><p>BTW: <strong>Both</strong> capture files show 1042/1043 as <strong>source port</strong>. I thought that was the port on Win7, where your software is listening for traffic !?!</p><p><strong>Please add more details</strong> about the involved systems. Which IP address is what (Win7, device), what is the direction of data exchange (only device -&gt; win7 or both directions, etc.).</p><p>Please run the following command on the <strong>receiving station</strong> and check if <strong>your executable</strong> shows up for any port</p><blockquote><p>netstat -nab | more</p></blockquote><p>You need to run that command in an elevated DOS box (run as administrator!)</p></div><div id="comment-27572-info" class="comment-info"><span class="comment-age">(29 Nov '13, 09:24)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="27573"></span><div id="comment-27573" class="comment"><div id="post-27573-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Oops, with the primary network adapter removed,</p></blockquote><p>Primary interface? Removed? From what?</p></div><div id="comment-27573-info" class="comment-info"><span class="comment-age">(29 Nov '13, 09:50)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="27576"></span><div id="comment-27576" class="comment not_top_scorer"><div id="post-27576-score" class="comment-score"></div><div class="comment-text"><p>My bad, I mixed up source and destination port. Please understand this specific part of the software is not my code. I'm just using a more or less third-party DLL for receiving the data. Unfortunately it's not very well documented. So I'm not opening the port myself. I will have another look at "netstat -a" when I'm back at work on Monday.</p><p>The software has the port open for receiving the packets. I don't need to find out about that. Opening the port is also part of the general logging output of the application. There was this case (I mentioned when describing "packet no. 4 and 5" in the last comment) where receiving the packets stopped in mid-stream, as in: the port was open, was listened too, was receiving data and was not closed (yet). And then suddenly nothing came in anymore. The software was still running, the DLL was still cycling through its receiving thread. The reason why I did not see the port in netstat's output was probably just that I was looking for the wrong (destination) port.</p><p>I know that Wireshark will not solve the problem. I used it merely to find out whether the packets actually do reach the computer. I also recall mentioning that I'm pretty sure there could also be a security tool issue which I haven't found out about yet. Last thing I did before going home was setting up another computer with a rather slim Win7: no additional security tools, no anti-virus software. If there the software works like it did on XP, I can blame the remotely managed workstation and all its (security) software details that I don't know about and probably am not even supposed to - considering the IT department's perspective. Probably will switch to a system like this in the end if it turns out to be a security tool issue.</p><blockquote><p>Primary interface? Removed? From what?</p></blockquote><p>From the equation, dude! :-) I disabled the network card of the computer to not have its traffic show up in netstat's output.</p><p>Mac</p><p>PS: What you saw in the log files is a filtered capture of only the traffic going from the device (160.10.79.35) to Win7 (160.10.79.50). There's a lot more being exchanged between the two sides, TCP and UDP, lots of different ports. But it's only the incoming packets for said DLL not getting through now and then. All other traffic (incoming and outgoing) of the main application is doing fine.</p></div><div id="comment-27576-info" class="comment-info"><span class="comment-age">(29 Nov '13, 16:16)</span> <span class="comment-user userinfo">MacShark</span></div></div></div><div id="comment-tools-27562" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-27562-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

