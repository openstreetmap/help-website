+++
type = "question"
title = "A question about Windows Size, Window Size Scaling and max throughput on 10GB LAN"
description = '''Hello Can someone please help me with the following question? I understand (from what I have read so far), the Window Size plays an important role in the overall potential throughput of a systems and thereby application layer performance (assuming the application in question can get the data out of ...'''
date = "2016-11-13T02:49:00Z"
lastmod = "2017-02-20T22:35:00Z"
weight = 57353
keywords = [ "windows", "tcpwindowsize" ]
aliases = [ "/questions/57353" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [A question about Windows Size, Window Size Scaling and max throughput on 10GB LAN](/questions/57353/a-question-about-windows-size-window-size-scaling-and-max-throughput-on-10gb-lan)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-57353-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-57353-score" class="post-score" title="current number of votes">0</div><span id="post-57353-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello Can someone please help me with the following question?</p><p>I understand (from what I have read so far), the Window Size plays an important role in the overall potential throughput of a systems and thereby application layer performance (assuming the application in question can get the data out of the receive buffer fast enough)</p><p>I read that in a network with a 1 ms delay and with a window size of 64k (where window scaling is not in effect) the maximum throughput is 524 Mbps. Whereas if Window Scaling option is available (which I be believe was introduced in RFC 1323?) the throughput on the same network can go up to 8590 Mbps.</p><p>The reason I ask is we have a layer two (switched) network using Cisco Nexus switches, not sure which model. Attached to these switches are HP Servers running Windows 2008 R2 and NetApp Cluster Mode filers (with 4 LIFs). We have 10GB NICs in the Servers and NetApp controllers. However I have been told users are saying performance of their applications (sitting on top of this environment) is slow, e.g. slower than it was when it was on the older NetApp 7 mode filers. We have boiled it down a bit and believe the delay as at the network level as the delay to write data is between 170 and 270 ms (when measured from Windows Port driver to the network attached NetApp cluster mode filer). NetApp team are saying write to disk is very fast once processed by network layer, so issue appears to be at network delay. Network team are saying nothing odd going on at the nexus switches.</p><p>Therefore I am thinking about window size as I see a maximum of 64k and the Window Scaling option is set to -1 (unknown) and I also see NOP NOP (no option) in the TCP header information. Therefore I am thinking either the sender (windows server) or receiver (NetApp cluster mode filer) does not support the Window Scaling option (or it is disabled by some kind of configuration option), or the network switches are stripping it out (but I am informed the switches are only working at layer 2 so not touching the TCP headers, but I have to bear in mind this information may be incomplete).</p><p><strong>Question:</strong> Taking the above into account, in general (without packet trace at this point, may be able to post one later) is it true to say if I see a window size of 64k and Window Scaling option set to -1, this would have detrimental effect on the achievable throughput between two hosts on a 10GB Ethernet network with a 1ms (or less) delay, as I referred to above?</p><p>Thanks very much in advance Ernie</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-windows" rel="tag" title="see questions tagged &#39;windows&#39;">windows</span> <span class="post-tag tag-link-tcpwindowsize" rel="tag" title="see questions tagged &#39;tcpwindowsize&#39;">tcpwindowsize</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>13 Nov '16, 02:49</strong></p><img src="https://secure.gravatar.com/avatar/ff39c11ae2cb05528da757366e76d84b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="EBrant&#39;s gravatar image" /><p><span>EBrant</span><br />
<span class="score" title="1 reputation points">1</span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="9 badges"><span class="bronze">●</span><span class="badgecount">9</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="EBrant has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>13 Nov '16, 04:03</strong> </span></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span></p></div></div><div id="comments-container-57353" class="comments-container"></div><div id="comment-tools-57353" class="comment-tools"></div><div class="clear"></div><div id="comment-57353-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="57354"></span>

<div id="answer-container-57354" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-57354-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-57354-score" class="post-score" title="current number of votes">0</div><span id="post-57354-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Please seee a related problem here:</p><p><a href="https://ask.wireshark.org/questions/55972/slow-writes-even-slower-reads-spanning-wan-to-netapp">https://ask.wireshark.org/questions/55972/slow-writes-even-slower-reads-spanning-wan-to-netapp</a></p><p>and a discussion about that question here:</p><p><a href="https://blog.packet-foo.com/2016/10/trace-file-case-files-smb2-performance/#more-1393">https://blog.packet-foo.com/2016/10/trace-file-case-files-smb2-performance/#more-1393</a></p><p>But for detailed WindowScaling analysis you MUST capture the 3-way handshake, because the WS factor is advertised only there. And a WS of -1 means that you haven´t captured the 3-WayHandshake.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>13 Nov '16, 03:22</strong></p><img src="https://secure.gravatar.com/avatar/3b24b339fc62fb46dced6a443d3202ea?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Christian_R&#39;s gravatar image" /><p><span>Christian_R</span><br />
<span class="score" title="1830 reputation points"><span>1.8k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="25 badges"><span class="bronze">●</span><span class="badgecount">25</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Christian_R has 25 accepted answers">16%</span></p></div></div><div id="comments-container-57354" class="comments-container"><span id="57355"></span><div id="comment-57355" class="comment"><div id="post-57355-score" class="comment-score"></div><div class="comment-text"><p>Just to state explicitly what <span>@Christian_R</span> only implies: displaying a window scaling factor value of -1 is how the <strong>TCP dissector of Wireshark</strong> announces that the actual window size cannot be determined from the capture. If any of the two TCP session participants does not support window scaling but the SYN, SYN+ACK exchange is available in the capture, the dissector shows a window scaling factor of 1 and uses it to calculate the actual window size.</p></div><div id="comment-57355-info" class="comment-info"><span class="comment-age">(13 Nov '16, 04:15)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="57356"></span><div id="comment-57356" class="comment"><div id="post-57356-score" class="comment-score"></div><div class="comment-text"><p>Hello Christian and Sindy, thanks to you both for taking the time to reply to my question.</p><p>This is extremely useful information e.g. WS of -1 means that you haven´t captured the 3-WayHandshake and that a Window size of 1 (as further explained by sindy) SYN, SYN+ACK exchange is available in the capture, the dissector shows a window scaling factor of 1 and uses it to calculate the actual window size.</p><p>The above is very useful information to me for someone who has started to learn WireShark :)</p><p>I will start Wireshark, then disable and re-enable the network card, this should hopefully capture the three way handshake then I can check again</p><p>Thanks again Ernie</p></div><div id="comment-57356-info" class="comment-info"><span class="comment-age">(13 Nov '16, 05:28)</span> <span class="comment-user userinfo">EBrant</span></div></div><span id="57357"></span><div id="comment-57357" class="comment"><div id="post-57357-score" class="comment-score"></div><div class="comment-text"><p>Or you can just disconnect and reconnect the remote drive.</p></div><div id="comment-57357-info" class="comment-info"><span class="comment-age">(13 Nov '16, 05:52)</span> <span class="comment-user userinfo">Christian_R</span></div></div></div><div id="comment-tools-57354" class="comment-tools"></div><div class="clear"></div><div id="comment-57354-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="59575"></span>

<div id="answer-container-59575" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-59575-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-59575-score" class="post-score" title="current number of votes">0</div><span id="post-59575-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Firstly, to confirm what you have read and understood. Yes, TCP Window Size does play an important part in throughput. A receiver advertises a Receive Window - which represents the size of the receive buffer that it has allocated for that connection.</p><p>To us, in English, it means the amount of data that a sender can transmit before needing to wait to receive acknowledgements (ACKs). Once the sender has transmitted that amount of data, it must stop transmitting and wait for ACKs to come back. Once data is ACKed, the sender can transmit more data to again fill the Receive Window.</p><p>The effect is to specify the maximum data volume that can be transmitted per round trip. With Window Scaling disabled, the throughput can only be 64 KB per round trip time. The RTT being the time it takes your 64KB of data to get to the receiver and then the receiver's ACKs to get back to you. For a RTT of 1ms, this roughly means 64KB/ms - or 64MB/sec. A straight multiplication by 8 gives us 512Mb/s (close to the 524 Mbps you mention). Overheads will likely mean an actual throughput lower than that.</p><p>The terms "packets in flight" or "bytes in flight" are used to indicate the "sent but not yet ACKed" data. With no TCP Window Scaling, you can never have more than 64KB "in flight".</p><p>Clearly then, the RTT between your client and server and Window Scaling matters a lot in terms of throughput. For maximum throughput, you want the Receive Window to be large enough so that the sender can continuously transmit without having to stop and wait for ACKs. Hence, longer RTTs and larger bandwidths will need larger Receive Windows. You'll see the term "Bandwidth Delay Product" used as a measure of the window size needed to achieve maximum throughput for any given bandwidth and RTT.</p><p>Your Wireshark observation about the 64KB Window Size can't be relied on because we (and Wireshark) didn't get to see what the actual Window Scale was as specified in the 3-way handshake. That 64KB is an assumption made by Wireshark. However, you can display the "Bytes in Flight" value to show how much data was actually on the wire before ACKs were observed.</p><p>With one of your data packets highlighted in Wireshark, look in the "SEQ/ACK Analysis" portion of the "TCP Protocol" section of the Packet Details pane. Right-click on the "Bytes in flight" value and choose "Apply as Column". You will then be able to sort the column to find the largest value and get a hint as to your actual Transmit Window size. If you never see a value greater than 64KB, then perhaps TCP Window Scaling is not enabled for your connections.</p><p>Windows 2008 (and clients from Windows 7 onwards) should have Window Scaling enabled by default. Naturally, the most definitive method is to capture the SYN/SYN-ACKs.</p><p>Note that, due to any number of reasons, the sender may not always fill the Receive Window.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>20 Feb '17, 22:35</strong></p><img src="https://secure.gravatar.com/avatar/35a0c1d0cf15b9d54d73bf54ae28abcd?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Philst&#39;s gravatar image" /><p><span>Philst</span><br />
<span class="score" title="431 reputation points">431</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="16 badges"><span class="bronze">●</span><span class="badgecount">16</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Philst has 6 accepted answers">27%</span></p></div></div><div id="comments-container-59575" class="comments-container"></div><div id="comment-tools-59575" class="comment-tools"></div><div class="clear"></div><div id="comment-59575-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

