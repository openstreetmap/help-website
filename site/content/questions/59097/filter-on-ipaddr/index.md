+++
type = "question"
title = "Filter on ip.addr"
description = '''Hi, New user, lost in filters. I have some hardware connected to the internet. The hardware is sending out an NTP request and is certainly getting a response because the time stamp is correct. But I can&#x27;t find the packets in the WireShark capture. My hardware is at 192.168.1.86. I thought I could ju...'''
date = "2017-01-26T23:40:00Z"
lastmod = "2017-01-31T11:36:00Z"
weight = 59097
keywords = [ "filters" ]
aliases = [ "/questions/59097" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Filter on ip.addr](/questions/59097/filter-on-ipaddr)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-59097-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>New user, lost in filters. I have some hardware connected to the internet. The hardware is sending out an NTP request and is certainly getting a response because the time stamp is correct. But I can't find the packets in the WireShark capture.</p><p>My hardware is at 192.168.1.86. I thought I could just set a filter of ip.addr==192.168.1.86. I do see a broadcast to the board and a UDP reply, plus MDNS packets, but nothing that would be going to the NTP server. I have debug messages coming out of the hardware so I know the NTP request is going out.</p><p>What am I missing?</p><p>More details: I posted a related question a couple of months ago about capturing WiFi packets. I was told then that WiFi didn't work under Windows. The hardware is still WiFi (only). I am connecting to it through a WiFi access point. It's address is .89. The access point connects to a hub which then connects to a 2Wire router to the internet. The PC running WireShark is connected to the same hub as the access point and the router. So it seems to me that every packet going into or out of access point should be visible to WireShark. But either that's not true or I still am not filtering correctly.</p><p>Any ideas that can get me jump-started?</p><p>Thanks,</p><p>Dave</p></div><div id="question-tags" class="tags-container tags">filters</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>26 Jan '17, 23:40</strong></p><img src="https://secure.gravatar.com/avatar/9b50f067a8dd279d975863e3d08e20d6?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="djw&#39;s gravatar image" /><p>djw<br />
<span class="score" title="31 reputation points">31</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="djw has one accepted answer">100%</span></p></div></div><div id="comments-container-59097" class="comments-container"><span id="59100"></span><div id="comment-59100" class="comment"><div id="post-59100-score" class="comment-score"></div><div class="comment-text"><p>is that the only network interface in your system?.</p><p>Have you tried to force the ntp update meanwhile you're capturing traffic?</p></div><div id="comment-59100-info" class="comment-info"><span class="comment-age">(27 Jan '17, 00:13)</span> csigueros</div></div><span id="59104"></span><div id="comment-59104" class="comment"><div id="post-59104-score" class="comment-score"></div><div class="comment-text"><p>"The access point connects to a hub.. " I doubt you have a true hub, since you seem to only capture broadcast and multicast traffic. Get a switch with a real monitor port instead. See the wiki for more details.</p></div><div id="comment-59104-info" class="comment-info"><span class="comment-age">(27 Jan '17, 02:02)</span> Jaap ♦</div></div><span id="59123"></span><div id="comment-59123" class="comment"><div id="post-59123-score" class="comment-score"></div><div class="comment-text"><p>My expertise is in embedded systems, not networks. THANKS for the help!</p><p>After booting the embedded side, it connects to my WiFi access point, then connects to an NTP server and gets a new time stamp. It then waits 10 minutes and tries to get a new NTP time stamp. This always fails and it retries forever. This is the actual problem I'm trying to capture with WireShark.</p><p>Yes, I don't have a hub. But I did buy and install a new Netgear GS108Ev3. It's an 8 port switch with mirroring capability.</p><p>Let me explain my network. Cable box with internal hub and WiFi. Ethernet to other switches and devices, wired and wireless. Ethernet to the new Netgear switch. That switch connected only to a WiFi access point which my embedded hardware connects to, and a wire to my PC running WireShark. Nothing else is on the new switch. My understanding (wrong?) is by isolating the embedded hardware WiFi to the access point, and the access point to the switch (to the cable box), with mirroring on the access point, I'd be able to see what the embedded hardware is sending/receiving from the access point.</p><p>My access point is plugged into port 6, my PC running WireShark in port 4, and port 1 plugged into my cable box hub. I also created virtual LANs on the switch, 1 on ports 1-4 and 2 on ports 5-8. I did this because I ran the tests below and it didn't work, so I created the virtual LANs to make sure that the mirrored port wasn't somehow interfering with the port to my access point.</p><p>Without mirroring, I can boot my WiFi board. It goes through the initialization process and then goes to the NTP server and gets a time stamp, then fails 10 minutes later.</p><p>If I have mirroring turned on, source port = 6, destination port = 4 and then I boot my WiFi board, it never resolves the pool.ntp.org address. It keeps failing, waiting a while, then retrying.</p><p>If I don't mirror, I can get the first time stamp, as above. If after getting that first time stamp, I then turn on mirroring of port 6 to port 4, after 10 minutes it fails to connect to the NTP server. At this point, I can't tell if this is the same problem I've been chasing where it doesn't re-connect after 10 minutes, or if this is the problem where turning on mirroring kills the interface to the NTP server. I suspect somehow turning on mirroring is killing the interface to the internet since it doesn't work to begin with with mirroring turned on.</p><p>Any suggestions would be tremendously appreciated.</p><p>Thanks!</p><p>Dave</p></div><div id="comment-59123-info" class="comment-info"><span class="comment-age">(28 Jan '17, 14:41)</span> djw</div></div><span id="59146"></span><div id="comment-59146" class="comment not_top_scorer"><div id="post-59146-score" class="comment-score"></div><div class="comment-text"><p>Are you using a WiFi router or a WiFi Access Point?</p><p>There is a difference. The router can change the IP address of connected devices whereas the Access Point will not.</p><p>What if you do not put any filters on your interface? Do you see ingress and egress traffic to/from your embedded device?</p></div><div id="comment-59146-info" class="comment-info"><span class="comment-age">(30 Jan '17, 06:12)</span> Amato_C</div></div><span id="59154"></span><div id="comment-59154" class="comment not_top_scorer"><div id="post-59154-score" class="comment-score"></div><div class="comment-text"><p>I correctly stated it's an access point. It's configured correctly and connected to my cable router as an access point. I can connect via WiFi to either my cable box or the AP and everything works fine.</p><p>Yes, I do see a UDP packet from my hardware to 192.168.1.255 right after an ARP. Then I see a dozen or so MDNS packets. (What are these??? Seems like a security issue when my hardware (TCP stack from Microchip) is sending packets to 224.0.0.251.)</p><p>What I don't see are any other packets to/from my hardware. And I do see a lot of other packets to/from other devices and the AP.</p><p>Thanks,</p><p>Dave</p></div><div id="comment-59154-info" class="comment-info"><span class="comment-age">(30 Jan '17, 09:58)</span> djw</div></div><span id="59155"></span><div id="comment-59155" class="comment not_top_scorer"><div id="post-59155-score" class="comment-score"></div><div class="comment-text"><p>mDNS = multicast Domain Name System, <a href="https://en.wikipedia.org/wiki/Multicast_DNS">https://en.wikipedia.org/wiki/Multicast_DNS</a></p><p>What is interesting here is that you are only capturing multicast and broadcast packets.</p><p>Multicast packets have an IP address that begin with 224 or 223.</p><p>Broadcast addresses for a network segment end with 255 = in your case 192.168.1.255 You might also see IP addresses with all 1's (255.255.255.255)</p><p>Do you see any unicast traffic? That is, any addresses not listed above. For example, you should see traffic with a source (or destination address) with 192.168.1.x, where x is not 255</p><p>Try removing the VLAN's and provide feedback. If you still do not see any unicast traffic, then your switch is not mirroring traffic or your network interface on the Wireshark computer is not configured for promiscuous mode. <a href="https://wiki.wireshark.org/CaptureSetup/Ethernet">https://wiki.wireshark.org/CaptureSetup/Ethernet</a></p></div><div id="comment-59155-info" class="comment-info"><span class="comment-age">(30 Jan '17, 10:34)</span> Amato_C</div></div><span id="59157"></span><div id="comment-59157" class="comment"><div id="post-59157-score" class="comment-score">1</div><div class="comment-text"><p>Can you ping pool.ntp.org from your DUT (Device Under Test)?</p><p>Is the following diagram, created with the help of <a href="http://asciiflow.com/">asciiflow</a>, representative of your setup? If so, is WAP performing NAT?</p><pre><code>                                                      &lt;==========&gt;
                                                    +              +
                                                    |              |
                        +-----------------+     +-------+      +-------+
                        |    GS108Ev3     |     |       |      |       |
                        |                 |     |  WAP  |      |  DUT  |
                        | 1        4   6* |     |       |      |       |
                        +-^--------^---^--+     +----^--+      +-------+
                          |        |   |             |       192.168.1.86
                          |        |   +------?------+
                          |        |
                +---------v-+    +-v---------+
                |   Cable   |    |           |
Internet &lt;------+   Box     |    | Wireshark |   *Port 6 mirrored to Port 4.
                |           |    |           |
                +-----------+    +-----------+</code></pre><p>What do you see if you filter for ntp traffic, i.e., "udp port 123"?</p></div><div id="comment-59157-info" class="comment-info"><span class="comment-age">(30 Jan '17, 10:46)</span> cmaynard ♦♦</div></div><span id="59158"></span><div id="comment-59158" class="comment"><div id="post-59158-score" class="comment-score">1</div><div class="comment-text"><p>@cmaynard thanks for the link of the asciitool!</p></div><div id="comment-59158-info" class="comment-info"><span class="comment-age">(30 Jan '17, 11:08)</span> Christian_R</div></div><span id="59159"></span><div id="comment-59159" class="comment not_top_scorer"><div id="post-59159-score" class="comment-score"></div><div class="comment-text"><p>This site is weird. There was a comment from Amato_C, and my response, both now gone. ???</p><p>Yes, it's a real AP, configured properly with WiFi networks avaiable and working on other PCs.</p><p>cmaynard: Yes, your picture is accurate. (and I too thank you for the link) I see a ARP with the MAC address of my hardware, followed by a UDP from it, and then a bunch of MSDN packets. Nothing else. that's with ip.addr==192.168.1.86.</p><p>I see lots of packets to/from my AP, .89.</p><p>I see nothing with udp.port==123 which is weird because I know I'm hitting the NTP server once because I get a valid time stamp in debug statements from my hardware.</p><p>Yes, I can ping pool.ntp.org from anywhere else.</p><p>Those symptoms make me think I'm somehow using WireShark wrong.</p><p>???</p><p>Thanks,</p><p>Dave</p></div><div id="comment-59159-info" class="comment-info"><span class="comment-age">(30 Jan '17, 11:24)</span> djw</div></div><span id="59160"></span><div id="comment-59160" class="comment not_top_scorer"><div id="post-59160-score" class="comment-score"></div><div class="comment-text"><p>I believe all comments are still here, but you need to click the button that reads, "show &lt;n&gt; more comments".to view them all.</p></div><div id="comment-59160-info" class="comment-info"><span class="comment-age">(30 Jan '17, 11:44)</span> cmaynard ♦♦</div></div><span id="59161"></span><div id="comment-59161" class="comment not_top_scorer"><div id="post-59161-score" class="comment-score"></div><div class="comment-text"><p>Is your GS108Ev3 running latest firmware version? Currently this is 2.00.09.</p><p>Are you able to capture packets directly on the DUT using cli tools like <a href="http://www.tcpdump.org/tcpdump_man.html"><code>tcpdump</code></a>, <a href="https://www.wireshark.org/docs/man-pages/dumpcap.html"><code>dumpcap</code></a> or <a href="https://www.wireshark.org/docs/man-pages/tshark.html"><code>tshark</code></a>?</p></div><div id="comment-59161-info" class="comment-info"><span class="comment-age">(30 Jan '17, 11:57)</span> cmaynard ♦♦</div></div><span id="59164"></span><div id="comment-59164" class="comment not_top_scorer"><div id="post-59164-score" class="comment-score"></div><div class="comment-text"><p>Yes, show more helps, as well as looking at a browser window that isn't stale.</p><p>I have just upgraded to the latest firmware, same symptoms.</p><p>Sorry, you've just overloaded my brain with tools I don't know about. All I have (that I know about) on my embedded hardware are some debug statements built into the TCP and SNTP stack. Here are a couple lines from the debug:</p><p>SNTP solving IPv4 DNS: pool.ntp.org, time: 9 SNTP State: 3 - dns_solved, time: 9 SNTP solved DNS: pool.ntp.org, address: 132.163.4.102, time: 10 SNTP State: 4 - send, time: 10 SNTP State: 5 - recv, time: 11 SNTP State 6 - s_wait, time: 11 SNTP new TStamp: 1485822277, time: 11</p><p>That time stamp translates to 1/30/17 16:24:37 which is the time I ran this test. So it does look like my embedded hardware is getting to the NTP server at least once.</p><p>And again, I'm not able to see that on WireShark using the configuration I have, so it still appears I'm doing something wrong in WireShark.</p><p>Thanks,</p><p>Dave</p></div><div id="comment-59164-info" class="comment-info"><span class="comment-age">(30 Jan '17, 16:33)</span> djw</div></div><span id="59165"></span><div id="comment-59165" class="comment not_top_scorer"><div id="post-59165-score" class="comment-score"></div><div class="comment-text"><p>Oh yes, and that time stamp is fetched <em>only</em> if I don't mirror the port on the switch that is wired to the AP to the port on the switch of the PC running WireShark (and the switch configuration software).</p></div><div id="comment-59165-info" class="comment-info"><span class="comment-age">(30 Jan '17, 16:35)</span> djw</div></div><span id="59166"></span><div id="comment-59166" class="comment not_top_scorer"><div id="post-59166-score" class="comment-score"></div><div class="comment-text"><p>Sorry, now I'm completely lost. My network is the same as the drawing above, except I've turned off mirroring. From this PC, connected with WAP to my cable box, I can ping the new AP successfully. But I am <em>not</em> seeing this with Wireshark using a different PC wired to the switch as in the drawing above. So I am missing something really basic here. Though I do see a few packets to/from the AP in WireShark, I am not seeing the pings which I also know are getting there and back.</p></div><div id="comment-59166-info" class="comment-info"><span class="comment-age">(30 Jan '17, 16:53)</span> djw</div></div><span id="59177"></span><div id="comment-59177" class="comment not_top_scorer"><div id="post-59177-score" class="comment-score"></div><div class="comment-text"><p>Some more things to consider:</p><p>Capturing VLAN tagged traffic on Windows is a hit or miss situation at best. From all the text I can't make out if this is applicable.</p><p>Did you study, and understand all of <a href="https://wiki.wireshark.org/CaptureSetup/Ethernet">https://wiki.wireshark.org/CaptureSetup/Ethernet</a></p><p>Try to make your capture platform more isolated, remove all network stacks from the capture interface, but make sure it stays up. This to make it truly passive.</p></div><div id="comment-59177-info" class="comment-info"><span class="comment-age">(31 Jan '17, 02:04)</span> Jaap ♦</div></div><span id="59183"></span><div id="comment-59183" class="comment not_top_scorer"><div id="post-59183-score" class="comment-score"></div><div class="comment-text"><p><em>But I am not seeing this with Wireshark using a different PC wired to the switch as in the drawing above</em>. Did you configure port mirroring correctly? It sounds to me like you didn't if you're not seeing the traffic.</p></div><div id="comment-59183-info" class="comment-info"><span class="comment-age">(31 Jan '17, 08:43)</span> cmaynard ♦♦</div></div><span id="59185"></span><div id="comment-59185" class="comment not_top_scorer"><div id="post-59185-score" class="comment-score"></div><div class="comment-text"><p>This is my current configuration. At this time, there are no VLAN or mirror configurations enabled:</p><p>+---------------+ +-----------+ +-----------+ | | | | | | | cable | | | | access | | box |&lt;---&gt;| switch |&lt;---&gt;| point | | | | | | | | | | | | | +---------------+ +-----------+ +-----------+ ^ | v +-----------+ | | | PC | | | +-----------+</p><p>These are only the wired interfaces. Since the switch is between the AP and the cable box hub, and WiFi is not at all involved, I would expect to see traffic between my laptop over WiFi to the cable box (NOT the AP) when I ping the AP. I do not see this even though pings are successful. Obviously I'm doing something wrong.</p><p>Until I can see reasonable, known traffic on WireShark, I don't expect to see the traffic coming over WiFi to the AP.</p><p>Any other help?</p><p>Thanks!</p><p>Dave</p></div><div id="comment-59185-info" class="comment-info"><span class="comment-age">(31 Jan '17, 09:32)</span> djw</div></div><span id="59186"></span><div id="comment-59186" class="comment not_top_scorer"><div id="post-59186-score" class="comment-score"></div><div class="comment-text"><p>Sorry about the picture. I'm still new to this.</p><p>+----------+ +---------+ +---------+ | | | | | | | cable | | switch | | access | | box +----&gt; +----&gt; point | | | | | | | +----------+ +----^----+ +---------+ | | | +---+----+ | | | PC | | | | | +--------+</p></div><div id="comment-59186-info" class="comment-info"><span class="comment-age">(31 Jan '17, 09:38)</span> djw</div></div><span id="59187"></span><div id="comment-59187" class="comment not_top_scorer"><div id="post-59187-score" class="comment-score"></div><div class="comment-text"><p><em>I would expect to see traffic between my laptop over WiFi to the cable box (NOT the AP) when I ping the AP.</em></p><p>I don't understand what you're saying here. (And your diagram isn't much help either.) If your laptop is connected wirelessly to the AP and you ping the AP, then you won't see that traffic on the switch. I guess I'm missing something. Unless what you're saying is that the cable box is also acting as a wireless access point? But then what is the point of the AP? It's broadcasting a different wireless network?</p></div><div id="comment-59187-info" class="comment-info"><span class="comment-age">(31 Jan '17, 10:00)</span> cmaynard ♦♦</div></div></div><div id="comment-tools-59097" class="comment-tools"><span class="comments-showing"> showing 5 of 19 </span> <a href="#" class="show-all-comments-link">show 14 more comments</a></div><div class="clear"></div><div id="comment-59097-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="59190"></span>

<div id="answer-container-59190" class="answer accepted-answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-59190-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Success!</p><p>I wish I could say why it wasn't working. In the end, I decided to reset the switch to factory defaults. When I did that, it timed out. So I reset the switch and tried again. Same thing. So I reset again. I then connected my PC via WiFi in addition to the wire, using the old password installed before the factory default. That worked, indicating the factory default did not work.</p><p>And then I was able to capture data.</p><p>Apparently the switch was in a mode it wasn't happy with. Maybe when I turned VLAN on then off I should have rebooted? I don't know, and there's not enough in the switch manual to say.</p><p>Bottom line is, WireShark IS working and apparently I am capturing packets correctly now that the switch is working too.</p><p>I'll post again if I have anything else to add.</p><p>Thanks to all (ESPECIALLY cmaynard) for your help and patience.</p><p>Dave</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>31 Jan '17, 11:36</strong></p><img src="https://secure.gravatar.com/avatar/9b50f067a8dd279d975863e3d08e20d6?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="djw&#39;s gravatar image" /><p>djw<br />
<span class="score" title="31 reputation points">31</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="djw has one accepted answer">100%</span></p></div></div><div id="comments-container-59190" class="comments-container"><span id="59191"></span><div id="comment-59191" class="comment"><div id="post-59191-score" class="comment-score"></div><div class="comment-text"><p>Glad you got it working.</p><p>(I converted your comment to an answer, as it looks like restoring the factory defaults or simply resetting the Netgear GS108Ev3 was the solution.)</p></div><div id="comment-59191-info" class="comment-info"><span class="comment-age">(31 Jan '17, 11:42)</span> cmaynard ♦♦</div></div></div><div id="comment-tools-59190" class="comment-tools"></div><div class="clear"></div><div id="comment-59190-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

