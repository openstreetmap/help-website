+++
type = "question"
title = "RANAP : non searching indication paging failure"
description = '''Hello, I am currently facing an issue where the Core Network is sending two additional parameters while paging into m network. I dont know why but paging fails (the internal logs say that the UE is using type 2 paging). I suspect that this parameter is indirectly involved in this. Please suggest?'''
date = "2014-03-30T22:45:00Z"
lastmod = "2014-04-01T15:11:00Z"
weight = 31307
keywords = [ "ranap" ]
aliases = [ "/questions/31307" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [RANAP : non searching indication paging failure](/questions/31307/ranap-non-searching-indication-paging-failure)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-31307-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello,</p><p>I am currently facing an issue where the Core Network is sending two additional parameters while paging into m network. I dont know why but paging fails (the internal logs say that the UE is using type 2 paging). I suspect that this parameter is indirectly involved in this. Please suggest?</p></div><div id="question-tags" class="tags-container tags">ranap</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>30 Mar '14, 22:45</strong></p><img src="https://secure.gravatar.com/avatar/f838a328cdab742fd493824f6f1dfa83?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Balrog2486&#39;s gravatar image" /><p>Balrog2486<br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Balrog2486 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 06 Apr '14, 00:14</p></div></div><div id="comments-container-31307" class="comments-container"><span id="31337"></span><div id="comment-31337" class="comment"><div id="post-31337-score" class="comment-score"></div><div class="comment-text"><p>Can any body please suggest if paging is affected by this parameter or not?</p></div><div id="comment-31337-info" class="comment-info"><span class="comment-age">(01 Apr '14, 01:20)</span> Balrog2486</div></div></div><div id="comment-tools-31307" class="comment-tools"></div><div class="clear"></div><div id="comment-31307-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="31361"></span>

<div id="answer-container-31361" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-31361-score" class="post-score" title="current number of votes">1</div></div></td><td><div class="item-right"><div class="answer-body"><p>Can you post the RANAP packet capture to something like cloudshark (<a href="https://appliance.cloudshark.org/upload/">https://appliance.cloudshark.org/upload/</a> ) and post the link here?</p><p>What additional parameters are you seeing, specifically? When the page procedure fails, is there any error indication over the wire? Does the UE see the page request and respond to it? As for "type", at least in spec there's no such IE in a RANAP Page request. Also what vendor RNC is this that is giving you that log message?</p><p>Edit: Just reread this. The question is still a bit confusing but I think you're asking about one parameter specifically (non-searching indication), and its affect on paging, correct? If that is your question, then yes it definitely does affect paging logic.</p><p>Refer to the RANAP spec (25.413) for more details, but basically if 'non searching indication' is included and "search" is not set, it means the RNC shouldn't bother mapping the RRC connections to the Iu connections for the UE, so for the page procedure it should use the paging broadcast channel for the LAC/RAC rather than the existing RRC channel toward the given UE.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>01 Apr '14, 15:11</strong></p><img src="https://secure.gravatar.com/avatar/f533c5f20f9c9afbf4b03de08a100e11?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Quadratic&#39;s gravatar image" /><p>Quadratic<br />
<span class="score" title="1885 reputation points"><span>1.9k</span></span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="28 badges"><span class="bronze">●</span><span class="badgecount">28</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Quadratic has 23 accepted answers">13%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 02 Apr '14, 16:07</p></div></div><div id="comments-container-31361" class="comments-container"><span id="31446"></span><div id="comment-31446" class="comment"><div id="post-31446-score" class="comment-score"></div><div class="comment-text"><p>Thanks. That parameter has to to with paging coordination for the UE.</p><p>As a practical example, let's say you have a UE which has registered on both a GPRS Core (SGSN) and circuit-switch Core (MSC). If the RNC receives a page request for the UE from an SGSN, but the UE already has an active RRC connection to signal to the MSC, what is the most efficient thing for the RNC to do?</p><p>If there's no coordination between the two core networks by the RNC, it would have to page the whole routing area of NodeBs because the UE is in PMM-Idle mobility state and thus has no known cell to the SGSN, <em>even though</em> the RNC knows the serving cell because the UE has an active RRC connection for the MSC signaling.</p><p>To add efficiency here, the concept of a "Common ID" is used between core networks, which is basically just the IMSI (I have never seen it not be the IMSI, and even the 3GPP specs put IMSI in brackets for defining the Permanent NAS identifier for the UE). There's a dedicated exchange for sending the RNC this "Common ID".</p><p>Because the RNC has this permanent identifier, <em>if requested</em> as part of the page procedure by an SGSN or MSC, with "search" indicated in the "non-searching indication" IE, that tells the RNC that it can attempt to locate the UE based on whether or not it has an RRC connection at the time of the page. If it doesn't then it has no choice but to page the whole LA/RA, but if it does then it can identify the cell and prevent a redundant page procedure.</p><p>In your trace, an SGSN at 0-51-46 is paging two RNCs at DPC 0-52-84 and 0-51-70 for IMSI 286015215017435 in packets 491 and 493 (because both RNCs serve RA 1, which would be the last-known RA for the UE). In both cases, the SGSN is asking the RNCs to perform that search procedure, and associate any RRC connection for the same "Common ID" with this UE for the purpose of paging optimization.</p><p>Without NBAP or Uu control in the trace it's impossible to say why there was no response to the page requests, but I think you're looking at a red herring with that Common Id and Non-Searching Indication IE. Again, those are defined in the spec I'd sited before for RANAP signaling and they look normal to me.</p></div><div id="comment-31446-info" class="comment-info"><span class="comment-age">(02 Apr '14, 16:00)</span> Quadratic</div></div><span id="31500"></span><div id="comment-31500" class="comment"><div id="post-31500-score" class="comment-score"></div><div class="comment-text"><p>Ok, I think a few mobility management concepts are being confused here:</p><p>"PMM-Idle" is a state that a UE can be in toward an SGSN. This means basically that the UE is registered (and expected to send periodic routing area updates), but does not have a RAB in the PS Core. This is in contrast to "PMM-Connected" state where the SGSN knows the serving RNC of the UE (and consequently the UE has an RRC connection open).</p><p>The SGSN in your trace does not believe that the UE is "PMM-Connected", in the sense that it knows there is no RAB and it does not know the serving RNC (if there even is a serving RNC for the UE). It does, however, believe that the UE has a PDP Context.</p><p>Whether or not the UE has an "active" PDP Context is separate from whether or not it is in idle mode toward the SGSN. "Idle" refers to the UE's "GPRS Mobility Management" or "GMM" state (GPRS registration state toward the SGSN). For the main three mobile core types (CS, GPRS, EPS), you have the same logical divisions (MM/SM, GMM/GSM and EMM/ESM respectively).</p><p>So, for your scenario the SGSN's behaviour here is perfectly normal. After the Iu release (with the UE in PMM-Idle mode), the UE may still have a PDP Context and thus, from the perspective of an upstream GGSN it still has an IP address in a packet data network. If something in that network is trying to reach the UE (eg: a pushed email application, or an incoming SIP-based voice call), the SGSN will need to reestablish contact with the UE. Since the SGSN <em>does not know the serving RNC</em> when the UE is in PMM-Idle mode, it must initiate the page procedure.</p><p>That procedure should trigger the UE to send a Service Request message to the SGSN, after the RNC forwards the page and the UE receives it, either over an established RRC channel (because that non-search indication IE is set to search) or over the global paging channel by a nearby NodeB, which the UE should be listening for.</p><p>Does the RNC forward the page request to the NodeB's in RA 1 (in your example)? Does the UE get that page request? Does it send the service request? These are the questions you need to answer to solve this one.</p></div><div id="comment-31500-info" class="comment-info"><span class="comment-age">(03 Apr '14, 15:09)</span> Quadratic</div></div><span id="31501"></span><div id="comment-31501" class="comment"><div id="post-31501-score" class="comment-score"></div><div class="comment-text"><p>One other thing - The difference between type 1 and type 2 page procedures is transparent to the SGSN, and at a RANAP level the distinction is not drawn. The SGSN does not know whether an RRC connection exists or not for this UE toward another CN.</p><p>From your description, are you saying that the page is being sent on an old/expired RRC channel rather than the global paging channel toward the UE, when the UE is idle and without an active RRC connection? If so, that would pretty much have to be an RNC problem since "UTRAN paging co-ordination" is the responsibility of the RNC. The SGSN can ask the RNC to check whether there's a matching Common ID or not for any existing RRC connection (and your SGSN <em>is</em> asking your RNCs to do that, based on the non-searching indication IE), but the RNC is the one to say "yes, there's an RRC connection for that UE, I'll send on the RRC channel" or "no, there's no RRC connection with that Common ID, I'll send on the global paging channel".</p></div><div id="comment-31501-info" class="comment-info"><span class="comment-age">(03 Apr '14, 15:26)</span> Quadratic</div></div><span id="31528"></span><div id="comment-31528" class="comment"><div id="post-31528-score" class="comment-score"></div><div class="comment-text"><p>Hello,</p><p>Can you tell me if this analysis is correct from the Node B logs...</p><p>IMSI : 286015620628136</p><p>A PS Call is established initially mmgmm_nas_cs__establish_req_hdlr: started new zsession.</p><p>UE State is Read as IDLE:</p><p>RRC &lt;- MMGMM: RANAP_PAGING [IDLE] [PS] RRC &lt;- MMGMM: RANAP_PAGING [IDLE] [PS]</p><p>Signaling Connection Request for the UE is added :</p><p>handle_signalling_connection_request_add_to_sm_and_allow: Ueid=7120 maps to imsi=286015620628136 SC -&gt; RRC: RRC_SC_SIGNALLING_CONNECTION_RESPONSE [user 7120]</p><p>URNTI is calculated for the UE in Idle mode (which is incorrect as the UE is read as IDLE and requires a normal paging message) Calculated U-RNTI as B5333326 using CellID 0000006 and SRNC ID B53</p><p>This suggests that the UE is connected to the SGSN (through Active PDP or active RAB). So during paging the SGSN sends Search Indication to INC but that parameter is not actually forwarded to the FAP for unknown reasons and the UE reaches an invalid state.</p></div><div id="comment-31528-info" class="comment-info"><span class="comment-age">(04 Apr '14, 11:18)</span> Balrog2486</div></div><span id="31533"></span><div id="comment-31533" class="comment"><div id="post-31533-score" class="comment-score"></div><div class="comment-text"><p>No, the UE may have a PDP context but it does not have an active RAB to the SGSN. The SGSN is sending the page in order to have the UE initiate a "Service Request" to establish a new RAB.</p><p>The UE is where you need to really zoom in here. Does the UE receive the page request on an RRC channel or the global paging channel (looks like it's sent on an RRC connection)? If received on an RRC connection, does that RRC connection exist from the perspective of the UE?</p><p>The logs show the RRC connection was established from the NodeB's perspective and that the page was sent over it. If that's true, either the RRC channel existed (in which case, the UE is wrong to not receive the page and initiate a service request) or the channel did not exist (in which case the RNC incorrectly mapped the page request's Common ID to that of an existing RRC connection, indicating a bug or logic error on the RNC).</p><p>If this is happening in a small percentage of cases, it's possibly a timing issue caused by coverage, if the UE's RRC connection is up but the physical air interface is unable to communicate the page. That might explain the unstable state the UE is getting stuck in (the SGSN would also likely have the UE in an unstable GMM state due to this), but that would make this scenario relatively normal and probably not preventable. There will always be a small percentage of UEs in an unstable mobility management state due to these kinds of scenarios.</p></div><div id="comment-31533-info" class="comment-info"><span class="comment-age">(04 Apr '14, 14:51)</span> Quadratic</div></div><span id="31551"></span><div id="comment-31551" class="comment not_top_scorer"><div id="post-31551-score" class="comment-score"></div><div class="comment-text"><p>Thank you for all the help.</p><p>Maybe that is the reason why I can see RAB Release Request with Cause as User Inactivity and No Remaining RAB messages.</p><p>Also I was able to see the following in the RANAP trace which actually proves that the UE is in unstable state:</p><p>radioNetwork: radio-connection-with-UE-Lost (46)</p><p>I think this confirms that the UE lost connection at the time of Paging.</p><p>Thanks again but I think this will ocnfirm the problem.</p></div><div id="comment-31551-info" class="comment-info"><span class="comment-age">(05 Apr '14, 12:33)</span> Balrog2486</div></div></div><div id="comment-tools-31361" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-31361-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

