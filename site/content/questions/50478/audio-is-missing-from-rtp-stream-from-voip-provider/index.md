+++
type = "question"
title = "Audio is missing from RTP stream from VoIP provider"
description = '''Hi,  I have an issue where intermittently I am not receiving audio on incoming calls from a particular VoIP provider. When I analyse the pcap files, I see the RTP stream comes in and the stream is made up of 1200+ packets, but when I decode the stream there is no audio received from the SIP provider...'''
date = "2016-02-24T10:44:00Z"
lastmod = "2016-02-24T15:57:00Z"
weight = 50478
keywords = [ "udp", "rtp", "rtp.payload", "voip", "codecs" ]
aliases = [ "/questions/50478" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Audio is missing from RTP stream from VoIP provider](/questions/50478/audio-is-missing-from-rtp-stream-from-voip-provider)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-50478-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-50478-score" class="post-score" title="current number of votes">0</div><span id="post-50478-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>I have an issue where intermittently I am not receiving audio on incoming calls from a particular VoIP provider. When I analyse the pcap files, I see the RTP stream comes in and the stream is made up of 1200+ packets, but when I decode the stream there is no audio received from the SIP provider. This is the same across codecs and is not limited to one particular codec or caller. One thing that does remain the same though is this only ever happens with calls from customers that are using the same SIP trunk provider - but it is an intermittent issue.</p><p>My SIP provider is telling me this is a firewall issue on my side, but can that be the case? It is possible that my firewall is removing the audio from the RTP packets sporadically? I cannot see how this can be? Has anyone seen this before and is there any way I can determine what is going on here?</p><p>My SIP provider has requested I run a pcap from the WAN side but given my setup and the location of the PBX this is going to be a bit of a nightmare.</p><p>Thank you in advance.</p><p>Jonathan.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-udp" rel="tag" title="see questions tagged &#39;udp&#39;">udp</span> <span class="post-tag tag-link-rtp" rel="tag" title="see questions tagged &#39;rtp&#39;">rtp</span> <span class="post-tag tag-link-rtp.payload" rel="tag" title="see questions tagged &#39;rtp.payload&#39;">rtp.payload</span> <span class="post-tag tag-link-voip" rel="tag" title="see questions tagged &#39;voip&#39;">voip</span> <span class="post-tag tag-link-codecs" rel="tag" title="see questions tagged &#39;codecs&#39;">codecs</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>24 Feb '16, 10:44</strong></p><img src="https://secure.gravatar.com/avatar/8ac8aaabcf360cef154c972fb2a2292a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="jonathanbaird&#39;s gravatar image" /><p><span>jonathanbaird</span><br />
<span class="score" title="6 reputation points">6</span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="jonathanbaird has one accepted answer">50%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>24 Feb '16, 11:09</strong> </span></p></div></div><div id="comments-container-50478" class="comments-container"></div><div id="comment-tools-50478" class="comment-tools"></div><div class="clear"></div><div id="comment-50478-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="50480"></span>

<div id="answer-container-50480" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-50480-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-50480-score" class="post-score" title="current number of votes">0</div><span id="post-50480-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>It sounds weird for several reasons:</p><ul><li><p>it would be quite an unusual firewall processing to let RTP get through but rewrite the payload</p></li><li><p>as you wrote it happens only for calls coming from a particular SIP provider, which I understand is not your own one, such a hypothetical firewall policy would have to be applied either only to a particular source IP or subnet (so your own SIP provider would have to let the RTP flow to you directly from that remote SIP provider, which is unusual too) <em>or</em> to a particular codec, which would mean that such codec is used only for calls with customers of that remote SIP provider.</p></li></ul><p>Can you publish a capture of the "silent" RTP? A whole call including the SIP messages would be better but I can imagine there may be a privacy issue.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>24 Feb '16, 11:02</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span></p></div></div><div id="comments-container-50480" class="comments-container"><span id="50483"></span><div id="comment-50483" class="comment"><div id="post-50483-score" class="comment-score"></div><div class="comment-text"><p>Hi,</p><p>Thanks very much for your response. I agree with you, I cannot understand how the firewall is stripping the audio at all, but maybe I am overlooking something.</p><p>I cannot really publish this unfortunately due to the nature of the business from which the call originated. I have a pcap with 3 calls from the same company on. The first 2 calls we do not receive audio, however on the third call we do.</p><p>The fact that this only happens with calls from "SIP Provider A" to calls to us also using "SIP Provider A" surely points to an issue at their side - unless I am misunderstanding this.</p><p>Just out of interest, what part of the packet would the firewall have to modify to remove the audio from the RTP packets, would it be the payload?</p><p>Jonathan.</p></div><div id="comment-50483-info" class="comment-info"><span class="comment-age">(24 Feb '16, 11:43)</span> <span class="comment-user userinfo">jonathanbaird</span></div></div><span id="50484"></span><div id="comment-50484" class="comment"><div id="post-50484-score" class="comment-score"></div><div class="comment-text"><p>There are many things about which an RTP receiver may be (and should be!) sensitive about. So rewriting the payload may be the reason of the issue, but also the timestamps or ssrc may be broken, and it is also enough to change the "payload type number" so that it identifies another codec and the receiver then expects something else than it receives. Due to the nature of the individual codecs, PCMA and PCMU receivers usually translate any incompatible payload into a noise (sometimes a loud one!), while compressing codecs usually translate it into silence.</p><p>Actually, even timing may be the reason, most RTP receivers go mad if packets come in bursts rather than in regular intervals as they should.</p><p>If you could post about ten received RTP packets of a "good" call and ten of a bad call, and the SDP exchange for both as text (I don't care about calling and called numbers, so the SDP is enough, not the SIP packet carrying it), I might see what is wrong. One packet is not enough, more than ten are not necessary.</p><p>Do you know whether the remote (calling) party can hear what your colleagues say, or whether the silence is bi-directional?</p></div><div id="comment-50484-info" class="comment-info"><span class="comment-age">(24 Feb '16, 11:52)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="50489"></span><div id="comment-50489" class="comment"><div id="post-50489-score" class="comment-score"></div><div class="comment-text"><p>When you say you see the RTP packets, where are you capturing it specifically in relation to the firewall? Is it after the firewall saw the packet, or before?</p><p>Further, what is the configured logic of the firewall for VoIP? What I mean is, traditionally with VoIP you have the concept of firewall "ALG" or pinholing, where the system looks at SIP packets containing SDP and, based on that content, sets up RTP rules. If that is the case, and this issue is intermittent and following a particular SIP trunk provider, it could be that there is a logic error in the SIP ALG process on the firewall such that selective streams are not getting through. That is something which very much can happen.</p></div><div id="comment-50489-info" class="comment-info"><span class="comment-age">(24 Feb '16, 14:10)</span> <span class="comment-user userinfo">Quadratic</span></div></div><span id="50491"></span><div id="comment-50491" class="comment"><div id="post-50491-score" class="comment-score"></div><div class="comment-text"><p><span>@Quadratic</span>, I've got a bit of hands on experience with <span>@jonathanbaird</span>'s capture in the meantime.</p><p>The affected RTP streams do get through jonathanbaird's firewall normally (so no payload <em>type</em> policing applied) and the <em>local</em> SIP provider sends all RTP streams from just two source IPs which means he does some kind of media proxying. I.e. these two source IPs are not specific for the <em>remote</em> SIP provider which is the only source of the silent RTP streams.</p><p>The payload of a silent stream is a "digital silence", i.e. in case of PCMA, all <code>d5</code> bytes without a single exception, while ssrc, seqno, RTP timestamps and frame timestamps (~ physical timing) are fine. So should jonathanbaird's firewall be guilty, it would have to:</p><ul><li><p>be capable of rewriting the payload by a proper silence pattern for a given codec (an odd functionality already), and</p></li><li><p>either do so intentionally for particular stream sources, but that cannot be the case because from the firewall's perspective, the source of affected and unaffected streams is the same,</p></li><li><p>or do so by mistake for randomly chosen streams, but that also cannot be the case because only streams coming from a single particular <em>remote</em> SIP provider are ever affected. So the choice would have to be random and systematic simultaneously which doesn't make sense.</p></li></ul><p>So my conclusion is that something is broken at the interconnection path between the two SIP providers.</p><p>But I do agree with you that too many ALGs turn out to be headache sources sooner or later :-)</p></div><div id="comment-50491-info" class="comment-info"><span class="comment-age">(24 Feb '16, 15:04)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="50492"></span><div id="comment-50492" class="comment"><div id="post-50492-score" class="comment-score"></div><div class="comment-text"><p>Understood. From that I'd agree, I know of no firewall capable of doing that.</p></div><div id="comment-50492-info" class="comment-info"><span class="comment-age">(24 Feb '16, 15:57)</span> <span class="comment-user userinfo">Quadratic</span></div></div></div><div id="comment-tools-50480" class="comment-tools"></div><div class="clear"></div><div id="comment-50480-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

