+++
type = "question"
title = "mac capture monitor-mode"
description = '''I have a network, which has 2 nodes (a phone, a MacBook) both are connected to same wireless network, I know the SSID and password for the wireless network password: mypassword ssid: myssid security: WPA2 Personal  I am currently running Wireshark on MacBook with following settings: Edit &amp;gt; Prefer...'''
date = "2015-02-27T10:59:00Z"
lastmod = "2015-03-05T11:00:00Z"
weight = 40138
keywords = [ "wireless", "sniffing", "monitor-mode", "wireshark" ]
aliases = [ "/questions/40138" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [mac capture monitor-mode](/questions/40138/mac-capture-monitor-mode)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40138-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40138-score" class="post-score" title="current number of votes">0</div><span id="post-40138-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I have a network, which has 2 nodes (a phone, a MacBook) both are connected to same wireless network, I know the SSID and password for the wireless network</p><pre><code>password: mypassword
ssid: myssid
security: WPA2 Personal</code></pre><p>I am currently running Wireshark on MacBook with following settings:</p><p><code>Edit &gt; Preference &gt; Capture &gt; Interfaces &gt; Edit</code></p><pre><code>default buffer size `2048MiB`
default link layer header type: 802.11
monitor mode: checked</code></pre><p><img src="http://i.imgur.com/a5iZw9d.png" /></p><p>and to decrypt traffic under</p><p><code>Edit &gt; Preference &gt; Protocols &gt; IEEE 802.11</code></p><pre><code>Reassemble fragmented 802.11 datagram packets: checked
ignore vendor specific HT elements: unchecked
call subredisetor for retransmitted 802.11 frames: checked
assume packets have FCS: unchecked
Ignore the protection bit: Yes with IV
Enable decryption: checked
decryption keys: 
     key type: wpa-pwd
     key: mypassword:myssid</code></pre><p><img src="http://i.imgur.com/87kpia3.png" /></p><p>I start it in capture mode: I make a http call to foobar.com from my phone, and I expected wireshark to pick it up and display in sniffed data, I don't see it there.</p><p>However, if I make same HTTP call to foobar.com from my mac, I can see it being listed.</p><p><strong>Edit:</strong></p><p>After that I see EAPOL handshake captured</p><p><img src="http://i.stack.imgur.com/8MYVf.png" alt="enter image description here" /></p><p>but still it is not able to decrypt packets captured for that source (Lg_Electr_41), also attached protocol preference</p><p><img src="http://i.stack.imgur.com/mJDbU.png" alt="enter image description here" /></p><p>good capture of EAPOL</p><p><img src="https://osqa-ask.wireshark.org/upfiles/Screen_Shot_2015-03-01_at_9.23.43_PM_UwS84kt.png" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-wireless" rel="tag" title="see questions tagged &#39;wireless&#39;">wireless</span> <span class="post-tag tag-link-sniffing" rel="tag" title="see questions tagged &#39;sniffing&#39;">sniffing</span> <span class="post-tag tag-link-monitor-mode" rel="tag" title="see questions tagged &#39;monitor-mode&#39;">monitor-mode</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 Feb '15, 10:59</strong></p><img src="https://secure.gravatar.com/avatar/949c0d7b65a57fcf78b7d0116898c18f?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="annonymous&#39;s gravatar image" /><p><span>annonymous</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="annonymous has no accepted answers">0%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>01 Mar '15, 21:34</strong> </span></p></div></div><div id="comments-container-40138" class="comments-container"></div><div id="comment-tools-40138" class="comment-tools"></div><div class="clear"></div><div id="comment-40138-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="40162"></span>

<div id="answer-container-40162" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40162-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40162-score" class="post-score" title="current number of votes">1</div><span id="post-40162-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="annonymous has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Could it be that you forget to disconnect the phone after you started Wireshark? Wireshark can only decrypt the traffic of any other device in the wireless network if Wireshark could sniff the EAPOL packets of this device. In the eapol packets the session key of the device (your phone e.g.) and the AP is handled. If your phone is connected with the AP and then you start Wireshark after, there is no way to read the traffic you will only be able to capture the raw and encrypted packets.</p><p>So if this was the case (that no eapol packets were sniffed), disconnect your phone, start wireshark, connect your phone to the AP, look if Wireshark got the 4 eapol packets (you can filter them), and only then you can read the traffic of your phone.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>28 Feb '15, 23:34</strong></p><img src="https://secure.gravatar.com/avatar/932f872b04b352a8f3d81288805f08be?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="franc&#39;s gravatar image" /><p><span>franc</span><br />
<span class="score" title="96 reputation points">96</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="9 badges"><span class="bronze">●</span><span class="badgecount">9</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="franc has 2 accepted answers">40%</span></p></img></div></div><div id="comments-container-40162" class="comments-container"><span id="40168"></span><div id="comment-40168" class="comment not_top_scorer"><div id="post-40168-score" class="comment-score"></div><div class="comment-text"><p>Thanks for your reply franc, I was able to capture EAPOL packets, still it is not able to decrypt rest of the packets, please see edit in question</p></div><div id="comment-40168-info" class="comment-info"><span class="comment-age">(01 Mar '15, 15:26)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40169"></span><div id="comment-40169" class="comment"><div id="post-40169-score" class="comment-score">1</div><div class="comment-text"><p>Did you see all 4 EAPOL Handshake packets? Also the "Malformed Packet" irritates me.</p></div><div id="comment-40169-info" class="comment-info"><span class="comment-age">(01 Mar '15, 16:14)</span> <span class="comment-user userinfo">franc</span></div></div><span id="40170"></span><div id="comment-40170" class="comment not_top_scorer"><div id="post-40170-score" class="comment-score"></div><div class="comment-text"><p>Yes I saw 5 one of them was malformed, it was able to capture all 4 good packets</p></div><div id="comment-40170-info" class="comment-info"><span class="comment-age">(01 Mar '15, 19:11)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40171"></span><div id="comment-40171" class="comment"><div id="post-40171-score" class="comment-score">1</div><div class="comment-text"><p>In monitor mode, even packets with a bad FCS are handed to the host, and perhaps one of the EAPOL packets was damaged by the microwave oven or something such as that. :-) If the malformed packet shows a bad FCS, that's probably what happened.</p></div><div id="comment-40171-info" class="comment-info"><span class="comment-age">(01 Mar '15, 20:18)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40172"></span><div id="comment-40172" class="comment not_top_scorer"><div id="post-40172-score" class="comment-score"></div><div class="comment-text"><p><span></span><span>@Guy</span> Thanks a lot for your help across stackexchange and in here - You are the man, This time I turned off microwave, also asked neighbors to turned off theirs ;) - recaptured EAPOL and updated screenshots</p></div><div id="comment-40172-info" class="comment-info"><span class="comment-age">(01 Mar '15, 21:27)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40187"></span><div id="comment-40187" class="comment not_top_scorer"><div id="post-40187-score" class="comment-score"></div><div class="comment-text"><p><span></span><span>@Guy</span> I verified on different network, it works there with same setup, only thing I see difference is security type is : wpa2 psk, and in the network where I was trying it was: WPA2 Personal, reported by client, not sure what is the difference and does it actually help</p></div><div id="comment-40187-info" class="comment-info"><span class="comment-age">(02 Mar '15, 12:09)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40188"></span><div id="comment-40188" class="comment"><div id="post-40188-score" class="comment-score">1</div><div class="comment-text"><p>In your edited screenshot I only see one eapol: "Message 1 of 4" but not the rest of the four neccessary eapol packets. Means that you need 1 of 4, 2 of 4, 3 of 4 and 4 of 4 to have captured all needed eapol packets. Thats how it shows in my wireshark on my mac, if i successfully capture the eapol.</p></div><div id="comment-40188-info" class="comment-info"><span class="comment-age">(02 Mar '15, 12:17)</span> <span class="comment-user userinfo">franc</span></div></div><span id="40189"></span><div id="comment-40189" class="comment"><div id="post-40189-score" class="comment-score">1</div><div class="comment-text"><p>At least according to the Wikipedia, <a href="https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access#Target_users_.28authentication_key_distribution.29">WPA-Personal and WPA-PSK are the same thing</a>.</p></div><div id="comment-40189-info" class="comment-info"><span class="comment-age">(02 Mar '15, 12:21)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40193"></span><div id="comment-40193" class="comment not_top_scorer"><div id="post-40193-score" class="comment-score"></div><div class="comment-text"><p><span>@franc</span> I will try to capture it again and update here, thanks for your help Guy, franc, could you brief me about how EAPOL thing plays part in encryption between router and node ?</p></div><div id="comment-40193-info" class="comment-info"><span class="comment-age">(02 Mar '15, 13:50)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40194"></span><div id="comment-40194" class="comment"><div id="post-40194-score" class="comment-score">1</div><div class="comment-text"><p>This is maybe a good explanation: <a href="http://en.wikipedia.org/wiki/IEEE_802.1X#Typical_authentication_progression">http://en.wikipedia.org/wiki/IEEE_802.1X#Typical_authentication_progression</a></p></div><div id="comment-40194-info" class="comment-info"><span class="comment-age">(02 Mar '15, 15:42)</span> <span class="comment-user userinfo">franc</span></div></div><span id="40195"></span><div id="comment-40195" class="comment not_top_scorer"><div id="post-40195-score" class="comment-score">1</div><div class="comment-text"><p>And, for details on the 4-way EAPOL handshake, see <a href="https://tools.ietf.org/html/rfc4764">RFC 4764</a> - that's an RFC, so perhaps not as good a tutorial as you might like, so see also <a href="http://security.stackexchange.com/questions/17767/four-way-handshake-in-wpa-personal-wpa-psk">this StackExchange question and its answers</a>.</p></div><div id="comment-40195-info" class="comment-info"><span class="comment-age">(02 Mar '15, 16:02)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40199"></span><div id="comment-40199" class="comment not_top_scorer"><div id="post-40199-score" class="comment-score"></div><div class="comment-text"><p><span>@Guy</span> another difference I noted was, my phone gets connected to 2.4Ghz and my Mac gets connected over 5Ghz band, does it make difference ?</p></div><div id="comment-40199-info" class="comment-info"><span class="comment-age">(02 Mar '15, 22:24)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40200"></span><div id="comment-40200" class="comment not_top_scorer"><div id="post-40200-score" class="comment-score"></div><div class="comment-text"><p>forced phone to join 5Ghz and still it is not able to decrypt HTTP protocols, some of the packets sourced from phone are decrypted with protocol=SSDP and it is making HTTP request to some where (not to foobar.com), another difference noted was: phone was listed under mode : <code>802.11ac</code> in router's web console, and mac was listed under <code>802.11an</code>, both at 5Ghz</p></div><div id="comment-40200-info" class="comment-info"><span class="comment-age">(02 Mar '15, 23:01)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40232"></span><div id="comment-40232" class="comment not_top_scorer"><div id="post-40232-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>another difference I noted was, my phone gets connected to 2.4Ghz and my Mac gets connected over 5Ghz band, does it make difference</p></blockquote><p>Yes, just as if you tune your FM radio to 89.7 MHz, it's not going to play a radio station broadcasting at 94.1 MHz. A Wi-Fi adapter includes a radio, and it will only receive signals in the right frequency band. I don't know whether any Wi-Fi adapters exist that can receive on more than one band simultaneously, capturing packets on both the 2.4 GHz and the 5 GHz band.</p></div><div id="comment-40232-info" class="comment-info"><span class="comment-age">(03 Mar '15, 14:54)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40233"></span><div id="comment-40233" class="comment not_top_scorer"><div id="post-40233-score" class="comment-score"></div><div class="comment-text"><p>ok and do you think 802.11ac and 802.11an makes difference ?</p></div><div id="comment-40233-info" class="comment-info"><span class="comment-age">(03 Mar '15, 15:01)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40235"></span><div id="comment-40235" class="comment not_top_scorer"><div id="post-40235-score" class="comment-score"></div><div class="comment-text"><p>Don't force your phone to join the 5 GHz channel, but force your Mac to join the 2.4 Wifi Channels, let them both traffic under 2.4 GHz. Maybe Wireshark doesn't work well on the 5 GHz, but it is working on 2.4 GHz so test this first.</p></div><div id="comment-40235-info" class="comment-info"><span class="comment-age">(03 Mar '15, 15:04)</span> <span class="comment-user userinfo">franc</span></div></div><span id="40238"></span><div id="comment-40238" class="comment not_top_scorer"><div id="post-40238-score" class="comment-score">1</div><div class="comment-text"><p>Wireshark doesn't care about 2.4 GHz vs. 5 GHz, so that's not the issue.</p><p>However, the <em>adapter</em> may care about <a href="https://en.wikipedia.org/wiki/IEEE_802.11ac">802.11ac</a> vs. <a href="https://en.wikipedia.org/wiki/IEEE_802.11a-1999">802.11a</a>/<a href="https://en.wikipedia.org/wiki/IEEE_802.11n-2009">802.11n</a>. 802.11ac only operates in the 5 GHz band, as does 802.11a; 802.11n can operate in either the 2.4 GHz or 5 GHz band.</p><p>Hardware that supports 802.11n but not 802.11ac will not be able to receive any 802.11ac traffic and thus will not be able to sniff any 802.11ac traffic; I don't know whether your MacBook can support 802.11ac or not (according to <a href="https://en.wikipedia.org/wiki/MacBook_Pro">the Wikipedia MacBook Pro article</a>, 11ac support first showed up in October 2013, so earlier MacBook Pros wouldn't support it, and the <a href="https://en.wikipedia.org/wiki/MacBook_Air">MacBook Air article</a> indicates that 11ac support also showed up in mid-2013).</p><p>Switching to the 2.4 MHz band should, it appears, force the phone to use 802.11n, so that might allow the Mac to receive its traffic.</p></div><div id="comment-40238-info" class="comment-info"><span class="comment-age">(03 Mar '15, 16:04)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40240"></span><div id="comment-40240" class="comment not_top_scorer"><div id="post-40240-score" class="comment-score"></div><div class="comment-text"><p>I will give it a test from longer distance (to force mac use 2.4Ghz) and see if it switches to use <code>ac</code>, and update you guys soon, thank you so much again</p></div><div id="comment-40240-info" class="comment-info"><span class="comment-age">(03 Mar '15, 20:00)</span> <span class="comment-user userinfo">annonymous</span></div></div><span id="40243"></span><div id="comment-40243" class="comment not_top_scorer"><div id="post-40243-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>sorry i correcct it, mac book is on ac, phone is on an, both at 5 Ghz</p></blockquote><p>That comment appears to have disappeared, but, if it's true that the MacBook was on 802.11ac and the phone was on 802.11a/802.11n (there's no "802.11an"; "an" refers to 802.11a and 802.11n, the first of which uses only the 5 GHz band and the latter of which can use either the 2.4 GHz or the 5 GHz band), then the MacBook should be able to capture the phone's traffic as long as they're both using the same band and channel within that band.</p><p>If the <em>phone</em> was using ac and the <em>MacBook</em> was using a or n, then the MacBook probably wouldn't be able to capture the phone's traffic.</p></div><div id="comment-40243-info" class="comment-info"><span class="comment-age">(03 Mar '15, 21:41)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="40298"></span><div id="comment-40298" class="comment not_top_scorer"><div id="post-40298-score" class="comment-score"></div><div class="comment-text"><p>I couldn't force switch mac to use particular protocol, it is working on another network, I assume the culprit is only this protocol difference, I will mark it as accepted, Thanks a lot for your help <span>@Guy</span> <span>@franc</span></p></div><div id="comment-40298-info" class="comment-info"><span class="comment-age">(05 Mar '15, 11:00)</span> <span class="comment-user userinfo">annonymous</span></div></div></div><div id="comment-tools-40162" class="comment-tools"><span class="comments-showing"> showing 5 of 20 </span> <a href="#" class="show-all-comments-link">show 15 more comments</a></div><div class="clear"></div><div id="comment-40162-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

