+++
type = "question"
title = "Get value of the field in every protocol in frame"
description = '''Good day! May be somebody could explain me how to solve following problem: I have a set of fields. For example F1,F2,F3,F4. And I have one frame in which there several protocols: SCTP MTP3 SCCP TCAP CAMEL And I want to search in every protocl the value of each field (F1,F2,F3,F4). If there is no suc...'''
date = "2015-08-20T23:25:00Z"
lastmod = "2015-08-20T23:25:00Z"
weight = 45287
keywords = [ "lua", "ss7", "dissector" ]
aliases = [ "/questions/45287" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Get value of the field in every protocol in frame](/questions/45287/get-value-of-the-field-in-every-protocol-in-frame)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-45287-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Good day!</p><p>May be somebody could explain me how to solve following problem:</p><p>I have a set of fields. For example F1,F2,F3,F4. And I have one frame in which there several protocols:</p><p>SCTP</p><p>MTP3</p><p>SCCP</p><p>TCAP</p><p>CAMEL</p><p>And I want to search in every protocl the value of each field (F1,F2,F3,F4). If there is no such field in protocl then get NULL for such field. In other words I want to have following result for my example:</p><pre><code>         F1 | F2  | F3  | F4</code></pre><p>SCTP | 123 | NIL | 433 | 609</p><p>MTP3 | NIL | 234 | 000 | NIL</p><p>SCCP | 234 | 123 | NIL | NIL</p><p>TCAP | 534 | NIL | NIL | NIL</p><p>CAMEL| 32 | 090 | 628 | 3435</p><p>Thanks for any help!</p></div><div id="question-tags" class="tags-container tags">lua ss7 dissector</div><div id="question-controls" class="post-controls"><div class="community-wiki">This question is marked "community wiki".</div></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>20 Aug '15, 23:25</strong></p><img src="https://secure.gravatar.com/avatar/2d7d6eacf9c502b9188b233cb3e1d8ff?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="domeno&#39;s gravatar image" /><p>domeno<br />
<span class="score" title="21 reputation points">21</span><span title="6 badges"><span class="badge1">●</span><span class="badgecount">6</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="11 badges"><span class="bronze">●</span><span class="badgecount">11</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="domeno has no accepted answers">0%</span></p></div></div><div id="comments-container-45287" class="comments-container"><span id="54872"></span><div id="comment-54872" class="comment"><div id="post-54872-score" class="comment-score"></div><div class="comment-text"><p>I'm afraid I don't understand exactly what you are asking. The SS7 protocol hierarchy is MTP3:SCCP:TCAP:CAMEL (let's leave aside SCTP for the moment). Can you provide an example of protocol fields which you expect to see in two of these protocols? Do you e.g. have in mind the source or destination point code in mtp3 and point code as calling or called address in SCCP?</p></div><div id="comment-54872-info" class="comment-info"><span class="comment-age">(16 Aug '16, 07:31)</span> sindy</div></div><span id="54907"></span><div id="comment-54907" class="comment"><div id="post-54907-score" class="comment-score"></div><div class="comment-text"><p>The main idea in this question was in following: In one frame in pcap file there are more then one chunk. Every chunk has identical structure of the protocols (MTP3 -&gt; SCCP -&gt; TCAP -&gt; CAMEL). For example we want to get in every chunk from protocol SCCP the following field: sccp.calling.digits. But in some chunks this field exists and in some chunks of the same frame this field does not exist. For example:</p><p>1 chunnk. sccp.calling.digits=123 2 chunnk. sccp.calling.digits does not exist 3 chunnk. sccp.calling.digits=789 4 chunnk. sccp.calling.digits does not exist</p><p>And I want to get the following result after the LUA script: 123 NULL 789 NULL</p></div><div id="comment-54907-info" class="comment-info"><span class="comment-age">(17 Aug '16, 03:52)</span> domeno</div></div><span id="54917"></span><div id="comment-54917" class="comment"><div id="post-54917-score" class="comment-score"></div><div class="comment-text"><p>OK. Put this way it is clear (at least to me), yet I am afraid that what you want to achieve is currently impossible. A lua post-dissector for the whole frame can be created but it cannot get any information about index of the individual PDUs in the frame, so if the first and third PDUs have got a field and the second and fourth haven't, the postdissector would just show two instances of that field but no indication in which PDU it has occurred, i.e. it would do the same what tshark does if you use <code>-E occurrence=a</code>.</p><p>So your <code>proxy</code> dissector might be the right place to insert such functionality - it would be registered instead of the original dissector and thus the lower layer dissector would call it for each PDU in the frame. The rough idea is that the <code>proxy</code> dissector would first call the original dissector, and then extract the fields the original one has created, and modify a list it would maintain for each of the fields in question according to the result. But implementing that is far from being easy, as each frame may be dissected several times.</p></div><div id="comment-54917-info" class="comment-info"><span class="comment-age">(17 Aug '16, 05:42)</span> sindy</div></div><span id="54921"></span><div id="comment-54921" class="comment"><div id="post-54921-score" class="comment-score"></div><div class="comment-text"><p>Using the exported PDU functionality and export at OSI level 4 you can dechunk the SCTP layer and then look at the resulting file.</p></div><div id="comment-54921-info" class="comment-info"><span class="comment-age">(17 Aug '16, 07:47)</span> Anders ♦</div></div><span id="54949"></span><div id="comment-54949" class="comment"><div id="post-54949-score" class="comment-score"></div><div class="comment-text"><p>I created proxy protocol to solve this problem. Yes the solution is not beautiful but solves my problem. Thanks!</p></div><div id="comment-54949-info" class="comment-info"><span class="comment-age">(18 Aug '16, 07:41)</span> domeno</div></div></div><div id="comment-tools-45287" class="comment-tools"></div><div class="clear"></div><div id="comment-45287-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

