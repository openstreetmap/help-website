+++
type = "question"
title = "merging captures with different Packet sizes"
description = '''Hi people, I have a capture from 2 endpoints. Dumpcap was running on both machines locally and one of the machines had TSO enabled so I see a lot of 9000 Packet lengths: In the other trace all offloading was disabled so I see 1460 everywhere. I was trying to merge both ends into one file and remove ...'''
date = "2015-06-28T13:24:00Z"
lastmod = "2015-06-29T00:38:00Z"
weight = 43639
keywords = [ "mergecap", "offload" ]
aliases = [ "/questions/43639" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [merging captures with different Packet sizes](/questions/43639/merging-captures-with-different-packet-sizes)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-43639-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-43639-score" class="post-score" title="current number of votes">0</div><span id="post-43639-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi people,</p><p>I have a capture from 2 endpoints. Dumpcap was running on both machines locally and one of the machines had TSO enabled so I see a lot of 9000 Packet lengths: In the other trace all offloading was disabled so I see 1460 everywhere.</p><p>I was trying to merge both ends into one file and remove the duplicates but editcap finds none (reasonably so I suppose) and i get a messy trace file with many false retransmissions etc. Is there a way around this or am I stuck with a: manually filtering the merged file or b: just opening wireshark 2 times and comparing by eye? Any help appreciated; the one packet out 7 ACKs back thing is driving me mad, especially when a packet gets lost...</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-mergecap" rel="tag" title="see questions tagged &#39;mergecap&#39;">mergecap</span> <span class="post-tag tag-link-offload" rel="tag" title="see questions tagged &#39;offload&#39;">offload</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>28 Jun '15, 13:24</strong></p><img src="https://secure.gravatar.com/avatar/05ba95262a3352e3af4ba69c0ec0dff2?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="DarrenWright&#39;s gravatar image" /><p><span>DarrenWright</span><br />
<span class="score" title="216 reputation points">216</span><span title="14 badges"><span class="badge1">●</span><span class="badgecount">14</span></span><span title="15 badges"><span class="silver">●</span><span class="badgecount">15</span></span><span title="20 badges"><span class="bronze">●</span><span class="badgecount">20</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="DarrenWright has 5 accepted answers">26%</span></p></div></div><div id="comments-container-43639" class="comments-container"><span id="43641"></span><div id="comment-43641" class="comment"><div id="post-43641-score" class="comment-score"></div><div class="comment-text"><p>Are they really "duplicates" though, considering they're completely different sizes? I mean the machine with the smaller ones might be missing a segment in the middle of other segments that comprise a single of the larger packets on the other machine. And the larger one is missing a lot of IP+TCP-layer header info of the smaller packet segments, which might or might not be important to the user. So the de-duplication logic would have to be pretty smart.</p><p>I think it would be better if mergecap let you specify that each file it's merging be stored as separate interfaces in pcapng file format - which supports distinguishing which of multiple interfaces a packet was on. That way they'd all be in the file but hopefully not considered duplicates. Of course that assumes wireshark won't detect "duplicates" across different interfaces as duplicates, but hopefully that's the case. (and if not, I'd consider it a bug, or at least reasonable to have an on/off setting for)</p><p>In theory, if your original captures were in pcapng format and were captured on different interface numbers, it should already correctly merge that information that today in the current mergecap version - so we could add a feature option to make mergecap explicitly do it just based on being different input files.</p><p>p.s. At last week's Sharkfest Robert Bullen presented a utility to remove duplicate packets, but I don't think that will help you because of the differing packet sizes due to TSO. (I didn't see Robert's presentation so I don't know that it won't address this use-case, but I'd be surprised if it did)</p></div><div id="comment-43641-info" class="comment-info"><span class="comment-age">(28 Jun '15, 15:14)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="43642"></span><div id="comment-43642" class="comment"><div id="post-43642-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Is there a way around this or am I stuck with a: manually filtering the merged file or b: just opening wireshark 2 times and comparing by eye?</p></blockquote><p>Well, that's the result if you capture on the host itself and you don't disable TCP offloading ;-) Depending on the kind of problem you are trying to solve, you can either disable TCP offloading on both sides or <strong>Follow TCP stream</strong> and compare the TCP stream data (not sure if that will help you).</p></div><div id="comment-43642-info" class="comment-info"><span class="comment-age">(28 Jun '15, 17:04)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="43651"></span><div id="comment-43651" class="comment"><div id="post-43651-score" class="comment-score"></div><div class="comment-text"><p>HI Kurt, Yeah: I kinda gave up explaining that to people. OFFLOAD BAD.. The problem is, as is so often the case, that explaining to someone that they need to change settings on their NIC usually lands against a wall. After a lot of coffee and tears in my eyes I managed to cut my way through it all and noticed something wierd with SACK being ignored. Noticed funnily enough that MrEeede just answered a different thread with possibly the answer I am looking for (SRE Keeps Increasing. Will have a look today; is just really hard to cut through the multiple ACKS to see what is happening.</p><p>It's just as it is, annoying, but not a problem of Merging / cleaning. Thanks.</p><p><span></span><span>@Hadriel</span>. Yeah, that was exactly the issue. and then SACK started playing around and the retransmissions were just killing the connection. The Mergecap explicit when it is seperate files, can that be a thing? :D</p></div><div id="comment-43651-info" class="comment-info"><span class="comment-age">(29 Jun '15, 00:38)</span> <span class="comment-user userinfo">DarrenWright</span></div></div></div><div id="comment-tools-43639" class="comment-tools"></div><div class="clear"></div><div id="comment-43639-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

