+++
type = "question"
title = "Webservice seems to pause in wireshark and then wake up and respond"
description = '''Our https webservice response time has gone from about 3 seconds to 16 seconds. Running wireshark (which I am new to so I can&#x27;t read efficiently but am trying) what I seem to see is that we get an encrypted handshake msg from our data vendor (no. 1231). We ack it in no. 1240. Then it almost seems th...'''
date = "2013-01-27T10:14:00Z"
lastmod = "2013-01-30T08:15:00Z"
weight = 17985
keywords = [ "pause", "webservice", "https", "wireshark" ]
aliases = [ "/questions/17985" ]
osqa_answers = 1
osqa_accepted = true
+++

<div class="headNormal">

# [Webservice seems to pause in wireshark and then wake up and respond](/questions/17985/webservice-seems-to-pause-in-wireshark-and-then-wake-up-and-respond)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17985-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17985-score" class="post-score" title="current number of votes">0</div><span id="post-17985-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Our https webservice response time has gone from about 3 seconds to 16 seconds. Running wireshark (which I am new to so I can't read efficiently but am trying) what I seem to see is that we get an encrypted handshake msg from our data vendor (no. 1231). We ack it in no. 1240. Then it almost seems that our webservice goes to sleep or something (don't know what), then about 15 seconds later it finally at no. 1486 sends the request to the data vendor (ACK PSH) and then all processing works fine as it should. I don't know why we are waiting 15 seconds before we send the request out to the data vendor. The only thing I really see happening in the intervening time is some communication with our database but doesn't look like date being transmitted just mostly keep alive communication. Any help in reading the wireshark capture for why we now have a long wait before sending the request to our datavendor would be greatly appreciated. Anyway to post the wireshark capture here? Or any suggestions at what to look at for why we wait? Thank you.</p><p>thank you. here is the url to the capture: <a href="http://www.cloudshark.org/captures/ba340820a9f4">http://www.cloudshark.org/captures/ba340820a9f4</a> note that 10.6.62.125 is our app server, 64.129.51.113 is our data vendor, database is 216.109.70.144</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-pause" rel="tag" title="see questions tagged &#39;pause&#39;">pause</span> <span class="post-tag tag-link-webservice" rel="tag" title="see questions tagged &#39;webservice&#39;">webservice</span> <span class="post-tag tag-link-https" rel="tag" title="see questions tagged &#39;https&#39;">https</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 Jan '13, 10:14</strong></p><img src="https://secure.gravatar.com/avatar/5a99095998f30a08ec58d7f6a5ece0f7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sgaf&#39;s gravatar image" /><p><span>sgaf</span><br />
<span class="score" title="21 reputation points">21</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sgaf has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>27 Jan '13, 12:41</strong> </span></p></div></div><div id="comments-container-17985" class="comments-container"><span id="17986"></span><div id="comment-17986" class="comment"><div id="post-17986-score" class="comment-score"></div><div class="comment-text"><p>If you can, please post it at <a href="http://www.cloudshark.org">http://www.cloudshark.org</a> and add the URL to your question - please make sure that you only post trace files that do not contain any sensitive data.</p></div><div id="comment-17986-info" class="comment-info"><span class="comment-age">(27 Jan '13, 11:16)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div></div><div id="comment-tools-17985" class="comment-tools"></div><div class="clear"></div><div id="comment-17985-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="17990"></span>

<div id="answer-container-17990" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17990-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17990-score" class="post-score" title="current number of votes">4</div><span id="post-17990-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span class="accept-answer on" rel="nofollow" title="sgaf has selected this answer as the correct answer"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I took a look at your trace and filtered on the session starting in frame 1218. You've read it correctly as far as I can tell - your app server takes about 15 seconds after it acked the handshake message before it continues to send data. Question is, why. So I marked frames 1240 and 1486 (last frame before the gap and first frame after), and cleared the filter to see what happens in between.</p><p>I guess you (or someone else) was logged into the app server using Microsoft terminal services, because there are a lot of packets on TCP port 3389. I ignored them by filtering them away with "<code>not tcp.port==3389</code>" and kept looking for other more interesting things. I tried to find connections that start after the first marked frame and finish just before the second, which would indicate that the app server has to do something else first before it can continue using the session to the data vendor.</p><p>I ended up with a filter like this: "<code>(ip.src==10.6.62.125 and tcp.flags==2) or frame.marked==1</code>". That would show me the two marked frames plus any syn coming from your app server. The only thing that shows up <strong>between</strong> the marked frames are three SYN packets to the same IP (192.143.241.184) that do not get answered at all. Filter on "<code>(ip.addr eq 10.6.62.125 and ip.addr eq 168.143.241.184)</code>") and you'll see there is nothing coming back.</p><p>Now for the interesting thing: the third unanswered SYN happens just 1.4 seconds before the TLS session to the data vendor finally continues, which is a bit too obvious to be a concidence. There is a pretty good chance that this failed connection attempts to 168.143.241.184 are what is holding up the TLS session, so here are your next steps:</p><ul><li>find out what that IP 168.143.241.184 does, and why your app server wants to connect to it</li><li>if it should do that, find out why it gets blocked. Three SYNs without a RST or SYN/ACK coming back usually means that there is a Firewall/Packet Filter blocking the SYN, maybe even a local firewall running on that node if someone forgot to open the port</li><li>if it shouldn't connect to that IP, get the app server fixed</li></ul></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 Jan '13, 16:26</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-17990" class="comments-container"><span id="17991"></span><div id="comment-17991" class="comment"><div id="post-17991-score" class="comment-score"></div><div class="comment-text"><p>(Nice analysis ...)</p></div><div id="comment-17991-info" class="comment-info"><span class="comment-age">(27 Jan '13, 16:34)</span> <span class="comment-user userinfo">Bill Meier ♦♦</span></div></div><span id="17992"></span><div id="comment-17992" class="comment"><div id="post-17992-score" class="comment-score"></div><div class="comment-text"><p>thank you :)</p></div><div id="comment-17992-info" class="comment-info"><span class="comment-age">(27 Jan '13, 17:31)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="17995"></span><div id="comment-17995" class="comment"><div id="post-17995-score" class="comment-score"></div><div class="comment-text"><p>Hi Jasper, thank you for your thorough analysis. That's great information. That IP address is not one we deal with and we shouldn't be connecting to. But to see if that solved the issue, I opened the firewall for port 80 and it brought down our response time to about where it should be. Each time I run it connects to a different ip address but always through port 80. Some of the various ips come back as deploy.akamaitechnologies.com. I don't know if that is something valid (say trying to validate the ssl certificate of our vendor) or something totally bogus. Thank you so much!!!</p></div><div id="comment-17995-info" class="comment-info"><span class="comment-age">(27 Jan '13, 19:01)</span> <span class="comment-user userinfo">sgaf</span></div></div><span id="17996"></span><div id="comment-17996" class="comment"><div id="post-17996-score" class="comment-score"></div><div class="comment-text"><p>Akamai is a provider that has a lot of different IP addresses as distributed access points to content someone hosts at their infrastructure, so if you see connections to various IPs it isn't suprising that much. Question is, what does the app server want from them? When you've opened the firewall you might want to take another capture to look at the information beining exchanged - since it's on port 80 it should be clear text. Maybe a certificate revocation list (crl) or something like that is checked.</p><p>Oh, and please accept my answer with the checkmark next to it to show that it helped ;-)</p></div><div id="comment-17996-info" class="comment-info"><span class="comment-age">(28 Jan '13, 01:03)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="18000"></span><div id="comment-18000" class="comment"><div id="post-18000-score" class="comment-score"></div><div class="comment-text"><p>I did another capture just need to analize it. Thanks again for your help.</p></div><div id="comment-18000-info" class="comment-info"><span class="comment-age">(28 Jan '13, 08:19)</span> <span class="comment-user userinfo">sgaf</span></div></div><span id="18056"></span><div id="comment-18056" class="comment not_top_scorer"><div id="post-18056-score" class="comment-score"></div><div class="comment-text"><p>Its doing a get of /msdownload/update/v3/static/trustedr/en/authrootstl.cab but not sure what certificate is out of date? Most of the information transferred is not readable.</p></div><div id="comment-18056-info" class="comment-info"><span class="comment-age">(29 Jan '13, 13:48)</span> <span class="comment-user userinfo">sgaf</span></div></div><span id="18061"></span><div id="comment-18061" class="comment not_top_scorer"><div id="post-18061-score" class="comment-score"></div><div class="comment-text"><p>As far as I can tell it is an update file for the list of root certificates, and it doesn't have to mean that the existing ones are out of date. Some applications just pull the latest list regularly to be sure to be up-to-date with it.</p></div><div id="comment-18061-info" class="comment-info"><span class="comment-age">(29 Jan '13, 16:21)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="18070"></span><div id="comment-18070" class="comment not_top_scorer"><div id="post-18070-score" class="comment-score"></div><div class="comment-text"><p>Who da man??? Jasper's da man! :)</p></div><div id="comment-18070-info" class="comment-info"><span class="comment-age">(29 Jan '13, 19:32)</span> <span class="comment-user userinfo">hansangb</span></div></div><span id="18071"></span><div id="comment-18071" class="comment not_top_scorer"><div id="post-18071-score" class="comment-score"></div><div class="comment-text"><p>Also, you can see things like this visually by using the "Statistics, Flow Graph" (thanks Sake!). You can see how the various connection start ups may be impacting your "real' connection. I presented this exact type of a problem in 2009's Sharkfest session (slow SSH Login). Maybe I'll do this as my next blog post!</p></div><div id="comment-18071-info" class="comment-info"><span class="comment-age">(29 Jan '13, 19:39)</span> <span class="comment-user userinfo">hansangb</span></div></div><span id="18105"></span><div id="comment-18105" class="comment not_top_scorer"><div id="post-18105-score" class="comment-score"></div><div class="comment-text"><p>Thx Hansang :)</p></div><div id="comment-18105-info" class="comment-info"><span class="comment-age">(30 Jan '13, 08:15)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div></div><div id="comment-tools-17990" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-17990-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

