+++
type = "question"
title = "TCP ZeroWindow"
description = '''Hi, i&#x27;m having some questions about the TCP ZeroWindow flag. According to my capture we have the following scene:  98408 16:55:40.447814 192.168.45.182 -&amp;gt; 192.168.45.178 TCP 8790 &amp;gt; 9112 [PSH, ACK] Seq=109220 Ack=136247 Win=118 Len=282 98411 16:55:40.627255 192.168.45.178 -&amp;gt; 192.168.45.182 T...'''
date = "2010-11-08T04:01:00Z"
lastmod = "2010-11-09T03:07:00Z"
weight = 849
keywords = [ "window", "zero", "tcp" ]
aliases = [ "/questions/849" ]
osqa_answers = 2
osqa_accepted = true
+++

<div class="headNormal">

# [TCP ZeroWindow](/questions/849/tcp-zerowindow)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-849-score" class="post-score" title="current number of votes">2</div><div id="favorite-count" class="favorite-count">2</div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, i'm having some questions about the TCP ZeroWindow flag. According to my capture we have the following scene:</p><blockquote><p>98408 16:55:40.447814 192.168.45.182 -&gt; 192.168.45.178 TCP 8790 &gt; 9112 [PSH, ACK] Seq=109220 Ack=136247 Win=118 Len=282</p><p>98411 16:55:40.627255 192.168.45.178 -&gt; 192.168.45.182 TCP 9112 &gt; 8790 [ACK] Seq=136247 Ack=109502 Win=64112 Len=118</p><p>98412 16:55:40.664670 192.168.45.182 -&gt; 192.168.45.178 TCP [TCP ZeroWindow] 8790 &gt; 9112 [PSH, ACK] Seq=109502 Ack=136365 Win=0 Len=165</p><p>98413 16:55:40.664694 192.168.45.182 -&gt; 192.168.63.6 TCP [TCP ZeroWindow] 8790 &gt; 9112 [PSH, ACK] Seq=109502 Ack=136365 Win=0 Len=165</p><p>98414 16:55:40.842944 192.168.63.6 -&gt; 192.168.45.182 TCP 9112 &gt; 8790 [ACK] Seq=136365 Ack=109667 Win=65535 Len=0</p></blockquote><p>The host 192.168.45.182 is the <strong>client</strong> and the host 192.168.45.178 is the <strong>server</strong>. One of my doubts is if the WIN in line 98412 is from client or from server.</p><p>The tcpguide web (<a href="http://www.tcpipguide.com/free/t_TCPWindowSizeAdjustmentandFlowControl.htm">http://www.tcpipguide.com/free/t_TCPWindowSizeAdjustmentandFlowControl.htm</a>) site tells that the send window to the client is the received window to the server. See the following text:</p><blockquote><p>We have seen the importance of the concept of window size to TCP's sliding window mechanism. In a connection between a client and a server, the client tells the server the number of bytes it is willing to receive at one time from the server; this is the client's receive window, which becomes the server's send window. Likewise, the server tells the client how many bytes of data it is willing to take from the client at one time; this is the server's receive window and the client's send window.</p></blockquote><p>And this picture even better explains the situation: <img src="http://www.tcpipguide.com/free/diagrams/tcpswflow.png" alt="alt text" /></p><p>But I'm still having doubts about the output of wireshark. Some one can explain me better?</p><p>Thank you very much.</p></div><div id="question-tags" class="tags-container tags">window zero tcp</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>08 Nov '10, 04:01</strong></p><img src="https://secure.gravatar.com/avatar/b00d762b1be6c2a2f5e33662101adac9?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Plinio%20Monteiro&#39;s gravatar image" /><p>Plinio Monteiro<br />
<span class="score" title="36 reputation points">36</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Plinio Monteiro has no accepted answers">0%</span></p></img></div></div><div id="comments-container-849" class="comments-container"></div><div id="comment-tools-849" class="comment-tools"></div><div class="clear"></div><div id="comment-849-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="850"></span>

<div id="answer-container-850" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-850-score" class="post-score" title="current number of votes">7</div></div></td><td><div class="item-right"><div class="answer-body"><p>OK, walk with me...</p><blockquote><p>98408 16:55:40.447814 192.168.45.182 -&gt; 192.168.45.178 TCP 8790 &gt; 9112 [PSH, ACK] Seq=109220 Ack=136247 Win=118 Len=282</p></blockquote><p>... the client sends 282 bytes to the server and also tells the server that it's receive buffer only has 118 bytes left...</p><blockquote><p>98411 16:55:40.627255 192.168.45.178 -&gt; 192.168.45.182 TCP 9112 &gt; 8790 [ACK] Seq=136247 Ack=109502 Win=64112 Len=118</p></blockquote><p>... the server sends 118 bytes (filling up the receive buffer of the client) and tells the client that it can still send 64112 bytes before it's receive buffer is full...</p><blockquote><p>98412 16:55:40.664670 192.168.45.182 -&gt; 192.168.45.178 TCP [TCP ZeroWindow] 8790 &gt; 9112 [PSH, ACK] Seq=109502 Ack=136365 Win=0 Len=165</p></blockquote><p>... the client sends 165 bytes to the server and also tells the server that it's receive buffer is now completely full so the server should stop sending data (until the application on the client fetches the data from the TCP receive buffer)...</p><blockquote><p>98413 16:55:40.664694 192.168.45.182 -&gt; 192.168.63.6 TCP [TCP ZeroWindow] 8790 &gt; 9112 [PSH, ACK] Seq=109502 Ack=136365 Win=0 Len=165</p></blockquote><p>... this looks like a natted version of the last packet???...</p><blockquote><p>98414 16:55:40.842944 192.168.63.6 -&gt; 192.168.45.182 TCP 9112 &gt; 8790 [ACK] Seq=136365 Ack=109667 Win=65535 Len=0</p></blockquote><p>... the server acknowledges the data that the client has sent, tells the client that the application has read some data from the TCP receive window so that there is now again room for 65535 more bytes. It also does <em>not</em> send data, as it has not received word from the client that some buffer space has been freed...</p><p>Does it make more sense like this?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Nov '10, 05:27</strong></p><img src="https://secure.gravatar.com/avatar/7901a94d8fdd1f9f47cda9a32fcfa177?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SYN-bit&#39;s gravatar image" /><p>SYN-bit ♦♦<br />
<span class="score" title="17094 reputation points"><span>17.1k</span></span><span title="9 badges"><span class="badge1">●</span><span class="badgecount">9</span></span><span title="57 badges"><span class="silver">●</span><span class="badgecount">57</span></span><span title="245 badges"><span class="bronze">●</span><span class="badgecount">245</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SYN-bit has 174 accepted answers">20%</span></p></div></div><div id="comments-container-850" class="comments-container"><span id="851"></span><div id="comment-851" class="comment"><div id="post-851-score" class="comment-score"></div><div class="comment-text"><p>Hi SYNbit,</p><p>Thank's for the return. Yes, it's clear, but i have some questions:</p><p>1- When the server restart the application, the "problem tcp zerowindows" is solved;</p><p>2- This client connect with others server's and we don't receive any TCP ZeroWindow;</p><p>3- According to the picture, the window of the client is overlap by the window of the server. On steps 1, 2 and 3, the client send a 140b data and has a window of 360, leaving only 220bytes, but in the next send, the window is 260 and not 220, so the client took the window size from the server. It's that or am I wrong? Thank you very much again.</p></div><div id="comment-851-info" class="comment-info"><span class="comment-age">(08 Nov '10, 05:49)</span> Plinio Monteiro</div></div><span id="853"></span><div id="comment-853" class="comment"><div id="post-853-score" class="comment-score"></div><div class="comment-text"><p>1) It is the responsibility of the application to fetch data from the TCP receive buffers. Since the buffer decreases to 0 and (assuming from your information) does not get back to a normal value, it is the application that is at fault here. It does not fetch data from the TCP receive buffer. So it's logical that the "zero window" condition vanishes as the application is restarted. However, the exact cause of the lockup does not go away that way.</p></div><div id="comment-853-info" class="comment-info"><span class="comment-age">(08 Nov '10, 06:22)</span> SYN-bit ♦♦</div></div><span id="854"></span><div id="comment-854" class="comment"><div id="post-854-score" class="comment-score"></div><div class="comment-text"><p>2) As it's an application problem, communication to other servers will not be affected. Unless the same application runs on other systems without problems. Then you need to look for the specifics on the faulty server. If not, then you need to troubleshoot the application.</p><p>3) I don't think the picture is any good, for one thing, the ACK's of the server don't seem to free buffer space on the client, which of course it should be doing.</p></div><div id="comment-854-info" class="comment-info"><span class="comment-age">(08 Nov '10, 06:22)</span> SYN-bit ♦♦</div></div><span id="855"></span><div id="comment-855" class="comment"><div id="post-855-score" class="comment-score"></div><div class="comment-text"><p>Plinio, it's important to separate the send versus receive window sizes. Remember, you cannot see the send window size in the packet traces. Only the RECEIVE window sizes are visible in the packet trace files. Things to keep in mind are: 1) Typically SEND and RECEIVE window sizes are set equally. So whatever your RCV window size is, that's the SEND window size as well. 2) The WIN field in the packet trace is ALWAYS the RECEIVE window size. It has nothing to do with what it can send.<br />
3) TCP is a two way communication. So often it helps if you analyze the flow in one direction.</p></div><div id="comment-855-info" class="comment-info"><span class="comment-age">(08 Nov '10, 07:25)</span> hansangb</div></div><span id="856"></span><div id="comment-856" class="comment"><div id="post-856-score" class="comment-score"></div><div class="comment-text"><p>4) The RCV window size tells the SENDER what the RECEIVER can take. In other words, RCV window is the throttling mechanism used by the RECEIVER. 5) The SEND window is the throttling mechanism for the sender. If it runs out of the SEND window size, it has to stop (regardless of the receiver's RCV window size).<br />
6) The SENDER has to stop if the RECEIVER advertises a zero window.</p><p>When the application removes the data from the TCP stack, the stack will advertise the new window size as appropriate. There are some rules about when it can advertise this, but don't worry about that for now.</p></div><div id="comment-856-info" class="comment-info"><span class="comment-age">(08 Nov '10, 07:29)</span> hansangb</div></div><span id="864"></span><div id="comment-864" class="comment not_top_scorer"><div id="post-864-score" class="comment-score"></div><div class="comment-text"><p>Thank you very much guys for the help.</p></div><div id="comment-864-info" class="comment-info"><span class="comment-age">(08 Nov '10, 12:28)</span> Plinio Monteiro</div></div></div><div id="comment-tools-850" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-850-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="870"></span>

<div id="answer-container-870" class="answer answered-by-owner">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-870-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>SYNbit and hansangb,</p><p>Just one more question.</p><p>If the client's window size reaches zero, and there ins't a negotiation of the window, can be a problem in the SERVER application or de CLIENT application? Can be a problem of the machine too?</p><p>Thank you again.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Nov '10, 03:07</strong></p><img src="https://secure.gravatar.com/avatar/b00d762b1be6c2a2f5e33662101adac9?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Plinio%20Monteiro&#39;s gravatar image" /><p>Plinio Monteiro<br />
<span class="score" title="36 reputation points">36</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Plinio Monteiro has no accepted answers">0%</span> </br></br></p></div></div><div id="comments-container-870" class="comments-container"><span id="872"></span><div id="comment-872" class="comment"><div id="post-872-score" class="comment-score"></div><div class="comment-text"><p>If the client advertizes a window that reaches zero, then the Application on the client does not read quickly enough from the TCP receive buffers. So it's a client application problem.</p></div><div id="comment-872-info" class="comment-info"><span class="comment-age">(09 Nov '10, 03:13)</span> SYN-bit ♦♦</div></div><span id="873"></span><div id="comment-873" class="comment"><div id="post-873-score" class="comment-score"></div><div class="comment-text"><p>thank you very much again.</p></div><div id="comment-873-info" class="comment-info"><span class="comment-age">(09 Nov '10, 03:20)</span> Plinio Monteiro</div></div><span id="880"></span><div id="comment-880" class="comment"><div id="post-880-score" class="comment-score"></div><div class="comment-text"><p>ZeroWindows can be hard to diagnose. if the client is Windoze box then you should look at I/O contention of the harddrive and page file utilization - for some silly reason Windoze tends to swap out "sleeping" connections. When new data is sent to one of these sessions it has to be put back into active memory before the buffers are emptied. If the client workstation is already underload AND the harddrive is active then this process can take a while - which leads to full buffers and zero windows. Also, if the server is dumping a LOT of data at once the client can get temporarily choked.</p></div><div id="comment-880-info" class="comment-info"><span class="comment-age">(09 Nov '10, 08:22)</span> GeonJay</div></div></div><div id="comment-tools-870" class="comment-tools"></div><div class="clear"></div><div id="comment-870-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

