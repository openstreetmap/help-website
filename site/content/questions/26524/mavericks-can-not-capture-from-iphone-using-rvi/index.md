+++
type = "question"
title = "Mavericks - can not capture from iPhone using RVI"
description = '''After updating my macbook to Mavericks, Wireshark can still capture data from my iPhone using RVI(remote virtual interface). But it cannot analyze and show packets right. it only tells about packets that they are &quot;User encapsulation not handled: DLT=149, check your Preferences-&amp;gt;Protocols-&amp;gt;DLT_...'''
date = "2013-10-29T11:13:00Z"
lastmod = "2014-02-19T01:46:00Z"
weight = 26524
keywords = [ "rvi", "iphone", "rvictl", "mavericks" ]
aliases = [ "/questions/26524" ]
osqa_answers = 4
osqa_accepted = false
+++

<div class="headNormal">

# [Mavericks - can not capture from iPhone using RVI](/questions/26524/mavericks-can-not-capture-from-iphone-using-rvi)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26524-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26524-score" class="post-score" title="current number of votes">2</div><span id="post-26524-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>After updating my macbook to Mavericks, Wireshark can still capture data from my iPhone using RVI(remote virtual interface). But it cannot analyze and show packets right. it only tells about packets that they are "User encapsulation not handled: DLT=149, check your Preferences-&gt;Protocols-&gt;DLT_USER".</p><p>This problem only occurs when capturing lively. If I capture and save using tcpdump, Wireshark analyzes them right. I tried to test using stable version and night builds. but the results were same.</p><p>Can anyone tell me how to solve this? Thanks in advance.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-rvi" rel="tag" title="see questions tagged &#39;rvi&#39;">rvi</span> <span class="post-tag tag-link-iphone" rel="tag" title="see questions tagged &#39;iphone&#39;">iphone</span> <span class="post-tag tag-link-rvictl" rel="tag" title="see questions tagged &#39;rvictl&#39;">rvictl</span> <span class="post-tag tag-link-mavericks" rel="tag" title="see questions tagged &#39;mavericks&#39;">mavericks</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>29 Oct '13, 11:13</strong></p><img src="https://secure.gravatar.com/avatar/a57f39c60bd2b8e9474cafc9890d5b88?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="gish&#39;s gravatar image" /><p><span>gish</span><br />
<span class="score" title="41 reputation points">41</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="gish has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>12 Nov '13, 23:56</strong> </span></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span></p></div></div><div id="comments-container-26524" class="comments-container"><span id="29449"></span><div id="comment-29449" class="comment"><div id="post-29449-score" class="comment-score"></div><div class="comment-text"><p>Has anybody had any success on this yet. I am still not able to capture and analyse packets directly in Wireshark.</p></div><div id="comment-29449-info" class="comment-info"><span class="comment-age">(05 Feb '14, 02:49)</span> <span class="comment-user userinfo">Anil Giri</span></div></div><span id="29450"></span><div id="comment-29450" class="comment"><div id="post-29450-score" class="comment-score"></div><div class="comment-text"><p>I've filed a bug on this with Apple, but they haven't responded.</p><p>I haven't had time to dive into the Mavericks source and determine what the header looks like.</p></div><div id="comment-29450-info" class="comment-info"><span class="comment-age">(05 Feb '14, 02:53)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div></div><div id="comment-tools-26524" class="comment-tools"></div><div class="clear"></div><div id="comment-26524-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

4 Answers:

</div>

</div>

<span id="26525"></span>

<div id="answer-container-26525" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26525-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26525-score" class="post-score" title="current number of votes">2</div><span id="post-26525-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>Can anyone tell me how to solve this?</p></blockquote><p>Solve this by complaining to Apple, ideally by filing a bug at <a href="http://bugreport.apple.com/">http://bugreport.apple.com/</a>, asking them not to use DLT_USER2 for their own purposes, and asking them instead to request an official DLT_ value from <span class="__cf_email__" data-cfemail="750116051100180558021a071e10070635191c0601065b011605110018055b1a0712">[email protected]</span>, citing the page at <a href="http://www.tcpdump.org/linktypes.html">http://www.tcpdump.org/linktypes.html</a>. The more dups, the better.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>29 Oct '13, 11:51</strong></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Guy Harris has 216 accepted answers">19%</span></p></div></div><div id="comments-container-26525" class="comments-container"><span id="29469"></span><div id="comment-29469" class="comment"><div id="post-29469-score" class="comment-score"></div><div class="comment-text"><p>Oh, and please attach Mavericks remote virtual interface captures to <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=9358">bug 9358</a>; that will make it possible to test changes to Wireshark to dissect those packets natively (and develop changes to libpcap and tcpdump to fix this, so that I can yell at Apple to update their libpcap and tcpdump).</p></div><div id="comment-29469-info" class="comment-info"><span class="comment-age">(05 Feb '14, 12:12)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div></div><div id="comment-tools-26525" class="comment-tools"></div><div class="clear"></div><div id="comment-26525-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="27065"></span>

<div id="answer-container-27065" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-27065-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-27065-score" class="post-score" title="current number of votes">2</div><span id="post-27065-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>A better method is to use header size = 108 and payload protocol = eth.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Nov '13, 23:14</strong></p><img src="https://secure.gravatar.com/avatar/768701f7fe3d49349c810cdf8bda3ab4?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="bennettp123&#39;s gravatar image" /><p><span>bennettp123</span><br />
<span class="score" title="41 reputation points">41</span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="bennettp123 has no accepted answers">0%</span></p></div></div><div id="comments-container-27065" class="comments-container"><span id="27073"></span><div id="comment-27073" class="comment"><div id="post-27073-score" class="comment-score"></div><div class="comment-text"><p>This solution works much better for me</p></div><div id="comment-27073-info" class="comment-info"><span class="comment-age">(18 Nov '13, 10:35)</span> <span class="comment-user userinfo">sboisson</span></div></div></div><div id="comment-tools-27065" class="comment-tools"></div><div class="clear"></div><div id="comment-27065-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="29452"></span>

<div id="answer-container-29452" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-29452-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-29452-score" class="post-score" title="current number of votes">2</div><span id="post-29452-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>As others mentioned, the workaround is to enable the DLT_USER protocol #149 in Wireshark.</p><p>From my experience the actual header and protocol is different depending wether your device is connected using wifi or radio:</p><ul><li>when connected with radio (3G): set header length to 112, and protocol to <code>ip</code></li><li>when connected with wifi: set header length to 108, and protocol to <code>eth</code></li></ul></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>05 Feb '14, 03:06</strong></p><img src="https://secure.gravatar.com/avatar/d3eee7ba9de5d866516e8e0d97d12e5d?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sboisson&#39;s gravatar image" /><p><span>sboisson</span><br />
<span class="score" title="41 reputation points">41</span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sboisson has no accepted answers">0%</span></p></div></div><div id="comments-container-29452" class="comments-container"><span id="29997"></span><div id="comment-29997" class="comment"><div id="post-29997-score" class="comment-score"></div><div class="comment-text"><p>This is just to confirm that the above approach (set header length to 108, and protocol to eth) works for me. I can capture live and see all the info about my SIP packets during capture.</p></div><div id="comment-29997-info" class="comment-info"><span class="comment-age">(19 Feb '14, 01:46)</span> <span class="comment-user userinfo">Anil Giri</span></div></div></div><div id="comment-tools-29452" class="comment-tools"></div><div class="clear"></div><div id="comment-29452-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="26559"></span>

<div id="answer-container-26559" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-26559-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-26559-score" class="post-score" title="current number of votes">1</div><span id="post-26559-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>A way to get data directly:</p><p>Go into Preferences/Protocols/DLT_USER and add an entry for user2, which is DLT=149. Set the header length to 112, and the protocol value to IP. This is less robust than #1, because there's plenty of info in that 112 byte header that's being ignored, but it should work for IP traffic.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>30 Oct '13, 22:06</strong></p><img src="https://secure.gravatar.com/avatar/acc9b06519286e0a5a9b5d6f7d3183a2?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="kjbrock&#39;s gravatar image" /><p><span>kjbrock</span><br />
<span class="score" title="26 reputation points">26</span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="kjbrock has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>30 Oct '13, 22:10</strong> </span></p></div></div><div id="comments-container-26559" class="comments-container"><span id="26560"></span><div id="comment-26560" class="comment"><div id="post-26560-score" class="comment-score"></div><div class="comment-text"><p>Thank you, kjbrock. Now I can enjoy live capture :)</p></div><div id="comment-26560-info" class="comment-info"><span class="comment-age">(30 Oct '13, 23:20)</span> <span class="comment-user userinfo">gish</span></div></div><span id="26561"></span><div id="comment-26561" class="comment"><div id="post-26561-score" class="comment-score"></div><div class="comment-text"><p>This does not help me capture and analyse my SIP message. Is there a better way to get it working as it was prior to mavericks?</p></div><div id="comment-26561-info" class="comment-info"><span class="comment-age">(31 Oct '13, 00:15)</span> <span class="comment-user userinfo">Anil Giri</span></div></div><span id="26593"></span><div id="comment-26593" class="comment"><div id="post-26593-score" class="comment-score">1</div><div class="comment-text"><p>Have you tried the "capture with tcpdump and open in WS" solution? That seems to show me all the packets, not just the IP packets.<br />
</p><p>To get general capture working in WS you'd probably need to write something that parses the header and determines the protocol type from that. So for the truly masochistic, get Apple's tcpdump sources, look at how they're parsing it and integrate that into WS.</p><p>I think that Guy Harris is absolutely correct that Apple shouldn't be doing this with User2, so longer term we've got to hope that they'll fix this on their end.</p></div><div id="comment-26593-info" class="comment-info"><span class="comment-age">(31 Oct '13, 08:12)</span> <span class="comment-user userinfo">kjbrock</span></div></div><span id="26926"></span><div id="comment-26926" class="comment"><div id="post-26926-score" class="comment-score"></div><div class="comment-text"><p>Sorry for replying late.</p><p>The capture with tcpdump approach works fine. I can capture and write to a file. Then I am able to analyse the packets in Wireshark.</p><p>But this adds an additional step to my workflow. I would definitely want to file a bug with Apple if it is so. Can you please explain to me what exactly it is that appears to be broken on their part. I am not entirely familiar with the whole User2 thing.</p></div><div id="comment-26926-info" class="comment-info"><span class="comment-age">(12 Nov '13, 23:11)</span> <span class="comment-user userinfo">Anil Giri</span></div></div><span id="27054"></span><div id="comment-27054" class="comment"><div id="post-27054-score" class="comment-score">1</div><div class="comment-text"><p>I had to use header length 122 to get this to work for me. And for clarification, you need to have payload protocol set to "ip" (as opposed to header protocol or other).</p></div><div id="comment-27054-info" class="comment-info"><span class="comment-age">(16 Nov '13, 13:07)</span> <span class="comment-user userinfo">sadkinson</span></div></div></div><div id="comment-tools-26559" class="comment-tools"></div><div class="clear"></div><div id="comment-26559-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

