+++
type = "question"
title = "False FCS Error for frame packet size more than 64 bytes"
description = '''I am sorry if this is a repeated question regarding FCS Error. We are getting the FCS error for the frame packet size more than 64 bytes. Frame check sequence: 0x4a495453 [incorrect, should be 0xd7636502] In our ethernet driver there is an option to Make sure the driver does not transmit packet  les...'''
date = "2013-09-10T07:42:00Z"
lastmod = "2014-10-22T23:05:00Z"
weight = 24525
keywords = [ "fcs", "error" ]
aliases = [ "/questions/24525" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [False FCS Error for frame packet size more than 64 bytes](/questions/24525/false-fcs-error-for-frame-packet-size-more-than-64-bytes)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-24525-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-24525-score" class="post-score" title="current number of votes">1</div><span id="post-24525-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I am sorry if this is a repeated question regarding FCS Error. We are getting the FCS error for the frame packet size more than 64 bytes. Frame check sequence: 0x4a495453 [incorrect, should be 0xd7636502]</p><p>In our ethernet driver there is an option to Make sure the driver does not transmit packet less than minimum(i.e 64 bytes) as per the Ethernet standards. But, we are getting the FCS errors if we set the packet size as 64 bytes and there won't be FCS errors if we set the minimum packet size as 60 bytes.</p><p>As the communication itself doesn't have any problem we believe this may be a<br />
false alarm by the Wireshark. Is there any way to avoid such false errors on the Wireshark.</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-fcs" rel="tag" title="see questions tagged &#39;fcs&#39;">fcs</span> <span class="post-tag tag-link-error" rel="tag" title="see questions tagged &#39;error&#39;">error</span></div><div id="question-controls" class="post-controls"><div class="community-wiki">This question is marked "community wiki".</div></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>10 Sep '13, 07:42</strong></p><img src="https://secure.gravatar.com/avatar/95b7a2dbd4bb027522da73b25efd3f7a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="paddu&#39;s gravatar image" /><p><span>paddu</span><br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="paddu has no accepted answers">0%</span> </br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>10 Sep '13, 07:45</strong> </span></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-24525" class="comments-container"><span id="24526"></span><div id="comment-24526" class="comment"><div id="post-24526-score" class="comment-score"></div><div class="comment-text"><p>What preferences are set for the Ethernet dissector in your profile?</p></div><div id="comment-24526-info" class="comment-info"><span class="comment-age">(10 Sep '13, 07:47)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="24534"></span><div id="comment-24534" class="comment"><div id="post-24534-score" class="comment-score"></div><div class="comment-text"><p>Does this happen with all protocols running on top of Ethernet, including, for example, IPv4 and IPv6, or does it just happen with some protocols?</p><p>In your driver, does the minimum packet size refer to the size of the packet <em>including</em> the FCS (in which case 64 is the correct minimum), or <em>not</em> including the FCS (in which case 60 is the correct minimum)?</p><p>(And, yes, grahamb's question is also relevant here.)</p></div><div id="comment-24534-info" class="comment-info"><span class="comment-age">(10 Sep '13, 12:59)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="24571"></span><div id="comment-24571" class="comment"><div id="post-24571-score" class="comment-score"></div><div class="comment-text"><p>Thank you.. Yes we are using NDK(IPv4) ethernet drivers provided from TI. According to the documents of this driver the driver includes the FCS, but I am not able to confirm where it is added inside the driver.<br />
</p><p>Actually there is an function named EmacSend() in the driver, which sets the valid length of the packet as shown below.</p><p>/ <em>Make sure the driver does not transmit packet less than min. as per the * Ethernet standards.</em> / if( PBM_getValidLen(hPkt) &lt; 60 ) PBM_setValidLen (hPkt, 64 );</p><p>If we change the setValidLen to 60, there won't be any FCS error but FCS error occurs if we leave it as 64.</p><p>As I am new to this field I don't know much about the Ethernet dissector I shall come back about this later.</p></div><div id="comment-24571-info" class="comment-info"><span class="comment-age">(11 Sep '13, 06:23)</span> <span class="comment-user userinfo">paddu</span></div></div><span id="24579"></span><div id="comment-24579" class="comment"><div id="post-24579-score" class="comment-score"></div><div class="comment-text"><p>can you please post two capture files that show the effect (google drive, dropbox, cloudshark). One with good FCS and one with bad FCS.</p></div><div id="comment-24579-info" class="comment-info"><span class="comment-age">(11 Sep '13, 09:12)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-24525" class="comment-tools"></div><div class="clear"></div><div id="comment-24525-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="24582"></span>

<div id="answer-container-24582" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-24582-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-24582-score" class="post-score" title="current number of votes">0</div><span id="post-24582-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Please read the following thread and search for <strong>EMAC_DSC_FLAG_PASSCRC</strong>.</p><blockquote><p><a href="http://e2e.ti.com/support/embedded/bios/f/355/p/274592/969028.aspx">http://e2e.ti.com/support/embedded/bios/f/355/p/274592/969028.aspx</a></p></blockquote><p>Did you set or clear that flag?</p><p>If you set it, did you calculate the CRC value yourself (correctly) and added it to the frame?<br />
If you set the flag, please try to clear it and let the EMAC create the CRC.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>11 Sep '13, 10:02</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>11 Sep '13, 10:09</strong> </span></p></div></div><div id="comments-container-24582" class="comments-container"><span id="24605"></span><div id="comment-24605" class="comment"><div id="post-24605-score" class="comment-score"></div><div class="comment-text"><p>Thank you.. Regarding the "PASSCRC" flag we haven't changed anything from the default driver, so the flag seems to be "clear" i.e the EMAC generates CRC.</p><p>We are little bit confused about the if loop in the TI NDK Driver. "if( PBM_getValidLen(hPkt) &lt; 60 ) PBM_setValidLen (hPkt, 64 );"</p><p>They are checking if the packets are less than "60" , and if it is less than "60" set the packet valid leght to "64"</p><p>But as pet the ethernet standard the minimum packet lenght is "64" so, why is this driver checking for packets &lt;60 in the if condition and why not directly check if the packet is&lt;64?</p><p>I have asked the same question to TI but yet to get a reply.</p><p>Please let know if are any comments on this part also.</p><p>Regarding the capture files, I need the permission from the company to upload the data, I shall come back to you as soon as possible.</p></div><div id="comment-24605-info" class="comment-info"><span class="comment-age">(12 Sep '13, 04:40)</span> <span class="comment-user userinfo">paddu</span></div></div><span id="24614"></span><div id="comment-24614" class="comment"><div id="post-24614-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I have asked the same question to TI but yet to get a reply.<br />
Please let know if are any comments on this part also.</p></blockquote><p>O.K. if TI has no answer to that question, how could I? ;-))</p><blockquote><p>Regarding the capture files, I need the permission from the company to upload the data,</p></blockquote><p>O.K.</p></div><div id="comment-24614-info" class="comment-info"><span class="comment-age">(12 Sep '13, 12:50)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="25162"></span><div id="comment-25162" class="comment"><div id="post-25162-score" class="comment-score"></div><div class="comment-text"><p>I am sorry for the delay. I have uploaded the capture file of the bad FCS into the below cloudshark site. <a href="http://www.cloudshark.org/captures/c5f307132b33">http://www.cloudshark.org/captures/c5f307132b33</a></p><p>If the frame length is 64 bytes, it appears that Wireshark will take the last 4 bytes of the packet greater than 60 bytes and use those 4 bytes as the FCS.</p></div><div id="comment-25162-info" class="comment-info"><span class="comment-age">(24 Sep '13, 08:39)</span> <span class="comment-user userinfo">paddu</span></div></div><span id="25169"></span><div id="comment-25169" class="comment"><div id="post-25169-score" class="comment-score"></div><div class="comment-text"><p>I received a capture file just yesterday exhibiting this same behavior. It caused a few folks to waste some time chasing this red herring until I set them straight.</p><p>An independent capture file is posted on cloudshark at <a href="http://cloudshark.org/captures/943b17cd1baa">http://cloudshark.org/captures/943b17cd1baa</a>. It contains 2 ICMP echo request/reply exchanges. In the first case, the packet is less than 60 bytes so padding is required, and in the second case the pakcet is more than 60 bytes so no padding is required. You can see the <strong>extra</strong> 4 bytes of padding in the ICMP echo reply in frame 2 and also notice the <code>ETHERNET FRAME CHECK SEQUENCE INCORRECT</code> indication from Wireshark. (The manufacturer has been contacted about their extra 4 bytes of padding, but no reply has been received from them yet.)</p><p>The file was anonymized using <a href="http://www.tracewrangler.com/">TraceWrangler</a>.</p></div><div id="comment-25169-info" class="comment-info"><span class="comment-age">(24 Sep '13, 12:59)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="25183"></span><div id="comment-25183" class="comment"><div id="post-25183-score" class="comment-score"></div><div class="comment-text"><p>Thank you so much, can I assume that this behavior is not from the wireshark but from the Ethernet driver(from the manufacture)?</p><p>Please let me know if there is any possible solution to overcome this sort of errors.</p></div><div id="comment-25183-info" class="comment-info"><span class="comment-age">(24 Sep '13, 19:49)</span> <span class="comment-user userinfo">paddu</span></div></div><span id="25184"></span><div id="comment-25184" class="comment not_top_scorer"><div id="post-25184-score" class="comment-score"></div><div class="comment-text"><p>Well, it seems that some manufacturers are adding more padding than is necessary. As a result, Wireshark gets confused and can incorrectly report FCS errors when there aren't any. The <em>"solution"</em>, at least for now, is to turn off the Ethernet dissector's "Validate the Ethernet checksum if possible" preference if you don't like seeing these indications in Wireshark.</p></div><div id="comment-25184-info" class="comment-info"><span class="comment-age">(24 Sep '13, 19:54)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="25232"></span><div id="comment-25232" class="comment not_top_scorer"><div id="post-25232-score" class="comment-score"></div><div class="comment-text"><p>Hi cmaynard,</p><p>I was studying the capture you posted to cloudshark above in trying to understand why this padding and FCS are present.</p><p>From what I can tell, it seems that the padding is added to bring the data size up to 60 bytes, with the FCS being an additional 4 bytes (after the padding), which results in a total size of 64 bytes. But I'm not sure why this padding and FRC are not always added.</p><p>Looking at the capture, let host A = 192.168.1.1 and host B = 192.168.1.2</p><p>In frame 1 and frame 2, I see that they both contain 43 bytes of "valid data," yet the value shown in the length column shows 43 bytes for frame 1, but 64 bytes for frame 2.</p><p>The key difference that I noticed between these two frames is that in frame 2, sent by host B, there is a 17 byte padding, plus 4 byte frame check (CRC) appended to the end of the frame. This results in a frame that meets the minimum size of 64 bytes. Frame 1, sent by host A, does not add such padding: <img src="https://osqa-ask.wireshark.org/upfiles/framepad.png" alt="alt text" /></p><p>The question I have is, why doesn't host A apply this same padding and FCS (in frame 1)?</p><p>It seems like the Ethernet driver at host A was not implemented to add padding/FCS to the end of the Ethernet frame, but host B's driver was. (or the maybe the h/w itself does this?).</p><p>Furthermore, neither host adds a frame check to frames 3 and 4. So it seems that a frame check should only exist if the total length of the frame is 64 bytes, and in such case the last 4 bytes are to be read as the frame check sequence ... ?</p><p>Your thoughts are appreciated!</p></div><div id="comment-25232-info" class="comment-info"><span class="comment-age">(25 Sep '13, 12:10)</span> <span class="comment-user userinfo">stevenconnell</span></div></div><span id="25237"></span><div id="comment-25237" class="comment not_top_scorer"><div id="post-25237-score" class="comment-score"></div><div class="comment-text"><p>First, the capture was taken at the host 192.168.1.1, so Wireshark gets the packet before the transmitter adds the padding, thus the reason it's only 43 bytes. Whenever you see packets less than the minimum frame size, this is a tell-tale sign of the capture point. When that 43-byte packet hits the wire, it will be padded by 17 bytes to meet the minimum 60 byte (data) size ... plus the 4 byte FCS of course.</p><p>When 192.168.1.2 receives the packet, it replies and also needs to add padding. However, it adds not 17 bytes but 21 bytes of padding, 4 bytes more than is necessary. I do not have capture hardware that will actually capture the Ethernet FCS, so by the time Wireshark gets the packet, the FCS has already been discarded by the NIC. In fact, if the FCS truly was bad, Wireshark would never even see the packet. Those last 4 bytes are part of the padding, being misinterpreted by Wireshark as an FCS due to the sending device adding an extra, completely unnecessary 4 bytes of padding.</p><p>Regarding frames 3 and 4, they're both larger than the minimum frame size, so no padding is needed nor added. You don't see the FCS for those either because, as I mentioned above, we never actually receive the FCS for any frame, regardless of size.</p><p>Does that make sense?</p><p>You can even run some simple tests yourself using ping to verify this. Try some payload sizes such as follows to see the effect:</p><p>*nix:</p><pre><code>ping -c 1 -s 1 &lt;host&gt;
ping -c 1 -s 14 &lt;host&gt;
ping -c 1 -s 18 &lt;host&gt;
ping -c 1 -s 22 &lt;host&gt;
ping -c 1 -s 58 &lt;host&gt;</code></pre><p>Windows:</p><pre><code>ping -n 1 -l 1 &lt;host&gt;
ping -n 1 -l 14 &lt;host&gt;
ping -n 1 -l 18 &lt;host&gt;
ping -n 1 -l 22 &lt;host&gt;
ping -n 1 -l 58 &lt;host&gt;</code></pre></div><div id="comment-25237-info" class="comment-info"><span class="comment-age">(25 Sep '13, 12:43)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="25325"></span><div id="comment-25325" class="comment not_top_scorer"><div id="post-25325-score" class="comment-score"></div><div class="comment-text"><p>Your response actually cleared things up a lot, thanks!</p></div><div id="comment-25325-info" class="comment-info"><span class="comment-age">(27 Sep '13, 13:41)</span> <span class="comment-user userinfo">stevenconnell</span></div></div></div><div id="comment-tools-24582" class="comment-tools"><span class="comments-showing"> showing 5 of 9 </span> <a href="#" class="show-all-comments-link">show 4 more comments</a></div><div class="clear"></div><div id="comment-24582-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="37301"></span>

<div id="answer-container-37301" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-37301-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-37301-score" class="post-score" title="current number of votes">0</div><span id="post-37301-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>Try this:</p><ol><li>Open the config page as follows: Edit/Preferences/Protocols/Ethernet</li><li>Uncheck the "Validate the Ethernet checksum if possible".</li></ol><p>Wireshark of Version 1.11.3 (v1.11.3-0-g1dd5d3a from master) is tested OK.</p><p>Good Luck!</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>22 Oct '14, 23:05</strong></p><img src="https://secure.gravatar.com/avatar/9312c19dee0d372102b6ed50719bc255?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="liang_xinhui&#39;s gravatar image" /><p><span>liang_xinhui</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="liang_xinhui has no accepted answers">0%</span> </br></br></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>23 Oct '14, 00:21</strong> </span></p><img src="https://secure.gravatar.com/avatar/f93de7000747ab5efb5acd3034b2ebd7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Guy%20Harris&#39;s gravatar image" /><p><span>Guy Harris ♦♦</span><br />
<span class="score" title="17443 reputation points"><span>17.4k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="35 badges"><span class="silver">●</span><span class="badgecount">35</span></span><span title="196 badges"><span class="bronze">●</span><span class="badgecount">196</span></span></p></div></div><div id="comments-container-37301" class="comments-container"></div><div id="comment-tools-37301" class="comment-tools"></div><div class="clear"></div><div id="comment-37301-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

