+++
type = "question"
title = "FIFO vs CBWFQ throughput graph comparison"
description = '''Hi I&#x27;m trying to analyse these two throughput graphs for a dissertation. Could anyone shed some light on what this actually means. FIFO looks worse (and it should be) than CBWFQ, but what does this actually mean. I&#x27;m testing QoS schemes and this result comes from a congested 2MB serial link to see h...'''
date = "2013-04-16T02:18:00Z"
lastmod = "2013-04-20T05:48:00Z"
weight = 20456
keywords = [ "graphs", "statistics", "throughput", "qos", "wireshark" ]
aliases = [ "/questions/20456" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [FIFO vs CBWFQ throughput graph comparison](/questions/20456/fifo-vs-cbwfq-throughput-graph-comparison)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-20456-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-20456-score" class="post-score" title="current number of votes">0</div><span id="post-20456-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi</p><p>I'm trying to analyse these two throughput graphs for a dissertation. Could anyone shed some light on what this actually means. FIFO looks worse (and it should be) than CBWFQ, but what does this actually mean.</p><p>I'm testing QoS schemes and this result comes from a congested 2MB serial link to see how each perform sending RTP, FTP and ICMP at the same time.</p><p><a href="https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20throughput.jpg">https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20throughput.jpg</a> <a href="https://dl.dropboxusercontent.com/u/39248217/FIFO%20throughput.jpg">https://dl.dropboxusercontent.com/u/39248217/FIFO%20throughput.jpg</a></p><p>Thanks Dan</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-graphs" rel="tag" title="see questions tagged &#39;graphs&#39;">graphs</span> <span class="post-tag tag-link-statistics" rel="tag" title="see questions tagged &#39;statistics&#39;">statistics</span> <span class="post-tag tag-link-throughput" rel="tag" title="see questions tagged &#39;throughput&#39;">throughput</span> <span class="post-tag tag-link-qos" rel="tag" title="see questions tagged &#39;qos&#39;">qos</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>16 Apr '13, 02:18</strong></p><img src="https://secure.gravatar.com/avatar/703db8b1016496f63390abe9cd3275a4?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="dscott1709&#39;s gravatar image" /><p><span>dscott1709</span><br />
<span class="score" title="11 reputation points">11</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="dscott1709 has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>16 Apr '13, 02:24</strong> </span></p></div></div><div id="comments-container-20456" class="comments-container"></div><div id="comment-tools-20456" class="comment-tools"></div><div class="clear"></div><div id="comment-20456-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="20461"></span>

<div id="answer-container-20461" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-20461-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-20461-score" class="post-score" title="current number of votes">0</div><span id="post-20461-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>As you are talking about QoS, we need more information about the other traffic that passed your device while you measured <strong>one</strong> connection <strong>and</strong> the QoS policy for CBWFQ.</p><p>Without any further information, I would interpret the two graphs as follows.</p><p><strong>CBWFQ</strong><br />
</p><p>The monitored session got a bandwidth of ~72 Kbyte/s (due to the CBWFQ configuration). The spikes are possibly due to a change in the 'line usage', meaning that there was less 'other traffic' and thus your session received more bandwidth as it got available.</p><p>I'm sure you know how CBWFQ works. I'm adding a link for all other readers here ;-)</p><blockquote><p><a href="http://www.youtube.com/watch?v=9oFLCrVrQLQ">http://www.youtube.com/watch?v=9oFLCrVrQLQ</a></p></blockquote><p><strong>FIFO</strong><br />
</p><p>As the name says, the packets are routed as they come in (First In First Out). There is a strong influence on the traffic pattern of a single session based on the rest of the traffic at that time. As we don't know that, I simply guess, that there were several other session and/or protocols passing your device during the time you capture the traffic.</p><blockquote><p>FIFO looks worse (and it should be) than CBWFQ, but what does this actually mean.</p></blockquote><p>With FIFO the bandwidth for a certain class of traffic is totally unpredictable, as it depends on the rest of the traffic, passing a device (which itself is unpredictable). CBWFQ is not 'better' than FIFO. It is just more predictable, as <strong>you can configure</strong> which traffic gets how much bandwidth.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>16 Apr '13, 04:08</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div></div><div id="comments-container-20461" class="comments-container"><span id="20506"></span><div id="comment-20506" class="comment"><div id="post-20506-score" class="comment-score"></div><div class="comment-text"><p>Thanks Kurt</p><p>I'm passing an identical traffic mix of RTP video stream, FTP and ICMP over a 2MB clock rate serial link between two Cisco routers to compare how each QoS scheme (FIFO and CBWFQ) peforms best and what happens. I've given CBWFQ precedence levels of: RTP 7 FTP 4 ICMP 1</p><p>RTP video is bursty by nature if i'm right in saying. but the FTP seemed to transfer a a pretty constant rate. ICMP is in there just for illustration as I'm fundamentally comparing UDP and TCP protocols in QoS.</p><p>Does that help to give you more insight into why these graphs are different?</p><p>Cheers Dan</p></div><div id="comment-20506-info" class="comment-info"><span class="comment-age">(17 Apr '13, 03:05)</span> <span class="comment-user userinfo">dscott1709</span></div></div><span id="20531"></span><div id="comment-20531" class="comment"><div id="post-20531-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I'm passing an identical traffic mix of RTP video stream, FTP and ICMP over a 2MB clock rate serial link</p></blockquote><ul><li>in parallel or one after the other?<br />
</li><li>If "in parallel", can you please add the graphs for the other protocols, generated from the <strong>same</strong> capture file, for the <strong>same</strong> time interval?<br />
</li><li>How do you generate an <strong>identical</strong> traffic mix for <strong>different protocols</strong>?</li></ul><blockquote><p>Does that help to give you more insight into why these graphs are different?</p></blockquote><p>If the mentioned protocols were sent over the line "in parallel", then see my explanation above.</p><p>If you sent the protocol traffic one after the other over the line, I don't have an explanation for the graphs, as there are several things that could have caused that pattern. It could be:</p><ul><li>the FIFO implementation in the Cisco router</li><li>client IP stack</li><li>server IP stack</li></ul><p>For a further analysis, we would need the capture files and ideally a capture file where client and server are directly connected, without the router.</p></div><div id="comment-20531-info" class="comment-info"><span class="comment-age">(17 Apr '13, 12:39)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20597"></span><div id="comment-20597" class="comment"><div id="post-20597-score" class="comment-score"></div><div class="comment-text"><p>When I say 'identical' I just mean from an experimental approach that I've sent the same file across in FTP, the same scene from a movie streamed using port 8554 in RTP in VLC Player and a continuous ping. The traffic mix remains constant on every experiment and is run in parallel for 2 minutes every time give or take the odd second of human delay when I'm stopping the capture, ping, stream and file transfer. It's just for consistency and that as consistent I can get in my scenario. Remember I'm not going for an optimum QoS setup, I'm measuring relative performance of FIFO vs CBWFQ.</p><p>If I don't use the routers it kinda defeats the object of my experiments as I'm testing the 'internet' scenario (albeit a very simple version) of two different networks communicating over a dedicated link.</p><p>Just wondered why these graphs are appearing so different and most importantly what are the reasons behind it?</p><p>Cheers! :-)</p></div><div id="comment-20597-info" class="comment-info"><span class="comment-age">(18 Apr '13, 15:48)</span> <span class="comment-user userinfo">dscott1709</span></div></div><span id="20600"></span><div id="comment-20600" class="comment not_top_scorer"><div id="post-20600-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Just wondered why these graphs are appearing so different and most importantly what are the reasons behind it?</p></blockquote><p>O.K. this is how I understand your setup.</p><blockquote><p>client --- router --- server</p></blockquote><p>Test #1: You start an FTP session, a video stream and a ping command in parallel on the client, while the router runs in FIFO mode.</p><p>Test #2: You repeat test#1, while the router runs in CBWFQ mode.</p><p>If that is your setup, then please see my explanation in the answer above.</p><p>The difference is simply the order in which the packets are being 'released' (sent out) by the router.</p><p>In <strong>FIFO mode</strong>, the router just sends the packets as they come in. The order of the packets is determined by the behavior of the client (and server) software (ftp, video). So, the throughput in FIFO mode is fluctuating, as the client (and server) software does not send a equally constant stream of packets.</p><p>In <strong>CBWFQ mode</strong> the router has to fulfill a QoS policy. This is (basically) done by holding back and 'reordering' packets (of different traffic classes) before the get sent out. Thus the throughput graph looks 'smoother'. Why there are those 'spikes' in the CBWFQ graph, can only be answered by looking at the capture file. If you want an explanation for that, please upload the capture file somewhere (google docs, dropbox, cloudshark.org: BEWARE privacy issues!) and post the link here.</p></div><div id="comment-20600-info" class="comment-info"><span class="comment-age">(18 Apr '13, 16:13)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20601"></span><div id="comment-20601" class="comment not_top_scorer"><div id="post-20601-score" class="comment-score"></div><div class="comment-text"><p>Exactly Kurt! Spot on!</p><p>It's the spikes that are the elements I'd like to explain tbh. I've just thought that the buffer size is 1200ms on the client VLC Player, so maybe while that is filling up there is a brief moment for other traffic to grab some bandwidth?</p><p>Try these captures</p><p><a href="https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20clock%20rate%202MB.pcap">https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20clock%20rate%202MB.pcap</a></p><p><a href="https://dl.dropboxusercontent.com/u/39248217/FIFO%20clock%20rate%202MB.pcap">https://dl.dropboxusercontent.com/u/39248217/FIFO%20clock%20rate%202MB.pcap</a></p><p>Thanks</p></div><div id="comment-20601-info" class="comment-info"><span class="comment-age">(18 Apr '13, 16:46)</span> <span class="comment-user userinfo">dscott1709</span></div></div><span id="20602"></span><div id="comment-20602" class="comment not_top_scorer"><div id="post-20602-score" class="comment-score"></div><div class="comment-text"><blockquote><p>so maybe while that is filling up there is a brief moment for other traffic to grab some bandwidth?</p></blockquote><p>sounds like a reasonable explanation.</p></div><div id="comment-20602-info" class="comment-info"><span class="comment-age">(18 Apr '13, 17:00)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20603"></span><div id="comment-20603" class="comment"><div id="post-20603-score" class="comment-score">1</div><div class="comment-text"><p>If you look at the IO graph, you can see a similar pattern. The bandwidth of the UDP stream (red) drops several times (maybe due to the buffers you mentioned). Unfortunately the increase in bandwidth for the TCP session is not that obvious as in the TCP stream graph. But I still think the VLC 'buffer theory' is right.</p><blockquote><p><a href="http://img7.imageshack.us/img7/5916/iograph.jpg">http://img7.imageshack.us/img7/5916/iograph.jpg</a></p></blockquote></div><div id="comment-20603-info" class="comment-info"><span class="comment-age">(18 Apr '13, 17:26)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20606"></span><div id="comment-20606" class="comment"><div id="post-20606-score" class="comment-score">1</div><div class="comment-text"><p>UPDATE: IO graph starts at the same time as the TCP session (same as TCP stream graph).</p><blockquote><p><a href="http://postimg.org/image/xc6fldusd/">http://postimg.org/image/xc6fldusd/</a><br />
<a href="https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20throughput.jpg">https://dl.dropboxusercontent.com/u/39248217/CBWFQ%20throughput.jpg</a></p></blockquote><p>Now, you see the 'spikes' at the same time as in the TCP stream graph.</p></div><div id="comment-20606-info" class="comment-info"><span class="comment-age">(18 Apr '13, 17:47)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20619"></span><div id="comment-20619" class="comment not_top_scorer"><div id="post-20619-score" class="comment-score"></div><div class="comment-text"><p>Interestingly I've just had another look at what goes on around the spikes. At each spike there are duplicate ACK's sent for TCP traffic. They seem to occur around 47s, 58s and 109s which is close to the spikes?? Could it be that while other FTP packets are transmitting others have been dropped and requested for retransmission, which briefly allows other packets in the sequence more throughput. This is a heavily congested line, so maybe that makes sense? I can mention both suggestions in my report anyhow because it's still critical analysis.</p></div><div id="comment-20619-info" class="comment-info"><span class="comment-age">(19 Apr '13, 03:43)</span> <span class="comment-user userinfo">dscott1709</span></div></div><span id="20620"></span><div id="comment-20620" class="comment not_top_scorer"><div id="post-20620-score" class="comment-score"></div><div class="comment-text"><blockquote><p>At each spike there are duplicate ACK's sent for TCP traffic.</p></blockquote><p>That's pretty normal for a QoS solution, as the router may have to drop packets to fulfill the bandwidth policy. So a QoS device will actually do these things to fulfill the QoS policy:</p><ul><li>reorder packets for different traffic classes on the outgoing interface</li><li>holding back packets</li><li>dropping packets (if the buffers are full)</li></ul><p>All pretty normal for a QoS solution, at least as I have seen it several times.</p></div><div id="comment-20620-info" class="comment-info"><span class="comment-age">(19 Apr '13, 03:52)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="20629"></span><div id="comment-20629" class="comment not_top_scorer"><div id="post-20629-score" class="comment-score"></div><div class="comment-text"><p>Cheers for your input Kurt. What did you think about the jitter comparisons and the RTT on the other posts?</p></div><div id="comment-20629-info" class="comment-info"><span class="comment-age">(19 Apr '13, 07:13)</span> <span class="comment-user userinfo">dscott1709</span></div></div><span id="20655"></span><div id="comment-20655" class="comment not_top_scorer"><div id="post-20655-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Cheers for your input Kurt.</p></blockquote><p>If you think this was the correct answer that resolves your question can you please "accept" it by clicking the checkmark icon next to it. This highlights good answers for the benefit of subsequent users with the same or similar questions.</p><blockquote><p>What did you think about the jitter comparisons and the RTT on the other posts?</p></blockquote><p>Let's close this question and discuss that in the other question.</p></div><div id="comment-20655-info" class="comment-info"><span class="comment-age">(20 Apr '13, 05:48)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-20461" class="comment-tools"><span class="comments-showing"> showing 5 of 12 </span> <a href="#" class="show-all-comments-link">show 7 more comments</a></div><div class="clear"></div><div id="comment-20461-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

