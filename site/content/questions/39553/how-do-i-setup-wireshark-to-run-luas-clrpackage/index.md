+++
type = "question"
title = "How do I setup Wireshark to run Lua&#x27;s CLRPackage"
description = '''I previously asked this question about Wireshark setup for running Lua&#x27;s CLRPackage and it was answered here. The problem is, after version 1.10.9, it appears that some startup search paths or something related have changed. Could someone provide the changes that occurred after 1.10.9 that affect wh...'''
date = "2015-02-02T06:29:00Z"
lastmod = "2015-03-06T05:40:00Z"
weight = 39553
keywords = [ "lua", "error", "startup", "clrpackage", "wireshark" ]
aliases = [ "/questions/39553" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [How do I setup Wireshark to run Lua's CLRPackage](/questions/39553/how-do-i-setup-wireshark-to-run-luas-clrpackage)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-39553-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-39553-score" class="post-score" title="current number of votes">0</div><span id="post-39553-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>I previously asked this question about Wireshark setup for running Lua's CLRPackage and it was answered <a href="https://ask.wireshark.org/questions/5868/how-do-i-setup-wireshark-to-run-luas-clrpackage">here</a>. The problem is, after version 1.10.9, it appears that some startup search paths or something related have changed. Could someone provide the changes that occurred after 1.10.9 that affect where libraries and other scripts are searched?</p><p>I receive the following error if I run the setup with any version after 1.10.9:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/error.bmp" alt="Loading Error" /></p><p>The line in init.lua is:</p><p><code>DATA_DIR = datafile_path()</code></p><p><strong>Update</strong></p><p>I looks like this is from a previous init.lua file that was being copied, after updating to the latest version, the error is now:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/error2.bmp" alt="alt text" /></p><p><strong>Update 2</strong> To answer some of the questions:</p><ul><li>How did you load the "CLRPackage.lua" file? Did you put it in Wireshark's personal plugins directory, or load it using "dofile()", or load it from the command line using the "-X lua_script:..." command?</li></ul><p>It was placed in the <code>C:\Program Files (x86)\Wireshark\lua</code> directory</p><ul><li>Where exactly is the "luanet.lua" file?</li></ul><p>I actually dont see this file anywhere, but there is a <code>luanet.dll</code> in the clibs directory (<code>C:\Program Files (x86)\Wireshark\clibs</code>)</p><ul><li>What is line 15 of CLRPackage.lua?</li></ul><p>This is the code: <code>if not luanet then require 'luanet' end</code></p><p><strong>Update 3</strong> Update for additional questions</p><ul><li>I don't know how this worked even before 1.11.3, unless CLRPackage.lua amended the cpath.</li></ul><p>I looked inside of the CLRPackage.lua and I dont see any place it appends to the cpath. The test program that is included does however append the <code>LUA_DEV</code>\clibs directory to <code>package.cpath</code>, but I dont think thats part of the core dll's.</p><ul><li>How did you get CLRPackage installed? Did you need to compile Wireshark from source code to use CLRPackage? Or did you need to install LuaRocks or some other package?</li></ul><p>I didnt compile any of the files provided, I just copied them from the zip file provided. I've tried to compile them using VS2010 but I havent had any luck.</p><ul><li>What are your Wireshark personal and global plugins directories named? Open Wireshark, go to Help-&gt;About Wireshark, and click on the Folders tab. It will list a personal and global plugins directories.</li></ul><p>Here is the complete list:</p><p><img src="https://osqa-ask.wireshark.org/upfiles/folders_XD3x8i3.bmp" alt="Folders" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-lua" rel="tag" title="see questions tagged &#39;lua&#39;">lua</span> <span class="post-tag tag-link-error" rel="tag" title="see questions tagged &#39;error&#39;">error</span> <span class="post-tag tag-link-startup" rel="tag" title="see questions tagged &#39;startup&#39;">startup</span> <span class="post-tag tag-link-clrpackage" rel="tag" title="see questions tagged &#39;clrpackage&#39;">clrpackage</span> <span class="post-tag tag-link-wireshark" rel="tag" title="see questions tagged &#39;wireshark&#39;">wireshark</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>02 Feb '15, 06:29</strong></p><img src="https://secure.gravatar.com/avatar/8ceec9f7f83e3c12a72b6442393bde2a?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="SwDevMan81&#39;s gravatar image" /><p><span>SwDevMan81</span><br />
<span class="score" title="36 reputation points">36</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="6 badges"><span class="silver">●</span><span class="badgecount">6</span></span><span title="12 badges"><span class="bronze">●</span><span class="badgecount">12</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="SwDevMan81 has one accepted answer">50%</span></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>02 Feb '15, 11:52</strong> </span></p></div></div><div id="comments-container-39553" class="comments-container"><span id="39562"></span><div id="comment-39562" class="comment"><div id="post-39562-score" class="comment-score"></div><div class="comment-text"><p>Just to be clear: it was working fine in 1.10.9 but failed in 1.10.10?</p></div><div id="comment-39562-info" class="comment-info"><span class="comment-age">(02 Feb '15, 08:25)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39568"></span><div id="comment-39568" class="comment"><div id="post-39568-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - So I went through all the revisions to determine when it actually broke. It looks like it stopped working at 1.11.3, which looks like a change from Lua 5.1 to 5.2.</p></div><div id="comment-39568-info" class="comment-info"><span class="comment-age">(02 Feb '15, 09:27)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39572"></span><div id="comment-39572" class="comment"><div id="post-39572-score" class="comment-score"></div><div class="comment-text"><p>A lot changed for Wireshark's Lua in version 1.11.3. I'm not sure this is related to the change to Lua 5.2, though, because the error message above appears to show wireshark can't find the "luanet" Lua module in the path. The various directory paths that it's trying are missing the subdirectory that file is in, presumably.</p><p>So some questions: How did you load the "CLRPackage.lua" file? Did you put it in Wireshark's personal plugins directory, or load it using "<code>dofile()</code>", or load it from the command line using the "<code>-X lua_script:...</code>" command? And where exactly is the "luanet.lua" file? And what is line 15 of CLRPackage.lua?</p></div><div id="comment-39572-info" class="comment-info"><span class="comment-age">(02 Feb '15, 10:13)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39573"></span><div id="comment-39573" class="comment"><div id="post-39573-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - I update the question to address your questions. Let me know if you need more. All the locations and files that I copied match the answer provided <a href="https://ask.wireshark.org/questions/5868/how-do-i-setup-wireshark-to-run-luas-clrpackage/5880">here</a></p></div><div id="comment-39573-info" class="comment-info"><span class="comment-age">(02 Feb '15, 10:38)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39574"></span><div id="comment-39574" class="comment"><div id="post-39574-score" class="comment-score"></div><div class="comment-text"><p>OK, so the problem is that "<code>luanet.dll</code>" is a binary module, which means its directory (the "clibs" one) needs to be in Lua's "<code>package.cpath</code>" global variable, and it's not. There was a change in 1.11.3 to handle the various changes to environments, Lua 5.2., and module paths... but it only changed/fixed the Lua "<code>package.path</code>" variable, not "<code>package.cpath</code>" (<a href="https://code.wireshark.org/review/841">this change</a>).</p><p>So I can fix that, but I'm not sure it will be enough, because it won't add "<code>clibs</code>" because that's not a default directory, of either Lua or Wireshark. I don't know how this worked even before 1.11.3, unless CLRPackage.lua amended the cpath.</p><p>So some more questions: How did you get CLRPackage installed? Did you need to compile Wireshark from source code to use CLRPackage? Or did you need to install LuaRocks or some other package?</p><p>What are your Wireshark personal and global plugins directories named? Open Wireshark, go to Help-&gt;About Wireshark, and click on the Folders tab. It will list a personal and global plugins directories.</p></div><div id="comment-39574-info" class="comment-info"><span class="comment-age">(02 Feb '15, 11:34)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39575"></span><div id="comment-39575" class="comment not_top_scorer"><div id="post-39575-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - Updated with more information, thanks for the help on this.</p></div><div id="comment-39575-info" class="comment-info"><span class="comment-age">(02 Feb '15, 11:55)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39577"></span><div id="comment-39577" class="comment not_top_scorer"><div id="post-39577-score" class="comment-score"></div><div class="comment-text"><p>Well those plugin directories look normal, so I can't figure out why "<code>CLRPackage.lua</code>" was loaded at all to begin with, since it's not in one of those plugin directories. Are there any Lua files in those plugin directories? (even an "<code>init.lua</code>")</p></div><div id="comment-39577-info" class="comment-info"><span class="comment-age">(02 Feb '15, 12:58)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39580"></span><div id="comment-39580" class="comment not_top_scorer"><div id="post-39580-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - If I navigate to the <code>Personal Plugins</code> and <code>Global Plugins</code>, there are no lua scripts in those folders.</p></div><div id="comment-39580-info" class="comment-info"><span class="comment-age">(02 Feb '15, 13:37)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39582"></span><div id="comment-39582" class="comment not_top_scorer"><div id="post-39582-score" class="comment-score"></div><div class="comment-text"><p>Do you remember where you got the CLRPackage zip file? I googled but got various hits, none of which look like the definitive source.</p></div><div id="comment-39582-info" class="comment-info"><span class="comment-age">(02 Feb '15, 13:57)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39584"></span><div id="comment-39584" class="comment not_top_scorer"><div id="post-39584-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - I downloaded it from <a href="https://luaforwindows.googlecode.com/issues/attachment?aid=-5151554520907055534&amp;name=LuaInterface_203_LuaForWindows.zip&amp;token=ABZ6GAdJ23ZUGRfUwya7K8CNeNfGEHsMcg%3A1422914799901">here</a>. Inside the zip file, its <code>LuaInterface &gt; LuaInterface &gt; lua &gt; CLRPackage.lua</code></p></div><div id="comment-39584-info" class="comment-info"><span class="comment-age">(02 Feb '15, 14:08)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div></div><div id="comment-tools-39553" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-39553-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="39588"></span>

<div id="answer-container-39588" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-39588-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-39588-score" class="post-score" title="current number of votes">1</div><span id="post-39588-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I doubt that Luainterface will work with Wireshark anymore, because it looks like it was compiled for Lua 5.0 and 5.1 compatibility, but not 5.2. But you can find out... to get past the current issue of not finding the "<code>luanet.dll</code>" file, put this in your <code>init.lua</code> file, at the <strong>end</strong> of the <code>init.lua</code> file:</p><pre><code>package.cpath = DATA_DIR .. &quot;\\clibs\\?.dll;&quot; .. package.cpath</code></pre><p>Hopefully that should make Wireshark's Lua find the <code>luanet.dll</code> file when it loads <code>CLRPackage.lua</code>, but again my guess is at that point you'll hit another problem because it's not compiled for Lua 5.2 compatibility. You might have to upgrade to the current fork of Luainterface, which appears to be <a href="https://github.com/NLua/NLua">NLua</a>.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>02 Feb '15, 19:35</strong></p><img src="https://secure.gravatar.com/avatar/d02f20c18a7742ec73a666f1974bf6dc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Hadriel&#39;s gravatar image" /><p><span>Hadriel</span><br />
<span class="score" title="2652 reputation points"><span>2.7k</span></span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="39 badges"><span class="bronze">●</span><span class="badgecount">39</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Hadriel has 30 accepted answers">18%</span></p></img></div></div><div id="comments-container-39588" class="comments-container"><span id="39605"></span><div id="comment-39605" class="comment"><div id="post-39605-score" class="comment-score"></div><div class="comment-text"><p>I think you are right. I also added <code>package.path = DATA_DIR .. "\\lua\\?.lua;" .. package.path</code> to <code>init.lua</code> to get it to not error on startup, but now it just hangs at 99% at <code>Handing off plugins...</code>. So I'm guessing its because of the Lua incompatibility you mentioned.</p></div><div id="comment-39605-info" class="comment-info"><span class="comment-age">(03 Feb '15, 05:32)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39673"></span><div id="comment-39673" class="comment"><div id="post-39673-score" class="comment-score"></div><div class="comment-text"><p><span></span><span>@Hadriel</span> - I'm trying to build against Lua 5.2, but I'm having some porting issues. Is there any chance you could help with conversion. I tried NLua and it doesnt appear to support the stock Lua 5.2 source (I think theyve made modifications, which wont help when using the Lua thats built in Wireshark). The questions are <a href="http://stackoverflow.com/q/28332452/95573">here</a></p></div><div id="comment-39673-info" class="comment-info"><span class="comment-age">(05 Feb '15, 11:13)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="39836"></span><div id="comment-39836" class="comment"><div id="post-39836-score" class="comment-score"></div><div class="comment-text"><p>Unfortunately I don't use Windows nor have a Windows system.</p></div><div id="comment-39836-info" class="comment-info"><span class="comment-age">(12 Feb '15, 10:44)</span> <span class="comment-user userinfo">Hadriel</span></div></div><span id="39838"></span><div id="comment-39838" class="comment"><div id="post-39838-score" class="comment-score"></div><div class="comment-text"><p><span>@Hadriel</span> - No problem, I've actually got it to work now. I took the LuaInterface code and updated it for Lua 5.2 and compiled with VS 2010 targeting .NET 4.0 and Lua52.dll. I actually went back and built the LuaInterface for Lua 5.1 with VS 2010 targeting .NET 2.0 and Lua5.1.dll. I dont have a good place to host these but I could put them somewhere if you have a recommendation. Then I'll provide an answer to how to install like the previous question detailed. Thanks for the support on this, the answer you provided led me in the right direction.</p></div><div id="comment-39838-info" class="comment-info"><span class="comment-age">(12 Feb '15, 11:18)</span> <span class="comment-user userinfo">SwDevMan81</span></div></div><span id="40324"></span><div id="comment-40324" class="comment"><div id="post-40324-score" class="comment-score"></div><div class="comment-text"><p><span>@SwDevMan81</span> Hi could you elaborate on how you did it exactely so that we could try to build LuaInterface code and update it for Lua 5.2 as well? Thank you</p></div><div id="comment-40324-info" class="comment-info"><span class="comment-age">(06 Mar '15, 05:40)</span> <span class="comment-user userinfo">smuellener</span></div></div></div><div id="comment-tools-39588" class="comment-tools"></div><div class="clear"></div><div id="comment-39588-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

