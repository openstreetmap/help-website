+++
type = "question"
title = "Cannot see traffic on VLAN"
description = '''Hello I am running Wireshark v1.12.10 on a Windows 7 Samsung computer, with a Marvell Yukon 88E8040 Fast Ethernet card. I have modified the registry so that *PriorityVLANTag is set to 0, and the SkDisableVlanStrip is set to 1. When I run a capture I am using the ip.addr filter, the relation is &quot;is p...'''
date = "2016-04-07T03:25:00Z"
lastmod = "2016-04-11T17:46:00Z"
weight = 51459
keywords = [ "vlan" ]
aliases = [ "/questions/51459" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Cannot see traffic on VLAN](/questions/51459/cannot-see-traffic-on-vlan)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-51459-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello</p><p>I am running Wireshark v1.12.10 on a Windows 7 Samsung computer, with a Marvell Yukon 88E8040 Fast Ethernet card. I have modified the registry so that *PriorityVLANTag is set to 0, and the SkDisableVlanStrip is set to 1. When I run a capture I am using the ip.addr filter, the relation is "is present" I am doing the capture on a Netgear FS726TP switch, which uses VLANs, using port mirroring. But when I do the capture, I am not getting any network traffic, except for DHCP broadcasts and NBNS Name queries. What is it I must do to get the real traffic running on the port. I know that the port is being used for access to the Internet and other traffic.</p><p>Thanks</p></div><div id="question-tags" class="tags-container tags">vlan</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>07 Apr '16, 03:25</strong></p><img src="https://secure.gravatar.com/avatar/64884cb419bb3531b03e82f593b93eac?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="skeating&#39;s gravatar image" /><p>skeating<br />
<span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="skeating has no accepted answers">0%</span></p></div></div><div id="comments-container-51459" class="comments-container"><span id="51463"></span><div id="comment-51463" class="comment"><div id="post-51463-score" class="comment-score"></div><div class="comment-text"><p>What happens it you don't apply the ip.addr filter?</p></div><div id="comment-51463-info" class="comment-info"><span class="comment-age">(07 Apr '16, 04:52)</span> Jaap ♦</div></div><span id="51464"></span><div id="comment-51464" class="comment"><div id="post-51464-score" class="comment-score"></div><div class="comment-text"><p>I still get the same results.</p></div><div id="comment-51464-info" class="comment-info"><span class="comment-age">(07 Apr '16, 04:59)</span> skeating</div></div><span id="51486"></span><div id="comment-51486" class="comment"><div id="post-51486-score" class="comment-score"></div><div class="comment-text"><p>Can you see the VLAN headers on those packets you do capture (DHCP broadcasts etc.)?</p><p>Because you claim a VLAN issue but to me it seems like a normal behaviour if you've connected your capturing machine to an ordinary port of a switch and there is no traffic for the capturing machine itself.</p></div><div id="comment-51486-info" class="comment-info"><span class="comment-age">(07 Apr '16, 10:36)</span> sindy</div></div><span id="51487"></span><div id="comment-51487" class="comment"><div id="post-51487-score" class="comment-score"></div><div class="comment-text"><p>And as you wrote that the port is used for access to internet, do you mean you have replaced the original counterpart of that switch port with the capturing PC and you expect to see the attempts of other PCs to access internet servers?</p></div><div id="comment-51487-info" class="comment-info"><span class="comment-age">(07 Apr '16, 10:38)</span> sindy</div></div><span id="51489"></span><div id="comment-51489" class="comment"><div id="post-51489-score" class="comment-score"></div><div class="comment-text"><p>I'm not sure what you mean about the port. I was using port mirroring, in which I am plugged into port #1, which is mirroring port #16, which is the live port. So I have not replaced any PCs, just attempting to capture the traffic going to them.</p></div><div id="comment-51489-info" class="comment-info"><span class="comment-age">(07 Apr '16, 11:16)</span> skeating</div></div><span id="51493"></span><div id="comment-51493" class="comment not_top_scorer"><div id="post-51493-score" class="comment-score"></div><div class="comment-text"><p>Sorry, I've missed the part about port mirroring in your question, and have only noticed</p><blockquote><p>What is it I must do to get the real traffic running on the port. I know that the port is being used for access to the Internet and other traffic.</p></blockquote><p>The point is that getting just DHCP and NBNS name queries is a typical case when you are connected to an ordinary (i.e. not mirroring) port, while the setting on your network card's driver regarding VLAN header stripping would normally affect only whether the VLAN headers make it to the level inside the network stack where the frames are actually captured. So if tagged frames are coming, you normally can see them even if you don't use that "don't strip" setting, except that the 802.1 Q headers are removed before the frame is captured.</p><p>So I can imagine three possibilities:</p><ul><li><p>the mirroring doesn't work as expected on the switch,</p></li><li><p>the driver settings regarding VLANs cause something to go wrong,</p></li><li><p>some security/firewall software interferes with your WinPcap operation.</p></li></ul><p>Can you capture your own traffic in both directions if connected to an ordinary port and default VLAN-related settings are used on the network card driver? If yes, is it still true after you activate the "don't strip" settings? If not, can you disable all firewall/anti-virus/even VPN software for the time of taking the capture (see other similar questions "I can see only XXX traffic" on this site for details)?</p></div><div id="comment-51493-info" class="comment-info"><span class="comment-age">(07 Apr '16, 13:03)</span> sindy</div></div><span id="51511"></span><div id="comment-51511" class="comment not_top_scorer"><div id="post-51511-score" class="comment-score"></div><div class="comment-text"><p>I found the problem. I was mirroring from port 16 to port 1, and getting no where. Then I remembered that if I needed to setup a trunk, I had to do so to another port near 16. So I mirrored to port 20, and I got all the packets I needed. Netgear, go figure.</p></div><div id="comment-51511-info" class="comment-info"><span class="comment-age">(08 Apr '16, 06:50)</span> skeating</div></div><span id="51551"></span><div id="comment-51551" class="comment not_top_scorer"><div id="post-51551-score" class="comment-score"></div><div class="comment-text"><p>Well, in the case of Cisco, for the destination Port to maintain the DOT 1Q portion of the encapsulation when the packet is reassembled the command "Encapsulation DOT 1Q replicate" has to be added as part of the destination configuration. But this is because most good Cisco switches can work on a layer 3 level. .if you don't have a router in place, a Layer 3 device that can route the other network and add the dot1Q tag, then you don't truly have a VLAN / segmentation / 2 separate networks. The netgear is a true layer 2 device. Do you have a router if so what model? What is the ip of the first and second network? What does your capture show?</p></div><div id="comment-51551-info" class="comment-info"><span class="comment-age">(11 Apr '16, 06:12)</span> msmorten</div></div></div><div id="comment-tools-51459" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-51459-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="51540"></span>

<div id="answer-container-51540" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-51540-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Are you sure your interface on the Windows machine is in promiscuous mode? Are you sure you port is mirroring traffic? What is on the VLAN? what should it be seeing?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>09 Apr '16, 18:37</strong></p><img src="https://secure.gravatar.com/avatar/7dc1fee5b4e29c4e6cc3d5059312aac7?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="msmorten&#39;s gravatar image" /><p>msmorten<br />
<span class="score" title="4 reputation points">4</span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="5 badges"><span class="silver">●</span><span class="badgecount">5</span></span><span title="8 badges"><span class="bronze">●</span><span class="badgecount">8</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="msmorten has no accepted answers">0%</span></p></div></div><div id="comments-container-51540" class="comments-container"><span id="51549"></span><div id="comment-51549" class="comment"><div id="post-51549-score" class="comment-score"></div><div class="comment-text"><p>I have found the solution to part of the problem. Netgear, for some reason, will not allow port mirroring to any port. I was trying to mirror port 16 onto port 1, but no luck. But if I mirrored port 16 onto port 20, then I would get the traffic on port 16. What I cannot get is the VLAN traffic. I see the IPs of the VLAN, but there are no VLAN packets in captured packets. Any ideas why I cannot see the VLAN packets?</p></div><div id="comment-51549-info" class="comment-info"><span class="comment-age">(11 Apr '16, 05:37)</span> skeating</div></div><span id="51553"></span><div id="comment-51553" class="comment"><div id="post-51553-score" class="comment-score"></div><div class="comment-text"><p>For instance, with Cisco, to get the VLAN tag to be included in the reassembly of the packet on the destination port it has to be written in as part of the command on the destination port "encapsulation dot1q replicate" and this adds the tag back to the packet from buffer on the destination port. But this is only because most good Cisco switches operate on layer 3. The Netgear switch you're using is a true layer 2 device. So if you don't have a router that is handling the segmentation and routing of the virtual network, then you don't have true vlan or separate networks. What are you using as your CSU or router? What are your captures showing you? I am not sure if the netgear is capable of mirroring the vlan tag , passing it to the destination port. If so, then the destination port would have IP coming from two networks.</p><p>I wouldn't normally ask questions like this in a Cisco environment but when it comes to this netgear, you never know. What is the gateway to your two networks ? Can you ping them? Can you verify that you have two networks?</p></div><div id="comment-51553-info" class="comment-info"><span class="comment-age">(11 Apr '16, 07:09)</span> msmorten</div></div><span id="51560"></span><div id="comment-51560" class="comment"><div id="post-51560-score" class="comment-score"></div><div class="comment-text"><p>Also, from you router to the port that connects to the switch, you have to make sure you're trunking the vlan(s) you want to see on this switch. If the port that connecting the router to the switch isn't truncking and is only an access port, then the switch will only have traffic for the vlan that it has access too.</p></div><div id="comment-51560-info" class="comment-info"><span class="comment-age">(11 Apr '16, 10:38)</span> msmorten</div></div><span id="51582"></span><div id="comment-51582" class="comment"><div id="post-51582-score" class="comment-score"></div><div class="comment-text"><blockquote><p>What I cannot get is the VLAN traffic. I see the IPs of the VLAN</p></blockquote><p>This sounds a bit confusing to me. If you can see "the IPs", it means to me that you can see the frames from/to those IPs, but without knowledge of the overall architecture of the network, it is hard to say anything.</p><p>But let's suppose that a frame sent by a device which is only connected to the VLAN of interest to some device in the internet only passes through your switch once and it is visible in the capture. In this case, the question is whether VLANs and their monitoring do not work the way you expect on the switch (as @msmorten suggests) or whether the Marvell driver ignores the <code>SkDisableVlanStrip</code> setting and thus strips the 802.1Q headers before WinPcap or Npcap can read the frames.</p><p>To find out which one is true, I'd suggest to make an ordinary (<strong>not</strong> monitoring) port a member of the VLAN of interest and configure it as a "trunk" one (using Cisco terminology) or (using the terminology of most other switch vendors) so that this VLAN's frames would be sent out tagged, connect your PC to that port and run the capture with the <code>SkDisableVlanStrip</code> of the driver set to 1. If the broadcast frames (ARP requests, DHCP discoveries, NBNS name requests etc.) which you are going to capture this way have the 802.1Q headers in this case, the Marvell driver and WinPcap/Npcap are fine and the issue is the Netgear (or its setting); if you cannot see the 802.1Q headers even this way, the issue is the Marvell driver or the ?Pcap filter.</p><p>Just for the case, I assume you look for the VLAN ID into the dissection pane of a single frame, not just to the packet list which does not show the VLAN IDs by default - you would have to manually add a column to the packet list to see it there (which is easiest to do by right-clicking the field in the dissection pane and choosing <code>Apply as Column</code>).</p></div><div id="comment-51582-info" class="comment-info"><span class="comment-age">(12 Apr '16, 01:55)</span> sindy</div></div><span id="51592"></span><div id="comment-51592" class="comment"><div id="post-51592-score" class="comment-score"></div><div class="comment-text"><p>Is there a specific capture filter in Wireshark I should be using along with registry changes for the Marvell. I have read this: <a href="https://wiki.wireshark.org/CaptureSetup/VLAN#Capture_filters">https://wiki.wireshark.org/CaptureSetup/VLAN#Capture_filters</a> but do not understand the section on Capture Filters. Do I need to create one, or is there one already in the collection of filters in Wireshark?</p></div><div id="comment-51592-info" class="comment-info"><span class="comment-age">(12 Apr '16, 04:22)</span> skeating</div></div><span id="51599"></span><div id="comment-51599" class="comment not_top_scorer"><div id="post-51599-score" class="comment-score"></div><div class="comment-text"><blockquote><p>capture filter in Wireshark I should be using along with registry changes for the Marvell</p></blockquote><p>These two things are independent.</p><p>A capture filter <em>restricts</em> the capture to packets which match the expression, and no expression at all means everything is captured. But the capture filter does not <em>modify</em> the packets in any way, so it is unable to remove the 802.1Q headers even if used.</p><p>So if</p><ul><li><p>you are capturing on an ordinary port about which you are 100% sure that it sends out tagged frames,</p></li><li><p>SkDisableVlanStrip` is set to 1,</p></li><li><p>you use no capture filter at all,</p></li><li><p>you can see only frames without <code>802.1Q Virtual LAN</code> layer between <code>Ethernet II</code> and <code>Internet Protocol Version n</code> layers</p></li></ul><p>are all true, then the driver ignores the <code>SkDisableVlanStrip</code>. It may, however, require a restart so that this option would come into effect.</p></div><div id="comment-51599-info" class="comment-info"><span class="comment-age">(12 Apr '16, 06:36)</span> sindy</div></div></div><div id="comment-tools-51540" class="comment-tools"><span class="comments-showing"> showing 5 of 6 </span> <a href="#" class="show-all-comments-link">show 1 more comments</a></div><div class="clear"></div><div id="comment-51540-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="51571"></span>

<div id="answer-container-51571" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-51571-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Hi, you can try Npcap: <a href="https://github.com/nmap/npcap/releases">https://github.com/nmap/npcap/releases</a>. It's a update to original WinPcap (which is the capturing driver for Windows) and supports VLAN tag for capturing and sending.</p><p>Make sure you checked the "Support 802.1Q VLAN tag when capturing and sending data" option in the installer.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>11 Apr '16, 17:46</strong></p><img src="https://secure.gravatar.com/avatar/0f8ec58f46e4af3a67f768675c20aac8?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Yang%20Luo&#39;s gravatar image" /><p>Yang Luo<br />
<span class="score" title="91 reputation points">91</span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Yang Luo has one accepted answer">4%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 11 Apr '16, 17:47</p></div></div><div id="comments-container-51571" class="comments-container"><span id="51590"></span><div id="comment-51590" class="comment"><div id="post-51590-score" class="comment-score"></div><div class="comment-text"><p>The Npcap only works on WIFI, right? I need to connect with a cable. Is there something that does the same update for WinPcap using Ethernet?</p></div><div id="comment-51590-info" class="comment-info"><span class="comment-age">(12 Apr '16, 04:13)</span> skeating</div></div><span id="51594"></span><div id="comment-51594" class="comment"><div id="post-51594-score" class="comment-score"></div><div class="comment-text"><p>npcap works on wired Ethernet as well as WiFi.</p></div><div id="comment-51594-info" class="comment-info"><span class="comment-age">(12 Apr '16, 04:29)</span> grahamb ♦</div></div></div><div id="comment-tools-51571" class="comment-tools"></div><div class="clear"></div><div id="comment-51571-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

