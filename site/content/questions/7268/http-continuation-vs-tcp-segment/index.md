+++
type = "question"
title = "HTTP Continuation vs. TCP segment"
description = '''I&#x27;m examining results from tcpdump using wireshark/tshark and I&#x27;m seeing many packets with info &quot;Continuation or non-HTTP traffic&quot; and many other packets with info &quot;[TCP segment of a reassembled PDU]&quot;. I&#x27;m curious as to what the difference between the two is. The trace comes from a simulation of cli...'''
date = "2011-11-07T18:31:00Z"
lastmod = "2011-11-18T05:31:00Z"
weight = 7268
keywords = [ "continuation", "segment", "http", "tcp", "tcpdump" ]
aliases = [ "/questions/7268" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [HTTP Continuation vs. TCP segment](/questions/7268/http-continuation-vs-tcp-segment)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7268-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7268-score" class="post-score" title="current number of votes">1</div><span id="post-7268-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>I'm examining results from tcpdump using wireshark/tshark and I'm seeing many packets with info "Continuation or non-HTTP traffic" and many other packets with info "[TCP segment of a reassembled PDU]". I'm curious as to what the difference between the two is.</p><p>The trace comes from a simulation of client-server interaction using HTTP streaming. Each client initiates an HTTP connection (using GET) and the server proceeds to send back chunked data indefinitely. The size of the content is therefore unknown and cannot be provided in the header.</p><p>I'm quite confused because when I compare a "Continuation" packet with a "TCP segment" packet, they look nearly identical (the differences being minor details such as the timestamp). Can anyone shed some light on these two concepts for me?</p><p>Thank-you,</p><p>Eric</p><p><strong>Edit:</strong></p><p>Here is one of my <a href="http://cloudshark.org/captures/48a0ca8e0d35">captures</a>. In this particular trace, it looks like the switchover from "reassembled PDU" to "HTTP continuation" starts at number 6054/6055. Note that there are quite a lot of duplicate messages where the difference is just in the port; this is because it is simulating many clients (500 in this one, I believe).</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-continuation" rel="tag" title="see questions tagged &#39;continuation&#39;">continuation</span> <span class="post-tag tag-link-segment" rel="tag" title="see questions tagged &#39;segment&#39;">segment</span> <span class="post-tag tag-link-http" rel="tag" title="see questions tagged &#39;http&#39;">http</span> <span class="post-tag tag-link-tcp" rel="tag" title="see questions tagged &#39;tcp&#39;">tcp</span> <span class="post-tag tag-link-tcpdump" rel="tag" title="see questions tagged &#39;tcpdump&#39;">tcpdump</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>07 Nov '11, 18:31</strong></p><img src="https://secure.gravatar.com/avatar/52c6078760d2bc4d0238604270db8186?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="eHalcyon&#39;s gravatar image" /><p><span>eHalcyon</span><br />
<span class="score" title="16 reputation points">16</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="eHalcyon has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>10 Nov '11, 15:43</strong> </span></p></div></div><div id="comments-container-7268" class="comments-container"></div><div id="comment-tools-7268" class="comment-tools"></div><div class="clear"></div><div id="comment-7268-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="7269"></span>

<div id="answer-container-7269" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7269-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7269-score" class="post-score" title="current number of votes">2</div><span id="post-7269-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>This is merely a result of the TCP Protocol preferences setup, giving you two different views on the same type of data. If you go to your Wireshark Preferences and select the TCP protocol settings, you'll see something called "Allow subdisector to reassemble TCP streams". Depending on wether it is checked or unchecked you get either "reassembled PDU" or "continuation" Messages in the info column.</p><p>What this setting does is to allow Wireshark to look for and combine packets that contain pieces of the same payload and reconstruct it for you (otherwise you'd have to export them one by one and assemble them yourself). This is mostly needed for payload reconstruction. If you're more interested in packet timings etc. it is usually better to disable reassembly to see a clearer view on what happened when.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>07 Nov '11, 23:59</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-7269" class="comments-container"><span id="7288"></span><div id="comment-7288" class="comment"><div id="post-7288-score" class="comment-score"></div><div class="comment-text"><p>Thanks for the response! I tried unchecking the option, which left only "Continuation" messages. However, I am still curious as to why BOTH messages appear when the option is set. That is, when I "allow subdisector to reassemble TCP streams", it starts off with "reassembled PDU" but still eventually ends up with "continuation" messages.</p></div><div id="comment-7288-info" class="comment-info"><span class="comment-age">(08 Nov '11, 12:49)</span> <span class="comment-user userinfo">eHalcyon</span></div></div></div><div id="comment-tools-7269" class="comment-tools"></div><div class="clear"></div><div id="comment-7269-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="7317"></span>

<div id="answer-container-7317" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-7317-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-7317-score" class="post-score" title="current number of votes">2</div><span id="post-7317-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>In fact there are at least three different issues with reassembling considered chunked HTTP transfer encoding and you must check your preferences very carefully, especially if you are dealing with 'endless' server connection sending chunks of messages.</p><p>First, the application-level protocol packet, such as HTTP request may fit in single TCP segment, and may not. If the HTTP header is big enough to be split in segments (that's a rare issue, but happens if site is sending lots of cookies and optional X-headers), then you will see two or more packets in the wireshark capture, period. The same can happen to HTTP response headers and mostly it does happen to HTTP request/response bodies. Sometimes applications just do send HTTP headers in single TCP segment and HTTP body in next one. But please note, that those segments have nothing in common with chunks, when chunked Transfer-Encoding is used, because that encoding is application level and TCP is the transport level of the OSI model. So, even your single "chunk" can span multiple segments. But that's not the whole story. Single TCP segment can either fit in ethernet frame (PDU), but can be split as well. Most of the time this does not happen, but for some badly configured Windows machines the maximum size of TCP frame is bigger then usual maximum of Ethernet switches can handle. To add more fun, transport-level packets must be ACK'ed by the endpoint, and sometimes ACK is set within next TCP data packet, and sometimes it is sent separately, while still on the same HTTP port.</p><p>So, if you try to analyse Web application traffic on TCP level, you'll get a loads of useless sh#t most of the time. That's why you should use filters.</p><p>To help upper-level protocols collect and filter information, the wireshark dissectors have notion of 'reassembling', where higher-level dissector returns special code meaning 'hey, I need more data to properly dissect this packet' and then processing is restarted when more data arrives.</p><p>If you turn off ALL reassembling options for TCP and HTTP (and SSL) protocols, then you'll see the naked packets as they are on the wire. You'll notice that 'Continuation of HTTP traffic' message in Info column when packet is with data, but neither HTTP request nor HTTP response header found within it. And all packets without data will be tagged as plain TCP in Protocol column. Mostly that's about ACKs, SYNs and FINs, so you can filter them out.</p><p>If you allow TCP to reassemble streams, but leave other options unchecked - the picture won't change much, because upper level protocols won't request reassembling.</p><p>If you allow HTTP to request reassembling the headers spanning multiple segments and bodies then you can already do filtering by application protocol means. E.g. enter 'http' in the Display filter and you'll can forget about all [reassembled PDU] infos - they all be marked as being 'TCP' protocol.</p><p>Now the dangled part - reassembling application-level chunks. If you analyse protocol that depends upon sending data in chunks, e.g. AJAX chat over HTTP, I'd suggest leaving that option unchecked. Because reassembling stops when you receive the chunk with '0' size, which in your case you would never.</p><p>However, if your application does encode HTTP bodies with gzip, and use chunked encoding just to send it in streamlined version, you'd better check option of chunk reassembling, otherwise ungzipping will fail.</p><p>That was quite a lot of text above, but hope now everything is clear for you.</p><p>Also, if you want more advanced filtering options for HTTP responses, you may find it useful to install following Lua script : <a href="https://github.com/shomeax/wireshark-http-extra">Assocating HTTP responses to requests in Wireshark</a>. Should you have any questions about it, feel free to ask.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Nov '11, 22:57</strong></p><img src="https://secure.gravatar.com/avatar/35d96b8e73e6deb4e332d076fd3269b6?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="ShomeaX&#39;s gravatar image" /><p><span>ShomeaX</span><br />
<span class="score" title="73 reputation points">73</span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="ShomeaX has no accepted answers">0%</span></p></div></div><div id="comments-container-7317" class="comments-container"><span id="7332"></span><div id="comment-7332" class="comment"><div id="post-7332-score" class="comment-score"></div><div class="comment-text"><p>All very interesting! However, I am still confused as to why I am seeing both "reassembled PDU" and "HTTP continuation" messages in the same trace when the "allow subdisector to reassemble TCP streams" option is checked. Any ideas?</p></div><div id="comment-7332-info" class="comment-info"><span class="comment-age">(09 Nov '11, 12:00)</span> <span class="comment-user userinfo">eHalcyon</span></div></div><span id="7338"></span><div id="comment-7338" class="comment"><div id="post-7338-score" class="comment-score"></div><div class="comment-text"><p>Does this by any chance happen after a lost packet?</p><p>It might also be a bug in the HTTP dissector, but it's hard to tell without the tracefile...</p></div><div id="comment-7338-info" class="comment-info"><span class="comment-age">(09 Nov '11, 14:51)</span> <span class="comment-user userinfo">SYN-bit ♦♦</span></div></div><span id="7344"></span><div id="comment-7344" class="comment"><div id="post-7344-score" class="comment-score"></div><div class="comment-text"><p>+1 for posting tracefile, but considering the context, the first might be part of responses with Content-Length set, and the last are just the responses with Transfer-Encoding set to chunked, in case you've unchecked the "reassemble chunked-transfer bodies" in HTTP settings.</p></div><div id="comment-7344-info" class="comment-info"><span class="comment-age">(09 Nov '11, 16:25)</span> <span class="comment-user userinfo">ShomeaX</span></div></div><span id="7347"></span><div id="comment-7347" class="comment"><div id="post-7347-score" class="comment-score"></div><div class="comment-text"><p>No, packets do not seem to be lost. Well, I have a few "TCP ACKed lost segment" but there are no retransmissions so I think that means that TCPdump just missed the segment but caught the ACK. But those messages don't come up near where it starts switching from "reassembled PDU" to "continuation".<br />
</p><p>Apologies for my ignorance, but is there a way for me to attach a file here or should I just copy+paste text?</p></div><div id="comment-7347-info" class="comment-info"><span class="comment-age">(09 Nov '11, 16:54)</span> <span class="comment-user userinfo">eHalcyon</span></div></div><span id="7358"></span><div id="comment-7358" class="comment"><div id="post-7358-score" class="comment-score">1</div><div class="comment-text"><p>oh, yeah, http://cloudshark.org looks more useful for uploading captures. =)</p></div><div id="comment-7358-info" class="comment-info"><span class="comment-age">(09 Nov '11, 23:39)</span> <span class="comment-user userinfo">ShomeaX</span></div></div><span id="7378"></span><div id="comment-7378" class="comment not_top_scorer"><div id="post-7378-score" class="comment-score"></div><div class="comment-text"><p><a href="http://cloudshark.org/captures/48a0ca8e0d35">http://cloudshark.org/captures/48a0ca8e0d35</a></p><p>In this particular trace, it looks like the switchover from "reassembled PDU" to "HTTP continuation" starts at number 6054/6055. Note that there are quite a lot of duplicate messages where the difference is just in the port; this is because it is simulating many clients (500 in this one, I believe).</p></div><div id="comment-7378-info" class="comment-info"><span class="comment-age">(10 Nov '11, 13:14)</span> <span class="comment-user userinfo">eHalcyon</span></div></div><span id="7381"></span><div id="comment-7381" class="comment not_top_scorer"><div id="post-7381-score" class="comment-score"></div><div class="comment-text"><p>From what I see, there is the exact http response packet missing in the tcp stream which frame 6055 is part of (ip.addr==192.168.0.169 and ip.addr==192.168.0.170 and tcp.port==60078).</p><p>Could this be the thing missing in order for reassembly to get started? Because if I for example select "ignore packet" on a 200 OK in my 1.6.0 wireshark, I see the absolute same thing that reassembly stops to work after a packet loss which is pretty obvious to me</p></div><div id="comment-7381-info" class="comment-info"><span class="comment-age">(11 Nov '11, 03:56)</span> <span class="comment-user userinfo">Landi</span></div></div><span id="7422"></span><div id="comment-7422" class="comment not_top_scorer"><div id="post-7422-score" class="comment-score"></div><div class="comment-text"><p>Landi, I'm not sure what you mean. In frame 6055's tcp stream (204), I do see that a packet was lost in the capture (there is a an ACK for a lost segment). Is this what you're referring to?</p><p>If I examine the tcp stream for frame 6054 (459), that one switches from "reassembled PDU" to "Continuation" on frame 15091, well before any lost packets.</p></div><div id="comment-7422-info" class="comment-info"><span class="comment-age">(14 Nov '11, 12:17)</span> <span class="comment-user userinfo">eHalcyon</span></div></div><span id="7466"></span><div id="comment-7466" class="comment not_top_scorer"><div id="post-7466-score" class="comment-score"></div><div class="comment-text"><p>@eHalcyon: That's not what I see in your capture</p><p>tcp.stream == 459 gives me perfect "... Reassembled PDU" statements including your mentioned frame 15091. However, later in frame(s) 22861 and 23411 there are ACKed lost segments again and THEN reassembly - like expected - kicks out.</p><p>http://www.imgbox.de/users/public/images/KVIqC7mj5D.png</p></div><div id="comment-7466-info" class="comment-info"><span class="comment-age">(16 Nov '11, 03:05)</span> <span class="comment-user userinfo">Landi</span></div></div><span id="7474"></span><div id="comment-7474" class="comment not_top_scorer"><div id="post-7474-score" class="comment-score"></div><div class="comment-text"><p>@Landi - huh, when I view it on CloudShark I see what you see. But viewing the same stream in Wireshark, I see this:</p><p><a href="http://img215.imageshack.us/img215/2220/wiresharks.png">http://img215.imageshack.us/img215/2220/wiresharks.png</a></p></div><div id="comment-7474-info" class="comment-info"><span class="comment-age">(16 Nov '11, 12:06)</span> <span class="comment-user userinfo">eHalcyon</span></div></div><span id="7500"></span><div id="comment-7500" class="comment not_top_scorer"><div id="post-7500-score" class="comment-score"></div><div class="comment-text"><p>Maybe a version issue ? I don't know which Wireshark Version is running behind cloudshark - but maybe you go for the latest 1.6.3 version and compere with one or two others running as portable apps?</p></div><div id="comment-7500-info" class="comment-info"><span class="comment-age">(18 Nov '11, 05:31)</span> <span class="comment-user userinfo">Landi</span></div></div></div><div id="comment-tools-7317" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-7317-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

