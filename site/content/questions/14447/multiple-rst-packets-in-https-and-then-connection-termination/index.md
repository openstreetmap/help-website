+++
type = "question"
title = "Multiple RST packets in HTTPS and then Connection Termination"
description = '''Hi All,  I have been analyzing the wire shark logs of an HTTPS communication between two Applications. One applications works always, and the second one causes intermittent failures. I will post the logs of the one sample dialogue between the two and highlight the differences. But being new to Wire ...'''
date = "2012-09-22T04:02:00Z"
lastmod = "2012-09-22T04:02:00Z"
weight = 14447
keywords = [ "tcp", "https" ]
aliases = [ "/questions/14447" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [Multiple RST packets in HTTPS and then Connection Termination](/questions/14447/multiple-rst-packets-in-https-and-then-connection-termination)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-14447-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi All,</p><p>I have been analyzing the wire shark logs of an HTTPS communication between two Applications. One applications works always, and the second one causes intermittent failures. I will post the logs of the one sample dialogue between the two and highlight the differences. But being new to Wire shark, I am not able to interpret what behavior change is being caused by the difference, and need your expert opinion on the same:</p><p><strong>Working Application Logs</strong></p><ol><li>1142 109.255954 16.185.87.18 15.5.160.6 TCP 66 58382 &gt; https [SYN] Seq=0 Win=8192 Len=0 MSS=1460 WS=256 SACK_PERM=1</li><li>1146 109.562500 15.5.160.6 16.185.87.18 TCP 66 https &gt; 58382 [SYN, ACK] Seq=0 Ack=1 Win=8760 Len=0 MSS=1460 WS=1 SACK_PERM=1</li><li>1147 109.562548 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [ACK] Seq=1 Ack=1 Win=65536 Len=0</li><li>1148 109.566846 16.185.87.18 15.5.160.6 TLSv1 149 Client Hello</li><li>1152 109.873089 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58382 [ACK] Seq=1 Ack=96 Win=8665 Len=0</li><li>1153 109.874842 15.5.160.6 16.185.87.18 TLSv1 801 Server Hello, Certificate, Server Hello Done</li><li>1154 109.875756 16.185.87.18 15.5.160.6 TLSv1 252 Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message</li><li>1158 110.182242 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58382 [ACK] Seq=748 Ack=294 Win=8467 Len=0</li><li>1159 110.273444 15.5.160.6 16.185.87.18 TLSv1 113 Change Cipher Spec, Encrypted Handshake Message</li><li>1161 110.308246 16.185.87.18 15.5.160.6 TLSv1 171 Application Data</li><li>1164 110.614644 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58382 [ACK] Seq=807 Ack=411 Win=8350 Len=0</li><li>1167 110.663087 15.5.160.6 16.185.87.18 TLSv1 395 Application Data</li><li>1168 110.666238 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>1169 110.666281 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [ACK] Seq=411 Ack=2608 Win=65536 Len=0</li><li>1170 110.666301 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>1178 110.872278 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [ACK] Seq=411 Ack=4068 Win=65536 Len=0</li><li>1181 110.973815 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>1187 111.182323 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [ACK] Seq=411 Ack=5528 Win=65536 Len=0</li><li>1189 111.489027 15.5.160.6 16.185.87.18 TLSv1 799 Application Data</li><li>1190 111.489779 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [FIN, ACK] Seq=411 Ack=6273 Win=64768 Len=0</li><li>1201 111.796470 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58382 [ACK] Seq=6273 Ack=412 Win=8349 Len=0</li><li>1202 111.796879 15.5.160.6 16.185.87.18 TLSv1 91 Encrypted Alert</li><li>1203 111.796923 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [<strong>RST, ACK</strong>] Seq=412 Ack=6310 Win=0 Len=0</li><li>1204 111.796949 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58382 [<strong>FIN, PSH, ACK</strong>] Seq=6310 Ack=412 Win=8349 Len=0</li><li>1205 111.796967 16.185.87.18 15.5.160.6 TCP 54 58382 &gt; https [<strong>RST</strong>] Seq=412 Win=0 Len=0</li></ol><p>Then a new connection session begins:</p><ol><li>1259 113.651110 16.185.87.18 15.5.160.6 TCP 66 58385 &gt; https [SYN] Seq=0 Win=8192 Len=0 MSS=1460 WS=256 SACK_PERM=1</li><li>1269 113.957672 15.5.160.6 16.185.87.18 TCP 66 https &gt; 58385 [SYN, ACK] Seq=0 Ack=1 Win=8760 Len=0 MSS=1460 WS=1 SACK_PERM=1</li><li>...</li></ol><p>But in case of the application instance that has failures I am noticing some differences. Let me highlight the part.</p><p><strong>Failing Application Logs</strong></p><ol><li>4267 58.755022 16.185.87.18 15.5.160.6 TCP 66 58340 &gt; https [SYN] Seq=0 Win=8192 Len=0 MSS=1460 WS=256 SACK_PERM=1</li><li>4423 59.061045 15.5.160.6 16.185.87.18 TCP 66 https &gt; 58340 [SYN, ACK] Seq=0 Ack=1 Win=8760 Len=0 MSS=1460 WS=1 SACK_PERM=1</li><li>4424 59.061089 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [ACK] Seq=1 Ack=1 Win=65536 Len=0</li><li>4425 59.066820 16.185.87.18 15.5.160.6 TLSv1 149 Client Hello</li><li>4430 59.375396 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58340 [ACK] Seq=1 Ack=96 Win=8665 Len=0</li><li>4431 59.377159 15.5.160.6 16.185.87.18 TLSv1 801 Server Hello, Certificate, Server Hello Done</li><li>4432 59.378007 16.185.87.18 15.5.160.6 TLSv1 252 Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message</li><li>4435 59.686364 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58340 [ACK] Seq=748 Ack=294 Win=8467 Len=0</li><li>4439 59.779045 15.5.160.6 16.185.87.18 TLSv1 113 Change Cipher Spec, Encrypted Handshake Message</li><li>4441 59.832138 16.185.87.18 15.5.160.6 TLSv1 203 Application Data</li><li>4445 60.138602 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58340 [ACK] Seq=807 Ack=443 Win=8318 Len=0</li><li>4446 60.189159 15.5.160.6 16.185.87.18 TLSv1 395 Application Data</li><li>4447 60.192510 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>4448 60.192609 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [ACK] Seq=443 Ack=2608 Win=65536 Len=0</li><li>4449 60.192621 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>4454 60.388331 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [ACK] Seq=443 Ack=4068 Win=65536 Len=0</li><li>4455 60.499965 15.5.160.6 16.185.87.18 TCP 1514 [TCP segment of a reassembled PDU]</li><li>4456 60.698432 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [ACK] Seq=443 Ack=5528 Win=65536 Len=0</li><li>4460 61.007118 15.5.160.6 16.185.87.18 TLSv1 799 Application Data</li><li>4461 61.011470 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [FIN, ACK] Seq=443 Ack=6273 Win=64768 Len=0</li><li><strong><em>4462 61.013786 16.185.87.18 15.5.160.6 TCP 66 58342 &gt; https [SYN] Seq=0 Win=8192 Len=0 MSS=1460 WS=256 SACK_PERM=1</em></strong></li><li>4464 61.317911 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58340 [ACK] Seq=6273 Ack=444 Win=8317 Len=0</li><li>4465 61.318379 15.5.160.6 16.185.87.18 TLSv1 91 Encrypted Alert</li><li>4466 61.318407 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [RST, ACK] Seq=444 Ack=6310 Win=0 Len=0</li><li>4467 61.318655 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58340 [FIN, PSH, ACK] Seq=6310 Ack=444 Win=8317 Len=0</li><li>4468 61.318671 16.185.87.18 15.5.160.6 TCP 54 58340 &gt; https [RST] Seq=444 Win=0 Len=0</li></ol><p>Then the second call starts:</p><ol><li><strong><em>4469 61.321573 15.5.160.6 16.185.87.18 TCP 66 https &gt; 58342 [SYN, ACK] Seq=0 Ack=1 Win=8760 Len=0 MSS=1460 WS=1 SACK_PERM=1</em></strong></li><li><strong><em>4470 61.321597 16.185.87.18 15.5.160.6 TCP 54 58342 &gt; https [ACK] Seq=1 Ack=1 Win=65536 Len=0</em></strong></li><li>...</li></ol><p>After running like this for a while, then we start seeing issues like:</p><ol><li>4710 65.535669 16.185.87.18 15.5.160.6 TCP 54 58343 &gt; https [RST, ACK] Seq=337 Ack=5642 Win=0 Len=0</li><li>4711 65.535713 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58343 [FIN, PSH, ACK] Seq=5642 Ack=337 Win=8424 Len=0</li><li>4712 65.535725 16.185.87.18 15.5.160.6 TCP 54 58343 &gt; https [RST] Seq=337 Win=0 Len=0</li><li>4715 65.701371 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58344 [<strong>RST</strong>] Seq=1 Win=0 Len=0</li><li>4720 65.843009 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58344 [<strong>RST</strong>] Seq=1 Win=0 Len=0</li><li>4721 65.843798 15.5.160.6 16.185.87.18 TCP 60 https &gt; 58344 [<strong>RST</strong>] Seq=1 Win=0 Len=0</li></ol><p>This tells me that, in case of the second application, before even the connection for first request over HTTPS has been closed, the initial handshaking for the second request as well has started. Please notice: Line number 21, in case of Failing Application Logs.</p><p>But, with my limited knowledge, thats what I am guessing, if somebody could confirm, that is the case, could explain things a bit, it would be really helpful.</p><p>Thanks and Regards,</p><p>Sanket<br />
</p></div><div id="question-tags" class="tags-container tags">tcp https</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>22 Sep '12, 04:02</strong></p><img src="https://secure.gravatar.com/avatar/35246684b7f373b28c8e8d45a6bb7818?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Sanket&#39;s gravatar image" /><p>Sanket<br />
<span class="score" title="1 reputation points">1</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Sanket has no accepted answers">0%</span> </br></p></div></div><div id="comments-container-14447" class="comments-container"><span id="14451"></span><div id="comment-14451" class="comment"><div id="post-14451-score" class="comment-score"></div><div class="comment-text"><p>It takes much more time for us if don't post the actual pcap file. But opening a second connection isn't a problem in and of itself. It could be opening up a new connection because of HTTP issues (redirects for example) or because SSL has a short keep-alive timer. The "Encrypted alert" is telling you the SSL is about to be torn down. You need to look inside the SSL by decoding it (requires getting the key) or by using client tools like HTTP Analyzer.</p></div><div id="comment-14451-info" class="comment-info"><span class="comment-age">(22 Sep '12, 16:55)</span> hansangb</div></div></div><div id="comment-tools-14447" class="comment-tools"></div><div class="clear"></div><div id="comment-14447-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

