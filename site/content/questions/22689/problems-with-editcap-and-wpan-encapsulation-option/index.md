+++
type = "question"
title = "Problems with editcap and &quot;wpan&quot; encapsulation option"
description = '''Hello everyone. I&#x27;m doing some work in wireless sensor networks and right now I have a capture file with some IEEE 802.15.4 frames encapsulated in SLL. The protocols in each frame are: sll:wpan:6lowpan:ipv6:icmpv6 I tried removing the SLL header and changing the encapsulation type using editcap with...'''
date = "2013-07-05T07:27:00Z"
lastmod = "2013-07-08T11:50:00Z"
weight = 22689
keywords = [ "wpan", "6lowpan", "editcap" ]
aliases = [ "/questions/22689" ]
osqa_answers = 2
osqa_accepted = true
+++

<div class="headNormal">

# [Problems with editcap and "wpan" encapsulation option](/questions/22689/problems-with-editcap-and-wpan-encapsulation-option)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-22689-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello everyone. I'm doing some work in wireless sensor networks and right now I have a capture file with some IEEE 802.15.4 frames encapsulated in SLL. The protocols in each frame are: sll:wpan:6lowpan:ipv6:icmpv6</p><p>I tried removing the SLL header and changing the encapsulation type using editcap with the following command:</p><p><code>editcap -T wpan -C 16 test.pcap test_wpan.pcap</code></p><p>However, when trying to read the test_wpan.pcap file, I got a two-byte padding warning in my ICMPv6 (IEEE 802.15.4 footer with FCS), which leads me to believe the "wpan" option is actually setting the encapsulation type of "wpan-nofcs".</p><p>Regarding the WTAP_ENCAP number, with no processing of editcap I see 25 in each number. When I use editcap with "wpan", the number is changed to 104, and when I use the "wpan-nofcs" the number set is 127. Taking a look at <a href="http://www.tcpdump.org/linktypes.html">http://www.tcpdump.org/linktypes.html</a>, shouldn't the numbers be:</p><ul><li>SLL -&gt; 113</li><li>WPAN -&gt; 195</li><li>WPAN-NOFCS -&gt; 230</li></ul><p>??</p><p>Am I missing something?</p></div><div id="question-tags" class="tags-container tags">wpan 6lowpan editcap</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>05 Jul '13, 07:27</strong></p><img src="https://secure.gravatar.com/avatar/258b6e228a70fe84b9cb7df3b89c809b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="ojay&#39;s gravatar image" /><p>ojay<br />
<span class="score" title="16 reputation points">16</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="4 badges"><span class="silver">●</span><span class="badgecount">4</span></span><span title="7 badges"><span class="bronze">●</span><span class="badgecount">7</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="ojay has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 08 Jul '13, 10:13</p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p>cmaynard ♦♦<br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span></p></div></div><div id="comments-container-22689" class="comments-container"></div><div id="comment-tools-22689" class="comment-tools"></div><div class="clear"></div><div id="comment-22689-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="22733"></span>

<div id="answer-container-22733" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-22733-score" class="post-score" title="current number of votes">2</div></div></td><td><div class="item-right"><div class="answer-body"><p>OK, hopefully this will be of more help:</p><ol><li><p>Chop off the 16 bytes of the Linux cooked capture encapsulation, saving to a pcap file for best chance at success (NOTE: At this point, specifying "<code>-T wpan</code>" isn't strictly required):</p><p><code>editcap -T wpan -C 16 -F libpcap test.pcap tmp.pcap</code></p></li><li><p>Open the tmp.pcap file with Wireshark &gt;= SVN revision 50036. (Visit <a href="http://wiresharkdownloads.riverbed.com/wireshark/automated/">http://wiresharkdownloads.riverbed.com/wireshark/automated/</a> and download a recent automated version meeting that criteria.)</p><p>The packets are not correctly decoded because Wireshark now thinks that all frames are 16 bytes shorter than they're supposed to be. This can be corrected by exporting the packets to a text file and then re-importing them back into a new capture file, this time specifying the encapsulation.</p></li><li><p>Before exporting to text:</p><p>a. Add the "Absolute date and time" column.</p><p>b. Temporarily hide all other columns.</p><p>c. Turn off: Edit/Preferences/Protocols/Data/ "Show not dissected data on new Packet Bytes pane".</p></li><li><p>File/Export Packet Dissections/As "Plain Text" file...</p><p>a. Include the packet summary line (Absolute date and time only)</p><p>b. Exclude the column headings.</p><p>c. Exclude the packet details.</p><p>d. Include the packet bytes.</p><p>e. File name: tmp.txt</p></li><li><p>Close the current (incorrectly decoded) tmp.pcap capture file.</p></li><li><p>Import the tmp.txt file to a correctly decoded pcap file via File/Import from Hex Dump...:</p><p>a. Browse to where tmp.txt is located.</p><p>b. Select Date/Time and check that Format = "%F %T." (no quotes).</p><p>c. Select "IEEE 802.15.4 Wireless PAN" as the Encapsulation type.</p></li></ol><p>If all went OK, you should know have an as-yet unsaved pcap file in the format you were looking for. There may be an easier way to do this, but hopefully this provides at least 1 usable solution for you.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Jul '13, 11:50</strong></p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p>cmaynard ♦♦<br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="cmaynard has 108 accepted answers">20%</span></p></div></div><div id="comments-container-22733" class="comments-container"><span id="22768"></span><div id="comment-22768" class="comment"><div id="post-22768-score" class="comment-score"></div><div class="comment-text"><p>I can't post a comment, Akismet always considers it SPAM -.-</p><p>--edit--<br />
I'm having problems compiling Wireshark, I posted a question about it but I can't paste the link to it here because apparently the anti-spam plugin thinks it's spam. Good times...</p></div><div id="comment-22768-info" class="comment-info"><span class="comment-age">(09 Jul '13, 13:53)</span> ojay</div></div><span id="22775"></span><div id="comment-22775" class="comment"><div id="post-22775-score" class="comment-score"></div><div class="comment-text"><p>Hmm, that's too bad. Try posting to <a href="http://www.wireshark.org/lists/">wireshark-dev</a>?</p></div><div id="comment-22775-info" class="comment-info"><span class="comment-age">(09 Jul '13, 16:57)</span> cmaynard ♦♦</div></div><span id="22777"></span><div id="comment-22777" class="comment"><div id="post-22777-score" class="comment-score"></div><div class="comment-text"><p>BTW, the only reason I suggested using r50036 or later is so that you can avoid writing the column headings to the temporary tmp.txt file, because if they're present, the import will fail. You may be able to get away with not upgrading if you can figure out how to write a script that removes the column headings from the tmp.txt file prior to importing.</p></div><div id="comment-22777-info" class="comment-info"><span class="comment-age">(09 Jul '13, 17:37)</span> cmaynard ♦♦</div></div><span id="22819"></span><div id="comment-22819" class="comment"><div id="post-22819-score" class="comment-score"></div><div class="comment-text"><p>Okay I managed to successfully compile it! Thank you for all the help! :D</p><p>One thing though, when I try to save the file as pcap (Wireshark wants to save it in pcap-ng by default), I get a warning message saying there are comments in the file and if I save in pcap format I will loose them. Now, I don't what those comments might be. Is there anyway to read the comments and then decide if I want to delete/modify instead of Wireshark just telling me there are comments without me being able to read them?</p></div><div id="comment-22819-info" class="comment-info"><span class="comment-age">(10 Jul '13, 09:21)</span> ojay</div></div><span id="22820"></span><div id="comment-22820" class="comment not_top_scorer"><div id="post-22820-score" class="comment-score"></div><div class="comment-text"><p>Statistics -&gt; Summary will show the capture file comments, while Analyze -&gt; Expert Info will show the per-packet comments under the "Packet Comments" tab.</p></div><div id="comment-22820-info" class="comment-info"><span class="comment-age">(10 Jul '13, 09:28)</span> cmaynard ♦♦</div></div><span id="22821"></span><div id="comment-22821" class="comment not_top_scorer"><div id="post-22821-score" class="comment-score"></div><div class="comment-text"><p>Thank you! I noticed another thing. The original file displayed 48 packets (all ICMPv6, Data frame type of IEEE 802.15.4), but now the new file I created following your steps shows 72. Some packets showing Beacon frame type of IEEE 802.15.4 now appear. Is that because of the checkbox "Show not dissected data on new Packet Bytes pane" or did the IEEE 802.15.4 dissector got improved in version 1.11? I was using version 1.8.2, the most recent from the Ubuntu packaging system.</p></div><div id="comment-22821-info" class="comment-info"><span class="comment-age">(10 Jul '13, 09:48)</span> ojay</div></div><span id="22823"></span><div id="comment-22823" class="comment not_top_scorer"><div id="post-22823-score" class="comment-score"></div><div class="comment-text"><p>There have been improvements to the IEEE802.15.4 dissector since 1.8.2, so I'm fairly certain that is the reason. It's certainly not because of checking the "Show not dissected data on new Packet Bytes pane" preference, which is only needed to avoid writing the hex bytes for the entire frame along with the undissected hex bytes subset of the packet (if any) to the text file. If that were to happen, it would mess up the import.</p></div><div id="comment-22823-info" class="comment-info"><span class="comment-age">(10 Jul '13, 10:11)</span> cmaynard ♦♦</div></div><span id="22824"></span><div id="comment-22824" class="comment not_top_scorer"><div id="post-22824-score" class="comment-score"></div><div class="comment-text"><p>Or it could be that those extra frames are incorrectly being dissected as IEEE802.15.4 packets now? Do they look like valid beacon frames? How were they dissected before the encapsulation conversion? If you could post a small capture file before conversion to cloudshark, then it might helpful to see exactly what's going on.</p></div><div id="comment-22824-info" class="comment-info"><span class="comment-age">(10 Jul '13, 10:16)</span> cmaynard ♦♦</div></div><span id="22836"></span><div id="comment-22836" class="comment not_top_scorer"><div id="post-22836-score" class="comment-score"></div><div class="comment-text"><p>I can't post any links in comments...</p><p>--edit-- Here it is: <a href="http://cloudshark.org/captures/7002738c9fc1">cloudshark.org/captures/7002738c9fc1</a> (FTFY)<br />
The packets tree is not the same as I see it in Wireshark 1.8.2/1.11, the IEEE 802.15.4 frames aren't decoded in cloudshark.</p></div><div id="comment-22836-info" class="comment-info"><span class="comment-age">(11 Jul '13, 02:04)</span> ojay</div></div><span id="22868"></span><div id="comment-22868" class="comment"><div id="post-22868-score" class="comment-score">2</div><div class="comment-text"><p><strong>Update</strong>: As of <a href="http://anonsvn.wireshark.org/viewvc?revision=50491&amp;view=revision">r50493</a>, with the introduction of the <code>-L</code> option to <code>editcap</code>, you can now accomplish what you want in a single step. Example:</p><pre><code>editcap -T wpan -C 16 -L -F libpcap test.pcap test_wpan.pcap</code></pre></div><div id="comment-22868-info" class="comment-info"><span class="comment-age">(11 Jul '13, 07:40)</span> cmaynard ♦♦</div></div></div><div id="comment-tools-22733" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-22733-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="22730"></span>

<div id="answer-container-22730" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-22730-score" class="post-score" title="current number of votes">2</div></div></td><td><div class="item-right"><div class="answer-body"><p>Did you try the following?</p><pre><code>editcap -T wpan -C 16 -F libpcap test.pcap test_wpan.pcap</code></pre></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Jul '13, 10:27</strong></p><img src="https://secure.gravatar.com/avatar/55158e2322c4e365a5e0a4a0ac3fbcef?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cmaynard&#39;s gravatar image" /><p>cmaynard ♦♦<br />
<span class="score" title="9361 reputation points"><span>9.4k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="38 badges"><span class="silver">●</span><span class="badgecount">38</span></span><span title="142 badges"><span class="bronze">●</span><span class="badgecount">142</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="cmaynard has 108 accepted answers">20%</span> </br></br></p></div></div><div id="comments-container-22730" class="comments-container"><span id="22731"></span><div id="comment-22731" class="comment"><div id="post-22731-score" class="comment-score"></div><div class="comment-text"><p>Thank you for the reply! I didn't know we had to specify libpcap format, I thought it was a default option?</p><p>I still see a wrong WTAP_ENCAP number (104 instead of 195) and Wireshark still warns me there's 2 bytes after ICMPv6 it doesn't recognize (should recognize as WPAN FCS).</p><p>The only difference I noted is this:</p><p>$ file test_wpan.pcap<br />
test_wpan.pcap: pcap-ng capture file - version 1.0</p><p>$ file test_wpan_new.pcap<br />
test_wpan_new.pcap: tcpdump capture file (little-endian) - version 2.4, capture length 65535)</p></div><div id="comment-22731-info" class="comment-info"><span class="comment-age">(08 Jul '13, 10:39)</span> ojay</div></div><span id="22732"></span><div id="comment-22732" class="comment"><div id="post-22732-score" class="comment-score"></div><div class="comment-text"><p>pcap-ng is the new default, but it doesn't always work. There is at least 1 bug already reported about it.</p><p>WTAP_ENCAP's != DLT's.</p><p>What does capinfos (and/or Wireshark's summary) say about each of those files?</p><p>Maybe you could post a small capture file to cloudshark?</p></div><div id="comment-22732-info" class="comment-info"><span class="comment-age">(08 Jul '13, 10:42)</span> cmaynard ♦♦</div></div></div><div id="comment-tools-22730" class="comment-tools"></div><div class="clear"></div><div id="comment-22730-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

