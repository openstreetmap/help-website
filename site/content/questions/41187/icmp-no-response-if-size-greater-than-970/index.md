+++
type = "question"
title = "ICMP no response if size greater than 970"
description = '''Hi, I have a this setup : [server] -- [Cisco Switch] -- [windows client]. When I try to ping the server from client with -l 1200, I get &quot;Request timed out&quot; errors. I verified that the MTU on server is set to 9000. The MTU on windows client was set to 1010. I tried ping -f -l 970 and it succeeds but ...'''
date = "2015-04-04T06:36:00Z"
lastmod = "2015-05-19T09:23:00Z"
weight = 41187
keywords = [ "icmp", "mss" ]
aliases = [ "/questions/41187" ]
osqa_answers = 0
osqa_accepted = false
+++

<div class="headNormal">

# [ICMP no response if size greater than 970](/questions/41187/icmp-no-response-if-size-greater-than-970)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-41187-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-41187-score" class="post-score" title="current number of votes">0</div><span id="post-41187-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi, I have a this setup : [server] -- [Cisco Switch] -- [windows client]. When I try to ping the server from client with -l 1200, I get "Request timed out" errors. I verified that the MTU on server is set to 9000. The MTU on windows client was set to 1010. I tried ping -f -l 970 and it succeeds but anything above 970 fails. I changed the MTU setting on the windows client to 9000. Then I tried ping with -l 1000 but it failed. I tried to capture wireshark and it shows the request packets from client to server but info shows "no response found". I tried to open a ftp session from client to server and captured the trace and I can see in the handshake SYN packets the MSS is 9000. So what possibly could be a reason for ping to fail? If the size of the icmp packet is bigger than 970 then I should at least get the message saying that it needs fragmentation. And if the -f (don<code>t fragment) bit is not set, it should fragment the packet and should go through. Also I am assuming ICMP is not disabled otherwise ping should not work. If it</code>s MSS issue then why SYN packets for ftp connection handshake shows 9000 as the MSS on both side?</p><p>Thanks!</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-icmp" rel="tag" title="see questions tagged &#39;icmp&#39;">icmp</span> <span class="post-tag tag-link-mss" rel="tag" title="see questions tagged &#39;mss&#39;">mss</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>04 Apr '15, 06:36</strong></p><img src="https://secure.gravatar.com/avatar/68b978baf280d6656178b3a96a1df45e?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="vondutch9&#39;s gravatar image" /><p><span>vondutch9</span><br />
<span class="score" title="11 reputation points">11</span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="3 badges"><span class="silver">●</span><span class="badgecount">3</span></span><span title="5 badges"><span class="bronze">●</span><span class="badgecount">5</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="vondutch9 has no accepted answers">0%</span></p></div></div><div id="comments-container-41187" class="comments-container"><span id="41211"></span><div id="comment-41211" class="comment"><div id="post-41211-score" class="comment-score"></div><div class="comment-text"><p>Can you please upload a capture file (google drive, dropbox, cloudshark.org) that shows the various ping tests and the TCP connection, and then post the link here?</p></div><div id="comment-41211-info" class="comment-info"><span class="comment-age">(06 Apr '15, 03:41)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="41219"></span><div id="comment-41219" class="comment"><div id="post-41219-score" class="comment-score"></div><div class="comment-text"><p><em>If the size of the icmp packet is bigger than 970 then I should at least get the message saying that it needs fragmentation.</em></p><p>This is not the case. <a href="http://tools.ietf.org/html/rfc792">RFC 792</a> states:</p><pre><code>            To avoid the infinite regress of messages about messages
etc., no ICMP messages are sent about ICMP messages.</code></pre></div><div id="comment-41219-info" class="comment-info"><span class="comment-age">(06 Apr '15, 06:48)</span> <span class="comment-user userinfo">cmaynard ♦♦</span></div></div><span id="41240"></span><div id="comment-41240" class="comment"><div id="post-41240-score" class="comment-score"></div><div class="comment-text"><p>I have noticed this same thing this morning on Windows 7. (MTU=1500)</p><p>ping blah -f -l 1450 = No reply. Nothing. like really nothing captured ping blah -f = reply (sent 32bytes) ping blah -f -1400 = Fragmentation required ping blah -f 1373 = request timed out ping blah -f 1360 = reply</p><p>The sizes are not the point, but the sometimes nothing and sometimes fragmentation warning is starting to make life annoying. (1373 = Nothing but 1400 = reply fragmentation required???)</p><p>It is definitely the case and it does not matter where you ping. play with the sizes and you will see sometimes you get fragment required and sometimes not. I followed the path, always the same route.</p><p>*Update: The route stayed the same, however on the route I noticed that the one address had several (5) different IP Addresses. I watched a bit more closely and noticed that ONE of these addresses always gave me a Type 4 and the rest didn't.. Just called the provider of the servers and he went "oops" So I assume that in the next few minutes either my rogue Fragment needed will probably black hole on me or I will get Type 4 from everyone..</p><p>With regard to No response found: I get this in most Ping requests, And right after that a response stating request in ** Probably a timing issue or something</p></div><div id="comment-41240-info" class="comment-info"><span class="comment-age">(07 Apr '15, 02:14)</span> <span class="comment-user userinfo">DarrenWright</span></div></div><span id="41241"></span><div id="comment-41241" class="comment"><div id="post-41241-score" class="comment-score"></div><div class="comment-text"><p>Just looked at "No response found". If you capture live ICMP and a ping takes longer than 100ms or so, then I always see "No response found" in the info field. If I then switch profiles or reload, the ICMP request is refreshed and matches the reply. can someone else verify this and I'll open a bug report if need be. Not sure if this is one of the users problems, but it probably doesn't help. 1.12.4 before someone asks.</p></div><div id="comment-41241-info" class="comment-info"><span class="comment-age">(07 Apr '15, 02:41)</span> <span class="comment-user userinfo">DarrenWright</span></div></div><span id="42548"></span><div id="comment-42548" class="comment"><div id="post-42548-score" class="comment-score"></div><div class="comment-text"><p>I can confirm that we are seeing the same behaviour although it does not appear to be related to size. OUr ICMP packets are only 65 bytes (520 bits). In a particular capture we are seeing response times above 200ms (I'll try and find something better to test against) and when we save the capture and re-open it there ICMP packets appear to be recalculated. All of the 'no response found!' entries are gone.</p><p>What is really odd is that the ICMP portion of the packet shows the correct response frame packet reference so it looks like the packets know about but it is just Wireshark that is misinterpreting the results.</p><p>I'm going to try and grab an older version and see if it still happens. Currently running version 1.12.4 on Server 2012 R2. (Full version is 1.12.4-0-gb4861da from master-1.12)</p><p>EDIT: I can confirm that this behaviour exists in v12.5 now. Testing version 1.10.14 now. Doesn't appear to be exhibiting the same behaviour. I'll update this post if anything changes.</p></div><div id="comment-42548-info" class="comment-info"><span class="comment-age">(19 May '15, 08:52)</span> <span class="comment-user userinfo">jbiggley</span></div></div><span id="42549"></span><div id="comment-42549" class="comment not_top_scorer"><div id="post-42549-score" class="comment-score"></div><div class="comment-text"><p>I think the issue with live capture may be a 1-pass\2-pass issue.</p><p>With a live capture, when the request is initially dissected, obviously no reply has been received yet so the info column defaults to "no response found".</p><p>When the reply is received and dissected the conversation tracking in the icmp dissector connects the request and the reply.</p><p>When the packets are re-dissected on the second pass, the request info column can be updated as the conversation includes the reply packet.</p><p>When opening an existing capture file, 2 passes are done which ensures the request info column is correct.</p><p>I'm not so sure what happens with a live capture, from the evidence it does seem as though some form of 2nd pass takes place but I'm not sure how or why. In my tests I get ~25% of requests with the "no reply found" info column, even with ping times of 4mS.</p></div><div id="comment-42549-info" class="comment-info"><span class="comment-age">(19 May '15, 09:20)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="42550"></span><div id="comment-42550" class="comment not_top_scorer"><div id="post-42550-score" class="comment-score"></div><div class="comment-text"><p>Crud. v1.10.14 shows the same sort of behaviour on our test server.<br />
</p><p>However we did not see the ping -f -l 1000 {target} issue in v1.10.14. Packets were delivered without issue</p></div><div id="comment-42550-info" class="comment-info"><span class="comment-age">(19 May '15, 09:23)</span> <span class="comment-user userinfo">jbiggley</span></div></div></div><div id="comment-tools-41187" class="comment-tools"><span class="comments-showing"> showing 5 of 7 </span> <a href="#" class="show-all-comments-link">show 2 more comments</a></div><div class="clear"></div><div id="comment-41187-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

</div>

