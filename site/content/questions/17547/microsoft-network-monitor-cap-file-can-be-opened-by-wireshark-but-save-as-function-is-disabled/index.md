+++
type = "question"
title = "Microsoft Network Monitor cap file can be opened by Wireshark but save as function is disabled"
description = '''I need to capture wireless traffic in monitor mode, so use Microsoft Network Monitor 3.4. To me, it seems to be the only solution on Windows 7, without extra hardware like airpcap. (REMARK: Wireshark does not support monitor mode on Windows platforms.) The cap file generated by Network Monitor can b...'''
date = "2013-01-07T21:42:00Z"
lastmod = "2015-03-16T13:50:00Z"
weight = 17547
keywords = [ "cap", "monitor", "microsoft", "file", "network" ]
aliases = [ "/questions/17547" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Microsoft Network Monitor cap file can be opened by Wireshark but save as function is disabled](/questions/17547/microsoft-network-monitor-cap-file-can-be-opened-by-wireshark-but-save-as-function-is-disabled)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17547-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17547-score" class="post-score" title="current number of votes">0</div><span id="post-17547-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>I need to capture wireless traffic in monitor mode, so use Microsoft Network Monitor 3.4. To me, it seems to be the only solution on Windows 7, without extra hardware like airpcap. (REMARK: Wireshark does not support monitor mode on Windows platforms.)</p><p>The cap file generated by Network Monitor can be opened by Wireshark and displayed correctly. However, I found that both the "save as" and "Export Specified Packets ..." functions (from the "File" menu) are disabled.</p><p>How can I make such functions work?</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-cap" rel="tag" title="see questions tagged &#39;cap&#39;">cap</span> <span class="post-tag tag-link-monitor" rel="tag" title="see questions tagged &#39;monitor&#39;">monitor</span> <span class="post-tag tag-link-microsoft" rel="tag" title="see questions tagged &#39;microsoft&#39;">microsoft</span> <span class="post-tag tag-link-file" rel="tag" title="see questions tagged &#39;file&#39;">file</span> <span class="post-tag tag-link-network" rel="tag" title="see questions tagged &#39;network&#39;">network</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>07 Jan '13, 21:42</strong></p><img src="https://secure.gravatar.com/avatar/d1bebed81e6b2a8de3a4ce24b4c3a1be?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="newwireshark&#39;s gravatar image" /><p><span>newwireshark</span><br />
<span class="score" title="1 reputation points">1</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="bronze">●</span><span class="badgecount">2</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="newwireshark has no accepted answers">0%</span></p></div></div><div id="comments-container-17547" class="comments-container"></div><div id="comment-tools-17547" class="comment-tools"></div><div class="clear"></div><div id="comment-17547-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="17561"></span>

<div id="answer-container-17561" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-17561-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-17561-score" class="post-score" title="current number of votes">0</div><span id="post-17561-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I just verified your setup and it does in fact not allow to save or export specified packets. From looking at the packets I guess that the reason is the pseudo header ("NetMon 802.11 capture header") inserted by NetMon for each packet, which it only does for WiFi captures.</p><p>Going one step further I checked what formats Wireshark should be able to write, and found that there is only NetMon 1.x and NetMon 2.x (I did that by running tshark.exe and editcap.exe with the "-F" parameter and nothing else).</p><p>My suspicion is that Wireshark can't write the NetMon 3.x format, which is probably required to write this "NetMon 802.11 capture header".</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>08 Jan '13, 04:52</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p><span>Jasper ♦♦</span><br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span></p></div></div><div id="comments-container-17561" class="comments-container"><span id="17562"></span><div id="comment-17562" class="comment"><div id="post-17562-score" class="comment-score"></div><div class="comment-text"><p>If it is able to read the <code>NetMon 802.11 header</code> shouldn't it be able to write a pcap-ng file by adding a radiotap header (if it's possible to 'convert' the NetMon 802.11 header to radiotap)? Apparently that functionality is not yet implemented.</p></div><div id="comment-17562-info" class="comment-info"><span class="comment-age">(08 Jan '13, 04:57)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="17583"></span><div id="comment-17583" class="comment"><div id="post-17583-score" class="comment-score"></div><div class="comment-text"><p>Hi Jasper,</p><p>Thank you for the comment.</p><p>I am sorry but I don't quite understand. If Wireshark can read the NetMon 3.4 cap file, why can't it export the packets in pcap format? In such case, writing to NetMon 3.4 header is not requried, I assume.</p><p>So does it mean that there is no work-around at all for this problem?</p></div><div id="comment-17583-info" class="comment-info"><span class="comment-age">(08 Jan '13, 18:01)</span> <span class="comment-user userinfo">newwireshark</span></div></div><span id="17584"></span><div id="comment-17584" class="comment"><div id="post-17584-score" class="comment-score"></div><div class="comment-text"><p>[I converted your answer to a comment to keep things in line]</p><p>Without reading the source code to verify this I can only guess that it is because the pcap format does not have a data structure or pseudo link layer type to write the NetMon header data. A conversion from the NetMon 802.11 capture header to the pcap radiotap header would be required, and I guess that has not been implemented as of yet.</p><p>So I guess the only workaround right now is to actually use NetMon for working on those kind of trace files until someone codes the necessary routines to write the data in pcap.</p></div><div id="comment-17584-info" class="comment-info"><span class="comment-age">(08 Jan '13, 18:47)</span> <span class="comment-user userinfo">Jasper ♦♦</span></div></div><span id="17589"></span><div id="comment-17589" class="comment"><div id="post-17589-score" class="comment-score"></div><div class="comment-text"><blockquote><p>My suspicion is that Wireshark can't write the NetMon 3.x format</p></blockquote><p>NetMon 3.x uses the 2.x format; the format has evolved over time, but it's still essentially the same format.</p><blockquote><p>I can only guess that it is because the pcap format does not have a data structure or pseudo link layer type to write the NetMon header data</p></blockquote><p>In particular, there's no pseudo link-layer header type for the NetMon flavor of 802.11 radio data pseudo-header, and Wireshark currently doesn't try to map 802.11 radio data pseudo-headers to a "common" format so that it could use, for example, radiotap headers.</p></div><div id="comment-17589-info" class="comment-info"><span class="comment-age">(10 Jan '13, 17:30)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="17590"></span><div id="comment-17590" class="comment"><div id="post-17590-score" class="comment-score"></div><div class="comment-text"><p>...and, unfortunately, that header includes the dreaded "RSSI" field, which radiotap doesn't have (it has, instead, antenna signal and noise values, either in dB from an arbitrary reference point or dB from 1 milliwatt), so it's hard to map to radiotap. (There are some other fields that might not map to radiotap; it'd be nice if Microsoft were to adopt radiotap for monitor mode Native Wi-Fi support, and then it'd match most UN*Xes.)</p></div><div id="comment-17590-info" class="comment-info"><span class="comment-age">(10 Jan '13, 17:34)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="35839"></span><div id="comment-35839" class="comment not_top_scorer"><div id="post-35839-score" class="comment-score"></div><div class="comment-text"><p>Hello, I have been experiencing the same issue. Namely, I have captured packets using Netmon 3.4 from Microsoft. I then opened the CAP file in Wireshark 1.12.0. From Wireshark, I was unable to “Save as” or “Export Specified Packets” - these options were grayed out. I then tried using editcap.exe to convert the Netmon capture file into a Wireshark PCAP file (editcap -F pcap test.cap test1.pcap). I keep getting the following error: editcap: Can't open or create test1.pcap: That file format doesn't support per-packet encapsulations</p><p>I noticed the last comment on this issue was January 2013. It has been over 1 1/2 years. Any progress?</p></div><div id="comment-35839-info" class="comment-info"><span class="comment-age">(28 Aug '14, 06:44)</span> <span class="comment-user userinfo">Amato_C</span></div></div><span id="35842"></span><div id="comment-35842" class="comment not_top_scorer"><div id="post-35842-score" class="comment-score"></div><div class="comment-text"><p>As far as I know no one is working on it - so yes no progress. Patches allways welcome ;-)</p></div><div id="comment-35842-info" class="comment-info"><span class="comment-age">(28 Aug '14, 08:30)</span> <span class="comment-user userinfo">Anders ♦</span></div></div><span id="40621"></span><div id="comment-40621" class="comment not_top_scorer"><div id="post-40621-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I noticed the last comment on this issue was January 2013. It has been over 1 1/2 years. Any progress?</p></blockquote><p>Yes. We have determined that pcap format does not, in fact, support per-packet encapsulations. :-)</p><p>The way to handle this would be to have a mechanism by which editcap can <em>start</em> writing out the pcap file, using the encapsulation of the first packet it sees, and fail when it reads a packet with a different encapsulation. No mechanism has been provided to support that yet.</p><p>Alternatively, you could try writing to a pcap-ng file, as those <em>do</em> support per-packet encapsulations. However, you still won't be able to write Wi-Fi packets, as there's no pcap/pcap-ng link-layer header type for Microsoft's 802.11+metadata.</p></div><div id="comment-40621-info" class="comment-info"><span class="comment-age">(16 Mar '15, 13:50)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div></div><div id="comment-tools-17561" class="comment-tools"><span class="comments-showing"> showing 5 of 8 </span> <a href="#" class="show-all-comments-link">show 3 more comments</a></div><div class="clear"></div><div id="comment-17561-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="40620"></span>

<div id="answer-container-40620" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-40620-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-40620-score" class="post-score" title="current number of votes">0</div><span id="post-40620-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I have written a utility that uses 1. tshark to export each frame in hex 2. tshark to export each frame's timestamp into a text file 3. text2pcap and editcap to import the hexdump into a nano pcap file format 4. parses the timestamp file and updates the nano pcap file with the original timestamp</p><p>This utility was written in python, and built into a Windows exe.</p><p>Drop a comment here to let me know if you wish to have a copy.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>16 Mar '15, 13:34</strong></p><img src="https://secure.gravatar.com/avatar/0bd470f6c157ba727d5c2a68595d007e?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="howlingcat&#39;s gravatar image" /><p><span>howlingcat</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="bronze">●</span><span class="badgecount">1</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="howlingcat has no accepted answers">0%</span></p></div></div><div id="comments-container-40620" class="comments-container"></div><div id="comment-tools-40620" class="comment-tools"></div><div class="clear"></div><div id="comment-40620-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

