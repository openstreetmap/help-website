+++
type = "question"
title = "Extra ACK at server side in TCP/IP socket communication"
description = '''Hi, Can you please help me to understand why there is an extra ACK (with len=0) from server (CentosOS 6.6 - linux 2.6.32) during the TCP socket communication? Is it possible to avoid the extra ACK? (avoid unnecessary overhead)?  Our scenario: small packets communication (GSM data) looking at tcp del...'''
date = "2016-03-23T07:06:00Z"
lastmod = "2016-03-29T03:41:00Z"
weight = 51125
keywords = [ "tcp_delayed_ack" ]
aliases = [ "/questions/51125" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [Extra ACK at server side in TCP/IP socket communication](/questions/51125/extra-ack-at-server-side-in-tcpip-socket-communication)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-51125-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-51125-score" class="post-score" title="current number of votes">0</div><span id="post-51125-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>Can you please help me to understand why there is an extra ACK (with len=0) from server (CentosOS 6.6 - linux 2.6.32) during the TCP socket communication? Is it possible to avoid the extra ACK? (avoid unnecessary overhead)?</p><p>Our scenario: small packets communication (GSM data)</p><p>looking at tcp delayed acknowledgement, Nagle's algorithm etc...not getting the right solution.</p><p>Thanks, Saty</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-tcp_delayed_ack" rel="tag" title="see questions tagged &#39;tcp_delayed_ack&#39;">tcp_delayed_ack</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>23 Mar '16, 07:06</strong></p><img src="https://secure.gravatar.com/avatar/c949261d8e8acbec16d3bffe46ff027b?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="saty&#39;s gravatar image" /><p><span>saty</span><br />
<span class="score" title="6 reputation points">6</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="saty has no accepted answers">0%</span></p></div></div><div id="comments-container-51125" class="comments-container"><span id="51128"></span><div id="comment-51128" class="comment"><div id="post-51128-score" class="comment-score"></div><div class="comment-text"><p>You'll need to provide some sort of evidence, ideally a capture file, to illustrate your issue. You haven't told us when this "spurious" ACK comes within the TCP conversation.</p></div><div id="comment-51128-info" class="comment-info"><span class="comment-age">(23 Mar '16, 08:41)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="51130"></span><div id="comment-51130" class="comment"><div id="post-51130-score" class="comment-score"></div><div class="comment-text"><p>how can i upload capture file?</p></div><div id="comment-51130-info" class="comment-info"><span class="comment-age">(23 Mar '16, 09:34)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51131"></span><div id="comment-51131" class="comment"><div id="post-51131-score" class="comment-score"></div><div class="comment-text"><p>You cannot (and no one else can either). Publish it at cloudshark, google drive, one drive, or anywhere else, login-free, and edit your Question with a link to it.</p></div><div id="comment-51131-info" class="comment-info"><span class="comment-age">(23 Mar '16, 09:56)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="51140"></span><div id="comment-51140" class="comment"><div id="post-51140-score" class="comment-score"></div><div class="comment-text"><p>uploaded capture file at <a href="https://www.cloudshark.org/captures/3319789a4eb5">https://www.cloudshark.org/captures/3319789a4eb5</a> (192.168.xx.xx is a server and 62.140.xx.xx is a client)</p><p>how can we avoid "ACK" having len=0 to reduce overhead on GSM data usage.</p></div><div id="comment-51140-info" class="comment-info"><span class="comment-age">(23 Mar '16, 23:13)</span> <span class="comment-user userinfo">saty</span></div></div></div><div id="comment-tools-51125" class="comment-tools"></div><div class="clear"></div><div id="comment-51125-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="51170"></span>

<div id="answer-container-51170" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-51170-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-51170-score" class="post-score" title="current number of votes">0</div><span id="post-51170-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I think the problem is your server sending immediate ACKs at times when it could have just waited for the data to flow in the reverse direction a few ms later.(yellow)<br />
Obviously when it has nothing to send it delays the ACKs (green) .<br />
Per this <a href="http://stackoverflow.com/questions/1615447/disable-tcp-delayed-acks">Stack_Overflow Thread</a> this seems to be program controlled by setting sockopt TCP_QUICKACK. So it is up to your server to send an iimmediate ack when it feels appropriate.</p><p>Regards Matthias<br />
<img src="https://osqa-ask.wireshark.org/upfiles/Selection_912.png" alt="alt text" /></p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>24 Mar '16, 22:55</strong></p><img src="https://secure.gravatar.com/avatar/5500bd1decb766660522dfb347eedc49?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mrEEde&#39;s gravatar image" /><p><span>mrEEde</span><br />
<span class="score" title="3892 reputation points"><span>3.9k</span></span><span title="15 badges"><span class="badge1">●</span><span class="badgecount">15</span></span><span title="22 badges"><span class="silver">●</span><span class="badgecount">22</span></span><span title="70 badges"><span class="bronze">●</span><span class="badgecount">70</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mrEEde has 48 accepted answers">20%</span> </br></br></p></img></div></div><div id="comments-container-51170" class="comments-container"><span id="51173"></span><div id="comment-51173" class="comment"><div id="post-51173-score" class="comment-score"></div><div class="comment-text"><p>yes, how can we avoid this immediate ACK from server? what changes will help in this case? is it server/OS level or socket program level change? thank you</p></div><div id="comment-51173-info" class="comment-info"><span class="comment-age">(25 Mar '16, 01:28)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51174"></span><div id="comment-51174" class="comment"><div id="post-51174-score" class="comment-score"></div><div class="comment-text"><p>here is the output of /proc/net/tcp</p><pre><code>---------------------
 sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode
   0: 00000000:170D 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 772479776 1 ffff88003783c7c0 99 0 0 10 -1
   1: 00000000:1F90 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783642140 1 ffff8801394a8180 99 0 0 10 -1
   2: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 770299248 1 ffff8800a9f55600 99 0 0 10 -1
   3: 00000000:1771 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 772479770 1 ffff88003783ce80 99 0 0 10 -1
   4: 00000000:1774 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783878789 1 ffff8801394a8f00 99 0 0 10 -1
   5: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 10965 1 ffff8801394934c0 99 0 0 10 -1
   6: 0100007F:0019 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 11209 1 ffff880139492080 99 0 0 10 -1
   7: 00000000:01BB 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 770320772 1 ffff8800a564a7c0 99 0 0 10 -1
   8: 171AA8C0:0AFC 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 11418 1 ffff880139492e00 99 0 0 10 -1
   9: 0100007F:1B5D 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 782540223 1 ffff8800a564b540 99 0 0 10 -1
  10: 00000000:D69E 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783878790 1 ffff8801394a95c0 99 0 0 10 -1
  11: 00000000:1B9E 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 782532703 1 ffff8800a9e5e180 99 0 0 10 -1
  12: 00000000:BAFF 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783878788 1 ffff8800b73b7740 99 0 0 10 -1
  13: 00000000:24E3 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783878796 1 ffff8800650d8f40 99 0 0 10 -1
  14: 0100007F:1F45 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783653097 1 ffff880037a80780 99 0 0 10 -1
  15: 00000000:1F49 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 783642141 1 ffff88013a0c2e40 99 0 0 10 -1
  16: 171AA8C0:B9AB 171AA8C0:1B9E 08 00000000:00000001 00:00000000 00000000     0        0 783653903 1 ffff8800650d9600 20 3 0 10 -1

... 36 lines
---------------------</code></pre></div><div id="comment-51174-info" class="comment-info"><span class="comment-age">(25 Mar '16, 02:29)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51175"></span><div id="comment-51175" class="comment"><div id="post-51175-score" class="comment-score"></div><div class="comment-text"><p>14: 0100007F:1F45 00000000:0000 0A 00000000:00000000 00:00000000 00000000 0 0 783653097 1 ffff880037a80780 99 0 0 10 -1</p></div><div id="comment-51175-info" class="comment-info"><span class="comment-age">(25 Mar '16, 02:30)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51176"></span><div id="comment-51176" class="comment"><div id="post-51176-score" class="comment-score"></div><div class="comment-text"><p>Just out of curiosity, why don't you want this ack? From my point of view it isn't so bad.</p></div><div id="comment-51176-info" class="comment-info"><span class="comment-age">(25 Mar '16, 03:11)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="51177"></span><div id="comment-51177" class="comment"><div id="post-51177-score" class="comment-score"></div><div class="comment-text"><p>By avoiding these immediate ACKS, if possible, we want to reduce unnecessary overhead on GSM data usage and save cost/bandwidth. This is a test case with one client, just think if there are many thousands of clients, many such ACKs (overhead), and how much can be saved.</p></div><div id="comment-51177-info" class="comment-info"><span class="comment-age">(25 Mar '16, 03:32)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51178"></span><div id="comment-51178" class="comment not_top_scorer"><div id="post-51178-score" class="comment-score"></div><div class="comment-text"><p>Which parts of the software can you modify or configure? Your application, the TCP stack behaviour, or none of the two? On both the client and server or nowhere at all?</p><p>What I can see is that the client requests something, and the server sends the ACK to it before it has assembled the response. This is what <span>@mrEEde</span> has drawn your attention to - if it normally takes tens of milliseconds to provide the response to the request, the server application may delay sending the ACK for the received request until it has the data of the response ready, so that it could send the ACK for the request in the same packet as the response. Currently, it looks as if it orders the tcp stack not to wait.</p><p>Another thing is that the client sends some data (6 bytes) back to the server as soon as it receives the server's response. After receiving these data, the server sends the immediate ACK again. The question is whether your application protocol needs to send those 6 bytes at all, i.e. whether these data are meaningful or whether it is just some kind of application-level ACK which would thus be redundant (useless) if you use a transport protocol with guaranteed delivery, such as TCP.</p><p>If you are not able to change the behaviour of the application software, I'm afraid you have no chance to get rid of those ACK-only (<code>tcp.len == 0</code>) packets.</p></div><div id="comment-51178-info" class="comment-info"><span class="comment-age">(25 Mar '16, 04:02)</span> <span class="comment-user userinfo">sindy</span></div></div><span id="51207"></span><div id="comment-51207" class="comment not_top_scorer"><div id="post-51207-score" class="comment-score"></div><div class="comment-text"><p>This trace lasted for 21 minutes, and only 2,146 bytes were transferred (including the Ethernet, IP, and TCP headers, not just the data). Adjusting for the fact that the capture was taken on the server, and some of the actual frames transmitted on the network would have been larger due to the minimum Ethernet frame size, 2,338 bytes would have been transferred. If all the zero-length ACKs could be eliminated, 768 bytes would be saved, or 0.61 bytes per second. While that is one-third of the total, I'm not sure I'd spend much time trying to change what is essentially normal TCP behavior in order to save 0.61 bytes per second per device.</p><p>The only reason it's such a high fraction of the total is that so little data is being sent. The largest packet in this trace had only 68 bytes of data. There were only 526 data bytes transferred in the whole 21 minutes. There is more or less the same amount of overhead in a packet, regardless of whether it contains no data, 100 bytes of data, or 1,460 bytes of data.</p></div><div id="comment-51207-info" class="comment-info"><span class="comment-age">(25 Mar '16, 14:19)</span> <span class="comment-user userinfo">Jim Aragon</span></div></div><span id="51211"></span><div id="comment-51211" class="comment not_top_scorer"><div id="post-51211-score" class="comment-score"></div><div class="comment-text"><p>Yes I think it, too. It is better to optimize an application and not always the TCP/IP implementation.</p><p>The way how the server stack works in these case is for a lot of use cases, from my point of view, a really smart implementation.</p></div><div id="comment-51211-info" class="comment-info"><span class="comment-age">(25 Mar '16, 14:30)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="51228"></span><div id="comment-51228" class="comment not_top_scorer"><div id="post-51228-score" class="comment-score"></div><div class="comment-text"><p>currently using CentosOS 6.6 - linux 2.6.32 on Server, Is there a way to reduce ACK overhead by tcp stack tuning on server level?</p><p>some parameters we are looking at "tcp_delayack", quickack etc is not available in sysctl file on this server OS version. Also looking at some socket program level parameters like tcp_cork etc not available.</p></div><div id="comment-51228-info" class="comment-info"><span class="comment-age">(28 Mar '16, 04:50)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51229"></span><div id="comment-51229" class="comment not_top_scorer"><div id="post-51229-score" class="comment-score"></div><div class="comment-text"><p>I common way how people handle this: They use UDP as Layer4 protocol and implement the needed Transportation Control mechanismen by themself.</p><p>I suggest you should think about that solution. Because you can save a lot of Bits if you are using UDP instead of TCP.</p><p>Otherwise I recommend, that you ask in a linux or CentOS forum about that parameter.</p></div><div id="comment-51229-info" class="comment-info"><span class="comment-age">(28 Mar '16, 05:20)</span> <span class="comment-user userinfo">Christian_R</span></div></div><span id="51230"></span><div id="comment-51230" class="comment not_top_scorer"><div id="post-51230-score" class="comment-score"></div><div class="comment-text"><p>i have raised this Question in "linuxquestions.org" forum now. <a href="http://www.linuxquestions.org/questions/showthread.php?p=5522417#post5522417">http://www.linuxquestions.org/questions/showthread.php?p=5522417#post5522417</a></p></div><div id="comment-51230-info" class="comment-info"><span class="comment-age">(28 Mar '16, 05:52)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51231"></span><div id="comment-51231" class="comment not_top_scorer"><div id="post-51231-score" class="comment-score"></div><div class="comment-text"><p>yes, UDP is a good solution to avoid ACK's (overheads etc) however having implemented on TCP, looking for a solution (OS level or Socket level) to avoid immediate ACKs, if possible then life would be happier this way.</p></div><div id="comment-51231-info" class="comment-info"><span class="comment-age">(28 Mar '16, 05:56)</span> <span class="comment-user userinfo">saty</span></div></div><span id="51251"></span><div id="comment-51251" class="comment not_top_scorer"><div id="post-51251-score" class="comment-score"></div><div class="comment-text"><p>can anyone suggest how to avoid immediate ACK's from server??</p></div><div id="comment-51251-info" class="comment-info"><span class="comment-age">(29 Mar '16, 03:41)</span> <span class="comment-user userinfo">saty</span></div></div></div><div id="comment-tools-51170" class="comment-tools"><span class="comments-showing"> showing 5 of 13 </span> <a href="#" class="show-all-comments-link">show 8 more comments</a></div><div class="clear"></div><div id="comment-51170-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

