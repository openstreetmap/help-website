+++
type = "question"
title = "Are there conditions that can cause Wireshark to &quot;drop&quot; packets?"
description = '''Hi, I&#x27;m using Wireshark 1.8.9 on SLES11 SP1. The environment it is being used in is a lab with very low latencies (~3ms). I&#x27;m capturing sequences of packets that consist of sending a single ping to the outside world through 8 sequential collection points, expecting the result of the capture to alway...'''
date = "2013-09-30T08:26:00Z"
lastmod = "2013-10-02T08:04:00Z"
weight = 25391
keywords = [ "intermittent", "refresh", "packetloss" ]
aliases = [ "/questions/25391" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Are there conditions that can cause Wireshark to "drop" packets?](/questions/25391/are-there-conditions-that-can-cause-wireshark-to-drop-packets)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25391-score" class="post-score" title="current number of votes">1</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi,</p><p>I'm using Wireshark 1.8.9 on SLES11 SP1. The environment it is being used in is a lab with very low latencies (~3ms). I'm capturing sequences of packets that consist of sending a single ping to the outside world through 8 sequential collection points, expecting the result of the capture to always consist of 16 packets. Wireshark is reading directly from a single NIC which is supplying the traffic from the 8 collection points.</p><p>After a lot of testing, I've discovered that I don't always collect 16 packets in Wireshark. In a typical test run of 300 pings, I might only get ~450 packets instead of the expected 480. This seems to happen ~80% of the time.</p><p>However, if I switch to using "tcpdump -n -s 0 -i NIC -w File.pcap", I find that I consistently capture all 480 packets.</p><p>Can someone explain, or speculate, on what might cause this?</p><p>I've already tried turning promiscuous mode on/off as well as delaying the display of packets until the end of the capture.</p><p>Thanks!</p></div><div id="question-tags" class="tags-container tags">intermittent refresh packetloss</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>30 Sep '13, 08:26</strong></p><img src="https://secure.gravatar.com/avatar/bddcc1f355a85cf062d811abe24cd285?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="mlampell&#39;s gravatar image" /><p>mlampell<br />
<span class="score" title="21 reputation points">21</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="mlampell has no accepted answers">0%</span></p></div></div><div id="comments-container-25391" class="comments-container"><span id="25395"></span><div id="comment-25395" class="comment"><div id="post-25395-score" class="comment-score">1</div><div class="comment-text"><p>Do you lose packets if you use dumpcap directly to do the capture ?</p><p>Dumpcap is the 'capture' part of Wireshark. It just captures to a file w/o doing any dissection; The file can then be read by Wireshark.</p><p>See the dumpcap man page for all the details as to command-line options, etc.</p><pre><code>&quot;dumpcap -i NIC -P -w file.pcap&quot;</code></pre><p>will create a .pcap file. (-P forces pcap format instead of pcapng format).</p><p>Also: what is the speed of your network ?</p></div><div id="comment-25395-info" class="comment-info"><span class="comment-age">(30 Sep '13, 08:45)</span> Bill Meier ♦♦</div></div><span id="25423"></span><div id="comment-25423" class="comment"><div id="post-25423-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>I might only get ~450 packets instead of the expected 480.</p></blockquote><p>those missing packets: Are they at the beginning, at the end or just randomly distributed in the capture file?</p><blockquote><p>I'm using Wireshark 1.8.9 on SLES11 SP1.</p></blockquote><p>Is that real hardware or a virtual machine?</p></div><div id="comment-25423-info" class="comment-info"><span class="comment-age">(30 Sep '13, 14:56)</span> Kurt Knochner ♦</div></div><span id="25432"></span><div id="comment-25432" class="comment"><div id="post-25432-score" class="comment-score"></div><div class="comment-text"><p>Thanks for both comments. Here are some answers:</p><ul><li><p>yes, I lose packets with dumpcap, both with -p and without -p. The pattern is similar to that which I get using wireshark directly. The only application that doesn't appear to lose any packets is tcpdump.</p></li><li><p>the network is running at 1 Gbps. The timing between the packets is very close, to within a few tens of microseconds, e.g:</p></li></ul><p>1 2013-09-30 19:36:47.857667000</p><p>2 2013-09-30 19:36:47.857755000</p><p>3 2013-09-30 19:36:47.858032000</p><p>4 2013-09-30 19:36:47.858360000</p><p>5 2013-09-30 19:36:47.858409000</p><p>6 2013-09-30 19:36:47.858605000</p><p>7 2013-09-30 19:36:47.873108000</p><p>8 2013-09-30 19:36:47.873142000</p><p>9 2013-09-30 19:36:47.873452000</p><p>10 2013-09-30 19:36:47.873528000</p><ul><li><p>the "missing" packets are occurring throughout the capture, they don't appear to occur in any pattern</p></li><li><p>this is real hardware, not a VM</p></li></ul><p>And a question/theory:</p><p>Is it possible that the times are so close that some of the messages are being interpreted by Wireshark/dumpcap as occurring <em>in the past</em> and therefore being discarded by Wireshark?</p><p>If so, why would this behavior not happen with tcpdump?</p><p>Thanks for your help!</p></div><div id="comment-25432-info" class="comment-info"><span class="comment-age">(30 Sep '13, 18:19)</span> mlampell</div></div><span id="25454"></span><div id="comment-25454" class="comment"><div id="post-25454-score" class="comment-score">2</div><div class="comment-text"><blockquote><p>yes, I lose packets with dumpcap,</p></blockquote><p>does dumpcap print any message about dropped packets after you stopped it? Can you please post that message?</p><blockquote><p>Is it possible that the times are so close that some of the messages are being interpreted by Wireshark/dumpcap as occurring in the past and therefore being discarded by Wireshark?</p></blockquote><p>No, Wireshark will not throw away any packet due to that reason.</p><blockquote><p>If so, why would this behavior not happen with tcpdump?</p></blockquote><p>That's the key question here. Maybe your dumpcap is linked to a different libpcap.</p><p>Can you please post the output of the following commands?</p><blockquote><p>ldd `which tcpdump`<br />
ldd `which dumpcap`</p></blockquote></div><div id="comment-25454-info" class="comment-info"><span class="comment-age">(01 Oct '13, 03:15)</span> Kurt Knochner ♦</div></div><span id="25475"></span><div id="comment-25475" class="comment"><div id="post-25475-score" class="comment-score"></div><div class="comment-text"><p>@mlampell: Please add a dummy comment (just a few words). I will paste the ldd output you sent me into that comment.</p><p>O.K. I'm posting this on behalf of @mlampell as the system treats him as spammer right now (maybe to many tries to post a link !?!)</p><hr /><pre><code>Output when I stop dumpcap:
&gt;dumpcap -iVNIC3 -s0 -w 300dumpcap3.pcap Capturing on VNIC3
File: 300dumpcap3.pcap
Packets captured: 4662
Packets received/dropped on interface VNIC3: 4662/138 (97.1%)
Output from the ldd commands:
&gt; ldd which tcpdump
        linux-vdso.so.1 =&gt;  (0x00007fff2ddff000)
        libpcap.so.0 =&gt; /usr/lib64/libpcap.so.0 (0x00007fc8d8514000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fc8d81b6000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fc8d874a000) 
&gt; ldd which dumpcap
        linux-vdso.so.1 =&gt;  (0x00007fff8c1ff000)
        libwsutil.so.2 =&gt; /usr/local/lib/libwsutil.so.2 (0x00007f65afae5000)
        libgthread-2.0.so.0 =&gt; /usr/lib64/libgthread-2.0.so.0 (0x00007f65af8e0000)
        libglib-2.0.so.0 =&gt; /usr/lib64/libglib-2.0.so.0 (0x00007f65af61a000)
        libpcap.so.0 =&gt; /usr/lib64/libpcap.so.0 (0x00007f65af3e4000)
        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f65af1ce000)
        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f65aefb1000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f65aec53000)
        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f65aea4a000)
        libgmodule-2.0.so.0 =&gt; /usr/lib64/libgmodule-2.0.so.0 (0x00007f65ae846000)
        libpcre.so.0 =&gt; /usr/lib64/libpcre.so.0 (0x00007f65ae616000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f65afceb000)
        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f65ae412000)</code></pre></div><div id="comment-25475-info" class="comment-info"><span class="comment-age">(01 Oct '13, 08:30)</span> Kurt Knochner ♦</div></div><span id="25476"></span><div id="comment-25476" class="comment not_top_scorer"><div id="post-25476-score" class="comment-score"></div><div class="comment-text"><p>O.K. The path to libpcap is that same, so the difference between the behavior of tcpdump and dumpcap is probably not related to that.</p><p>As you can see, dumpcap indeed drops packets. Maybe there is simply too much traffic, so dumpcap was not able to write every frame to disk. Please use capture filters to reduce the amount a captured packets. The capture filter syntax is the same as with tcpdump.</p><blockquote><p>dumpcap -ni VNIC3 -s0 -w 300dumpcap3.pcap -f "host x.x.x.x and port yyyy"</p></blockquote><p>BTW: What is VNIC3? How is that interface defined on your system?</p></div><div id="comment-25476-info" class="comment-info"><span class="comment-age">(01 Oct '13, 08:40)</span> Kurt Knochner ♦</div></div><span id="25511"></span><div id="comment-25511" class="comment not_top_scorer"><div id="post-25511-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Re: Kurt\'s suggestion, I can\'t limit the traffic any further; the only traffic being captured is the 16 ping messages.</p></blockquote><p>O.K. if I look at the output of dumpcap, there is no plausible reason why it drops 3% of the packets if there are only 4662 packtes !?!</p><blockquote><p>Packets received/dropped on interface VNIC3: 4662/138 (97.1%)</p></blockquote></div><div id="comment-25511-info" class="comment-info"><span class="comment-age">(02 Oct '13, 07:18)</span> Kurt Knochner ♦</div></div><span id="25515"></span><div id="comment-25515" class="comment not_top_scorer"><div id="post-25515-score" class="comment-score"></div><div class="comment-text"><p>The only reason I can imagine for the dropped packets: Some of those 4662 frames are hitting the sniffer interface in a very, very short period of time and thus flooding the capture buffer. If you look at the IO graphs, do you see a (large) spike somewhere?</p></div><div id="comment-25515-info" class="comment-info"><span class="comment-age">(02 Oct '13, 07:44)</span> Kurt Knochner ♦</div></div><span id="25517"></span><div id="comment-25517" class="comment not_top_scorer"><div id="post-25517-score" class="comment-score"></div><div class="comment-text"><p>Hello Kurt, thanks for the input. By the way, I created a new login, mlampell2, to allow me to continue posting...</p><p>I don't see any spikes, and I'm still confused about why now both tcpdump and dumpcap are capturing all the packets, yet some are lost during the "transfer" to the Wireshark GUI. Any ideas for how to troubleshoot this further?</p></div><div id="comment-25517-info" class="comment-info"><span class="comment-age">(02 Oct '13, 07:52)</span> mlampell2</div></div><span id="25536"></span><div id="comment-25536" class="comment not_top_scorer"><div id="post-25536-score" class="comment-score"></div><div class="comment-text"><p>I'll convert some comments to answers. Plesse accept the answer of Bill Meier. If you like, you can up vote my answer.</p></div><div id="comment-25536-info" class="comment-info"><span class="comment-age">(02 Oct '13, 09:36)</span> Kurt Knochner ♦</div></div></div><div id="comment-tools-25391" class="comment-tools"><span class="comments-showing"> showing 5 of 10 </span> <a href="#" class="show-all-comments-link">show 5 more comments</a></div><div class="clear"></div><div id="comment-25391-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="25478"></span>

<div id="answer-container-25478" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25478-score" class="post-score" title="current number of votes">1</div></div></td><td><div class="item-right"><div class="answer-body"><p>Do you get a better result with dumpcap if you use a larger 'kernel buffer size' ?</p><pre><code>dumpcap ... -B 6 ...</code></pre><p>The default size for dumpcap 1.8 is apparently 1MB (according to the help):</p><p>... -B &lt;buffer size=""&gt; size of kernel buffer (def: 1MB) ...</p><p>(The development dumpcap help says</p><p>-B &lt;buffer size=""&gt; size of kernel buffer in MB (def: 2MB)</p><p>Looking at the code, the buffer size is also specified in MB for dumpcap 1.8</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>01 Oct '13, 09:26</strong></p><img src="https://secure.gravatar.com/avatar/bfb20acfe44690473b10c7963b5d4a18?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Bill%20Meier&#39;s gravatar image" /><p>Bill Meier ♦♦<br />
<span class="score" title="3180 reputation points"><span>3.2k</span></span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="50 badges"><span class="bronze">●</span><span class="badgecount">50</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Bill Meier has 31 accepted answers">17%</span> </br></p></div></div><div id="comments-container-25478" class="comments-container"><span id="25510"></span><div id="comment-25510" class="comment"><div id="post-25510-score" class="comment-score"></div><div class="comment-text"><p>Thanks Kurt and Bill both.</p><p>Re: Kurt's suggestion, I can't limit the traffic any further; the only traffic being captured is the 16 ping messages.</p><p>The VNIC3 is a virtual NIC that is aggregating the traffic from one or more physical NICs. So far I have not considered the VNIC3 to be suspect since all the traffic is being captured with tcpdump.</p><p>It appears that Bill has found a partial answer (thanks Bill!) By increasing the size of the kernel buffer to 6 (from the default 1), I am now capturing all 4800 packets using dumpcap -B6. However, when I switched to wireshark, I did not get all the packets all the time, even with this option. I tried as high as -B30 but I still lost 148/4800 packets.</p><p>I also tried using the Wireshark option to <em>not display packets in real time</em>. In this mode Wireshark shows a blank screen until I stop the capture and then shows all the captured packets. Using this option I still lost 147 packets.</p><p>Any suggestions for how to get wireshark to display <em>ALL</em> packets now that dumpcap seems to be capturing all of them?</p></div><div id="comment-25510-info" class="comment-info"><span class="comment-age">(02 Oct '13, 07:17)</span> mlampell2</div></div></div><div id="comment-tools-25478" class="comment-tools"></div><div class="clear"></div><div id="comment-25478-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="25520"></span>

<div id="answer-container-25520" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-25520-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>Did you change the buffer size in Wireshark as well?</p><blockquote><p>Edit -&gt; Preferences -&gt; Capture -&gt; Interfaces Edit [Button]</p></blockquote><p>Select the interface then check the field: Default Buffer size</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>02 Oct '13, 08:04</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span></p></div></div><div id="comments-container-25520" class="comments-container"><span id="25524"></span><div id="comment-25524" class="comment"><div id="post-25524-score" class="comment-score"></div><div class="comment-text"><p>On my version of Wireshark, 1.8.9, on SLES 11 sp1, I don't see an option on that interface to change the default buffer size. Instead, I was using the option "-B 30" when invoking wireshark from the command line, and this is not solving the problem.</p></div><div id="comment-25524-info" class="comment-info"><span class="comment-age">(02 Oct '13, 08:16)</span> mlampell2</div></div><span id="25530"></span><div id="comment-25530" class="comment"><div id="post-25530-score" class="comment-score"></div><div class="comment-text"><p>O.K. in 1.8.x the option is in a different menu.</p><blockquote><p>Capture -&gt; Options</p></blockquote><p>Double click the interface and you'll see the buffer size.</p></div><div id="comment-25530-info" class="comment-info"><span class="comment-age">(02 Oct '13, 08:31)</span> Kurt Knochner ♦</div></div><span id="25532"></span><div id="comment-25532" class="comment"><div id="post-25532-score" class="comment-score"></div><div class="comment-text"><p>Wow, that did the trick! Thanks very much. Don't know why passing the -B option on the command line isn't doing the same thing, but at least I have a usable workaround.</p><p>How do I turn this into the official answer for the question? Plus, if possible I would like to acknowledge both Kurt Knochner and Bill Meier, since Bill originally put me on the path to investigate the -B option.</p><p>Thanks again!</p></div><div id="comment-25532-info" class="comment-info"><span class="comment-age">(02 Oct '13, 08:59)</span> mlampell2</div></div></div><div id="comment-tools-25520" class="comment-tools"></div><div class="clear"></div><div id="comment-25520-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</hr>

</div>

</div>

