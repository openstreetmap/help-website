+++
type = "question"
title = "throughput burst when wireshark enabled"
description = '''Hi! We&#x27;ve faced an interesting issue. When wireshark (or tcpdump) is enabled we see a bust of throughput measured by iperf. hostA ---- Linux GatewayA --- RouterA ---- L2VPN ---- RouterB ---- Linux GatewayB ---- hostB The link between routers is 100Mb/s, Linux Gateways are crypto gates making an IPse...'''
date = "2013-06-27T05:31:00Z"
lastmod = "2013-07-08T03:54:00Z"
weight = 22401
keywords = [ "throughput" ]
aliases = [ "/questions/22401" ]
osqa_answers = 1
osqa_accepted = false
+++

<div class="headNormal">

# [throughput burst when wireshark enabled](/questions/22401/throughput-burst-when-wireshark-enabled)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-22401-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-22401-score" class="post-score" title="current number of votes">0</div><span id="post-22401-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hi!</p><p>We've faced an interesting issue. When wireshark (or tcpdump) is enabled we see a bust of throughput measured by iperf.</p><p>hostA ---- Linux GatewayA --- RouterA ---- L2VPN ---- RouterB ---- Linux GatewayB ---- hostB</p><p>The link between routers is 100Mb/s, Linux Gateways are crypto gates making an IPsec tunnel, so doing iperf between the end hosts we see 28 Mb/s with Wireshark on end hosts disabled, and 44 Mb/s - with Wireshark enabled. End hosts are Windows machines.</p><p>May be there is some issue with TCP/IP Windows Stack in some possible non optimal packet handling that is "fixed" by enabling Wireshark?<br />
</p><p><img src="https://osqa-ask.wireshark.org/upfiles/pic_1.jpg" alt="alt text" /> <img src="https://osqa-ask.wireshark.org/upfiles/Wireshark_graph_2.jpg" alt="alt text" /></p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-throughput" rel="tag" title="see questions tagged &#39;throughput&#39;">throughput</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 Jun '13, 05:31</strong></p><img src="https://secure.gravatar.com/avatar/cc89db4042baf2210993e9a95b60e387?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="AlAl&#39;s gravatar image" /><p><span>AlAl</span><br />
<span class="score" title="11 reputation points">11</span><span title="1 badges"><span class="badge1">●</span><span class="badgecount">1</span></span><span title="1 badges"><span class="silver">●</span><span class="badgecount">1</span></span><span title="4 badges"><span class="bronze">●</span><span class="badgecount">4</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="AlAl has no accepted answers">0%</span> </br></p></img></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>27 Jun '13, 14:43</strong> </span></p></div></div><div id="comments-container-22401" class="comments-container"><span id="22404"></span><div id="comment-22404" class="comment"><div id="post-22404-score" class="comment-score"></div><div class="comment-text"><p>What do you mean by "wireshark enabled"? Running, or installed.</p><p>If running, are you opening the interfaces in promiscuous mode?</p></div><div id="comment-22404-info" class="comment-info"><span class="comment-age">(27 Jun '13, 06:08)</span> <span class="comment-user userinfo">grahamb ♦</span></div></div><span id="22410"></span><div id="comment-22410" class="comment"><div id="post-22410-score" class="comment-score"></div><div class="comment-text"><p>Yes, running in promiscuous mode on the interface from which iperf is sending (or receiving) traffic</p></div><div id="comment-22410-info" class="comment-info"><span class="comment-age">(27 Jun '13, 08:13)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22421"></span><div id="comment-22421" class="comment"><div id="post-22421-score" class="comment-score"></div><div class="comment-text"><p>Does it also happen if you <em>don't</em> run in promiscuous mode?</p></div><div id="comment-22421-info" class="comment-info"><span class="comment-age">(27 Jun '13, 13:27)</span> <span class="comment-user userinfo">Guy Harris ♦♦</span></div></div><span id="22424"></span><div id="comment-22424" class="comment"><div id="post-22424-score" class="comment-score"></div><div class="comment-text"><p>Do you have Name Resolution enabled? Possibly via external DNS?</p></div><div id="comment-22424-info" class="comment-info"><span class="comment-age">(27 Jun '13, 13:45)</span> <span class="comment-user userinfo">mrEEde2</span></div></div><span id="22425"></span><div id="comment-22425" class="comment"><div id="post-22425-score" class="comment-score"></div><div class="comment-text"><p>It's needed to check, we used Wireshark with default settings, so promiscuous mode was on. I accidently noticed the difference, the main task was to measure IPsec throughput capabilities of the gateways.</p></div><div id="comment-22425-info" class="comment-info"><span class="comment-age">(27 Jun '13, 13:46)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22427"></span><div id="comment-22427" class="comment not_top_scorer"><div id="post-22427-score" class="comment-score"></div><div class="comment-text"><p>no DNS, servers access each other by ip.</p></div><div id="comment-22427-info" class="comment-info"><span class="comment-age">(27 Jun '13, 13:56)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22428"></span><div id="comment-22428" class="comment not_top_scorer"><div id="post-22428-score" class="comment-score"></div><div class="comment-text"><p>does Wireshark show the same throughput as jperf?</p></div><div id="comment-22428-info" class="comment-info"><span class="comment-age">(27 Jun '13, 14:24)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="22429"></span><div id="comment-22429" class="comment not_top_scorer"><div id="post-22429-score" class="comment-score"></div><div class="comment-text"><p>Yes, it does, please see an attached picture</p></div><div id="comment-22429-info" class="comment-info"><span class="comment-age">(27 Jun '13, 14:36)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22440"></span><div id="comment-22440" class="comment not_top_scorer"><div id="post-22440-score" class="comment-score"></div><div class="comment-text"><p>O.K. that's kind of strange. Can you please test with UDP?</p></div><div id="comment-22440-info" class="comment-info"><span class="comment-age">(27 Jun '13, 23:56)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div><span id="22442"></span><div id="comment-22442" class="comment not_top_scorer"><div id="post-22442-score" class="comment-score"></div><div class="comment-text"><p>Yes, tested earlier, it seemed no issue with UDP, speed 60 MB/s with no packet loss (unfortunately now I have no pics regarding that tests)</p></div><div id="comment-22442-info" class="comment-info"><span class="comment-age">(28 Jun '13, 00:27)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22443"></span><div id="comment-22443" class="comment not_top_scorer"><div id="post-22443-score" class="comment-score"></div><div class="comment-text"><p>I'd go and look into the TCP tests and compare values like RWIN etc. and especially look for delayed ACKs of whatever slowing the growth of CWIN when wireshark/tcpdump is not enabled. Might find s.th. there. It would be very interesting if you could upload some tests to cloudshark, first 1000 packets or so - would highly appreciate that and like to take a closer look</p></div><div id="comment-22443-info" class="comment-info"><span class="comment-age">(28 Jun '13, 00:54)</span> <span class="comment-user userinfo">Landi</span></div></div></div><div id="comment-tools-22401" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-22401-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="22444"></span>

<div id="answer-container-22444" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-22444-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-22444-score" class="post-score" title="current number of votes">1</div><span id="post-22444-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><blockquote><p>would highly appreciate that and like to take a closer look</p></blockquote><p>me too.</p><p>Another option: Maybe there is a driver issue with TCP offloading. Maybe (really just <strong>maybe</strong>) the driver enables (or disables) TCP offloading if the interface runs in promiscuous mode, hence only an effect for TCP and not for UDP !?!</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>28 Jun '13, 01:59</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p><span>Kurt Knochner ♦</span><br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span></p></img></div></div><div id="comments-container-22444" class="comments-container"><span id="22449"></span><div id="comment-22449" class="comment"><div id="post-22449-score" class="comment-score"></div><div class="comment-text"><p>Kurt, probably you have pointed me to the solution, we have tried to disable TCP offloading in hosts network drivers (Broadcom Netextreme) and now we have 58 Mb/s between the hosts...</p></div><div id="comment-22449-info" class="comment-info"><span class="comment-age">(28 Jun '13, 03:52)</span> <span class="comment-user userinfo">AlAl</span></div></div><span id="22721"></span><div id="comment-22721" class="comment"><div id="post-22721-score" class="comment-score"></div><div class="comment-text"><p>good.</p><p>PS: I converted my comment to an answer.</p><p>HINT: If a supplied answer resolves your question can you please "accept" it by clicking the checkmark icon next to it. This highlights good answers for the benefit of subsequent users with the same or similar questions.</p></div><div id="comment-22721-info" class="comment-info"><span class="comment-age">(08 Jul '13, 03:54)</span> <span class="comment-user userinfo">Kurt Knochner ♦</span></div></div></div><div id="comment-tools-22444" class="comment-tools"></div><div class="clear"></div><div id="comment-22444-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

