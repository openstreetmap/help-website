+++
type = "question"
title = "Why the Massive Delay for HTTP Client"
description = '''When I apply the filter : ip.addr == 95.1.1.50 &amp;amp;&amp;amp; ip.addr ==95.1.1.104, There is a massive delay shown at packet 2327. I&#x27;m really struggling to get my head around this. Could anyone set me in the right direction? The capture file is at: https://drive.google.com/file/d/0B6vUPsqTPCf8aFRYMGVuZ0...'''
date = "2015-12-17T05:55:00Z"
lastmod = "2015-12-19T09:16:00Z"
weight = 48611
keywords = [ "delay", "client", "http", "long" ]
aliases = [ "/questions/48611" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [Why the Massive Delay for HTTP Client](/questions/48611/why-the-massive-delay-for-http-client)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-48611-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-48611-score" class="post-score" title="current number of votes">0</div><span id="post-48611-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span> <span id="favorite-mark" class="ajax-command favorite-mark" rel="nofollow" title="mark/unmark this question as favorite (click again to cancel)"> </span><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>When I apply the filter : ip.addr == 95.1.1.50 &amp;&amp; ip.addr ==95.1.1.104,</p><p>There is a massive delay shown at packet 2327. I'm really struggling to get my head around this. Could anyone set me in the right direction?</p><p>The capture file is at:</p><p><a href="https://drive.google.com/file/d/0B6vUPsqTPCf8aFRYMGVuZ0dIa28/view?usp=sharing">https://drive.google.com/file/d/0B6vUPsqTPCf8aFRYMGVuZ0dIa28/view?usp=sharing</a></p><p>Many thanks, JW</p></div><div id="question-tags" class="tags-container tags"><span class="post-tag tag-link-delay" rel="tag" title="see questions tagged &#39;delay&#39;">delay</span> <span class="post-tag tag-link-client" rel="tag" title="see questions tagged &#39;client&#39;">client</span> <span class="post-tag tag-link-http" rel="tag" title="see questions tagged &#39;http&#39;">http</span> <span class="post-tag tag-link-long" rel="tag" title="see questions tagged &#39;long&#39;">long</span></div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>17 Dec '15, 05:55</strong></p><img src="https://secure.gravatar.com/avatar/b5939fd3d8d129ff53ff4a8870f6789f?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="joewoody&#39;s gravatar image" /><p><span>joewoody</span><br />
<span class="score" title="6 reputation points">6</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="joewoody has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p><span> edited <strong>17 Dec '15, 09:30</strong> </span></p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p><span>grahamb ♦</span><br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-48611" class="comments-container"><span id="48622"></span><div id="comment-48622" class="comment"><div id="post-48622-score" class="comment-score"></div><div class="comment-text"><p>Here's a capture that represents what we would consider "normal" behaviour using the same filter - ip.addr == 95.1.1.50 &amp;&amp; ip.addr ==95.1.1.104</p><p><a href="https://drive.google.com/file/d/0B6vUPsqTPCf8SmZHMm9Rc2ZEYWM/view?usp=sharing">https://drive.google.com/file/d/0B6vUPsqTPCf8SmZHMm9Rc2ZEYWM/view?usp=sharing</a></p><p>In this instance, the application loads up resonably quickly. However, we have a server at .87. When we turn this server off this is when we see the massive delays as in the original capture file. Spinning this server back up returns us to normality. Now, there's nothing in the captures to suggest the server at .87 is involved in any way at all. I've captured at the client (.50), appserver (.104) and also the server at .87. As I've said - with the server at .87 turned on, behaviour is normal.</p><p>However, with this server turned off and the proxy turned off in the client browser - the application loads normally.</p><p>With the server off and the proxy ON in the client browser - this consistently produces a 80-90 second delay in the loading of the application. The proxy server is at .88. Again, and I'm relatively new to this, there's nothing untoward showing in the captures. It appears that the proxy server is somehow interfering - but I can't think why!</p><p>Thanks, JW</p></div><div id="comment-48622-info" class="comment-info"><span class="comment-age">(17 Dec '15, 14:07)</span> <span class="comment-user userinfo">joewoody</span></div></div></div><div id="comment-tools-48611" class="comment-tools"></div><div class="clear"></div><div id="comment-48611-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="48613"></span>

<div id="answer-container-48613" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-48613-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-48613-score" class="post-score" title="current number of votes">0</div><span id="post-48613-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>You have to look for the answer at the application level, as everything looks just fine at TCP level.</p><p>Frame 2327 contains an initial packet establishing a new TCP session towards 95.1.1.104:8888 (as it contains a SYN flag), and the previous session from the same client has been closed in a normal (i.e. not emergency) way.</p><p>What is unusual is that it was the server (.104) who has initiated the closure by sending a FIN flag, quite soon after the session has been used for the last time (in particular, to transport the 304 response to the GET). This might possibly be explained by existence of a very aggressive firewall in the path, which would terminate idle TCP sessions after 5 seconds of inactivity.</p><p>It can also be seen that the machine running the client application opens a new session for each request instead of reusing an already existing one, as sessions from two different tcp ports of that machine overlap in time. But this may be because two different instances of the client application are running there, or because there is actually a private subnet with several machines which is NATed to 95.1.1.50. In short, not enough information about the network topology to explain these induced questions.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Dec '15, 07:17</strong></p><img src="https://secure.gravatar.com/avatar/00fc6e2633725bd871ff636f0175eabc?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="sindy&#39;s gravatar image" /><p><span>sindy</span><br />
<span class="score" title="6049 reputation points"><span>6.0k</span></span><span title="4 badges"><span class="badge1">●</span><span class="badgecount">4</span></span><span title="8 badges"><span class="silver">●</span><span class="badgecount">8</span></span><span title="51 badges"><span class="bronze">●</span><span class="badgecount">51</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="sindy has 110 accepted answers">24%</span></p></div></div><div id="comments-container-48613" class="comments-container"><span id="48639"></span><div id="comment-48639" class="comment"><div id="post-48639-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Now, there's nothing in the captures to suggest the server at .87 is involved in any way at all.</p></blockquote><p>I dare to disagree with this statement. When you apply a display filter <code>(ip.addr == 95.1.1.50 and ip.addr == 95.1.1.104) or arp.src.proto_ipv4 == 95.1.1.50</code> on your first capture (...withoutDC...), you can see that 95.1.1.50 desperately needs to send something to 95.1.1.87 (probably a request for some data as well). The .50 starts sending arp requests asking for .87's MAC - first of them is in frame 885, and most of all arp requests the .50 has been sending since getting the 304 response to its <code>GET /forms/java/frmall.jar</code> until sending its <code>GET /forms/java/plumbsicons.jar</code> were for the .87. On the contrary, it is true that in your other capture (...withDC...), there is no exchange between 95.1.1.50 and 95.1.1.87 at all.</p><p>So as said, I would concentrate at the application level. I suppose that the .50 needs some information from the .87 to be able to send the <code>GET /forms/java/plumbsicons.jar</code> to .104, but when the .87 is running, it gets that information sooner than you start the capture. So if the .87 is down, the .50 spends the time between the GET requests attempting to obtain that information, and sends the <code>GET /forms/java/plumbsicons.jar</code> only after these attempts have timed out.</p><p>It should help your understanding a lot to know what kind of information the .50 needs from the .87. To learn that, you have to capture the .50's exchange with both the .87 and the .104 right from .50's boot. This means that the capture should be taken</p><ul><li><p>either at the .87 and .104 simultaneously,</p></li><li><p>or using another machine and a monitoring port of a switch (or a tap) "at the .50's cable".</p></li></ul><p>The reason is that as we don't know any details yet, we must assume that the exchange between .50 and .87 may take place already before you would be able to run the Wireshark capture on the .50 itself.</p></div><div id="comment-48639-info" class="comment-info"><span class="comment-age">(19 Dec '15, 09:16)</span> <span class="comment-user userinfo">sindy</span></div></div></div><div id="comment-tools-48613" class="comment-tools"></div><div class="clear"></div><div id="comment-48613-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="48615"></span>

<div id="answer-container-48615" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><span id="post-48615-upvote" class="ajax-command post-vote up" rel="nofollow" title="I like this post (click again to cancel)"> </span><div id="post-48615-score" class="post-score" title="current number of votes">0</div><span id="post-48615-downvote" class="ajax-command post-vote down" rel="nofollow" title="I dont like this post (click again to cancel)"> </span></div></td><td><div class="item-right"><div class="answer-body"><p>I am suspecting that you are proxying your application to an intermediate devices so that you can analyse the request and response that is being passed between the client and server. Here is a few things that I see from the packet capture,</p><ol><li>.50 is a client &amp; .104 is the server<br />
</li><li>Capture is taken from the client .50</li><li>Tcp being closed by the server after 5 secs of inactivity. The idle-timeout looks to be the HTTP keepalive timer.</li></ol><p><img src="https://osqa-ask.wireshark.org/upfiles/temp.png" alt="alt text" /></p><ol><li>From the latency point of view, these test was done from a LAN setup.</li><li>I'd suggest that you take two captures (one at the client and another at the server side). This is to make sure that the Acknowledgement that the client sent in fact reached the server.</li><li>You will need to know what is expected flow of request &amp; response behavior of this application. Is it that the application server is still processing data while the timer has just timed out? Or, all the expected response is already sent back to the client and the next request didn't go out in a timely manner from the client? What is expected after packet 4561 (after the HTTP 200 is completed -sent by the server)?<br />
</li></ol></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>17 Dec '15, 09:38</strong></p><img src="https://secure.gravatar.com/avatar/c1ab41a3eb718abcabc86051c1bcd165?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="hunghoong&#39;s gravatar image" /><p><span>hunghoong</span><br />
<span class="score" title="11 reputation points">11</span><span title="3 badges"><span class="bronze">●</span><span class="badgecount">3</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="hunghoong has no accepted answers">0%</span> </br></br></p></img></div></div><div id="comments-container-48615" class="comments-container"></div><div id="comment-tools-48615" class="comment-tools"></div><div class="clear"></div><div id="comment-48615-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

