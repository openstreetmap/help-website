+++
type = "question"
title = "How to spoof packets / send fake certificates?"
description = '''Just for the curiosity really. I am sure you can send http requests from a computer. How can I do that? Let&#x27;s say I visit google.com from my smartphone, it automatically returns https version instead of http. Is it possible that when my laptop sees that my smartphone uses https somehow, it would sen...'''
date = "2014-05-02T10:55:00Z"
lastmod = "2014-05-03T02:24:00Z"
weight = 32431
keywords = [ "security" ]
aliases = [ "/questions/32431" ]
osqa_answers = 2
osqa_accepted = false
+++

<div class="headNormal">

# [How to spoof packets / send fake certificates?](/questions/32431/how-to-spoof-packets-send-fake-certificates)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-32431-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count">1</div></div></td><td><div id="item-right"><div class="question-body"><p>Just for the curiosity really. I am sure you can send http requests from a computer. How can I do that?</p><p>Let's say I visit google.com from my smartphone, it automatically returns https version instead of http. Is it possible that when my laptop sees that my smartphone uses https somehow, it would send a fake certificate or something, and if smartphone accepts that, there would no longer be a secure connection between google and smartphone?</p></div><div id="question-tags" class="tags-container tags">security</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>02 May '14, 10:55</strong></p><img src="https://secure.gravatar.com/avatar/eeca75356089d0569c63dfc514d7f19d?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="tttttttttttt2&#39;s gravatar image" /><p>tttttttttttt2<br />
<span class="score" title="34 reputation points">34</span><span title="7 badges"><span class="badge1">●</span><span class="badgecount">7</span></span><span title="9 badges"><span class="silver">●</span><span class="badgecount">9</span></span><span title="12 badges"><span class="bronze">●</span><span class="badgecount">12</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="tttttttttttt2 has no accepted answers">0%</span></p></div></div><div id="comments-container-32431" class="comments-container"></div><div id="comment-tools-32431" class="comment-tools"></div><div class="clear"></div><div id="comment-32431-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

2 Answers:

</div>

</div>

<span id="32445"></span>

<div id="answer-container-32445" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-32445-score" class="post-score" title="current number of votes">1</div></div></td><td><div class="item-right"><div class="answer-body"><p>As @Jasper mentioned, you can do a SSL man in the middle attack. Besides the tools he mentioned, there are some other interesting tools for Linux to intercept HTTPS connections and send fake certs.</p><blockquote><p><a href="http://mitmproxy.org/">http://mitmproxy.org/</a><br />
<a href="http://honeyproxy.org/">http://honeyproxy.org/</a><br />
</p></blockquote><p>Furthermore you can try to 'downgrade' https to http. This will work well in some cases (especially SSL secured form based authentication) and it won't work in other cases (if the server requires SSL and it won't accept HTTP anymore).</p><blockquote><p><a href="http://wroot.org/posts/downgrade-https-connections-to-http-using-ettercap-filters/">http://wroot.org/posts/downgrade-https-connections-to-http-using-ettercap-filters/</a><br />
</p></blockquote><p>Finally you could also try to play HTTP-to-HTTPS proxy. If your client tries to access a site with HTTP, and if the server sends a redirect to the HTTPS URL, you could intercept that redirect (with a MIM) and then simply talk HTTPS to the server and HTTP to the client. In that case you even don't have to fake cert. Neither of them will realize you are in between. Take a look at the 'Reverse proxy mode' of <a href="http://mitmproxy.org/">mitmproxy</a> (mentioned above) or <a href="http://www.thoughtcrime.org/software/sslstrip/">sslstrip</a>.</p><p>Regards<br />
Kurt</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>03 May '14, 02:24</strong></p><img src="https://secure.gravatar.com/avatar/23b7bf5b13bc2c98b2e8aa9869ca5d75?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Kurt%20Knochner&#39;s gravatar image" /><p>Kurt Knochner ♦<br />
<span class="score" title="24767 reputation points"><span>24.8k</span></span><span title="10 badges"><span class="badge1">●</span><span class="badgecount">10</span></span><span title="39 badges"><span class="silver">●</span><span class="badgecount">39</span></span><span title="237 badges"><span class="bronze">●</span><span class="badgecount">237</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Kurt Knochner has 344 accepted answers">15%</span> </br></br></p></div><div class="post-update-info post-update-info-edited"><p>edited 04 May '14, 08:38</p></div></div><div id="comments-container-32445" class="comments-container"><span id="32449"></span><div id="comment-32449" class="comment"><div id="post-32449-score" class="comment-score"></div><div class="comment-text"><p>@KurtKnocher What if the network is protected by wpa/wpa2 and a preshared key (which I have)? Will this software work?</p></div><div id="comment-32449-info" class="comment-info"><span class="comment-age">(03 May '14, 06:07)</span> tttttttttttt2</div></div><span id="32457"></span><div id="comment-32457" class="comment"><div id="post-32457-score" class="comment-score"></div><div class="comment-text"><p>Yes it will. WPA2 will not protect against these kinds of attacks between two clients in the same wireless LAN.</p></div><div id="comment-32457-info" class="comment-info"><span class="comment-age">(03 May '14, 15:42)</span> Quadratic</div></div><span id="32482"></span><div id="comment-32482" class="comment"><div id="post-32482-score" class="comment-score"></div><div class="comment-text"><p>@KurtKnocher: " If your client tries to access a site with HTTP, and if the server sends a redirect to the HTTPS URL, you could intercept that redirect (with a MIM) and then simply talk HTTPS to the server and HTTP to the client" - I made that work. But what if client tries to access https website? Why doesn't it redirect to http? What could I do to make it redirect?</p></div><div id="comment-32482-info" class="comment-info"><span class="comment-age">(04 May '14, 08:49)</span> tttttttttttt2</div></div><span id="32485"></span><div id="comment-32485" class="comment"><div id="post-32485-score" class="comment-score">1</div><div class="comment-text"><blockquote><p>But what if client tries to access https website?</p></blockquote><p>Then it does not work (one of the cases I mentioned above), because in that case the client expects to receive <strong>valid</strong> from the target server. <strong>Valid</strong> means, a cert signed by one of the CA certs the client knows (usually built into the OS and/or client software).</p><blockquote><p>Why doesn't it redirect to http?</p></blockquote><p>Because you can't. The connection between the client and the server is encrypted and the client won't accept a simple <strong>HTTP</strong> redirect for this <strong>encrypted HTTPS</strong> connection.</p><blockquote><p>What could I do to make it redirect?</p></blockquote><p><strong>Nothing</strong>, as that's not possible without <strong>intercepting</strong> the SSL connection (means doing a mitm attack) by sending a fake cert to the client, which will pop-up a warning in the client, as the cert is signed by a CA that is unknown the the client.</p><p>That's a major part of the SSL/TLS security story/concept!!</p><p>If you could subvert that in any way, SSL/TLS would be totally pointless ;-))</p><p><strong>However</strong> there have been implementation bugs in SSL/TLS that <strong>did allow</strong> bad things. Just search for 'ssl vulnerabilities' in your preferred search engine.</p></div><div id="comment-32485-info" class="comment-info"><span class="comment-age">(04 May '14, 09:09)</span> Kurt Knochner ♦</div></div><span id="32487"></span><div id="comment-32487" class="comment"><div id="post-32487-score" class="comment-score"></div><div class="comment-text"><p>@KurtKnochner: Thank you so much. What about sending fake certificates? I am trying ettercap and it works if client accepts bad certificate, however, it shows only form submissions, but I want to see all the traffic (for example what if user is already logged in). I think it really should be possible with a fake certificate, but I can't figure out how.</p></div><div id="comment-32487-info" class="comment-info"><span class="comment-age">(04 May '14, 09:18)</span> tttttttttttt2</div></div><span id="32488"></span><div id="comment-32488" class="comment not_top_scorer"><div id="post-32488-score" class="comment-score"></div><div class="comment-text"><p>My guess is to use etter.ssl.crt in wireshark somehow, because that is a certificate client accepts. What do you think?</p></div><div id="comment-32488-info" class="comment-info"><span class="comment-age">(04 May '14, 09:22)</span> tttttttttttt2</div></div><span id="32489"></span><div id="comment-32489" class="comment not_top_scorer"><div id="post-32489-score" class="comment-score"></div><div class="comment-text"><blockquote><p>I think it really should be possible with a fake certificate, but I can't figure out how.</p></blockquote><p>Yes, that's possible, but kind of beyond the socpe of this site (ask <strong>Wireshark</strong> related questions).</p><p>Please take a look at the docs of mitmproxy or search for 'mitmproxy tutorial'. That should bring up the necessary information.</p></div><div id="comment-32489-info" class="comment-info"><span class="comment-age">(04 May '14, 09:22)</span> Kurt Knochner ♦</div></div><span id="32490"></span><div id="comment-32490" class="comment not_top_scorer"><div id="post-32490-score" class="comment-score"></div><div class="comment-text"><p>@KurtKnochner: I think it could be related to wireshark? Because etter.ssl.crt is a certificate that client accepts and maybe it's possible to use it in wireshark, then it could decrypt ssl traffic (just my guesses).</p></div><div id="comment-32490-info" class="comment-info"><span class="comment-age">(04 May '14, 09:23)</span> tttttttttttt2</div></div><span id="32491"></span><div id="comment-32491" class="comment not_top_scorer"><div id="post-32491-score" class="comment-score"></div><div class="comment-text"><p>Also, for mitmproxy it seems ssl certificate has to be installed in the device first.</p></div><div id="comment-32491-info" class="comment-info"><span class="comment-age">(04 May '14, 09:44)</span> tttttttttttt2</div></div><span id="32495"></span><div id="comment-32495" class="comment not_top_scorer"><div id="post-32495-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Also, for mitmproxy it seems <strong>ssl certificate has to be installed in the device first</strong>.</p></blockquote><p>Sure!</p><p>And that's the same for <strong>all SSL interception solutions</strong>!! You'll have to add the CA cert that issues the fake certs to the <strong>trusted issuer certificate store</strong> of the client, otherwise the client will warn the user about the fake cert. If you issue self signed certs, you will have to add them to the cert store, instead of the <strong>interception CA cert</strong>.</p><p>As I said: That's a fundamental part of the SSL/TLS security. If you could subvert that with any way, using SSL/TLS would be totally pointless!!</p><p>Please read more about how SSL/TLS works (google it), as some aspects of SSL interception will be much clearer for you then.</p><p>Maybe, the following paper helps to better understand SSL interception and what's possible and what not</p><blockquote><p><a href="https://media.blackhat.com/bh-eu-12/Jarmoc/bh-eu-12-Jarmoc-SSL_TLS_Interception-Slides.pdf">https://media.blackhat.com/bh-eu-12/Jarmoc/bh-eu-12-Jarmoc-SSL_TLS_Interception-Slides.pdf</a></p></blockquote></div><div id="comment-32495-info" class="comment-info"><span class="comment-age">(04 May '14, 10:47)</span> Kurt Knochner ♦</div></div><span id="32498"></span><div id="comment-32498" class="comment not_top_scorer"><div id="post-32498-score" class="comment-score"></div><div class="comment-text"><p>I understand that client will be warned, that's fine by me.</p></div><div id="comment-32498-info" class="comment-info"><span class="comment-age">(04 May '14, 11:04)</span> tttttttttttt2</div></div><span id="32499"></span><div id="comment-32499" class="comment not_top_scorer"><div id="post-32499-score" class="comment-score"></div><div class="comment-text"><p>Also, what if user is logged in, I want him to be logged out or accept a new certificate. Again, I understand that the client will have to accept this fake certificate and he'll be warned.</p></div><div id="comment-32499-info" class="comment-info"><span class="comment-age">(04 May '14, 11:06)</span> tttttttttttt2</div></div><span id="32500"></span><div id="comment-32500" class="comment not_top_scorer"><div id="post-32500-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Also, what if user is logged in, I want him to be logged out or accept a new certificate</p></blockquote><p>it does not make a difference if the client is <strong>logged in</strong> or not (at the application on the target server).</p><p>All that matters is, if you are able to force the client to establish a <strong>new SSL/TLS session</strong>. Only then you will be able to intercept the handshake and send back the fake cert. So, if the client has already established a TLS connection, you can try to RESET the TCP connection (send a faked TCP RESET).</p><p>BTW: Wireshark won't be able to send that TCP RESET. Please google other tools that can do it.</p><p>BTW#2: While this is an interesting discussion (and I'm willing to continue it for a while), it kind of gets 'out of control' regarding the purpose of this site (<strong>Wireshark</strong> questions and answers). Maybe you're better off asking these kind of questions in another site/forum, like the Kali Linux Forum ;-))</p></div><div id="comment-32500-info" class="comment-info"><span class="comment-age">(04 May '14, 11:12)</span> Kurt Knochner ♦</div></div><span id="32504"></span><div id="comment-32504" class="comment not_top_scorer"><div id="post-32504-score" class="comment-score"></div><div class="comment-text"><p>Thank you Kurt :) I posted a question there. Basically I just have 2 questions remaining: how to use a certificate that is applied in victim's browser from ettercap in wireshark and how to send a tcp reset.</p></div><div id="comment-32504-info" class="comment-info"><span class="comment-age">(04 May '14, 12:19)</span> tttttttttttt2</div></div><span id="32507"></span><div id="comment-32507" class="comment not_top_scorer"><div id="post-32507-score" class="comment-score"></div><div class="comment-text"><p>Strangely I can't find how to sent tcp rst request... :/</p></div><div id="comment-32507-info" class="comment-info"><span class="comment-age">(04 May '14, 14:06)</span> tttttttttttt2</div></div><span id="32510"></span><div id="comment-32510" class="comment not_top_scorer"><div id="post-32510-score" class="comment-score"></div><div class="comment-text"><p>hm....</p><blockquote><p><a href="https://www.google.com/?q=linux+send+tcp+reset">https://www.google.com/?q=linux+send+tcp+reset</a></p></blockquote><p>and tcpkill</p><blockquote><p><a href="http://en.m.wikipedia.org/wiki/Tcpkill">http://en.m.wikipedia.org/wiki/Tcpkill</a></p></blockquote></div><div id="comment-32510-info" class="comment-info"><span class="comment-age">(04 May '14, 15:45)</span> Kurt Knochner ♦</div></div><span id="32515"></span><div id="comment-32515" class="comment not_top_scorer"><div id="post-32515-score" class="comment-score"></div><div class="comment-text"><p>Oh, and ettercap stops working after an hour or so... :| Also, why ip_forward is not set 1 by default at all times? Damn it, I know so little and I wish I had a job related to cyber security or something like that.</p></div><div id="comment-32515-info" class="comment-info"><span class="comment-age">(04 May '14, 17:21)</span> tttttttttttt2</div></div><span id="32516"></span><div id="comment-32516" class="comment not_top_scorer"><div id="post-32516-score" class="comment-score"></div><div class="comment-text"><p>btw, using ettercap+sslstrip means that sslstrip will try to use http if client requested it (https will be between my pc and server then), and if it's not possible, ettercap will be used by sending a fake cert that user has to accept, right?</p></div><div id="comment-32516-info" class="comment-info"><span class="comment-age">(04 May '14, 17:30)</span> tttttttttttt2</div></div><span id="32534"></span><div id="comment-32534" class="comment not_top_scorer"><div id="post-32534-score" class="comment-score"></div><div class="comment-text"><p>I made it all work, I've figured out how to apply ethercap certificate in wireshark and it shows decrypted ssl traffic. Finally. :) Is it possible to dump packets to file with ethercap -w file only of particular ip? Kali linux doesn't approve my question for some reason...</p></div><div id="comment-32534-info" class="comment-info"><span class="comment-age">(05 May '14, 05:41)</span> tttttttttttt2</div></div></div><div id="comment-tools-32445" class="comment-tools"><span class="comments-showing"> showing 5 of 19 </span> <a href="#" class="show-all-comments-link">show 14 more comments</a></div><div class="clear"></div><div id="comment-32445-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<span id="32433"></span>

<div id="answer-container-32433" class="answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-32433-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>No, because the fake certificate would be invalid and the user gets a big red warning (otherwise there would be no point in using certificates if they could be falsified). But if you can get the guy using the smartphone to accept bad certificates you could. Easiest way to do this is to use a proxy, like <a href="http://www.portswigger.net/burp/">Burp</a> or <a href="http://www.telerik.com/fiddler">Fiddler</a>.</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>02 May '14, 11:32</strong></p><img src="https://secure.gravatar.com/avatar/c578ba2967741f25aebd6afef702f432?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Jasper&#39;s gravatar image" /><p>Jasper ♦♦<br />
<span class="score" title="23806 reputation points"><span>23.8k</span></span><span title="5 badges"><span class="badge1">●</span><span class="badgecount">5</span></span><span title="51 badges"><span class="silver">●</span><span class="badgecount">51</span></span><span title="284 badges"><span class="bronze">●</span><span class="badgecount">284</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Jasper has 263 accepted answers">18%</span> </br></br></p></div></div><div id="comments-container-32433" class="comments-container"><span id="32440"></span><div id="comment-32440" class="comment"><div id="post-32440-score" class="comment-score"></div><div class="comment-text"><p>Anything on Linux?</p></div><div id="comment-32440-info" class="comment-info"><span class="comment-age">(02 May '14, 15:17)</span> tttttttttttt2</div></div><span id="32444"></span><div id="comment-32444" class="comment"><div id="post-32444-score" class="comment-score"></div><div class="comment-text"><p>Burp works on all plattforms.</p></div><div id="comment-32444-info" class="comment-info"><span class="comment-age">(02 May '14, 17:47)</span> Jasper ♦♦</div></div><span id="32451"></span><div id="comment-32451" class="comment"><div id="post-32451-score" class="comment-score"></div><div class="comment-text"><p>Also, shouldn't ARP poisoning be enough? Why use Burp?</p></div><div id="comment-32451-info" class="comment-info"><span class="comment-age">(03 May '14, 07:22)</span> tttttttttttt2</div></div><span id="32452"></span><div id="comment-32452" class="comment"><div id="post-32452-score" class="comment-score"></div><div class="comment-text"><p>Also, what if I change my MAC address on laptop to the same as Smartphone's MAC, will I then be able to see HTTPS requests' content in wireshark? I think it makes sense if both smartphone and laptop are on the same network.</p></div><div id="comment-32452-info" class="comment-info"><span class="comment-age">(03 May '14, 07:27)</span> tttttttttttt2</div></div><span id="32520"></span><div id="comment-32520" class="comment"><div id="post-32520-score" class="comment-score"></div><div class="comment-text"><p>ARP poisoning only forces the packets to use your node as "gateway" on a layer2/3 basis. You cannot modify or exchange certificates on those layers, you need some software to do that. Which is where the proxies or MITM tools come in.</p><p>If you create a duplicate MAC on the network you might actually see some of the packets, yes, but that is not a predictable or stable way to do things. You'll most likely confuse your switch by telling it that the same destination exists in two physical locations, which will lead to MAC address flapping (which is not good).</p></div><div id="comment-32520-info" class="comment-info"><span class="comment-age">(04 May '14, 20:26)</span> Jasper ♦♦</div></div></div><div id="comment-tools-32433" class="comment-tools"></div><div class="clear"></div><div id="comment-32433-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

