+++
type = "question"
title = "Bug GSM SMS failed assertion g_utf8_validate using Tshark"
description = '''Hello to all, I&#x27;m using tshark to filter a pcap file using to a csv file output. I&#x27;m using a display filter for sccp that works just fine and without any error in GUI of Wireshark, but using the same filter in command line with tshark I get several errors like below. Is there a way to fix this? disp...'''
date = "2015-11-27T11:52:00Z"
lastmod = "2015-11-27T12:09:00Z"
weight = 48032
keywords = [ "diplayfilter", "gsm_sms", "tsharkbug" ]
aliases = [ "/questions/48032" ]
osqa_answers = 0
osqa_accepted = true
+++

<div class="headNormal">

# [Bug GSM SMS failed assertion g\_utf8\_validate using Tshark](/questions/48032/bug-gsm-sms-failed-assertion-g_utf8_validate-using-tshark)

</div>

<div id="main-body">

<div id="askform">

<table id="question-table" style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-48032-score" class="post-score" title="current number of votes">0</div><div id="favorite-count" class="favorite-count"></div></div></td><td><div id="item-right"><div class="question-body"><p>Hello to all,</p><p>I'm using tshark to filter a pcap file using to a csv file output. I'm using a display filter for sccp that works just fine and without any error in GUI of Wireshark, but using the same filter in command line with tshark I get several errors like below. Is there a way to fix this?</p><p>display filter expression used: sccp.called.digits matches "123456"</p><p>Thanks for any help</p><pre><code>** (tshark.exe:112236): WARNING **: Dissector bug, protocol GSM SMS, in packet 213753: proto.c:2990: failed assertion &quot;g_utf8_validate(value, -1, ((void *)0))&quot;

** (tshark.exe:109572): WARNING **: Dissector bug, protocol GSM SMS, in packet 217919: proto.c:2990: failed assertion &quot;g_utf8_validate(value, -1, ((void *)0))&quot;

** (tshark.exe:109572): WARNING **: Dissector bug, protocol GSM SMS, in packet 223736: proto.c:2990: failed assertion &quot;g_utf8_validate(value, -1, ((void *)0))&quot;

** (tshark.exe:113252): WARNING **: Dissector bug, protocol GSM SMS, in packet 21200: proto.c:2990: failed assertion &quot;g_utf8_validate(value, -1, ((void *)0))&quot;

** (tshark.exe:113252): WARNING **: Dissector bug, protocol GSM SMS, in packet 202122: proto.c:2990: failed assertion &quot;g_utf8_validate(value, -1, ((void *)0))&quot;</code></pre></div><div id="question-tags" class="tags-container tags">diplayfilter gsm_sms tsharkbug</div><div id="question-controls" class="post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>asked <strong>27 Nov '15, 11:52</strong></p><img src="https://secure.gravatar.com/avatar/11103cc9b10ea69c717d91c7337e93fb?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="cgkmal&#39;s gravatar image" /><p>cgkmal<br />
<span class="score" title="11 reputation points">11</span><span title="2 badges"><span class="badge1">●</span><span class="badgecount">2</span></span><span title="2 badges"><span class="silver">●</span><span class="badgecount">2</span></span><span title="6 badges"><span class="bronze">●</span><span class="badgecount">6</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="cgkmal has no accepted answers">0%</span></p></div><div class="post-update-info post-update-info-edited"><p>edited 06 Apr '17, 07:13</p><img src="https://secure.gravatar.com/avatar/d2a7e24ca66604c749c7c88c1da8ff78?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="grahamb&#39;s gravatar image" /><p>grahamb ♦<br />
<span class="score" title="19834 reputation points"><span>19.8k</span></span><span title="3 badges"><span class="badge1">●</span><span class="badgecount">3</span></span><span title="30 badges"><span class="silver">●</span><span class="badgecount">30</span></span><span title="206 badges"><span class="bronze">●</span><span class="badgecount">206</span></span></p></div></div><div id="comments-container-48032" class="comments-container"><span id="48035"></span><div id="comment-48035" class="comment"><div id="post-48035-score" class="comment-score"></div><div class="comment-text"><p>Hi @cgkmal, could you share a pcap file which would contain one MAP packet with SMS payload and one without (File -&gt; Export specified packets -&gt; Captured packets -&gt; Range: x, y)?</p><p>If you do not need the SMS contents, a workaround for you should be to disable the gsm_sms dissector. To do so, you have to go, in GUI Wireshark, to Analyze -&gt; Enabled protocols, uncheck GSM SMS, press OK and exit Wireshark. The preference is saved to the default profile which tshark uses as well.</p></div><div id="comment-48035-info" class="comment-info"><span class="comment-age">(27 Nov '15, 14:02)</span> sindy</div></div></div><div id="comment-tools-48032" class="comment-tools"></div><div class="clear"></div><div id="comment-48032-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

------------------------------------------------------------------------

<div class="tabBar">

<span id="sort-top"></span>

<div class="headQuestions">

One Answer:

</div>

</div>

<span id="48033"></span>

<div id="answer-container-48033" class="answer accepted-answer">

<table style="width:100%;"><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><tbody><tr class="odd"><td style="width: 30px; vertical-align: top"><div class="vote-buttons"><div id="post-48033-score" class="post-score" title="current number of votes">0</div></div></td><td><div class="item-right"><div class="answer-body"><p>What is the encoding of your SMS? Is it UCS2? Could you please provide the pcap (or open a bug on <a href="https://bugs.wireshark.org">https://bugs.wireshark.org</a>) so that I can have a look at the capture and fix the bug?</p></div><div class="answer-controls post-controls"></div><div class="post-update-info-container"><div class="post-update-info post-update-info-user"><p>answered <strong>27 Nov '15, 12:09</strong></p><img src="https://secure.gravatar.com/avatar/713f24fd877861260b71ecd455018625?s=32&amp;d=identicon&amp;r=g" class="gravatar" width="32" height="32" alt="Pascal%20Quantin&#39;s gravatar image" /><p>Pascal Quantin<br />
<span class="score" title="5544 reputation points"><span>5.5k</span></span><span title="10 badges"><span class="silver">●</span><span class="badgecount">10</span></span><span title="60 badges"><span class="bronze">●</span><span class="badgecount">60</span></span><br />
<span class="accept_rate" title="Rate of the user&#39;s accepted answers">accept rate:</span> <span title="Pascal Quantin has 92 accepted answers">30%</span></p></div></div><div id="comments-container-48033" class="comments-container"><span id="48039"></span><div id="comment-48039" class="comment"><div id="post-48039-score" class="comment-score"></div><div class="comment-text"><p><em>Definitely</em> open a bug on <a href="https://bugs.wireshark.org">the Wireshark Bugzilla</a>, and attach a capture to it if possible.</p></div><div id="comment-48039-info" class="comment-info"><span class="comment-age">(27 Nov '15, 22:28)</span> Guy Harris ♦♦</div></div><span id="48040"></span><div id="comment-48040" class="comment"><div id="post-48040-score" class="comment-score"></div><div class="comment-text"><p>Hi Sindy, Pascal. Thanks for answer. When I filter with tshark a file of aprox 60 MB appear one or two bug errors mentioning the pasket number for the error. Then I export to a small file a few packets containing the packet associated to the bug, but when I run tshark over this small file the bug doesn't appear. I'm not sure why.</p></div><div id="comment-48040-info" class="comment-info"><span class="comment-age">(27 Nov '15, 23:29)</span> cgkmal</div></div><span id="48041"></span><div id="comment-48041" class="comment"><div id="post-48041-score" class="comment-score"></div><div class="comment-text"><p>That means that you have to provide the complete 60 MB file when filing the bug, otherwise the developers would not be able to debug the issue and verify that the fix is working.</p></div><div id="comment-48041-info" class="comment-info"><span class="comment-age">(28 Nov '15, 01:51)</span> sindy</div></div><span id="48048"></span><div id="comment-48048" class="comment"><div id="post-48048-score" class="comment-score"></div><div class="comment-text"><blockquote><p>Then I export to a small file a few packets containing the packet associated to the bug, but when I run tshark over this small file the bug doesn't appear.</p></blockquote><p>When you run tshark over the file, do you do so with the <code>-V</code> command-line flag? If not, it might not do a full dissection (to save CPU time) and might not run into that problem, but if you do so with <code>-V</code>, it has to do a full dissection, and if you use a display filter or read filter, it has to do a full dissection.</p></div><div id="comment-48048-info" class="comment-info"><span class="comment-age">(28 Nov '15, 12:07)</span> Guy Harris ♦♦</div></div><span id="48051"></span><div id="comment-48051" class="comment"><div id="post-48051-score" class="comment-score"></div><div class="comment-text"><p>Hi Guy, I not using -v option. <a href="https://drive.google.com/file/d/0Bw1LxFXOgxPPOUs1aWlkUk9RS0U/view?usp=sharing" title="Here">Here</a> you can find a sample file to test. I've used a display filter expression with -Y option, but to reproduce the bug is not needed any option, it appears just sending</p><pre><code>tshark -r sample.pcap</code></pre><p>with this small file appears a bug with SCTP and SMS packet.</p><p>PS: the SMS format inside shows that is UCS2.</p><p>Thanks for the help.</p></div><div id="comment-48051-info" class="comment-info"><span class="comment-age">(28 Nov '15, 23:54)</span> cgkmal</div></div><span id="48052"></span><div id="comment-48052" class="comment not_top_scorer"><div id="post-48052-score" class="comment-score"></div><div class="comment-text"><p>If you run tshark on the file without <code>-V</code>, the error isn't reported. If you run shark on the file <em>with</em> <code>-V</code>, the error <em>is</em> reported.</p></div><div id="comment-48052-info" class="comment-info"><span class="comment-age">(29 Nov '15, 00:40)</span> Guy Harris ♦♦</div></div><span id="48053"></span><div id="comment-48053" class="comment not_top_scorer"><div id="post-48053-score" class="comment-score"></div><div class="comment-text"><p>Please open a bug on this on <a href="https://bugs.wireshark.org">the Wireshark Bugzilla</a> and attach that capture, so we can track this as a bug. (Among other things, it looks as if we might be incorrectly reassembling the SMS message text from the two fragments.)</p></div><div id="comment-48053-info" class="comment-info"><span class="comment-age">(29 Nov '15, 00:53)</span> Guy Harris ♦♦</div></div><span id="48057"></span><div id="comment-48057" class="comment not_top_scorer"><div id="post-48057-score" class="comment-score"></div><div class="comment-text"><p>I reported the bug here: <a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=11809">https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=11809</a> and pushed a fix here: <a href="https://code.wireshark.org/review/#/c/12288/">https://code.wireshark.org/review/#/c/12288/</a></p><p>Until a version of the fix is available, you can deactivate reassembly of segmented SMS: Edit -&gt; Preferences -&gt; Protocols -&gt; GSM SMS and uncheck "Reassemble fragmented SMS"</p></div><div id="comment-48057-info" class="comment-info"><span class="comment-age">(29 Nov '15, 09:00)</span> Pascal Quantin</div></div><span id="48059"></span><div id="comment-48059" class="comment not_top_scorer"><div id="post-48059-score" class="comment-score"></div><div class="comment-text"><p>The fix will be part of Wireshark 1.12.9 and 2.0.1 once released.</p></div><div id="comment-48059-info" class="comment-info"><span class="comment-age">(29 Nov '15, 11:00)</span> Pascal Quantin</div></div><span id="48089"></span><div id="comment-48089" class="comment not_top_scorer"><div id="post-48089-score" class="comment-score"></div><div class="comment-text"><p>Thank you Pascal/Guy for your support. I understand the issue is for SMS that have more than one part. I deactivated "Reassemble fragmented SMS" and the red line mentioning a bug in GUI dissapeared and the bug print with tshark dissapeared too. Only remains the line reporting a bug in SCTP "failed assertion "fixed_item-&gt;parent == tree" ". Thanks for help to fix and make even better this great software. Regards</p></div><div id="comment-48089-info" class="comment-info"><span class="comment-age">(30 Nov '15, 07:13)</span> cgkmal</div></div><span id="48092"></span><div id="comment-48092" class="comment not_top_scorer"><div id="post-48092-score" class="comment-score"></div><div class="comment-text"><p>Yes there seems to be another bug in SCTP dissector in 1.12.x that is solved in Wireshark 2.0 (this error does not appear with this version).</p><p>If you consider I have solved your issue, please accept the answer for the benefit of other users by clicking the checkmark icon next to the answer. Please read the FAQ for more information.</p></div><div id="comment-48092-info" class="comment-info"><span class="comment-age">(30 Nov '15, 07:40)</span> Pascal Quantin</div></div></div><div id="comment-tools-48033" class="comment-tools"><span class="comments-showing"> showing 5 of 11 </span> <a href="#" class="show-all-comments-link">show 6 more comments</a></div><div class="clear"></div><div id="comment-48033-form-container" class="comment-form-container"></div><div class="clear"></div></div></td></tr></tbody></table>

</div>

<div class="paginator-container-left">

</div>

</div>

</div>

